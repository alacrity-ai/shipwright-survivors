(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function i(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=i(r);fetch(r.href,c)}})();function ob(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Lh={exports:{}},co={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ag;function rb(){if(Ag)return co;Ag=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(n,r,c){var h=null;if(c!==void 0&&(h=""+c),r.key!==void 0&&(h=""+r.key),"key"in r){c={};for(var u in r)u!=="key"&&(c[u]=r[u])}else c=r;return r=c.ref,{$$typeof:a,type:n,key:h,ref:r!==void 0?r:null,props:c}}return co.Fragment=e,co.jsx=i,co.jsxs=i,co}var kg;function lb(){return kg||(kg=1,Lh.exports=rb()),Lh.exports}var pt=lb();function cb(){window.addEventListener("contextmenu",a=>a.preventDefault()),window.addEventListener("dragover",a=>a.preventDefault()),window.addEventListener("drop",a=>a.preventDefault()),window.addEventListener("keydown",a=>{const e=a.target;if(!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable))switch(a.code){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Space":case"Tab":a.preventDefault();break}}),window.addEventListener("mousedown",a=>{a.button===1&&a.preventDefault()})}function Yi(a){if(a.startsWith("cockpit"))return 10;const e=a.match(/(\d{1,2})$/);return e?parseInt(e[1],10):0}function hb(a){if(Yi(a.id)===0){const i=a.id.replace(/\d+$/,"1");return ci(i)}return a}const G=32,du={cockpit0:{id:"cockpit0",name:"Cockpit",armor:20,cost:50,mass:50,behavior:{canFire:!0,isCockpit:!0,fire:{fireRate:.6,fireType:"bullet",fireDamage:4,projectileSpeed:600,lifetime:1.8,accuracy:.3}},sprite:"cockpit0",category:"system",subcategory:"system",dropRate:0},cockpit1:{id:"cockpit1",name:"Cockpit",armor:150,cost:50,mass:50,behavior:{canFire:!0,isCockpit:!0,fire:{fireRate:.8,fireType:"bullet",fireDamage:14,projectileSpeed:800,lifetime:1.8,accuracy:.75}},sprite:"cockpit1",category:"system",subcategory:"system",dropRate:0},hull0:{id:"hull0",name:"Hull Mk 0",armor:15,mass:50,cost:20,sprite:"hull0",category:"system",subcategory:"hull",dropRate:.07},hull1:{id:"hull1",name:"Hull Mk I",armor:50,mass:50,cost:20,sprite:"hull1",category:"hull",subcategory:"hull",dropRate:.05},hull2:{id:"hull2",name:"Hull Mk II",armor:75,mass:60,cost:40,sprite:"hull2",category:"hull",subcategory:"hull",dropRate:.05},hull3:{id:"hull3",name:"Hull Mk III",armor:100,mass:75,cost:80,sprite:"hull3",category:"hull",subcategory:"hull",dropRate:.04},hull4:{id:"hull4",name:"Hull Mk IV",armor:150,mass:90,cost:140,sprite:"hull4",category:"hull",subcategory:"hull",dropRate:.03},facetplate0:{id:"facetplate0",name:"Facetplate Mk 0",armor:20,mass:30,cost:30,sprite:"facetplate0",category:"system",subcategory:"system",behavior:{rammingDamageMultiplier:1.1,rammingArmor:7},dropRate:.05},facetplate1:{id:"facetplate1",name:"Facetplate Mk I",armor:75,mass:30,cost:30,sprite:"facetplate1",category:"hull",subcategory:"facetplate",dropRate:.05,behavior:{rammingDamageMultiplier:1.3,rammingArmor:7}},facetplate2:{id:"facetplate2",name:"Facetplate Mk II",armor:100,mass:40,cost:60,sprite:"facetplate2",category:"hull",subcategory:"facetplate",behavior:{rammingDamageMultiplier:1.5,rammingArmor:12},dropRate:.04},facetplate3:{id:"facetplate3",name:"Facetplate Mk III",armor:125,mass:50,cost:100,sprite:"facetplate3",category:"hull",subcategory:"facetplate",behavior:{rammingDamageMultiplier:1.7,rammingArmor:17},dropRate:.03},facetplate4:{id:"facetplate4",name:"Facetplate Mk IV",armor:175,mass:60,cost:120,sprite:"facetplate4",category:"hull",subcategory:"facetplate",behavior:{rammingDamageMultiplier:2,rammingArmor:22},dropRate:.02},turret0:{id:"turret0",name:"Turret Mk 0",armor:20,cost:40,mass:40,sprite:"turret0",behavior:{canFire:!0,fire:{fireRate:1,fireType:"bullet",fireDamage:2,projectileSpeed:700,lifetime:2.2,accuracy:.5}},category:"system",subcategory:"system",dropRate:.3,placementSound:"assets/sounds/sfx/ship/attach_00.wav"},turret1:{id:"turret1",name:"Turret Mk I",armor:40,cost:40,mass:40,sprite:"turret1",behavior:{canFire:!0,fire:{fireRate:1,fireType:"bullet",fireDamage:10,projectileSpeed:800,lifetime:1.8,accuracy:.65}},category:"weapon",subcategory:"turret",dropRate:.3,placementSound:"assets/sounds/sfx/ship/attach_00.wav"},turret2:{id:"turret2",name:"Turret Mk II",armor:50,cost:100,mass:50,sprite:"turret2",behavior:{canFire:!0,fire:{fireRate:2,fireType:"bullet",fireDamage:16,projectileSpeed:800,lifetime:2.2,accuracy:.75}},category:"weapon",subcategory:"turret",dropRate:.2,placementSound:"assets/sounds/sfx/ship/attach_00.wav"},turret3:{id:"turret3",name:"Turret Mk III",armor:75,cost:200,mass:60,sprite:"turret3",behavior:{canFire:!0,fire:{fireRate:3,fireType:"bullet",fireDamage:20,projectileSpeed:900,lifetime:2.2,accuracy:.9}},category:"weapon",subcategory:"turret",dropRate:.15,placementSound:"assets/sounds/sfx/ship/attach_00.wav"},turret4:{id:"turret4",name:"Turret Mk IV",armor:100,cost:400,mass:100,sprite:"turret4",behavior:{canFire:!0,fire:{fireRate:4,fireType:"bullet",fireDamage:30,projectileSpeed:1e3,lifetime:2.2,accuracy:.95}},category:"weapon",subcategory:"turret",dropRate:.12,placementSound:"assets/sounds/sfx/ship/attach_00.wav"},explosiveLance0:{id:"explosiveLance0",name:"Explosive Lance Mk 0",armor:60,cost:120,mass:80,sprite:"explosiveLance0",category:"system",subcategory:"system",behavior:{canFire:!0,fire:{fireRate:.5,fireType:"explosiveLance",fireDamage:1,explosionDamage:2,explosionRadiusBlocks:3,detonationDelayMs:1500,projectileSpeed:1e3,lifetime:.8,accuracy:.95}},dropRate:.2},explosiveLance1:{id:"explosiveLance1",name:"Explosive Lance Mk I",armor:60,cost:140,mass:80,sprite:"explosiveLance1",category:"weapon",subcategory:"explosiveLance",behavior:{canFire:!0,fire:{fireRate:.5,fireType:"explosiveLance",fireDamage:1,explosionDamage:20,explosionRadiusBlocks:3,detonationDelayMs:1500,projectileSpeed:1600,lifetime:.8,accuracy:.95}},dropRate:.15},explosiveLance2:{id:"explosiveLance2",name:"Explosive Lance Mk II",armor:80,cost:220,mass:90,sprite:"explosiveLance2",category:"weapon",subcategory:"explosiveLance",behavior:{canFire:!0,fire:{fireRate:.6,fireType:"explosiveLance",fireDamage:1,explosionDamage:25,explosionRadiusBlocks:4,detonationDelayMs:1500,projectileSpeed:1600,lifetime:.85,accuracy:.97}},dropRate:.14},explosiveLance3:{id:"explosiveLance3",name:"Explosive Lance Mk III",armor:90,cost:360,mass:110,sprite:"explosiveLance3",category:"weapon",subcategory:"explosiveLance",behavior:{canFire:!0,fire:{fireRate:.7,fireType:"explosiveLance",fireDamage:1,explosionDamage:30,explosionRadiusBlocks:5,detonationDelayMs:1500,projectileSpeed:1600,lifetime:.9,accuracy:.98}},dropRate:.13},explosiveLance4:{id:"explosiveLance4",name:"Explosive Lance Mk IV",armor:100,cost:600,mass:120,sprite:"explosiveLance4",category:"weapon",subcategory:"explosiveLance",behavior:{canFire:!0,fire:{fireRate:.8,fireType:"explosiveLance",fireDamage:1,explosionDamage:40,explosionRadiusBlocks:6,detonationDelayMs:1500,projectileSpeed:1600,lifetime:1,accuracy:.99}},dropRate:.1},laser0:{id:"laser0",name:"Laser Emitter Mk 0",armor:40,cost:500,mass:80,sprite:"laser0",category:"system",subcategory:"system",behavior:{canFire:!0,fire:{fireType:"laser",fireRate:0,energyCost:.15,fireDamage:1,projectileSpeed:0,lifetime:0,accuracy:1}},dropRate:.12},laser1:{id:"laser1",name:"Laser Emitter Mk I",armor:80,cost:500,mass:100,sprite:"laser1",category:"weapon",subcategory:"laser",behavior:{canFire:!0,energyMaxIncrease:60,fire:{fireType:"laser",fireDamage:2,energyCost:.15}},dropRate:.06},laser2:{id:"laser2",name:"Laser Emitter Mk II",armor:100,cost:1e3,mass:160,sprite:"laser2",category:"weapon",subcategory:"laser",behavior:{canFire:!0,energyMaxIncrease:80,fire:{fireType:"laser",fireDamage:3.5,energyCost:.2}},dropRate:.08},laser3:{id:"laser3",name:"Laser Emitter Mk III",armor:100,cost:1800,mass:160,sprite:"laser3",category:"weapon",subcategory:"laser",behavior:{canFire:!0,energyMaxIncrease:100,fire:{fireType:"laser",fireDamage:5,energyCost:.3}},dropRate:.06},reactor0:{id:"reactor0",name:"Reactor Mk 0",armor:25,cost:400,mass:60,behavior:{energyChargeRate:10},sprite:"reactor0",category:"system",subcategory:"system",dropRate:.08},reactor1:{id:"reactor1",name:"Reactor Mk I",armor:50,cost:400,mass:60,behavior:{energyChargeRate:10},sprite:"reactor1",category:"utility",subcategory:"energy",dropRate:.06},reactor2:{id:"reactor2",name:"Reactor Mk II",armor:75,cost:800,mass:80,behavior:{energyChargeRate:20},sprite:"reactor2",category:"utility",subcategory:"energy",dropRate:.03},battery0:{id:"battery0",name:"Battery Mk 0",armor:20,cost:200,mass:40,behavior:{energyMaxIncrease:100},sprite:"battery0",category:"system",subcategory:"system",dropRate:.08},battery1:{id:"battery1",name:"Battery Mk I",armor:30,cost:200,mass:50,behavior:{energyMaxIncrease:50},sprite:"battery1",category:"utility",subcategory:"energy",dropRate:.06},battery2:{id:"battery2",name:"Battery Mk II",armor:40,cost:400,mass:60,behavior:{energyMaxIncrease:100},sprite:"battery2",category:"utility",subcategory:"energy",dropRate:.03},shield0:{id:"shield0",name:"Shield Mk 0",armor:20,cost:200,mass:40,behavior:{shieldEfficiency:.5,shieldRadius:2,energyMaxIncrease:30,shieldEnergyDrain:1},sprite:"shield0",category:"system",subcategory:"system",dropRate:.08},shield1:{id:"shield1",name:"Shield Mk I",armor:60,cost:160,mass:50,behavior:{shieldEfficiency:.65,shieldRadius:2,energyMaxIncrease:30,shieldEnergyDrain:3},sprite:"shield1",category:"utility",subcategory:"shield",dropRate:.08},shield2:{id:"shield2",name:"Shield Mk II",armor:80,cost:300,mass:60,behavior:{shieldEfficiency:.8,shieldRadius:3,energyMaxIncrease:40,shieldEnergyDrain:5},sprite:"shield2",category:"utility",subcategory:"shield",dropRate:.03},shield3:{id:"shield3",name:"Shield Mk III",armor:100,cost:600,mass:70,behavior:{shieldEfficiency:1,shieldRadius:4,energyMaxIncrease:50,shieldEnergyDrain:7},sprite:"shield3",category:"utility",subcategory:"shield",dropRate:.02},engine0:{id:"engine0",name:"Engine Mk 0",armor:15,cost:35,mass:30,behavior:{canThrust:!0,thrustPower:50},sprite:"engine0",category:"system",subcategory:"system",dropRate:.08},engine1:{id:"engine1",name:"Engine Mk I",armor:40,cost:35,mass:30,behavior:{canThrust:!0,thrustPower:50},sprite:"engine1",category:"engine",subcategory:"engine",dropRate:.05},engine2:{id:"engine2",name:"Engine Mk II",armor:45,cost:60,mass:30,behavior:{canThrust:!0,thrustPower:75},sprite:"engine2",category:"engine",subcategory:"engine",dropRate:.08},engine3:{id:"engine3",name:"Engine Mk III",armor:50,cost:80,mass:30,behavior:{canThrust:!0,thrustPower:90},sprite:"engine3",category:"engine",subcategory:"engine",dropRate:.05},engine4:{id:"engine4",name:"Engine Mk IV",armor:55,mass:30,cost:160,behavior:{canThrust:!0,thrustPower:115},sprite:"engine4",category:"engine",subcategory:"engine",dropRate:.04},fin0:{id:"fin0",name:"Fin Mk 0",armor:10,mass:20,cost:30,behavior:{turnPower:.1},sprite:"fin0",category:"system",subcategory:"system",dropRate:.06},fin1:{id:"fin1",name:"Fin Mk II",armor:50,mass:10,cost:40,behavior:{turnPower:.5},sprite:"fin1",category:"hull",subcategory:"fin",dropRate:.06},fin2:{id:"fin2",name:"Fin Mk III",armor:75,mass:10,cost:80,behavior:{turnPower:1},sprite:"fin2",category:"hull",subcategory:"fin",dropRate:.06},fin3:{id:"fin3",name:"Fin Mk IV",armor:90,mass:10,cost:120,behavior:{turnPower:1.5},sprite:"fin3",category:"hull",subcategory:"fin",dropRate:.05},fin4:{id:"fin4",name:"Fin Mk IV",armor:120,mass:10,cost:200,behavior:{turnPower:2},sprite:"fin4",category:"hull",subcategory:"fin",dropRate:.05},harvester0:{id:"harvester0",name:"Resource Harvester Mk 0",armor:50,mass:30,cost:120,behavior:{harvestRate:5},sprite:"harvester0",category:"system",subcategory:"system",dropRate:.1},harvester1:{id:"harvester1",name:"Resource Harvester Mk I",armor:50,mass:30,cost:120,behavior:{harvestRate:3},sprite:"harvester1",category:"utility",subcategory:"exploration",dropRate:.1},harvester2:{id:"harvester2",name:"Resource Harvester Mk II",armor:80,mass:40,cost:200,behavior:{harvestRate:5},sprite:"harvester2",category:"utility",subcategory:"exploration",dropRate:.1},haloBlade0:{id:"haloBlade0",name:"Halo Blade Mk 0",armor:100,mass:80,cost:400,behavior:{haloBladeProperties:{orbitingRadius:500,orbitingSpeed:1.2,size:64,damage:1,color:"#FFBF00",sprite:"energyRing0"}},sprite:"haloBlade0",category:"weapon",subcategory:"haloBlade",dropRate:.1},haloBlade1:{id:"haloBlade1",name:"Halo Blade Mk I",armor:120,mass:80,cost:400,behavior:{haloBladeProperties:{orbitingRadius:500,orbitingSpeed:2,size:64,damage:5,color:"#FFBF00",sprite:"energyRing1"}},sprite:"haloBlade1",category:"weapon",subcategory:"haloBlade",dropRate:.18},haloBlade2:{id:"haloBlade2",name:"Halo Blade Mk II",armor:140,mass:80,cost:600,behavior:{haloBladeProperties:{orbitingRadius:700,orbitingSpeed:2.4,size:64,damage:8,color:"#2CFF05",sprite:"energyRing2"}},sprite:"haloBlade2",category:"weapon",subcategory:"haloBlade",dropRate:.14},haloBlade3:{id:"haloBlade3",name:"Halo Blade Mk III",armor:160,mass:80,cost:900,behavior:{haloBladeProperties:{orbitingRadius:900,orbitingSpeed:2.8,size:64,damage:12,color:"#00FFFF",sprite:"energyRing3"}},sprite:"haloBlade3",category:"weapon",subcategory:"haloBlade",dropRate:.12},haloBlade4:{id:"haloBlade4",name:"Halo Blade Mk IV",armor:180,mass:80,cost:1200,behavior:{haloBladeProperties:{orbitingRadius:1100,orbitingSpeed:3.2,size:64,damage:15,color:"#7F00FF",sprite:"energyRing4"}},sprite:"haloBlade4",category:"weapon",subcategory:"haloBlade",dropRate:.1},fuelTank0:{id:"fuelTank0",name:"Fuel Tank Mk 0",armor:50,cost:50,mass:25,behavior:{fuelCapacityIncrease:20},sprite:"fuelTank0",category:"system",subcategory:"system",dropRate:.08},fuelTank1:{id:"fuelTank1",name:"Fuel Tank Mk I",armor:60,cost:50,mass:25,behavior:{fuelCapacityIncrease:25},sprite:"fuelTank1",category:"utility",subcategory:"fuel",dropRate:.08},fuelTank2:{id:"fuelTank2",name:"Fuel Tank Mk II",armor:70,cost:50,mass:30,behavior:{fuelCapacityIncrease:35},sprite:"fuelTank2",category:"utility",subcategory:"fuel",dropRate:.08},fuelTank3:{id:"fuelTank3",name:"Fuel Tank Mk III",armor:80,cost:50,mass:35,behavior:{fuelCapacityIncrease:50},sprite:"fuelTank3",category:"utility",subcategory:"fuel",dropRate:.08},fuelTank4:{id:"fuelTank4",name:"Fuel Tank Mk IV",armor:90,cost:50,mass:40,behavior:{fuelCapacityIncrease:75},sprite:"fuelTank4",category:"utility",subcategory:"fuel",dropRate:.07}};function So(){return Object.values(du)}function ci(a){return du[a]}function Vp(a){const e=ci(a);return e?e.cost:void 0}function ub(a){return Object.values(du).filter(e=>Yi(e.id)===a)}function Bg(a){return Yi(a.id)}function fb(a,e){const i=a.createTexture();if(!i)throw new Error("Failed to create WebGL texture");return a.bindTexture(a.TEXTURE_2D,i),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null),i}function db(a,e){const i=a.createTexture();if(!i)throw new Error("Failed to create WebGL texture");return a.bindTexture(a.TEXTURE_2D,i),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null),i}function Wi(a,e){const i=a.createTexture();if(!i)throw new Error("Failed to create WebGL texture");return a.bindTexture(a.TEXTURE_2D,i),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null),i}function Or(a,e,i){const n=a.createLinearGradient(0,0,0,e);n.addColorStop(0,i.body[0]),n.addColorStop(.3,i.body[1]),n.addColorStop(.7,i.body[2]),n.addColorStop(1,i.body[3]),a.fillStyle=n,a.fillRect(0,0,e,e),a.fillStyle=i.housing,a.fillRect(2,6,e-4,e-8),a.fillStyle=i.innerHousing,a.fillRect(3,7,e-6,e-10);const r=a.createLinearGradient(0,0,e,0);r.addColorStop(0,i.barrel[0]),r.addColorStop(.5,i.barrel[1]),r.addColorStop(1,i.barrel[2]),a.fillStyle=r,a.fillRect(e/2-3,2,6,e-4),a.fillStyle=i.barrelDetail,a.fillRect(e/2-1,1,2,e-2);const c=a.createRadialGradient(e/2,e-6,0,e/2,e-6,4);c.addColorStop(0,i.glow[0]),c.addColorStop(.7,i.glow[1]),c.addColorStop(1,i.glow[2]),a.fillStyle=c,a.beginPath(),a.arc(e/2,e-6,4,0,Math.PI*2),a.fill();const h=a.createRadialGradient(e/2,2,0,e/2,2,5);h.addColorStop(0,i.muzzleGlow[0]),h.addColorStop(.3,i.muzzleGlow[1]),h.addColorStop(.6,i.muzzleGlow[2]),h.addColorStop(1,i.muzzleGlow[3]),a.fillStyle=h,a.beginPath(),a.arc(e/2,2,5,0,Math.PI*2),a.fill(),a.fillStyle=i.muzzleCore,a.beginPath(),a.arc(e/2,2,1.5,0,Math.PI*2),a.fill()}function Fr(a,e,i){const n=a.createLinearGradient(0,0,0,e);for(const[r,c]of i)n.addColorStop(r,c);a.fillStyle=n,a.fillRect(0,0,e,e)}function Ur(a,e,i){const n=a.createLinearGradient(0,e/2,0,e);for(const[r,c]of i)n.addColorStop(r,c);a.fillStyle=n,a.beginPath(),a.moveTo(e/2,e/2),a.lineTo(0,e),a.lineTo(e,e),a.closePath(),a.fill()}function Nr(a,e,i,n){const r=i/2,c=i/2,h=i*.35,u=a.createRadialGradient(r,c,0,r,c,i/2);n.baseGradientColors.forEach((m,y,v)=>u.addColorStop(y/(v.length-1),m)),a.fillStyle=u,a.fillRect(0,0,i,i);const d=e.createRadialGradient(r,c,0,r,c,h);n.rotatingBaseColors.forEach((m,y,v)=>d.addColorStop(y/(v.length-1),m)),gb(e,r,c,h,d),pb(e,r,c,h);const g=e.createLinearGradient(r-n.barrelWidth/2,0,r+n.barrelWidth/2,0);n.barrelGradientStops.forEach(([m,y])=>g.addColorStop(m,y)),mb(e,r,n.barrelWidth,n.barrelLength,g),yb(e,r)}function gb(a,e,i,n,r){a.fillStyle=r,a.beginPath(),a.arc(e,i,n,0,Math.PI*2),a.fill()}function pb(a,e,i,n){a.strokeStyle="#AAA",a.lineWidth=1,a.beginPath(),a.moveTo(e,i-n*.8),a.lineTo(e,i+n*.8),a.moveTo(e-n*.8,i),a.lineTo(e+n*.8,i),a.stroke()}function mb(a,e,i,n,r){a.fillStyle=r,a.fillRect(e-i/2,0,i,n)}function yb(a,e){a.fillStyle="#ff6666",a.fillRect(e-2,0,4,4)}function Rg(a,e,i){const n=e/2,r=e/2,c=a.createLinearGradient(0,0,0,e);i.chassisStops.forEach(([d,g])=>c.addColorStop(d,g)),a.fillStyle=c,a.fillRect(0,0,e,e);const h=a.createRadialGradient(n,r,i.coreRingInnerRadius,n,r,e/2);i.coreRingStops.forEach(([d,g])=>h.addColorStop(d,g)),a.fillStyle=h,a.beginPath(),a.arc(n,r,e/2,0,Math.PI*2),a.fill();const u=a.createRadialGradient(n,r,0,n,r,i.coreGlowRadius);i.coreGlowStops.forEach(([d,g])=>u.addColorStop(d,g)),a.fillStyle=u,a.beginPath(),a.arc(n,r,i.coreGlowRadius,0,Math.PI*2),a.fill(),a.strokeStyle=i.boltColor,a.lineWidth=1,a.beginPath(),a.moveTo(4,4),a.lineTo(e-4,4),a.moveTo(4,e-4),a.lineTo(e-4,e-4),a.moveTo(4,4),a.lineTo(4,e-4),a.moveTo(e-4,4),a.lineTo(e-4,e-4),a.stroke()}function Hr(a,e,i){const n=a.createLinearGradient(0,0,0,e);i.bodyStops.forEach(([u,d])=>n.addColorStop(u,d)),a.fillStyle=n,a.fillRect(0,0,e,e);const r=i.thrustInsetX??6,c=i.thrustHeight??4,h=i.thrustInsetY??6;a.fillStyle=i.thrustColor,a.fillRect(r,e-h,e-r*2,c)}function Wr(a,e,i){const n=a.createLinearGradient(0,0,e,e);for(const[r,c]of i)n.addColorStop(r,c);a.fillStyle=n,a.beginPath(),a.moveTo(0,e),a.lineTo(e,e),a.lineTo(e,0),a.closePath(),a.fill()}function Eg(a,e,i){const n=e/2,r=e/2,c=a.createLinearGradient(0,0,0,e);((i==null?void 0:i.chassisStops)??[[0,"#222831"],[.5,"#393E46"],[1,"#1E1E2F"]]).forEach(([d,g])=>c.addColorStop(d,g)),a.fillStyle=c,a.fillRect(0,0,e,e);const h=a.createRadialGradient(n,r,0,n,r,(i==null?void 0:i.coreRadius)??e*.4);((i==null?void 0:i.cellGlowStops)??[[0,"#C8E6C9"],[.5,"#81C784"],[1,"rgba(129, 199, 132, 0)"]]).forEach(([d,g])=>h.addColorStop(d,g)),a.fillStyle=h,a.beginPath(),a.arc(n,r,(i==null?void 0:i.coreRadius)??e*.4,0,Math.PI*2),a.fill(),a.fillStyle=(i==null?void 0:i.terminalColor)??"#B0BEC5";const u=(i==null?void 0:i.terminalSize)??3;a.fillRect(n-u/2,2,u,6),a.fillRect(n-u/2,e-8,u,6),a.strokeStyle="#A5D6A7",a.lineWidth=1.2,a.beginPath(),a.arc(n,r,e*.25,0,Math.PI*2),a.stroke()}function Oh(a,e,i){const n=e/2,r=e/2,c=a.createLinearGradient(0,0,0,e);((i==null?void 0:i.chassisStops)??[[0,"#1A1A2E"],[.5,"#16213E"],[1,"#0F3460"]]).forEach(([u,d])=>c.addColorStop(u,d)),a.fillStyle=c,a.fillRect(0,0,e,e);const h=a.createRadialGradient(n,r,0,n,r,(i==null?void 0:i.emitterRadius)??e*.35);((i==null?void 0:i.emitterGlowStops)??[[0,"#BBDEFB"],[.5,"#42A5F5"],[1,"rgba(66, 165, 245, 0)"]]).forEach(([u,d])=>h.addColorStop(u,d)),a.fillStyle=h,a.beginPath(),a.arc(n,r,(i==null?void 0:i.emitterRadius)??e*.35,0,Math.PI*2),a.fill(),a.strokeStyle=(i==null?void 0:i.ringColor)??"#90CAF9",a.lineWidth=1.5,a.beginPath(),a.arc(n,r,e*.38,0,Math.PI*2),a.stroke(),a.fillStyle=(i==null?void 0:i.terminalColor)??"#E3F2FD",a.fillRect(n-1.5,2,3,5),a.fillRect(n-1.5,e-7,3,5),a.fillRect(2,r-1.5,5,3),a.fillRect(e-7,r-1.5,5,3)}function Ig(a,e,i){const n=e/2,r=e/2,c=e*.45,h=a.createLinearGradient(0,0,0,e);((i==null?void 0:i.casingStops)??[[0,"#3E3E3E"],[.5,"#555555"],[1,"#222222"]]).forEach(([d,g])=>h.addColorStop(d,g)),a.fillStyle=h,a.fillRect(0,0,e,e);const u=a.createRadialGradient(n,r,0,n,r,c*.8);u.addColorStop(0,(i==null?void 0:i.vortexColor)??"#66ccff"),u.addColorStop(1,"rgba(102, 204, 255, 0)"),a.fillStyle=u,a.beginPath(),a.arc(n,r,c*.8,0,Math.PI*2),a.fill(),a.fillStyle=(i==null?void 0:i.intakeColor)??"#00B8D4",a.beginPath(),a.arc(n,r,c*.3,0,Math.PI*2),a.fill(),a.strokeStyle=(i==null?void 0:i.ringColor)??"rgba(0, 200, 255, 0.4)",a.lineWidth=1.5;for(let d=1;d<=2;d++)a.beginPath(),a.arc(n,r,c*(.4+.15*d),0,Math.PI*2),a.stroke()}function zr(a,e,i,n){const r=i/2,c=i/2,h=i*.35,u=a.createRadialGradient(r,c,0,r,c,i/2);((n==null?void 0:n.baseGradientColors)??["#222","#444","#111"]).forEach((y,v,M)=>u.addColorStop(v/(M.length-1),y)),a.fillStyle=u,a.fillRect(0,0,i,i);const d=e.createRadialGradient(r,c,0,r,c,h);d.addColorStop(0,"#900"),d.addColorStop(1,"#500"),e.fillStyle=d,e.beginPath(),e.arc(r,c,h,0,Math.PI*2),e.fill(),e.strokeStyle="#f55",e.lineWidth=1,e.beginPath(),e.moveTo(r,c-h*.8),e.lineTo(r,c+h*.8),e.moveTo(r-h*.8,c),e.lineTo(r+h*.8,c),e.stroke();const g=(n==null?void 0:n.barrelLength)??i*.7,m=(n==null?void 0:n.barrelGradientStops)??[[0,"#ffcccb"],[.5,"#ff5555"],[1,"#aa0000"]];bb(e,r,g,m),Sb(e,r,g,m),Mb(e,r,m)}function _g(a,e,i){const n=a.replace("#",""),r=e.replace("#",""),c=parseInt(n.substr(0,2),16),h=parseInt(n.substr(2,2),16),u=parseInt(n.substr(4,2),16),d=parseInt(r.substr(0,2),16),g=parseInt(r.substr(2,2),16),m=parseInt(r.substr(4,2),16),y=Math.round(c+(d-c)*i),v=Math.round(h+(g-h)*i),M=Math.round(u+(m-u)*i);return`#${y.toString(16).padStart(2,"0")}${v.toString(16).padStart(2,"0")}${M.toString(16).padStart(2,"0")}`}function vb(a,e){const i=a.replace("#",""),n=Math.min(255,Math.round(parseInt(i.substr(0,2),16)*(1+e))),r=Math.min(255,Math.round(parseInt(i.substr(2,2),16)*(1+e))),c=Math.min(255,Math.round(parseInt(i.substr(4,2),16)*(1+e)));return`#${n.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}${c.toString(16).padStart(2,"0")}`}function bb(a,e,i,n){var g,m,y;const c=i/4,h=((g=n[0])==null?void 0:g[1])||"#cccccc",u=((m=n[1])==null?void 0:m[1])||"#888888",d=((y=n[2])==null?void 0:y[1])||"#444444";for(let v=0;v<4;v++){const M=v*c,b=v/3,C=8-b*3,w=C-1;let A;b<=.5?A=_g(h,u,b*2):A=_g(u,d,(b-.5)*2),a.fillStyle=A,a.beginPath(),a.moveTo(e-C/2,M),a.lineTo(e+C/2,M),a.lineTo(e+w/2,M+c),a.lineTo(e-w/2,M+c),a.closePath(),a.fill(),v>0&&(a.strokeStyle=vb(d,.3),a.lineWidth=1,a.beginPath(),a.moveTo(e-C/2,M),a.lineTo(e+C/2,M),a.stroke())}}function Sb(a,e,i,n){var u;const r=((u=n[1])==null?void 0:u[1])||"#ffaa00";a.fillStyle=r;const c=6,h=i/(c+1);for(let d=0;d<c;d++){const g=h*(d+1),m=2;a.fillRect(e-6,g-m/2,m,m),a.fillRect(e+4,g-m/2,m,m)}}function Mb(a,e,i){var c,h;const n=((c=i[2])==null?void 0:c[1])||"#ff6600",r=((h=i[0])==null?void 0:h[1])||"#ffff00";a.fillStyle=n,a.beginPath(),a.moveTo(e-3,0),a.lineTo(e+3,0),a.lineTo(e,-4),a.closePath(),a.fill(),a.fillStyle=r,a.beginPath(),a.arc(e,-1,1.5,0,Math.PI*2),a.fill()}function Gr(a,e,i){const n=e/2,r=e/2,c=e*.45,h=c*.2,u=4,d=a.createLinearGradient(0,0,0,e);for(const[m,y]of i.casingStops)d.addColorStop(m,y);a.fillStyle=d,a.fillRect(0,0,e,e);const g=a.createRadialGradient(n,r,0,n,r,c);g.addColorStop(0,i.glowColor),g.addColorStop(1,"rgba(0,0,0,0)"),a.fillStyle=g,a.beginPath(),a.arc(n,r,c,0,Math.PI*2),a.fill(),a.strokeStyle=i.ringColor,a.lineWidth=u,a.beginPath(),a.arc(n,r,c-u/2,0,Math.PI*2),a.stroke(),a.fillStyle=i.coreColor,a.beginPath(),a.arc(n,r,h,0,Math.PI*2),a.fill()}function Vr(a,e,i){const n=e/2,r=e/2,c=a.createLinearGradient(0,0,0,e);((i==null?void 0:i.casingStops)??[[0,"#2B2B2B"],[.3,"#1F1F1F"],[.6,"#0F0F0F"],[1,"#000000"]]).forEach(([y,v])=>c.addColorStop(y,v)),a.fillStyle=c,a.fillRect(0,0,e,e);const h=e*.28,u=a.createRadialGradient(n,r,0,n,r,h);u.addColorStop(0,(i==null?void 0:i.coreColor)??"#FFD54F"),u.addColorStop(1,"rgba(255, 213, 79, 0)"),a.fillStyle=u,a.beginPath(),a.arc(n,r,h,0,Math.PI*2),a.fill(),a.strokeStyle=(i==null?void 0:i.stripeColor)??"#666",a.lineWidth=2;const d=4;for(let y=0;y<d;y++){const v=(y+1)/(d+1)*e;a.beginPath(),a.moveTo(v,4),a.lineTo(v,e-4),a.stroke()}a.fillStyle=(i==null?void 0:i.terminalHighlightColor)??"#FFECB3";const g=e*.2,m=4;a.fillRect(n-g/2,2,g,m),a.fillRect(n-g/2,e-m-2,g,m)}var gu=(a=>(a.NONE="none",a.LIGHT="light",a.MODERATE="moderate",a.HEAVY="heavy",a))(gu||{});const pu=new Map,Jr=new Map;function el(){const a=document.createElement("canvas");return a.width=G,a.height=G,a}function qn(a,e){if(e==="none")return a;const i=el(),n=i.getContext("2d"),r=el(),c=r.getContext("2d"),h={light:{opacity:.9,tint:"rgba(255,0,0,0.1)",cracks:!1},moderate:{opacity:.7,tint:"rgba(255,0,0,0.25)",cracks:!0},heavy:{opacity:.4,tint:"rgba(255,0,0,0.4)",cracks:!0}}[e];if(n.globalAlpha=h.opacity,n.drawImage(a,0,0),n.globalAlpha=1,c.clearRect(0,0,G,G),c.fillStyle=h.tint,c.fillRect(0,0,G,G),c.globalCompositeOperation="destination-in",c.drawImage(a,0,0),c.globalCompositeOperation="source-over",n.drawImage(r,0,0),h.cracks){c.clearRect(0,0,G,G),c.strokeStyle=e==="heavy"?"rgba(40,40,40,0.9)":"rgba(60,60,60,0.7)",c.lineWidth=e==="heavy"?2:1;const u=G/2;c.beginPath(),c.moveTo(u*.2,u*.4),c.lineTo(u*1.6,u*1.8),c.moveTo(u*.4,u*1.8),c.lineTo(u*1.8,u*.2),e==="heavy"&&(c.moveTo(0,u),c.lineTo(u*.8,u*1.2),c.moveTo(u*1.2,u*.8),c.lineTo(G,u)),c.stroke(),c.globalCompositeOperation="destination-in",c.drawImage(a,0,0),c.globalCompositeOperation="source-over",n.drawImage(r,0,0)}return i}function Cb(a){return{none:a,light:{base:qn(a.base,"light"),overlay:a.overlay?qn(a.overlay,"light"):void 0},moderate:{base:qn(a.base,"moderate"),overlay:a.overlay?qn(a.overlay,"moderate"):void 0},heavy:{base:qn(a.base,"heavy"),overlay:a.overlay?qn(a.overlay,"heavy"):void 0}}}function Tb(a){const e=el(),i=e.getContext("2d"),n=el(),r=n.getContext("2d");switch(a){case"cockpit0":i.fillStyle="#444",i.fillRect(0,0,G,G),i.fillStyle="#ff2222",i.beginPath(),i.arc(G/2,G/2,8,0,Math.PI*2),i.fill();break;case"cockpit1":i.fillStyle="#444",i.fillRect(0,0,G,G),i.fillStyle="#0ff",i.beginPath(),i.arc(G/2,G/2,8,0,Math.PI*2),i.fill();break;case"hull0":case"hull1":Fr(i,G,[[0,"#C0C0C0"],[.3,"#A0A0A0"],[.7,"#808080"],[1,"#606060"]]);break;case"hull2":Fr(i,G,[[0,"#66FF66"],[.2,"#4CAF50"],[.6,"#388E3C"],[1,"#1B5E20"]]);break;case"hull3":Fr(i,G,[[0,"#64B5F6"],[.2,"#2196F3"],[.6,"#1976D2"],[1,"#0D47A1"]]);break;case"hull4":Fr(i,G,[[0,"#E1BEE7"],[.15,"#BA68C8"],[.4,"#9C27B0"],[.7,"#7B1FA2"],[1,"#4A148C"]]);break;case"facetplate0":case"facetplate1":Ur(i,G,[[0,"#C0C0C0"],[.3,"#A0A0A0"],[.7,"#808080"],[1,"#606060"]]);break;case"facetplate2":Ur(i,G,[[0,"#66FF66"],[.2,"#4CAF50"],[.6,"#388E3C"],[1,"#1B5E20"]]);break;case"facetplate3":Ur(i,G,[[0,"#64B5F6"],[.2,"#2196F3"],[.6,"#1976D2"],[1,"#0D47A1"]]);break;case"facetplate4":Ur(i,G,[[0,"#E1BEE7"],[.15,"#BA68C8"],[.4,"#9C27B0"],[.7,"#7B1FA2"],[1,"#4A148C"]]);break;case"fuelTank0":case"fuelTank1":Vr(i,G,{casingStops:[[0,"#C0C0C0"],[.3,"#A0A0A0"],[.6,"#808080"],[1,"#606060"]],coreColor:"#FFF176",stripeColor:"#999",terminalHighlightColor:"#F0F4C3"});break;case"fuelTank2":Vr(i,G,{casingStops:[[0,"#66FF66"],[.2,"#4CAF50"],[.6,"#388E3C"],[1,"#1B5E20"]],coreColor:"#B2FF59",stripeColor:"#33691E",terminalHighlightColor:"#DCEDC8"});break;case"fuelTank3":Vr(i,G,{casingStops:[[0,"#64B5F6"],[.2,"#2196F3"],[.6,"#1976D2"],[1,"#0D47A1"]],coreColor:"#81D4FA",stripeColor:"#1565C0",terminalHighlightColor:"#E3F2FD"});break;case"fuelTank4":Vr(i,G,{casingStops:[[0,"#E1BEE7"],[.15,"#BA68C8"],[.4,"#9C27B0"],[.7,"#7B1FA2"],[1,"#4A148C"]],coreColor:"#CE93D8",stripeColor:"#8E24AA",terminalHighlightColor:"#F3E5F5"});break;case"turret0":case"turret1":Nr(i,r,G,{baseGradientColors:["#777","#555","#333"],rotatingBaseColors:["#888","#666","#444"],barrelGradientStops:[[0,"#444"],[.3,"#f44"],[.7,"#c22"],[1,"#822"]],barrelWidth:6,barrelLength:G*.6});break;case"turret2":Nr(i,r,G,{baseGradientColors:["#66BB6A","#4CAF50","#2E7D32"],rotatingBaseColors:["#81C784","#4CAF50","#1B5E20"],barrelGradientStops:[[0,"#1B5E20"],[.2,"#388E3C"],[.5,"#4CAF50"],[.8,"#66BB6A"],[1,"#2E7D32"]],barrelWidth:7,barrelLength:G*.65});break;case"turret3":Nr(i,r,G,{baseGradientColors:["#64B5F6","#2196F3","#1565C0"],rotatingBaseColors:["#90CAF9","#42A5F5","#1976D2","#0D47A1"],barrelGradientStops:[[0,"#0D47A1"],[.15,"#1565C0"],[.4,"#1976D2"],[.6,"#2196F3"],[.85,"#64B5F6"],[1,"#1565C0"]],barrelWidth:8,barrelLength:G*.7});break;case"turret4":Nr(i,r,G,{baseGradientColors:["#E1BEE7","#BA68C8","#9C27B0","#7B1FA2","#4A148C"],rotatingBaseColors:["#F3E5F5","#E1BEE7","#CE93D8","#AB47BC","#8E24AA"],barrelGradientStops:[[0,"#4A148C"],[.1,"#6A1B99"],[.25,"#7B1FA2"],[.4,"#8E24AA"],[.6,"#AB47BC"],[.75,"#CE93D8"],[.9,"#E1BEE7"],[1,"#7B1FA2"]],barrelWidth:10,barrelLength:G*.75});break;case"laser0":Or(i,G,{body:["#3A3A3A","#2A2A2A","#1A1A1A","#101010"],housing:"#64B5F6",innerHousing:"#1565C0",barrel:["#81D4FA","#0288D1","#81D4FA"],barrelDetail:"#B3E5FC",glow:["#4FC3F7","#0288D1","rgba(2, 136, 209, 0)"],muzzleGlow:["#FFFFFF","#4FC3F7","#0288D1","rgba(2, 136, 209, 0)"],muzzleCore:"#FFFFFF"});break;case"laser1":Or(i,G,{body:["#555D66","#3C444D","#2B3036","#1E2227"],housing:"#90A4AE",innerHousing:"#546E7A",barrel:["#B0BEC5","#78909C","#B0BEC5"],barrelDetail:"#CFD8DC",glow:["#4FC3F7","#0288D1","rgba(2, 136, 209, 0)"],muzzleGlow:["#E1F5FE","#81D4FA","#0288D1","rgba(2, 136, 209, 0)"],muzzleCore:"#E0F7FA"});break;case"laser2":Or(i,G,{body:["#355E3B","#254D32","#1B3C29","#122D21"],housing:"#AED581",innerHousing:"#7CB342",barrel:["#C5E1A5","#8BC34A","#C5E1A5"],barrelDetail:"#DCEDC8",glow:["#76FF03","#64DD17","rgba(100, 221, 23, 0)"],muzzleGlow:["#CCFF90","#AEEA00","#64DD17","rgba(174, 234, 0, 0)"],muzzleCore:"#F0F4C3"});break;case"laser3":Or(i,G,{body:["#2E003E","#1D002A","#14001F","#0A0014"],housing:"#9575CD",innerHousing:"#673AB7",barrel:["#B39DDB","#7E57C2","#B39DDB"],barrelDetail:"#D1C4E9",glow:["#D500F9","#AA00FF","rgba(170, 0, 255, 0)"],muzzleGlow:["#E1BEE7","#BA68C8","#8E24AA","rgba(142, 36, 170, 0)"],muzzleCore:"#F3E5F5"});break;case"reactor0":case"reactor1":Rg(i,G,{chassisStops:[[0,"#2C2C2C"],[.5,"#1E1E1E"],[1,"#0F0F0F"]],coreRingStops:[[0,"#4FC3F7"],[.4,"#0288D1"],[1,"#00000000"]],coreRingInnerRadius:4,coreGlowStops:[[0,"#81D4FA"],[.4,"#4FC3F7"],[1,"rgba(129, 212, 250, 0)"]],coreGlowRadius:6,boltColor:"#64B5F6"});break;case"reactor2":Rg(i,G,{chassisStops:[[0,"#1C0D2B"],[.5,"#2A1850"],[1,"#100820"]],coreRingStops:[[0,"#BA68C8"],[.4,"#8E24AA"],[1,"#00000000"]],coreRingInnerRadius:5,coreGlowStops:[[0,"#CE93D8"],[.5,"#AB47BC"],[1,"rgba(171, 71, 188, 0)"]],coreGlowRadius:7,boltColor:"#D1C4E9"});break;case"battery0":case"battery1":Eg(i,G,{chassisStops:[[0,"#263238"],[.5,"#37474F"],[1,"#102027"]],cellGlowStops:[[0,"#B2EBF2"],[.5,"#4DD0E1"],[1,"rgba(77, 208, 225, 0)"]],coreRadius:7,terminalColor:"#B0BEC5",terminalSize:3});break;case"battery2":Eg(i,G,{chassisStops:[[0,"#311B92"],[.5,"#512DA8"],[1,"#1A237E"]],cellGlowStops:[[0,"#D1C4E9"],[.5,"#9575CD"],[1,"rgba(149, 117, 205, 0)"]],coreRadius:8,terminalColor:"#EDE7F6",terminalSize:3});break;case"shield0":case"shield1":Oh(i,G,{chassisStops:[[0,"#1A1A2E"],[.5,"#16213E"],[1,"#0F3460"]],emitterGlowStops:[[0,"#BBDEFB"],[.5,"#42A5F5"],[1,"rgba(66, 165, 245, 0)"]],emitterRadius:10,ringColor:"#90CAF9",terminalColor:"#E3F2FD"});break;case"shield2":Oh(i,G,{chassisStops:[[0,"#003322"],[.5,"#005533"],[1,"#00261A"]],emitterGlowStops:[[0,"#66FFCC"],[.5,"#00CC88"],[1,"rgba(0, 204, 136, 0)"]],emitterRadius:11,ringColor:"#00E6A8",terminalColor:"#CCFFEE"});break;case"shield3":Oh(i,G,{chassisStops:[[0,"#4A0033"],[.5,"#800080"],[1,"#2E003E"]],emitterGlowStops:[[0,"#FFB3E6"],[.5,"#E040FB"],[1,"rgba(224, 64, 251, 0)"]],emitterRadius:12,ringColor:"#FF80AB",terminalColor:"#FFD6F9"});break;case"engine0":case"engine1":Hr(i,G,{bodyStops:[[0,"#C0C0C0"],[.5,"#A0A0A0"],[1,"#808080"]],thrustColor:"#09f"});break;case"engine2":Hr(i,G,{bodyStops:[[0,"#66FF66"],[.5,"#4CAF50"],[1,"#388E3C"]],thrustColor:"#0f0"});break;case"engine3":Hr(i,G,{bodyStops:[[0,"#64B5F6"],[.5,"#2196F3"],[1,"#1976D2"]],thrustColor:"#00f"});break;case"engine4":Hr(i,G,{bodyStops:[[0,"#B39DDB"],[.5,"#7B1FA2"],[1,"#4A148C"]],thrustColor:"#f0f"});break;case"fin0":case"fin1":Wr(i,G,[[0,"#E0E0E0"],[.3,"#B0B0B0"],[.7,"#808080"],[1,"#404040"]]);break;case"fin2":Wr(i,G,[[0,"#81C784"],[.2,"#66BB6A"],[.5,"#4CAF50"],[.8,"#2E7D32"],[1,"#1B5E20"]]);break;case"fin3":Wr(i,G,[[0,"#90CAF9"],[.15,"#64B5F6"],[.4,"#42A5F5"],[.7,"#1E88E5"],[.9,"#1565C0"],[1,"#0D47A1"]]);break;case"fin4":Wr(i,G,[[0,"#F3E5F5"],[.1,"#E1BEE7"],[.25,"#CE93D8"],[.45,"#BA68C8"],[.65,"#AB47BC"],[.8,"#8E24AA"],[.95,"#6A1B99"],[1,"#4A148C"]]);break;case"harvester0":case"harvester1":Ig(i,G,{intakeColor:"#00ACC1",vortexColor:"#4DD0E1",ringColor:"rgba(0, 200, 255, 0.35)",casingStops:[[0,"#263238"],[.5,"#37474F"],[1,"#212121"]]});break;case"harvester2":Ig(i,G,{intakeColor:"#00BFA5",vortexColor:"#1DE9B6",ringColor:"rgba(106, 0, 255, 0.4)",casingStops:[[0,"#004D40"],[.5,"#00695C"],[1,"#00251A"]]});break;case"explosiveLance0":case"explosiveLance1":zr(i,r,G,{baseGradientColors:["#2e2e2e","#3c3c3c","#121212"],barrelGradientStops:[[0,"#cccccc"],[.5,"#888888"],[1,"#444444"]]});break;case"explosiveLance2":zr(i,r,G,{baseGradientColors:["#1b3d2f","#2c704f","#09251a"],barrelGradientStops:[[0,"#a8e6cf"],[.5,"#56c596"],[1,"#228b22"]]});break;case"explosiveLance3":zr(i,r,G,{baseGradientColors:["#0d47a1","#1976d2","#0a1a3f"],barrelGradientStops:[[0,"#82b1ff"],[.5,"#448aff"],[1,"#2962ff"]]});break;case"explosiveLance4":zr(i,r,G,{baseGradientColors:["#4a148c","#7b1fa2","#12002e"],barrelGradientStops:[[0,"#e1bee7"],[.5,"#ba68c8"],[1,"#8e24aa"]]});break;case"haloBlade0":case"haloBlade1":Gr(i,G,{ringColor:"#FFBF00",coreColor:"#FFEB3B",glowColor:"rgba(255, 191, 0, 0.4)",casingStops:[[0,"#3A3A3A"],[.5,"#2A2A2A"],[1,"#101010"]]});break;case"haloBlade2":Gr(i,G,{ringColor:"#2CFF05",coreColor:"#B2FF59",glowColor:"rgba(44, 255, 5, 0.35)",casingStops:[[0,"#1B3C29"],[.5,"#254D32"],[1,"#122D21"]]});break;case"haloBlade3":Gr(i,G,{ringColor:"#00FFFF",coreColor:"#80DEEA",glowColor:"rgba(0, 255, 255, 0.35)",casingStops:[[0,"#263238"],[.5,"#37474F"],[1,"#212121"]]});break;case"haloBlade4":Gr(i,G,{ringColor:"#7F00FF",coreColor:"#D1C4E9",glowColor:"rgba(127, 0, 255, 0.4)",casingStops:[[0,"#2E003E"],[.5,"#1D002A"],[1,"#0A0014"]]});break}const c={base:e,overlay:a.startsWith("turret")||a.startsWith("explosiveLance")?n:void 0},h=Cb(c);pu.set(a,h)}function wb(){for(const a of So())Tb(a.id)}function Ab(a){let e=0;for(const i of So()){const n=pu.get(i.id);if(!n){console.warn(`[GL2Cache] No raster sprite found for block: ${i.id}`);continue}try{const r={none:{base:Wi(a,n.none.base),overlay:n.none.overlay?Wi(a,n.none.overlay):void 0},light:{base:Wi(a,n.light.base),overlay:n.light.overlay?Wi(a,n.light.overlay):void 0},moderate:{base:Wi(a,n.moderate.base),overlay:n.moderate.overlay?Wi(a,n.moderate.overlay):void 0},heavy:{base:Wi(a,n.heavy.base),overlay:n.heavy.overlay?Wi(a,n.heavy.overlay):void 0}};Jr.set(i.id,r),e++}catch(r){console.error(`[GL2Cache] Failed to convert block sprite to GL2 texture: ${i.id}`,r)}}console.log(`[GL2Cache] Total GL2 textures initialized: ${e}`)}function kb(a){for(const[e,i]of Jr.entries())for(const n of Object.values(gu)){const r=i[n];r.base&&a.isTexture(r.base)&&a.deleteTexture(r.base),r.overlay&&a.isTexture(r.overlay)&&a.deleteTexture(r.overlay)}Jr.clear()}function Xp(a,e){const i=Math.max(0,a/e);return i>.75?"none":i>.5?"light":i>.25?"moderate":"heavy"}function hi(a,e="none"){const i=pu.get(a);if(!i)throw new Error(`Block sprite not cached: ${a}`);return i[e]}function Bb(a,e="none"){const i=Jr.get(a);if(!i)throw new Error(`GL2 block sprite not cached: ${a}`);return i[e]}const st=8,iu=new Map;function Yp(){const a=document.createElement("canvas");return a.width=st,a.height=st,a}function Rb(){const a=Yp(),e=a.getContext("2d"),i=e.createRadialGradient(st/2,st/2,0,st/2,st/2,st/2);return i.addColorStop(0,"#ffcc00"),i.addColorStop(.6,"#ffaa00"),i.addColorStop(1,"#cc6600"),e.fillStyle=i,e.beginPath(),e.arc(st/2,st/2,st/2,0,Math.PI*2),e.fill(),a}function Eb(){const a=Yp(),e=a.getContext("2d"),i=e.createRadialGradient(st/2,st/2,0,st/2,st/2,st/2);return i.addColorStop(0,"#ff6666"),i.addColorStop(.7,"#cc2222"),i.addColorStop(1,"#880000"),e.fillStyle=i,e.beginPath(),e.arc(st/2,st/2,st/2,0,Math.PI*2),e.fill(),a}function Ib(){iu.set("currency",{base:Rb()}),iu.set("repair",{base:Eb()})}function _b(a){return iu.get(a)}function xb(a){const e=G/2-2,i=G/2,n=G/2;a.save(),a.fillStyle="#444",a.beginPath(),a.moveTo(i,n-e+3),a.bezierCurveTo(i+12,n-e,i+e,n-10,i+e-2,n),a.bezierCurveTo(i+e,n+10,i+10,n+e-4,i,n+e),a.bezierCurveTo(i-10,n+e-6,i-e,n+10,i-e+2,n),a.bezierCurveTo(i-e,n-10,i-10,n-e,i,n-e+3),a.closePath(),a.fill(),a.fillStyle="rgba(255,255,255,0.05)";for(let r=0;r<10;r++){const c=Math.random()*G,h=Math.random()*G;a.beginPath(),a.arc(c,h,1+Math.random()*1.5,0,Math.PI*2),a.fill()}a.restore()}function Db(a){const e=G,i=G;a.save();const n=a.createRadialGradient(e*.3,i*.3,0,e*.5,i*.5,e*.8);n.addColorStop(0,"#4a4a4a"),n.addColorStop(.6,"#383838"),n.addColorStop(1,"#2a2a2a"),a.fillStyle=n,a.fillRect(0,0,e,i),a.fillStyle="rgba(20, 20, 20, 0.3)";for(let h=0;h<5;h++){const u=Math.random()*e,d=Math.random()*i,g=8+Math.random()*12;a.beginPath();for(let m=0;m<8;m++){const y=m/8*Math.PI*2,v=g*(.7+Math.random()*.6),M=u+Math.cos(y)*v,b=d+Math.sin(y)*v;m===0?a.moveTo(M,b):a.lineTo(M,b)}a.closePath(),a.fill()}a.fillStyle="rgba(70, 70, 70, 0.4)";for(let h=0;h<4;h++){const u=Math.random()*e,d=Math.random()*i,g=6+Math.random()*10;a.beginPath();for(let m=0;m<6;m++){const y=m/6*Math.PI*2,v=g*(.8+Math.random()*.4),M=u+Math.cos(y)*v,b=d+Math.sin(y)*v;m===0?a.moveTo(M,b):a.lineTo(M,b)}a.closePath(),a.fill()}const r=a.createLinearGradient(0,0,e*.3,i*.3);r.addColorStop(0,"rgba(255, 255, 255, 0.08)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=r,a.fillRect(0,0,e*.3,i*.3);const c=a.createLinearGradient(e*.7,i*.7,e,i);c.addColorStop(0,"rgba(0, 0, 0, 0)"),c.addColorStop(1,"rgba(0, 0, 0, 0.15)"),a.fillStyle=c,a.fillRect(e*.7,i*.7,e*.3,i*.3),a.fillStyle="rgba(255, 255, 255, 0.06)";for(let h=0;h<12;h++){const u=Math.random()*e,d=Math.random()*i,g=.5+Math.random()*1;a.beginPath(),a.arc(u,d,g,0,Math.PI*2),a.fill()}a.fillStyle="rgba(0, 0, 0, 0.3)";for(let h=0;h<8;h++){const u=Math.random()*e,d=Math.random()*i,g=.3+Math.random()*.7;a.beginPath(),a.arc(u,d,g,0,Math.PI*2),a.fill()}a.restore()}function Pb(a){const e=G,i=G;a.save(),a.beginPath(),a.moveTo(0,i),a.lineTo(e,i),a.quadraticCurveTo(e*.55+(Math.random()-.5)*4,-2,0,i),a.closePath(),a.clip();const n=a.createRadialGradient(e*.4,i*.7,0,e*.5,i*.6,e*.9);n.addColorStop(0,"#4a4a4a"),n.addColorStop(.6,"#383838"),n.addColorStop(1,"#2a2a2a"),a.fillStyle=n,a.fillRect(0,0,e,i);const r=a.createLinearGradient(e*.2,i*.2,e*.8,i*.8);r.addColorStop(0,"rgba(255, 255, 255, 0.12)"),r.addColorStop(.5,"rgba(255, 255, 255, 0.04)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=r,a.fillRect(0,0,e,i);const c=a.createLinearGradient(0,i*.8,0,i);c.addColorStop(0,"rgba(0, 0, 0, 0)"),c.addColorStop(1,"rgba(0, 0, 0, 0.2)"),a.fillStyle=c,a.fillRect(0,i*.8,e,i*.2),a.fillStyle="rgba(20, 20, 20, 0.25)";for(let h=0;h<4;h++){const u=Math.random()*e,d=i*.3+Math.random()*i*.6,g=6+Math.random()*8;a.beginPath();for(let m=0;m<6;m++){const y=m/6*Math.PI*2,v=g*(.7+Math.random()*.6),M=u+Math.cos(y)*v,b=d+Math.sin(y)*v;m===0?a.moveTo(M,b):a.lineTo(M,b)}a.closePath(),a.fill()}a.fillStyle="rgba(70, 70, 70, 0.3)";for(let h=0;h<3;h++){const u=Math.random()*e,d=i*.4+Math.random()*i*.5,g=4+Math.random()*6;a.beginPath();for(let m=0;m<5;m++){const y=m/5*Math.PI*2,v=g*(.8+Math.random()*.4),M=u+Math.cos(y)*v,b=d+Math.sin(y)*v;m===0?a.moveTo(M,b):a.lineTo(M,b)}a.closePath(),a.fill()}a.fillStyle="rgba(255, 255, 255, 0.06)";for(let h=0;h<8;h++){const u=Math.random()*e,d=i*.2+Math.random()*i*.7,g=.5+Math.random()*1;a.beginPath(),a.arc(u,d,g,0,Math.PI*2),a.fill()}a.fillStyle="rgba(0, 0, 0, 0.25)";for(let h=0;h<6;h++){const u=Math.random()*e,d=i*.3+Math.random()*i*.6,g=.3+Math.random()*.7;a.beginPath(),a.arc(u,d,g,0,Math.PI*2),a.fill()}a.restore(),a.strokeStyle="rgba(0, 0, 0, 0.1)",a.lineWidth=.5,a.beginPath(),a.moveTo(0,i),a.lineTo(e,i),a.stroke(),a.restore()}function Lb(a){const e=G,i=G;a.save(),a.beginPath(),a.moveTo(0,i),a.lineTo(e,i),a.bezierCurveTo(e*.8,i*.3,e*.2,i*.1,0,i),a.closePath(),a.clip();const n=a.createRadialGradient(e*.3,i*.8,0,e*.5,i*.6,e*.9);n.addColorStop(0,"#4a4a4a"),n.addColorStop(.6,"#383838"),n.addColorStop(1,"#2a2a2a"),a.fillStyle=n,a.fillRect(0,0,e,i);const r=a.createLinearGradient(e*.1,i*.1,e*.9,i*.6);r.addColorStop(0,"rgba(255, 255, 255, 0.15)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.08)"),r.addColorStop(.7,"rgba(255, 255, 255, 0.02)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=r,a.fillRect(0,0,e,i);const c=a.createRadialGradient(e*.7,i*.2,0,e*.7,i*.2,e*.3);c.addColorStop(0,"rgba(255, 255, 255, 0.1)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=c,a.fillRect(e*.4,0,e*.6,i*.4);const h=a.createLinearGradient(0,i*.85,0,i);h.addColorStop(0,"rgba(0, 0, 0, 0)"),h.addColorStop(1,"rgba(0, 0, 0, 0.18)"),a.fillStyle=h,a.fillRect(0,i*.85,e,i*.15),a.fillStyle="rgba(20, 20, 20, 0.28)";for(let u=0;u<5;u++){const d=Math.random()*e,g=i*.25+Math.random()*i*.7,m=5+Math.random()*9;a.beginPath();for(let y=0;y<7;y++){const v=y/7*Math.PI*2,M=m*(.6+Math.random()*.8),b=d+Math.cos(v)*M,C=g+Math.sin(v)*M;y===0?a.moveTo(b,C):a.lineTo(b,C)}a.closePath(),a.fill()}a.fillStyle="rgba(70, 70, 70, 0.35)";for(let u=0;u<4;u++){const d=Math.random()*e,g=i*.3+Math.random()*i*.6,m=3+Math.random()*7;a.beginPath();for(let y=0;y<6;y++){const v=y/6*Math.PI*2,M=m*(.7+Math.random()*.5),b=d+Math.cos(v)*M,C=g+Math.sin(v)*M;y===0?a.moveTo(b,C):a.lineTo(b,C)}a.closePath(),a.fill()}a.fillStyle="rgba(255, 255, 255, 0.065)";for(let u=0;u<10;u++){const d=Math.random()*e,g=i*.15+Math.random()*i*.8,m=.4+Math.random()*1.2;a.beginPath(),a.arc(d,g,m,0,Math.PI*2),a.fill()}a.fillStyle="rgba(0, 0, 0, 0.28)";for(let u=0;u<7;u++){const d=Math.random()*e,g=i*.2+Math.random()*i*.7,m=.2+Math.random()*.8;a.beginPath(),a.arc(d,g,m,0,Math.PI*2),a.fill()}a.fillStyle="rgba(45, 45, 45, 0.4)";for(let u=0;u<3;u++){const d=Math.random()*e,g=i*.4+Math.random()*i*.5,m=2+Math.random()*3;a.beginPath(),a.arc(d,g,m,0,Math.PI*2),a.fill()}a.restore(),a.strokeStyle="rgba(0, 0, 0, 0.08)",a.lineWidth=.5,a.beginPath(),a.moveTo(0,i),a.lineTo(e,i),a.stroke(),a.restore()}function Ob(a){const e=G,i=G;a.save(),a.beginPath(),a.moveTo(0,i),a.lineTo(e,i),a.arc(e/2,i,e/2,0,Math.PI,!0),a.closePath(),a.clip();const n=a.createRadialGradient(e*.5,i*.9,0,e*.5,i*.7,e*.7);n.addColorStop(0,"#4a4a4a"),n.addColorStop(.6,"#383838"),n.addColorStop(1,"#2a2a2a"),a.fillStyle=n,a.fillRect(0,0,e,i);const r=a.createLinearGradient(0,i*.3,e,i*.7);r.addColorStop(0,"rgba(255, 255, 255, 0.1)"),r.addColorStop(.5,"rgba(255, 255, 255, 0.05)"),r.addColorStop(1,"rgba(255, 255, 255, 0.1)"),a.fillStyle=r,a.fillRect(0,0,e,i);const c=a.createRadialGradient(e*.5,i*.5,0,e*.5,i*.5,e*.4);c.addColorStop(0,"rgba(255, 255, 255, 0.08)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=c,a.fillRect(e*.2,i*.2,e*.6,i*.6);const h=a.createLinearGradient(0,i*.9,0,i);h.addColorStop(0,"rgba(0, 0, 0, 0)"),h.addColorStop(1,"rgba(0, 0, 0, 0.15)"),a.fillStyle=h,a.fillRect(0,i*.9,e,i*.1),a.fillStyle="rgba(20, 20, 20, 0.25)";for(let u=0;u<3;u++){const d=e*.2+Math.random()*e*.6,g=i*.4+Math.random()*i*.5,m=3+Math.random()*5;a.beginPath();for(let y=0;y<5;y++){const v=y/5*Math.PI*2,M=m*(.7+Math.random()*.6),b=d+Math.cos(v)*M,C=g+Math.sin(v)*M;y===0?a.moveTo(b,C):a.lineTo(b,C)}a.closePath(),a.fill()}a.fillStyle="rgba(70, 70, 70, 0.3)";for(let u=0;u<2;u++){const d=e*.3+Math.random()*e*.4,g=i*.5+Math.random()*i*.4,m=2+Math.random()*4;a.beginPath();for(let y=0;y<4;y++){const v=y/4*Math.PI*2,M=m*(.8+Math.random()*.4),b=d+Math.cos(v)*M,C=g+Math.sin(v)*M;y===0?a.moveTo(b,C):a.lineTo(b,C)}a.closePath(),a.fill()}a.fillStyle="rgba(255, 255, 255, 0.06)";for(let u=0;u<6;u++){const d=e*.1+Math.random()*e*.8,g=i*.3+Math.random()*i*.6,m=.3+Math.random()*.8;a.beginPath(),a.arc(d,g,m,0,Math.PI*2),a.fill()}a.fillStyle="rgba(0, 0, 0, 0.25)";for(let u=0;u<4;u++){const d=e*.2+Math.random()*e*.6,g=i*.4+Math.random()*i*.5,m=.2+Math.random()*.5;a.beginPath(),a.arc(d,g,m,0,Math.PI*2),a.fill()}a.fillStyle="rgba(45, 45, 45, 0.35)";for(let u=0;u<2;u++){const d=e*.3+Math.random()*e*.4,g=i*.5+Math.random()*i*.4,m=1+Math.random()*2;a.beginPath(),a.arc(d,g,m,0,Math.PI*2),a.fill()}a.restore(),a.strokeStyle="rgba(0, 0, 0, 0.06)",a.lineWidth=.3,a.beginPath(),a.moveTo(0,i),a.lineTo(e,i),a.stroke(),a.restore()}const qp={circleRock0:{id:"circleRock0",name:"Basalt Chunk",armor:5,cost:0,mass:120,sprite:"circleRock0",category:"environment",subcategory:"asteroid",dropRate:0},rock0:{id:"rock0",name:"Basalt Chunk",armor:5,cost:0,mass:120,sprite:"rock0",category:"environment",subcategory:"asteroid",dropRate:0},facetRock0:{id:"facetRock0",name:"Basalt Chunk",armor:5,cost:0,mass:120,sprite:"facetRock0",category:"environment",subcategory:"asteroid",dropRate:0},facetRock1:{id:"facetRock1",name:"Basalt Chunk",armor:5,cost:0,mass:120,sprite:"facetRock1",category:"environment",subcategory:"asteroid",dropRate:0},facetRockSlim0:{id:"facetRockSlim0",name:"Basalt Chunk",armor:5,cost:0,mass:120,sprite:"facetRockSlim0",category:"environment",subcategory:"asteroid",dropRate:0}};function Fb(a){return qp[a]}function Ub(){return Object.values(qp)}var Qr=(a=>(a.NONE="none",a.FRACTURED="fractured",a.CRUMBLING="crumbling",a))(Qr||{});const jp=new Map;function su(){const a=document.createElement("canvas");return a.width=G,a.height=G,a}function xg(a,e){if(e==="none")return a;const i=su(),n=i.getContext("2d"),r=su(),c=r.getContext("2d"),h={fractured:{opacity:.8,tint:"rgba(100, 100, 100, 0.15)",cracks:!0,cracksColor:"rgba(80, 80, 80, 0.7)",lineWidth:1},crumbling:{opacity:.6,tint:"rgba(150, 75, 0, 0.3)",cracks:!0,cracksColor:"rgba(60, 30, 0, 0.85)",lineWidth:2}}[e];return n.globalAlpha=h.opacity,n.drawImage(a,0,0),n.globalAlpha=1,c.clearRect(0,0,G,G),c.fillStyle=h.tint,c.fillRect(0,0,G,G),c.globalCompositeOperation="destination-in",c.drawImage(a,0,0),c.globalCompositeOperation="source-over",n.drawImage(r,0,0),h.cracks&&(c.clearRect(0,0,G,G),c.strokeStyle=h.cracksColor,c.lineWidth=h.lineWidth,c.beginPath(),c.moveTo(4,4),c.lineTo(28,28),c.moveTo(10,22),c.lineTo(22,10),c.moveTo(0,16),c.lineTo(32,16),c.stroke(),c.globalCompositeOperation="destination-in",c.drawImage(a,0,0),c.globalCompositeOperation="source-over",n.drawImage(r,0,0)),i}function Nb(a){return{none:a,fractured:{base:xg(a.base,"fractured")},crumbling:{base:xg(a.base,"crumbling")}}}function Hb(a){const e=su(),i=e.getContext("2d");switch(a){case"circleRock0":xb(i);break;case"rock0":Db(i);break;case"facetRock0":Pb(i);break;case"facetRock1":Lb(i);break;case"facetRockSlim0":Ob(i);break;default:throw new Error(`Unknown asteroid block type: ${a}`)}const r=Nb({base:e});jp.set(a,r)}function Wb(){for(const a of Ub())Hb(a.id)}function zb(a,e="none"){const i=jp.get(a);if(!i)throw new Error(`Asteroid sprite not cached: ${a}`);return i[e]}function Xr(a,e,i,n,r){a.save(),a.clearRect(0,0,a.canvas.width,a.canvas.height);const c=n*.35,h=n-c,u=a.createRadialGradient(e,i,h,e,i,n*1.5);u.addColorStop(0,Yr(r,.3)),u.addColorStop(.7,Yr(r,.1)),u.addColorStop(1,Yr(r,0)),a.beginPath(),a.fillStyle=u,a.arc(e,i,n*1.5,0,Math.PI*2),a.fill(),a.beginPath(),a.arc(e,i,n,0,Math.PI*2),a.fillStyle=r,a.fill(),a.globalCompositeOperation="destination-out",a.beginPath(),a.arc(e,i,h,0,Math.PI*2),a.fill(),a.globalCompositeOperation="source-over",a.beginPath(),a.arc(e,i,n-c*.5,0,Math.PI*2),a.strokeStyle=Yr("#FFFFFF",.2),a.lineWidth=1.5,a.stroke(),a.restore()}function Yr(a,e){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);if(!i)return a;const n=parseInt(i[1],16),r=parseInt(i[2],16),c=parseInt(i[3],16);return`rgba(${n},${r},${c},${e})`}const nu=128,Zp=new Map,tl=new Map;function Gb(){return["energyRing0","energyRing1","energyRing2","energyRing3","energyRing4"]}function Vb(){const a=document.createElement("canvas");a.width=nu,a.height=nu;const e=a.getContext("2d",{alpha:!0});return{canvas:a,ctx:e}}function Xb(a){const{canvas:e,ctx:i}=Vb(),n=nu/2;switch(i.clearRect(0,0,e.width,e.height),a){case"energyRing0":case"energyRing1":Xr(i,n,n,64,"#FFBF00");break;case"energyRing2":Xr(i,n,n,64,"#2CFF05");break;case"energyRing3":Xr(i,n,n,64,"#00FFFF");break;case"energyRing4":Xr(i,n,n,64,"#7F00FF");break;default:console.warn(`[ProjectileSpriteCache] Unknown projectile type: ${a}`);break}Zp.set(a,{canvas:e})}function Yb(){for(const a of Gb())Xb(a)}function qb(a){let e=0;for(const[i,n]of Zp.entries())try{const r=Wi(a,n.canvas);tl.set(i,{texture:r}),e++}catch(r){console.error(`[GLProjectileSpriteCache] Failed to create texture for ${i}:`,r)}console.log(`[GLProjectileSpriteCache] Initialized ${e} GL2 projectile textures.`)}function jb(a){for(const{texture:e}of tl.values())e&&a.isTexture(e)&&a.deleteTexture(e);tl.clear()}function ho(a){const e=tl.get(a);if(!e)throw new Error(`GL projectile sprite not cached: ${a}`);return e}var Fh={exports:{}},uo={},Uh={exports:{}},Nh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dg;function Zb(){return Dg||(Dg=1,function(a){function e(D,X){var te=D.length;D.push(X);e:for(;0<te;){var ae=te-1>>>1,k=D[ae];if(0<r(k,X))D[ae]=X,D[te]=k,te=ae;else break e}}function i(D){return D.length===0?null:D[0]}function n(D){if(D.length===0)return null;var X=D[0],te=D.pop();if(te!==X){D[0]=te;e:for(var ae=0,k=D.length,H=k>>>1;ae<H;){var J=2*(ae+1)-1,$=D[J],oe=J+1,ye=D[oe];if(0>r($,te))oe<k&&0>r(ye,$)?(D[ae]=ye,D[oe]=te,ae=oe):(D[ae]=$,D[J]=te,ae=J);else if(oe<k&&0>r(ye,te))D[ae]=ye,D[oe]=te,ae=oe;else break e}}return X}function r(D,X){var te=D.sortIndex-X.sortIndex;return te!==0?te:D.id-X.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;a.unstable_now=function(){return c.now()}}else{var h=Date,u=h.now();a.unstable_now=function(){return h.now()-u}}var d=[],g=[],m=1,y=null,v=3,M=!1,b=!1,C=!1,w=!1,A=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function _(D){for(var X=i(g);X!==null;){if(X.callback===null)n(g);else if(X.startTime<=D)n(g),X.sortIndex=X.expirationTime,e(d,X);else break;X=i(g)}}function x(D){if(C=!1,_(D),!b)if(i(d)!==null)b=!0,N||(N=!0,K());else{var X=i(g);X!==null&&se(x,X.startTime-D)}}var N=!1,W=-1,z=5,q=-1;function ie(){return w?!0:!(a.unstable_now()-q<z)}function ee(){if(w=!1,N){var D=a.unstable_now();q=D;var X=!0;try{e:{b=!1,C&&(C=!1,R(W),W=-1),M=!0;var te=v;try{t:{for(_(D),y=i(d);y!==null&&!(y.expirationTime>D&&ie());){var ae=y.callback;if(typeof ae=="function"){y.callback=null,v=y.priorityLevel;var k=ae(y.expirationTime<=D);if(D=a.unstable_now(),typeof k=="function"){y.callback=k,_(D),X=!0;break t}y===i(d)&&n(d),_(D)}else n(d);y=i(d)}if(y!==null)X=!0;else{var H=i(g);H!==null&&se(x,H.startTime-D),X=!1}}break e}finally{y=null,v=te,M=!1}X=void 0}}finally{X?K():N=!1}}}var K;if(typeof I=="function")K=function(){I(ee)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,Z=le.port2;le.port1.onmessage=ee,K=function(){Z.postMessage(null)}}else K=function(){A(ee,0)};function se(D,X){W=A(function(){D(a.unstable_now())},X)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(D){D.callback=null},a.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<D?Math.floor(1e3/D):5},a.unstable_getCurrentPriorityLevel=function(){return v},a.unstable_next=function(D){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var te=v;v=X;try{return D()}finally{v=te}},a.unstable_requestPaint=function(){w=!0},a.unstable_runWithPriority=function(D,X){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var te=v;v=D;try{return X()}finally{v=te}},a.unstable_scheduleCallback=function(D,X,te){var ae=a.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?ae+te:ae):te=ae,D){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=te+k,D={id:m++,callback:X,priorityLevel:D,startTime:te,expirationTime:k,sortIndex:-1},te>ae?(D.sortIndex=te,e(g,D),i(d)===null&&D===i(g)&&(C?(R(W),W=-1):C=!0,se(x,te-ae))):(D.sortIndex=k,e(d,D),b||M||(b=!0,N||(N=!0,K()))),D},a.unstable_shouldYield=ie,a.unstable_wrapCallback=function(D){var X=v;return function(){var te=v;v=X;try{return D.apply(this,arguments)}finally{v=te}}}}(Nh)),Nh}var Pg;function Kb(){return Pg||(Pg=1,Uh.exports=Zb()),Uh.exports}var Hh={exports:{}},me={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lg;function Qb(){if(Lg)return me;Lg=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),h=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.iterator;function v(k){return k===null||typeof k!="object"?null:(k=y&&k[y]||k["@@iterator"],typeof k=="function"?k:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,C={};function w(k,H,J){this.props=k,this.context=H,this.refs=C,this.updater=J||M}w.prototype.isReactComponent={},w.prototype.setState=function(k,H){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,H,"setState")},w.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function A(){}A.prototype=w.prototype;function R(k,H,J){this.props=k,this.context=H,this.refs=C,this.updater=J||M}var I=R.prototype=new A;I.constructor=R,b(I,w.prototype),I.isPureReactComponent=!0;var _=Array.isArray,x={H:null,A:null,T:null,S:null,V:null},N=Object.prototype.hasOwnProperty;function W(k,H,J,$,oe,ye){return J=ye.ref,{$$typeof:a,type:k,key:H,ref:J!==void 0?J:null,props:ye}}function z(k,H){return W(k.type,H,void 0,void 0,void 0,k.props)}function q(k){return typeof k=="object"&&k!==null&&k.$$typeof===a}function ie(k){var H={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(J){return H[J]})}var ee=/\/+/g;function K(k,H){return typeof k=="object"&&k!==null&&k.key!=null?ie(""+k.key):H.toString(36)}function le(){}function Z(k){switch(k.status){case"fulfilled":return k.value;case"rejected":throw k.reason;default:switch(typeof k.status=="string"?k.then(le,le):(k.status="pending",k.then(function(H){k.status==="pending"&&(k.status="fulfilled",k.value=H)},function(H){k.status==="pending"&&(k.status="rejected",k.reason=H)})),k.status){case"fulfilled":return k.value;case"rejected":throw k.reason}}throw k}function se(k,H,J,$,oe){var ye=typeof k;(ye==="undefined"||ye==="boolean")&&(k=null);var ue=!1;if(k===null)ue=!0;else switch(ye){case"bigint":case"string":case"number":ue=!0;break;case"object":switch(k.$$typeof){case a:case e:ue=!0;break;case m:return ue=k._init,se(ue(k._payload),H,J,$,oe)}}if(ue)return oe=oe(k),ue=$===""?"."+K(k,0):$,_(oe)?(J="",ue!=null&&(J=ue.replace(ee,"$&/")+"/"),se(oe,H,J,"",function(ui){return ui})):oe!=null&&(q(oe)&&(oe=z(oe,J+(oe.key==null||k&&k.key===oe.key?"":(""+oe.key).replace(ee,"$&/")+"/")+ue)),H.push(oe)),1;ue=0;var ut=$===""?".":$+":";if(_(k))for(var Fe=0;Fe<k.length;Fe++)$=k[Fe],ye=ut+K($,Fe),ue+=se($,H,J,ye,oe);else if(Fe=v(k),typeof Fe=="function")for(k=Fe.call(k),Fe=0;!($=k.next()).done;)$=$.value,ye=ut+K($,Fe++),ue+=se($,H,J,ye,oe);else if(ye==="object"){if(typeof k.then=="function")return se(Z(k),H,J,$,oe);throw H=String(k),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return ue}function D(k,H,J){if(k==null)return k;var $=[],oe=0;return se(k,$,"","",function(ye){return H.call(J,ye,oe++)}),$}function X(k){if(k._status===-1){var H=k._result;H=H(),H.then(function(J){(k._status===0||k._status===-1)&&(k._status=1,k._result=J)},function(J){(k._status===0||k._status===-1)&&(k._status=2,k._result=J)}),k._status===-1&&(k._status=0,k._result=H)}if(k._status===1)return k._result.default;throw k._result}var te=typeof reportError=="function"?reportError:function(k){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof k=="object"&&k!==null&&typeof k.message=="string"?String(k.message):String(k),error:k});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",k);return}console.error(k)};function ae(){}return me.Children={map:D,forEach:function(k,H,J){D(k,function(){H.apply(this,arguments)},J)},count:function(k){var H=0;return D(k,function(){H++}),H},toArray:function(k){return D(k,function(H){return H})||[]},only:function(k){if(!q(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},me.Component=w,me.Fragment=i,me.Profiler=r,me.PureComponent=R,me.StrictMode=n,me.Suspense=d,me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=x,me.__COMPILER_RUNTIME={__proto__:null,c:function(k){return x.H.useMemoCache(k)}},me.cache=function(k){return function(){return k.apply(null,arguments)}},me.cloneElement=function(k,H,J){if(k==null)throw Error("The argument must be a React element, but you passed "+k+".");var $=b({},k.props),oe=k.key,ye=void 0;if(H!=null)for(ue in H.ref!==void 0&&(ye=void 0),H.key!==void 0&&(oe=""+H.key),H)!N.call(H,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&H.ref===void 0||($[ue]=H[ue]);var ue=arguments.length-2;if(ue===1)$.children=J;else if(1<ue){for(var ut=Array(ue),Fe=0;Fe<ue;Fe++)ut[Fe]=arguments[Fe+2];$.children=ut}return W(k.type,oe,void 0,void 0,ye,$)},me.createContext=function(k){return k={$$typeof:h,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null},k.Provider=k,k.Consumer={$$typeof:c,_context:k},k},me.createElement=function(k,H,J){var $,oe={},ye=null;if(H!=null)for($ in H.key!==void 0&&(ye=""+H.key),H)N.call(H,$)&&$!=="key"&&$!=="__self"&&$!=="__source"&&(oe[$]=H[$]);var ue=arguments.length-2;if(ue===1)oe.children=J;else if(1<ue){for(var ut=Array(ue),Fe=0;Fe<ue;Fe++)ut[Fe]=arguments[Fe+2];oe.children=ut}if(k&&k.defaultProps)for($ in ue=k.defaultProps,ue)oe[$]===void 0&&(oe[$]=ue[$]);return W(k,ye,void 0,void 0,null,oe)},me.createRef=function(){return{current:null}},me.forwardRef=function(k){return{$$typeof:u,render:k}},me.isValidElement=q,me.lazy=function(k){return{$$typeof:m,_payload:{_status:-1,_result:k},_init:X}},me.memo=function(k,H){return{$$typeof:g,type:k,compare:H===void 0?null:H}},me.startTransition=function(k){var H=x.T,J={};x.T=J;try{var $=k(),oe=x.S;oe!==null&&oe(J,$),typeof $=="object"&&$!==null&&typeof $.then=="function"&&$.then(ae,te)}catch(ye){te(ye)}finally{x.T=H}},me.unstable_useCacheRefresh=function(){return x.H.useCacheRefresh()},me.use=function(k){return x.H.use(k)},me.useActionState=function(k,H,J){return x.H.useActionState(k,H,J)},me.useCallback=function(k,H){return x.H.useCallback(k,H)},me.useContext=function(k){return x.H.useContext(k)},me.useDebugValue=function(){},me.useDeferredValue=function(k,H){return x.H.useDeferredValue(k,H)},me.useEffect=function(k,H,J){var $=x.H;if(typeof J=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return $.useEffect(k,H)},me.useId=function(){return x.H.useId()},me.useImperativeHandle=function(k,H,J){return x.H.useImperativeHandle(k,H,J)},me.useInsertionEffect=function(k,H){return x.H.useInsertionEffect(k,H)},me.useLayoutEffect=function(k,H){return x.H.useLayoutEffect(k,H)},me.useMemo=function(k,H){return x.H.useMemo(k,H)},me.useOptimistic=function(k,H){return x.H.useOptimistic(k,H)},me.useReducer=function(k,H,J){return x.H.useReducer(k,H,J)},me.useRef=function(k){return x.H.useRef(k)},me.useState=function(k){return x.H.useState(k)},me.useSyncExternalStore=function(k,H,J){return x.H.useSyncExternalStore(k,H,J)},me.useTransition=function(){return x.H.useTransition()},me.version="19.1.0",me}var Og;function mu(){return Og||(Og=1,Hh.exports=Qb()),Hh.exports}var Wh={exports:{}},gt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fg;function $b(){if(Fg)return gt;Fg=1;var a=mu();function e(d){var g="https://react.dev/errors/"+d;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)g+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var n={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},r=Symbol.for("react.portal");function c(d,g,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:y==null?null:""+y,children:d,containerInfo:g,implementation:m}}var h=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(d,g){if(d==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return gt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,gt.createPortal=function(d,g){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(e(299));return c(d,g,null,m)},gt.flushSync=function(d){var g=h.T,m=n.p;try{if(h.T=null,n.p=2,d)return d()}finally{h.T=g,n.p=m,n.d.f()}},gt.preconnect=function(d,g){typeof d=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,n.d.C(d,g))},gt.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},gt.preinit=function(d,g){if(typeof d=="string"&&g&&typeof g.as=="string"){var m=g.as,y=u(m,g.crossOrigin),v=typeof g.integrity=="string"?g.integrity:void 0,M=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;m==="style"?n.d.S(d,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:y,integrity:v,fetchPriority:M}):m==="script"&&n.d.X(d,{crossOrigin:y,integrity:v,fetchPriority:M,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},gt.preinitModule=function(d,g){if(typeof d=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var m=u(g.as,g.crossOrigin);n.d.M(d,{crossOrigin:m,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&n.d.M(d)},gt.preload=function(d,g){if(typeof d=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var m=g.as,y=u(m,g.crossOrigin);n.d.L(d,m,{crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},gt.preloadModule=function(d,g){if(typeof d=="string")if(g){var m=u(g.as,g.crossOrigin);n.d.m(d,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:m,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else n.d.m(d)},gt.requestFormReset=function(d){n.d.r(d)},gt.unstable_batchedUpdates=function(d,g){return d(g)},gt.useFormState=function(d,g,m){return h.H.useFormState(d,g,m)},gt.useFormStatus=function(){return h.H.useHostTransitionStatus()},gt.version="19.1.0",gt}var Ug;function Jb(){if(Ug)return Wh.exports;Ug=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),Wh.exports=$b(),Wh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ng;function eS(){if(Ng)return uo;Ng=1;var a=Kb(),e=mu(),i=Jb();function n(t){var s="https://react.dev/errors/"+t;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function c(t){var s=t,o=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,(s.flags&4098)!==0&&(o=s.return),t=s.return;while(t)}return s.tag===3?o:null}function h(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function u(t){if(c(t)!==t)throw Error(n(188))}function d(t){var s=t.alternate;if(!s){if(s=c(t),s===null)throw Error(n(188));return s!==t?null:t}for(var o=t,l=s;;){var f=o.return;if(f===null)break;var p=f.alternate;if(p===null){if(l=f.return,l!==null){o=l;continue}break}if(f.child===p.child){for(p=f.child;p;){if(p===o)return u(f),t;if(p===l)return u(f),s;p=p.sibling}throw Error(n(188))}if(o.return!==l.return)o=f,l=p;else{for(var S=!1,T=f.child;T;){if(T===o){S=!0,o=f,l=p;break}if(T===l){S=!0,l=f,o=p;break}T=T.sibling}if(!S){for(T=p.child;T;){if(T===o){S=!0,o=p,l=f;break}if(T===l){S=!0,l=p,o=f;break}T=T.sibling}if(!S)throw Error(n(189))}}if(o.alternate!==l)throw Error(n(190))}if(o.tag!==3)throw Error(n(188));return o.stateNode.current===o?t:s}function g(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t;for(t=t.child;t!==null;){if(s=g(t),s!==null)return s;t=t.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),M=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),I=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),q=Symbol.for("react.activity"),ie=Symbol.for("react.memo_cache_sentinel"),ee=Symbol.iterator;function K(t){return t===null||typeof t!="object"?null:(t=ee&&t[ee]||t["@@iterator"],typeof t=="function"?t:null)}var le=Symbol.for("react.client.reference");function Z(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===le?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case b:return"Fragment";case w:return"Profiler";case C:return"StrictMode";case x:return"Suspense";case N:return"SuspenseList";case q:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case M:return"Portal";case I:return(t.displayName||"Context")+".Provider";case R:return(t._context.displayName||"Context")+".Consumer";case _:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case W:return s=t.displayName||null,s!==null?s:Z(t.type)||"Memo";case z:s=t._payload,t=t._init;try{return Z(t(s))}catch{}}return null}var se=Array.isArray,D=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},ae=[],k=-1;function H(t){return{current:t}}function J(t){0>k||(t.current=ae[k],ae[k]=null,k--)}function $(t,s){k++,ae[k]=t.current,t.current=s}var oe=H(null),ye=H(null),ue=H(null),ut=H(null);function Fe(t,s){switch($(ue,s),$(ye,t),$(oe,null),s.nodeType){case 9:case 11:t=(t=s.documentElement)&&(t=t.namespaceURI)?J0(t):0;break;default:if(t=s.tagName,s=s.namespaceURI)s=J0(s),t=eg(s,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}J(oe),$(oe,t)}function ui(){J(oe),J(ye),J(ue)}function ua(t){t.memoizedState!==null&&$(ut,t);var s=oe.current,o=eg(s,t.type);s!==o&&($(ye,t),$(oe,o))}function Ki(t){ye.current===t&&(J(oe),J(ye)),ut.current===t&&(J(ut),no._currentValue=te)}var Ml=Object.prototype.hasOwnProperty,Cl=a.unstable_scheduleCallback,Tl=a.unstable_cancelCallback,Um=a.unstable_shouldYield,Nm=a.unstable_requestPaint,fi=a.unstable_now,Hm=a.unstable_getCurrentPriorityLevel,xu=a.unstable_ImmediatePriority,Du=a.unstable_UserBlockingPriority,Co=a.unstable_NormalPriority,Wm=a.unstable_LowPriority,Pu=a.unstable_IdlePriority,zm=a.log,Gm=a.unstable_setDisableYieldValue,fa=null,_t=null;function Qi(t){if(typeof zm=="function"&&Gm(t),_t&&typeof _t.setStrictMode=="function")try{_t.setStrictMode(fa,t)}catch{}}var xt=Math.clz32?Math.clz32:Ym,Vm=Math.log,Xm=Math.LN2;function Ym(t){return t>>>=0,t===0?32:31-(Vm(t)/Xm|0)|0}var To=256,wo=4194304;function Es(t){var s=t&42;if(s!==0)return s;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Ao(t,s,o){var l=t.pendingLanes;if(l===0)return 0;var f=0,p=t.suspendedLanes,S=t.pingedLanes;t=t.warmLanes;var T=l&134217727;return T!==0?(l=T&~p,l!==0?f=Es(l):(S&=T,S!==0?f=Es(S):o||(o=T&~t,o!==0&&(f=Es(o))))):(T=l&~p,T!==0?f=Es(T):S!==0?f=Es(S):o||(o=l&~t,o!==0&&(f=Es(o)))),f===0?0:s!==0&&s!==f&&(s&p)===0&&(p=f&-f,o=s&-s,p>=o||p===32&&(o&4194048)!==0)?s:f}function da(t,s){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&s)===0}function qm(t,s){switch(t){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lu(){var t=To;return To<<=1,(To&4194048)===0&&(To=256),t}function Ou(){var t=wo;return wo<<=1,(wo&62914560)===0&&(wo=4194304),t}function wl(t){for(var s=[],o=0;31>o;o++)s.push(t);return s}function ga(t,s){t.pendingLanes|=s,s!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function jm(t,s,o,l,f,p){var S=t.pendingLanes;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=o,t.entangledLanes&=o,t.errorRecoveryDisabledLanes&=o,t.shellSuspendCounter=0;var T=t.entanglements,B=t.expirationTimes,O=t.hiddenUpdates;for(o=S&~o;0<o;){var V=31-xt(o),j=1<<V;T[V]=0,B[V]=-1;var F=O[V];if(F!==null)for(O[V]=null,V=0;V<F.length;V++){var U=F[V];U!==null&&(U.lane&=-536870913)}o&=~j}l!==0&&Fu(t,l,0),p!==0&&f===0&&t.tag!==0&&(t.suspendedLanes|=p&~(S&~s))}function Fu(t,s,o){t.pendingLanes|=s,t.suspendedLanes&=~s;var l=31-xt(s);t.entangledLanes|=s,t.entanglements[l]=t.entanglements[l]|1073741824|o&4194090}function Uu(t,s){var o=t.entangledLanes|=s;for(t=t.entanglements;o;){var l=31-xt(o),f=1<<l;f&s|t[l]&s&&(t[l]|=s),o&=~f}}function Al(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function kl(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Nu(){var t=X.p;return t!==0?t:(t=window.event,t===void 0?32:bg(t.type))}function Zm(t,s){var o=X.p;try{return X.p=t,s()}finally{X.p=o}}var $i=Math.random().toString(36).slice(2),ft="__reactFiber$"+$i,Tt="__reactProps$"+$i,ln="__reactContainer$"+$i,Bl="__reactEvents$"+$i,Km="__reactListeners$"+$i,Qm="__reactHandles$"+$i,Hu="__reactResources$"+$i,pa="__reactMarker$"+$i;function Rl(t){delete t[ft],delete t[Tt],delete t[Bl],delete t[Km],delete t[Qm]}function cn(t){var s=t[ft];if(s)return s;for(var o=t.parentNode;o;){if(s=o[ln]||o[ft]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(t=ng(t);t!==null;){if(o=t[ft])return o;t=ng(t)}return s}t=o,o=t.parentNode}return null}function hn(t){if(t=t[ft]||t[ln]){var s=t.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return t}return null}function ma(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t.stateNode;throw Error(n(33))}function un(t){var s=t[Hu];return s||(s=t[Hu]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Je(t){t[pa]=!0}var Wu=new Set,zu={};function Is(t,s){fn(t,s),fn(t+"Capture",s)}function fn(t,s){for(zu[t]=s,t=0;t<s.length;t++)Wu.add(s[t])}var $m=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Gu={},Vu={};function Jm(t){return Ml.call(Vu,t)?!0:Ml.call(Gu,t)?!1:$m.test(t)?Vu[t]=!0:(Gu[t]=!0,!1)}function ko(t,s,o){if(Jm(s))if(o===null)t.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":t.removeAttribute(s);return;case"boolean":var l=s.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){t.removeAttribute(s);return}}t.setAttribute(s,""+o)}}function Bo(t,s,o){if(o===null)t.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttribute(s,""+o)}}function Ti(t,s,o,l){if(l===null)t.removeAttribute(o);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(o);return}t.setAttributeNS(s,o,""+l)}}var El,Xu;function dn(t){if(El===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);El=s&&s[1]||"",Xu=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+El+t+Xu}var Il=!1;function _l(t,s){if(!t||Il)return"";Il=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(s){var j=function(){throw Error()};if(Object.defineProperty(j.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(j,[])}catch(U){var F=U}Reflect.construct(t,[],j)}else{try{j.call()}catch(U){F=U}t.call(j.prototype)}}else{try{throw Error()}catch(U){F=U}(j=t())&&typeof j.catch=="function"&&j.catch(function(){})}}catch(U){if(U&&F&&typeof U.stack=="string")return[U.stack,F.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var f=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");f&&f.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=l.DetermineComponentFrameRoot(),S=p[0],T=p[1];if(S&&T){var B=S.split(`
`),O=T.split(`
`);for(f=l=0;l<B.length&&!B[l].includes("DetermineComponentFrameRoot");)l++;for(;f<O.length&&!O[f].includes("DetermineComponentFrameRoot");)f++;if(l===B.length||f===O.length)for(l=B.length-1,f=O.length-1;1<=l&&0<=f&&B[l]!==O[f];)f--;for(;1<=l&&0<=f;l--,f--)if(B[l]!==O[f]){if(l!==1||f!==1)do if(l--,f--,0>f||B[l]!==O[f]){var V=`
`+B[l].replace(" at new "," at ");return t.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",t.displayName)),V}while(1<=l&&0<=f);break}}}finally{Il=!1,Error.prepareStackTrace=o}return(o=t?t.displayName||t.name:"")?dn(o):""}function ey(t){switch(t.tag){case 26:case 27:case 5:return dn(t.type);case 16:return dn("Lazy");case 13:return dn("Suspense");case 19:return dn("SuspenseList");case 0:case 15:return _l(t.type,!1);case 11:return _l(t.type.render,!1);case 1:return _l(t.type,!0);case 31:return dn("Activity");default:return""}}function Yu(t){try{var s="";do s+=ey(t),t=t.return;while(t);return s}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function zt(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function qu(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function ty(t){var s=qu(t)?"checked":"value",o=Object.getOwnPropertyDescriptor(t.constructor.prototype,s),l=""+t[s];if(!t.hasOwnProperty(s)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var f=o.get,p=o.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return f.call(this)},set:function(S){l=""+S,p.call(this,S)}}),Object.defineProperty(t,s,{enumerable:o.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function Ro(t){t._valueTracker||(t._valueTracker=ty(t))}function ju(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var o=s.getValue(),l="";return t&&(l=qu(t)?t.checked?"true":"false":t.value),t=l,t!==o?(s.setValue(t),!0):!1}function Eo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var iy=/[\n"\\]/g;function Gt(t){return t.replace(iy,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function xl(t,s,o,l,f,p,S,T){t.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?t.type=S:t.removeAttribute("type"),s!=null?S==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+zt(s)):t.value!==""+zt(s)&&(t.value=""+zt(s)):S!=="submit"&&S!=="reset"||t.removeAttribute("value"),s!=null?Dl(t,S,zt(s)):o!=null?Dl(t,S,zt(o)):l!=null&&t.removeAttribute("value"),f==null&&p!=null&&(t.defaultChecked=!!p),f!=null&&(t.checked=f&&typeof f!="function"&&typeof f!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?t.name=""+zt(T):t.removeAttribute("name")}function Zu(t,s,o,l,f,p,S,T){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(t.type=p),s!=null||o!=null){if(!(p!=="submit"&&p!=="reset"||s!=null))return;o=o!=null?""+zt(o):"",s=s!=null?""+zt(s):o,T||s===t.value||(t.value=s),t.defaultValue=s}l=l??f,l=typeof l!="function"&&typeof l!="symbol"&&!!l,t.checked=T?t.checked:!!l,t.defaultChecked=!!l,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(t.name=S)}function Dl(t,s,o){s==="number"&&Eo(t.ownerDocument)===t||t.defaultValue===""+o||(t.defaultValue=""+o)}function gn(t,s,o,l){if(t=t.options,s){s={};for(var f=0;f<o.length;f++)s["$"+o[f]]=!0;for(o=0;o<t.length;o++)f=s.hasOwnProperty("$"+t[o].value),t[o].selected!==f&&(t[o].selected=f),f&&l&&(t[o].defaultSelected=!0)}else{for(o=""+zt(o),s=null,f=0;f<t.length;f++){if(t[f].value===o){t[f].selected=!0,l&&(t[f].defaultSelected=!0);return}s!==null||t[f].disabled||(s=t[f])}s!==null&&(s.selected=!0)}}function Ku(t,s,o){if(s!=null&&(s=""+zt(s),s!==t.value&&(t.value=s),o==null)){t.defaultValue!==s&&(t.defaultValue=s);return}t.defaultValue=o!=null?""+zt(o):""}function Qu(t,s,o,l){if(s==null){if(l!=null){if(o!=null)throw Error(n(92));if(se(l)){if(1<l.length)throw Error(n(93));l=l[0]}o=l}o==null&&(o=""),s=o}o=zt(s),t.defaultValue=o,l=t.textContent,l===o&&l!==""&&l!==null&&(t.value=l)}function pn(t,s){if(s){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=s;return}}t.textContent=s}var sy=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function $u(t,s,o){var l=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?l?t.setProperty(s,""):s==="float"?t.cssFloat="":t[s]="":l?t.setProperty(s,o):typeof o!="number"||o===0||sy.has(s)?s==="float"?t.cssFloat=o:t[s]=(""+o).trim():t[s]=o+"px"}function Ju(t,s,o){if(s!=null&&typeof s!="object")throw Error(n(62));if(t=t.style,o!=null){for(var l in o)!o.hasOwnProperty(l)||s!=null&&s.hasOwnProperty(l)||(l.indexOf("--")===0?t.setProperty(l,""):l==="float"?t.cssFloat="":t[l]="");for(var f in s)l=s[f],s.hasOwnProperty(f)&&o[f]!==l&&$u(t,f,l)}else for(var p in s)s.hasOwnProperty(p)&&$u(t,p,s[p])}function Pl(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ny=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ay=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Io(t){return ay.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var Ll=null;function Ol(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var mn=null,yn=null;function ef(t){var s=hn(t);if(s&&(t=s.stateNode)){var o=t[Tt]||null;e:switch(t=s.stateNode,s.type){case"input":if(xl(t,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Gt(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var l=o[s];if(l!==t&&l.form===t.form){var f=l[Tt]||null;if(!f)throw Error(n(90));xl(l,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name)}}for(s=0;s<o.length;s++)l=o[s],l.form===t.form&&ju(l)}break e;case"textarea":Ku(t,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&gn(t,!!o.multiple,s,!1)}}}var Fl=!1;function tf(t,s,o){if(Fl)return t(s,o);Fl=!0;try{var l=t(s);return l}finally{if(Fl=!1,(mn!==null||yn!==null)&&(pr(),mn&&(s=mn,t=yn,yn=mn=null,ef(s),t)))for(s=0;s<t.length;s++)ef(t[s])}}function ya(t,s){var o=t.stateNode;if(o===null)return null;var l=o[Tt]||null;if(l===null)return null;o=l[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(n(231,s,typeof o));return o}var wi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ul=!1;if(wi)try{var va={};Object.defineProperty(va,"passive",{get:function(){Ul=!0}}),window.addEventListener("test",va,va),window.removeEventListener("test",va,va)}catch{Ul=!1}var Ji=null,Nl=null,_o=null;function sf(){if(_o)return _o;var t,s=Nl,o=s.length,l,f="value"in Ji?Ji.value:Ji.textContent,p=f.length;for(t=0;t<o&&s[t]===f[t];t++);var S=o-t;for(l=1;l<=S&&s[o-l]===f[p-l];l++);return _o=f.slice(t,1<l?1-l:void 0)}function xo(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function Do(){return!0}function nf(){return!1}function wt(t){function s(o,l,f,p,S){this._reactName=o,this._targetInst=f,this.type=l,this.nativeEvent=p,this.target=S,this.currentTarget=null;for(var T in t)t.hasOwnProperty(T)&&(o=t[T],this[T]=o?o(p):p[T]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Do:nf,this.isPropagationStopped=nf,this}return m(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),s}var _s={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Po=wt(_s),ba=m({},_s,{view:0,detail:0}),oy=wt(ba),Hl,Wl,Sa,Lo=m({},ba,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gl,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Sa&&(Sa&&t.type==="mousemove"?(Hl=t.screenX-Sa.screenX,Wl=t.screenY-Sa.screenY):Wl=Hl=0,Sa=t),Hl)},movementY:function(t){return"movementY"in t?t.movementY:Wl}}),af=wt(Lo),ry=m({},Lo,{dataTransfer:0}),ly=wt(ry),cy=m({},ba,{relatedTarget:0}),zl=wt(cy),hy=m({},_s,{animationName:0,elapsedTime:0,pseudoElement:0}),uy=wt(hy),fy=m({},_s,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dy=wt(fy),gy=m({},_s,{data:0}),of=wt(gy),py={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},my={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vy(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=yy[t])?!!s[t]:!1}function Gl(){return vy}var by=m({},ba,{key:function(t){if(t.key){var s=py[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=xo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?my[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gl,charCode:function(t){return t.type==="keypress"?xo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?xo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Sy=wt(by),My=m({},Lo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rf=wt(My),Cy=m({},ba,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gl}),Ty=wt(Cy),wy=m({},_s,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ay=wt(wy),ky=m({},Lo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),By=wt(ky),Ry=m({},_s,{newState:0,oldState:0}),Ey=wt(Ry),Iy=[9,13,27,32],Vl=wi&&"CompositionEvent"in window,Ma=null;wi&&"documentMode"in document&&(Ma=document.documentMode);var _y=wi&&"TextEvent"in window&&!Ma,lf=wi&&(!Vl||Ma&&8<Ma&&11>=Ma),cf=" ",hf=!1;function uf(t,s){switch(t){case"keyup":return Iy.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ff(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var vn=!1;function xy(t,s){switch(t){case"compositionend":return ff(s);case"keypress":return s.which!==32?null:(hf=!0,cf);case"textInput":return t=s.data,t===cf&&hf?null:t;default:return null}}function Dy(t,s){if(vn)return t==="compositionend"||!Vl&&uf(t,s)?(t=sf(),_o=Nl=Ji=null,vn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return lf&&s.locale!=="ko"?null:s.data;default:return null}}var Py={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function df(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!Py[t.type]:s==="textarea"}function gf(t,s,o,l){mn?yn?yn.push(l):yn=[l]:mn=l,s=Mr(s,"onChange"),0<s.length&&(o=new Po("onChange","change",null,o,l),t.push({event:o,listeners:s}))}var Ca=null,Ta=null;function Ly(t){j0(t,0)}function Oo(t){var s=ma(t);if(ju(s))return t}function pf(t,s){if(t==="change")return s}var mf=!1;if(wi){var Xl;if(wi){var Yl="oninput"in document;if(!Yl){var yf=document.createElement("div");yf.setAttribute("oninput","return;"),Yl=typeof yf.oninput=="function"}Xl=Yl}else Xl=!1;mf=Xl&&(!document.documentMode||9<document.documentMode)}function vf(){Ca&&(Ca.detachEvent("onpropertychange",bf),Ta=Ca=null)}function bf(t){if(t.propertyName==="value"&&Oo(Ta)){var s=[];gf(s,Ta,t,Ol(t)),tf(Ly,s)}}function Oy(t,s,o){t==="focusin"?(vf(),Ca=s,Ta=o,Ca.attachEvent("onpropertychange",bf)):t==="focusout"&&vf()}function Fy(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Oo(Ta)}function Uy(t,s){if(t==="click")return Oo(s)}function Ny(t,s){if(t==="input"||t==="change")return Oo(s)}function Hy(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Dt=typeof Object.is=="function"?Object.is:Hy;function wa(t,s){if(Dt(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var o=Object.keys(t),l=Object.keys(s);if(o.length!==l.length)return!1;for(l=0;l<o.length;l++){var f=o[l];if(!Ml.call(s,f)||!Dt(t[f],s[f]))return!1}return!0}function Sf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Mf(t,s){var o=Sf(t);t=0;for(var l;o;){if(o.nodeType===3){if(l=t+o.textContent.length,t<=s&&l>=s)return{node:o,offset:s-t};t=l}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Sf(o)}}function Cf(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?Cf(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function Tf(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var s=Eo(t.document);s instanceof t.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)t=s.contentWindow;else break;s=Eo(t.document)}return s}function ql(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}var Wy=wi&&"documentMode"in document&&11>=document.documentMode,bn=null,jl=null,Aa=null,Zl=!1;function wf(t,s,o){var l=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Zl||bn==null||bn!==Eo(l)||(l=bn,"selectionStart"in l&&ql(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Aa&&wa(Aa,l)||(Aa=l,l=Mr(jl,"onSelect"),0<l.length&&(s=new Po("onSelect","select",null,s,o),t.push({event:s,listeners:l}),s.target=bn)))}function xs(t,s){var o={};return o[t.toLowerCase()]=s.toLowerCase(),o["Webkit"+t]="webkit"+s,o["Moz"+t]="moz"+s,o}var Sn={animationend:xs("Animation","AnimationEnd"),animationiteration:xs("Animation","AnimationIteration"),animationstart:xs("Animation","AnimationStart"),transitionrun:xs("Transition","TransitionRun"),transitionstart:xs("Transition","TransitionStart"),transitioncancel:xs("Transition","TransitionCancel"),transitionend:xs("Transition","TransitionEnd")},Kl={},Af={};wi&&(Af=document.createElement("div").style,"AnimationEvent"in window||(delete Sn.animationend.animation,delete Sn.animationiteration.animation,delete Sn.animationstart.animation),"TransitionEvent"in window||delete Sn.transitionend.transition);function Ds(t){if(Kl[t])return Kl[t];if(!Sn[t])return t;var s=Sn[t],o;for(o in s)if(s.hasOwnProperty(o)&&o in Af)return Kl[t]=s[o];return t}var kf=Ds("animationend"),Bf=Ds("animationiteration"),Rf=Ds("animationstart"),zy=Ds("transitionrun"),Gy=Ds("transitionstart"),Vy=Ds("transitioncancel"),Ef=Ds("transitionend"),If=new Map,Ql="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ql.push("scrollEnd");function si(t,s){If.set(t,s),Is(s,[t])}var _f=new WeakMap;function Vt(t,s){if(typeof t=="object"&&t!==null){var o=_f.get(t);return o!==void 0?o:(s={value:t,source:s,stack:Yu(s)},_f.set(t,s),s)}return{value:t,source:s,stack:Yu(s)}}var Xt=[],Mn=0,$l=0;function Fo(){for(var t=Mn,s=$l=Mn=0;s<t;){var o=Xt[s];Xt[s++]=null;var l=Xt[s];Xt[s++]=null;var f=Xt[s];Xt[s++]=null;var p=Xt[s];if(Xt[s++]=null,l!==null&&f!==null){var S=l.pending;S===null?f.next=f:(f.next=S.next,S.next=f),l.pending=f}p!==0&&xf(o,f,p)}}function Uo(t,s,o,l){Xt[Mn++]=t,Xt[Mn++]=s,Xt[Mn++]=o,Xt[Mn++]=l,$l|=l,t.lanes|=l,t=t.alternate,t!==null&&(t.lanes|=l)}function Jl(t,s,o,l){return Uo(t,s,o,l),No(t)}function Cn(t,s){return Uo(t,null,null,s),No(t)}function xf(t,s,o){t.lanes|=o;var l=t.alternate;l!==null&&(l.lanes|=o);for(var f=!1,p=t.return;p!==null;)p.childLanes|=o,l=p.alternate,l!==null&&(l.childLanes|=o),p.tag===22&&(t=p.stateNode,t===null||t._visibility&1||(f=!0)),t=p,p=p.return;return t.tag===3?(p=t.stateNode,f&&s!==null&&(f=31-xt(o),t=p.hiddenUpdates,l=t[f],l===null?t[f]=[s]:l.push(s),s.lane=o|536870912),p):null}function No(t){if(50<Ka)throw Ka=0,ah=null,Error(n(185));for(var s=t.return;s!==null;)t=s,s=t.return;return t.tag===3?t.stateNode:null}var Tn={};function Xy(t,s,o,l){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pt(t,s,o,l){return new Xy(t,s,o,l)}function ec(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ai(t,s){var o=t.alternate;return o===null?(o=Pt(t.tag,s,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=s,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&65011712,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,s=t.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o.refCleanup=t.refCleanup,o}function Df(t,s){t.flags&=65011714;var o=t.alternate;return o===null?(t.childLanes=0,t.lanes=s,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=o.childLanes,t.lanes=o.lanes,t.child=o.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=o.memoizedProps,t.memoizedState=o.memoizedState,t.updateQueue=o.updateQueue,t.type=o.type,s=o.dependencies,t.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t}function Ho(t,s,o,l,f,p){var S=0;if(l=t,typeof t=="function")ec(t)&&(S=1);else if(typeof t=="string")S=qv(t,o,oe.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case q:return t=Pt(31,o,s,f),t.elementType=q,t.lanes=p,t;case b:return Ps(o.children,f,p,s);case C:S=8,f|=24;break;case w:return t=Pt(12,o,s,f|2),t.elementType=w,t.lanes=p,t;case x:return t=Pt(13,o,s,f),t.elementType=x,t.lanes=p,t;case N:return t=Pt(19,o,s,f),t.elementType=N,t.lanes=p,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case A:case I:S=10;break e;case R:S=9;break e;case _:S=11;break e;case W:S=14;break e;case z:S=16,l=null;break e}S=29,o=Error(n(130,t===null?"null":typeof t,"")),l=null}return s=Pt(S,o,s,f),s.elementType=t,s.type=l,s.lanes=p,s}function Ps(t,s,o,l){return t=Pt(7,t,l,s),t.lanes=o,t}function tc(t,s,o){return t=Pt(6,t,null,s),t.lanes=o,t}function ic(t,s,o){return s=Pt(4,t.children!==null?t.children:[],t.key,s),s.lanes=o,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}var wn=[],An=0,Wo=null,zo=0,Yt=[],qt=0,Ls=null,ki=1,Bi="";function Os(t,s){wn[An++]=zo,wn[An++]=Wo,Wo=t,zo=s}function Pf(t,s,o){Yt[qt++]=ki,Yt[qt++]=Bi,Yt[qt++]=Ls,Ls=t;var l=ki;t=Bi;var f=32-xt(l)-1;l&=~(1<<f),o+=1;var p=32-xt(s)+f;if(30<p){var S=f-f%5;p=(l&(1<<S)-1).toString(32),l>>=S,f-=S,ki=1<<32-xt(s)+f|o<<f|l,Bi=p+t}else ki=1<<p|o<<f|l,Bi=t}function sc(t){t.return!==null&&(Os(t,1),Pf(t,1,0))}function nc(t){for(;t===Wo;)Wo=wn[--An],wn[An]=null,zo=wn[--An],wn[An]=null;for(;t===Ls;)Ls=Yt[--qt],Yt[qt]=null,Bi=Yt[--qt],Yt[qt]=null,ki=Yt[--qt],Yt[qt]=null}var bt=null,Ge=null,ke=!1,Fs=null,di=!1,ac=Error(n(519));function Us(t){var s=Error(n(418,""));throw Ra(Vt(s,t)),ac}function Lf(t){var s=t.stateNode,o=t.type,l=t.memoizedProps;switch(s[ft]=t,s[Tt]=l,o){case"dialog":Me("cancel",s),Me("close",s);break;case"iframe":case"object":case"embed":Me("load",s);break;case"video":case"audio":for(o=0;o<$a.length;o++)Me($a[o],s);break;case"source":Me("error",s);break;case"img":case"image":case"link":Me("error",s),Me("load",s);break;case"details":Me("toggle",s);break;case"input":Me("invalid",s),Zu(s,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),Ro(s);break;case"select":Me("invalid",s);break;case"textarea":Me("invalid",s),Qu(s,l.value,l.defaultValue,l.children),Ro(s)}o=l.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||l.suppressHydrationWarning===!0||$0(s.textContent,o)?(l.popover!=null&&(Me("beforetoggle",s),Me("toggle",s)),l.onScroll!=null&&Me("scroll",s),l.onScrollEnd!=null&&Me("scrollend",s),l.onClick!=null&&(s.onclick=Cr),s=!0):s=!1,s||Us(t)}function Of(t){for(bt=t.return;bt;)switch(bt.tag){case 5:case 13:di=!1;return;case 27:case 3:di=!0;return;default:bt=bt.return}}function ka(t){if(t!==bt)return!1;if(!ke)return Of(t),ke=!0,!1;var s=t.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=t.type,o=!(o!=="form"&&o!=="button")||Mh(t.type,t.memoizedProps)),o=!o),o&&Ge&&Us(t),Of(t),s===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(n(317));e:{for(t=t.nextSibling,s=0;t;){if(t.nodeType===8)if(o=t.data,o==="/$"){if(s===0){Ge=ai(t.nextSibling);break e}s--}else o!=="$"&&o!=="$!"&&o!=="$?"||s++;t=t.nextSibling}Ge=null}}else s===27?(s=Ge,ps(t.type)?(t=Ah,Ah=null,Ge=t):Ge=s):Ge=bt?ai(t.stateNode.nextSibling):null;return!0}function Ba(){Ge=bt=null,ke=!1}function Ff(){var t=Fs;return t!==null&&(Bt===null?Bt=t:Bt.push.apply(Bt,t),Fs=null),t}function Ra(t){Fs===null?Fs=[t]:Fs.push(t)}var oc=H(null),Ns=null,Ri=null;function es(t,s,o){$(oc,s._currentValue),s._currentValue=o}function Ei(t){t._currentValue=oc.current,J(oc)}function rc(t,s,o){for(;t!==null;){var l=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,l!==null&&(l.childLanes|=s)):l!==null&&(l.childLanes&s)!==s&&(l.childLanes|=s),t===o)break;t=t.return}}function lc(t,s,o,l){var f=t.child;for(f!==null&&(f.return=t);f!==null;){var p=f.dependencies;if(p!==null){var S=f.child;p=p.firstContext;e:for(;p!==null;){var T=p;p=f;for(var B=0;B<s.length;B++)if(T.context===s[B]){p.lanes|=o,T=p.alternate,T!==null&&(T.lanes|=o),rc(p.return,o,t),l||(S=null);break e}p=T.next}}else if(f.tag===18){if(S=f.return,S===null)throw Error(n(341));S.lanes|=o,p=S.alternate,p!==null&&(p.lanes|=o),rc(S,o,t),S=null}else S=f.child;if(S!==null)S.return=f;else for(S=f;S!==null;){if(S===t){S=null;break}if(f=S.sibling,f!==null){f.return=S.return,S=f;break}S=S.return}f=S}}function Ea(t,s,o,l){t=null;for(var f=s,p=!1;f!==null;){if(!p){if((f.flags&524288)!==0)p=!0;else if((f.flags&262144)!==0)break}if(f.tag===10){var S=f.alternate;if(S===null)throw Error(n(387));if(S=S.memoizedProps,S!==null){var T=f.type;Dt(f.pendingProps.value,S.value)||(t!==null?t.push(T):t=[T])}}else if(f===ut.current){if(S=f.alternate,S===null)throw Error(n(387));S.memoizedState.memoizedState!==f.memoizedState.memoizedState&&(t!==null?t.push(no):t=[no])}f=f.return}t!==null&&lc(s,t,o,l),s.flags|=262144}function Go(t){for(t=t.firstContext;t!==null;){if(!Dt(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Hs(t){Ns=t,Ri=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function dt(t){return Uf(Ns,t)}function Vo(t,s){return Ns===null&&Hs(t),Uf(t,s)}function Uf(t,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},Ri===null){if(t===null)throw Error(n(308));Ri=s,t.dependencies={lanes:0,firstContext:s},t.flags|=524288}else Ri=Ri.next=s;return o}var Yy=typeof AbortController<"u"?AbortController:function(){var t=[],s=this.signal={aborted:!1,addEventListener:function(o,l){t.push(l)}};this.abort=function(){s.aborted=!0,t.forEach(function(o){return o()})}},qy=a.unstable_scheduleCallback,jy=a.unstable_NormalPriority,Ke={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function cc(){return{controller:new Yy,data:new Map,refCount:0}}function Ia(t){t.refCount--,t.refCount===0&&qy(jy,function(){t.controller.abort()})}var _a=null,hc=0,kn=0,Bn=null;function Zy(t,s){if(_a===null){var o=_a=[];hc=0,kn=fh(),Bn={status:"pending",value:void 0,then:function(l){o.push(l)}}}return hc++,s.then(Nf,Nf),s}function Nf(){if(--hc===0&&_a!==null){Bn!==null&&(Bn.status="fulfilled");var t=_a;_a=null,kn=0,Bn=null;for(var s=0;s<t.length;s++)(0,t[s])()}}function Ky(t,s){var o=[],l={status:"pending",value:null,reason:null,then:function(f){o.push(f)}};return t.then(function(){l.status="fulfilled",l.value=s;for(var f=0;f<o.length;f++)(0,o[f])(s)},function(f){for(l.status="rejected",l.reason=f,f=0;f<o.length;f++)(0,o[f])(void 0)}),l}var Hf=D.S;D.S=function(t,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&Zy(t,s),Hf!==null&&Hf(t,s)};var Ws=H(null);function uc(){var t=Ws.current;return t!==null?t:Ue.pooledCache}function Xo(t,s){s===null?$(Ws,Ws.current):$(Ws,s.pool)}function Wf(){var t=uc();return t===null?null:{parent:Ke._currentValue,pool:t}}var xa=Error(n(460)),zf=Error(n(474)),Yo=Error(n(542)),fc={then:function(){}};function Gf(t){return t=t.status,t==="fulfilled"||t==="rejected"}function qo(){}function Vf(t,s,o){switch(o=t[o],o===void 0?t.push(s):o!==s&&(s.then(qo,qo),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,Yf(t),t;default:if(typeof s.status=="string")s.then(qo,qo);else{if(t=Ue,t!==null&&100<t.shellSuspendCounter)throw Error(n(482));t=s,t.status="pending",t.then(function(l){if(s.status==="pending"){var f=s;f.status="fulfilled",f.value=l}},function(l){if(s.status==="pending"){var f=s;f.status="rejected",f.reason=l}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,Yf(t),t}throw Da=s,xa}}var Da=null;function Xf(){if(Da===null)throw Error(n(459));var t=Da;return Da=null,t}function Yf(t){if(t===xa||t===Yo)throw Error(n(483))}var ts=!1;function dc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gc(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function is(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function ss(t,s,o){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,(Ie&2)!==0){var f=l.pending;return f===null?s.next=s:(s.next=f.next,f.next=s),l.pending=s,s=No(t),xf(t,null,o),s}return Uo(t,l,s,o),No(t)}function Pa(t,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var l=s.lanes;l&=t.pendingLanes,o|=l,s.lanes=o,Uu(t,o)}}function pc(t,s){var o=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,o===l)){var f=null,p=null;if(o=o.firstBaseUpdate,o!==null){do{var S={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};p===null?f=p=S:p=p.next=S,o=o.next}while(o!==null);p===null?f=p=s:p=p.next=s}else f=p=s;o={baseState:l.baseState,firstBaseUpdate:f,lastBaseUpdate:p,shared:l.shared,callbacks:l.callbacks},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=s:t.next=s,o.lastBaseUpdate=s}var mc=!1;function La(){if(mc){var t=Bn;if(t!==null)throw t}}function Oa(t,s,o,l){mc=!1;var f=t.updateQueue;ts=!1;var p=f.firstBaseUpdate,S=f.lastBaseUpdate,T=f.shared.pending;if(T!==null){f.shared.pending=null;var B=T,O=B.next;B.next=null,S===null?p=O:S.next=O,S=B;var V=t.alternate;V!==null&&(V=V.updateQueue,T=V.lastBaseUpdate,T!==S&&(T===null?V.firstBaseUpdate=O:T.next=O,V.lastBaseUpdate=B))}if(p!==null){var j=f.baseState;S=0,V=O=B=null,T=p;do{var F=T.lane&-536870913,U=F!==T.lane;if(U?(Te&F)===F:(l&F)===F){F!==0&&F===kn&&(mc=!0),V!==null&&(V=V.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var ge=t,fe=T;F=s;var Le=o;switch(fe.tag){case 1:if(ge=fe.payload,typeof ge=="function"){j=ge.call(Le,j,F);break e}j=ge;break e;case 3:ge.flags=ge.flags&-65537|128;case 0:if(ge=fe.payload,F=typeof ge=="function"?ge.call(Le,j,F):ge,F==null)break e;j=m({},j,F);break e;case 2:ts=!0}}F=T.callback,F!==null&&(t.flags|=64,U&&(t.flags|=8192),U=f.callbacks,U===null?f.callbacks=[F]:U.push(F))}else U={lane:F,tag:T.tag,payload:T.payload,callback:T.callback,next:null},V===null?(O=V=U,B=j):V=V.next=U,S|=F;if(T=T.next,T===null){if(T=f.shared.pending,T===null)break;U=T,T=U.next,U.next=null,f.lastBaseUpdate=U,f.shared.pending=null}}while(!0);V===null&&(B=j),f.baseState=B,f.firstBaseUpdate=O,f.lastBaseUpdate=V,p===null&&(f.shared.lanes=0),us|=S,t.lanes=S,t.memoizedState=j}}function qf(t,s){if(typeof t!="function")throw Error(n(191,t));t.call(s)}function jf(t,s){var o=t.callbacks;if(o!==null)for(t.callbacks=null,t=0;t<o.length;t++)qf(o[t],s)}var Rn=H(null),jo=H(0);function Zf(t,s){t=Oi,$(jo,t),$(Rn,s),Oi=t|s.baseLanes}function yc(){$(jo,Oi),$(Rn,Rn.current)}function vc(){Oi=jo.current,J(Rn),J(jo)}var ns=0,ve=null,De=null,je=null,Zo=!1,En=!1,zs=!1,Ko=0,Fa=0,In=null,Qy=0;function Xe(){throw Error(n(321))}function bc(t,s){if(s===null)return!1;for(var o=0;o<s.length&&o<t.length;o++)if(!Dt(t[o],s[o]))return!1;return!0}function Sc(t,s,o,l,f,p){return ns=p,ve=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,D.H=t===null||t.memoizedState===null?xd:Dd,zs=!1,p=o(l,f),zs=!1,En&&(p=Qf(s,o,l,f)),Kf(t),p}function Kf(t){D.H=ir;var s=De!==null&&De.next!==null;if(ns=0,je=De=ve=null,Zo=!1,Fa=0,In=null,s)throw Error(n(300));t===null||et||(t=t.dependencies,t!==null&&Go(t)&&(et=!0))}function Qf(t,s,o,l){ve=t;var f=0;do{if(En&&(In=null),Fa=0,En=!1,25<=f)throw Error(n(301));if(f+=1,je=De=null,t.updateQueue!=null){var p=t.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}D.H=nv,p=s(o,l)}while(En);return p}function $y(){var t=D.H,s=t.useState()[0];return s=typeof s.then=="function"?Ua(s):s,t=t.useState()[0],(De!==null?De.memoizedState:null)!==t&&(ve.flags|=1024),s}function Mc(){var t=Ko!==0;return Ko=0,t}function Cc(t,s,o){s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~o}function Tc(t){if(Zo){for(t=t.memoizedState;t!==null;){var s=t.queue;s!==null&&(s.pending=null),t=t.next}Zo=!1}ns=0,je=De=ve=null,En=!1,Fa=Ko=0,In=null}function At(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return je===null?ve.memoizedState=je=t:je=je.next=t,je}function Ze(){if(De===null){var t=ve.alternate;t=t!==null?t.memoizedState:null}else t=De.next;var s=je===null?ve.memoizedState:je.next;if(s!==null)je=s,De=t;else{if(t===null)throw ve.alternate===null?Error(n(467)):Error(n(310));De=t,t={memoizedState:De.memoizedState,baseState:De.baseState,baseQueue:De.baseQueue,queue:De.queue,next:null},je===null?ve.memoizedState=je=t:je=je.next=t}return je}function wc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ua(t){var s=Fa;return Fa+=1,In===null&&(In=[]),t=Vf(In,t,s),s=ve,(je===null?s.memoizedState:je.next)===null&&(s=s.alternate,D.H=s===null||s.memoizedState===null?xd:Dd),t}function Qo(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ua(t);if(t.$$typeof===I)return dt(t)}throw Error(n(438,String(t)))}function Ac(t){var s=null,o=ve.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var l=ve.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(s={data:l.data.map(function(f){return f.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=wc(),ve.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(t),l=0;l<t;l++)o[l]=ie;return s.index++,o}function Ii(t,s){return typeof s=="function"?s(t):s}function $o(t){var s=Ze();return kc(s,De,t)}function kc(t,s,o){var l=t.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=o;var f=t.baseQueue,p=l.pending;if(p!==null){if(f!==null){var S=f.next;f.next=p.next,p.next=S}s.baseQueue=f=p,l.pending=null}if(p=t.baseState,f===null)t.memoizedState=p;else{s=f.next;var T=S=null,B=null,O=s,V=!1;do{var j=O.lane&-536870913;if(j!==O.lane?(Te&j)===j:(ns&j)===j){var F=O.revertLane;if(F===0)B!==null&&(B=B.next={lane:0,revertLane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),j===kn&&(V=!0);else if((ns&F)===F){O=O.next,F===kn&&(V=!0);continue}else j={lane:0,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},B===null?(T=B=j,S=p):B=B.next=j,ve.lanes|=F,us|=F;j=O.action,zs&&o(p,j),p=O.hasEagerState?O.eagerState:o(p,j)}else F={lane:j,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},B===null?(T=B=F,S=p):B=B.next=F,ve.lanes|=j,us|=j;O=O.next}while(O!==null&&O!==s);if(B===null?S=p:B.next=T,!Dt(p,t.memoizedState)&&(et=!0,V&&(o=Bn,o!==null)))throw o;t.memoizedState=p,t.baseState=S,t.baseQueue=B,l.lastRenderedState=p}return f===null&&(l.lanes=0),[t.memoizedState,l.dispatch]}function Bc(t){var s=Ze(),o=s.queue;if(o===null)throw Error(n(311));o.lastRenderedReducer=t;var l=o.dispatch,f=o.pending,p=s.memoizedState;if(f!==null){o.pending=null;var S=f=f.next;do p=t(p,S.action),S=S.next;while(S!==f);Dt(p,s.memoizedState)||(et=!0),s.memoizedState=p,s.baseQueue===null&&(s.baseState=p),o.lastRenderedState=p}return[p,l]}function $f(t,s,o){var l=ve,f=Ze(),p=ke;if(p){if(o===void 0)throw Error(n(407));o=o()}else o=s();var S=!Dt((De||f).memoizedState,o);S&&(f.memoizedState=o,et=!0),f=f.queue;var T=td.bind(null,l,f,t);if(Na(2048,8,T,[t]),f.getSnapshot!==s||S||je!==null&&je.memoizedState.tag&1){if(l.flags|=2048,_n(9,Jo(),ed.bind(null,l,f,o,s),null),Ue===null)throw Error(n(349));p||(ns&124)!==0||Jf(l,s,o)}return o}function Jf(t,s,o){t.flags|=16384,t={getSnapshot:s,value:o},s=ve.updateQueue,s===null?(s=wc(),ve.updateQueue=s,s.stores=[t]):(o=s.stores,o===null?s.stores=[t]:o.push(t))}function ed(t,s,o,l){s.value=o,s.getSnapshot=l,id(s)&&sd(t)}function td(t,s,o){return o(function(){id(s)&&sd(t)})}function id(t){var s=t.getSnapshot;t=t.value;try{var o=s();return!Dt(t,o)}catch{return!0}}function sd(t){var s=Cn(t,2);s!==null&&Nt(s,t,2)}function Rc(t){var s=At();if(typeof t=="function"){var o=t;if(t=o(),zs){Qi(!0);try{o()}finally{Qi(!1)}}}return s.memoizedState=s.baseState=t,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ii,lastRenderedState:t},s}function nd(t,s,o,l){return t.baseState=o,kc(t,De,typeof l=="function"?l:Ii)}function Jy(t,s,o,l,f){if(tr(t))throw Error(n(485));if(t=s.action,t!==null){var p={payload:f,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){p.listeners.push(S)}};D.T!==null?o(!0):p.isTransition=!1,l(p),o=s.pending,o===null?(p.next=s.pending=p,ad(s,p)):(p.next=o.next,s.pending=o.next=p)}}function ad(t,s){var o=s.action,l=s.payload,f=t.state;if(s.isTransition){var p=D.T,S={};D.T=S;try{var T=o(f,l),B=D.S;B!==null&&B(S,T),od(t,s,T)}catch(O){Ec(t,s,O)}finally{D.T=p}}else try{p=o(f,l),od(t,s,p)}catch(O){Ec(t,s,O)}}function od(t,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(l){rd(t,s,l)},function(l){return Ec(t,s,l)}):rd(t,s,o)}function rd(t,s,o){s.status="fulfilled",s.value=o,ld(s),t.state=o,s=t.pending,s!==null&&(o=s.next,o===s?t.pending=null:(o=o.next,s.next=o,ad(t,o)))}function Ec(t,s,o){var l=t.pending;if(t.pending=null,l!==null){l=l.next;do s.status="rejected",s.reason=o,ld(s),s=s.next;while(s!==l)}t.action=null}function ld(t){t=t.listeners;for(var s=0;s<t.length;s++)(0,t[s])()}function cd(t,s){return s}function hd(t,s){if(ke){var o=Ue.formState;if(o!==null){e:{var l=ve;if(ke){if(Ge){t:{for(var f=Ge,p=di;f.nodeType!==8;){if(!p){f=null;break t}if(f=ai(f.nextSibling),f===null){f=null;break t}}p=f.data,f=p==="F!"||p==="F"?f:null}if(f){Ge=ai(f.nextSibling),l=f.data==="F!";break e}}Us(l)}l=!1}l&&(s=o[0])}}return o=At(),o.memoizedState=o.baseState=s,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cd,lastRenderedState:s},o.queue=l,o=Ed.bind(null,ve,l),l.dispatch=o,l=Rc(!1),p=Pc.bind(null,ve,!1,l.queue),l=At(),f={state:s,dispatch:null,action:t,pending:null},l.queue=f,o=Jy.bind(null,ve,f,p,o),f.dispatch=o,l.memoizedState=t,[s,o,!1]}function ud(t){var s=Ze();return fd(s,De,t)}function fd(t,s,o){if(s=kc(t,s,cd)[0],t=$o(Ii)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var l=Ua(s)}catch(S){throw S===xa?Yo:S}else l=s;s=Ze();var f=s.queue,p=f.dispatch;return o!==s.memoizedState&&(ve.flags|=2048,_n(9,Jo(),ev.bind(null,f,o),null)),[l,p,t]}function ev(t,s){t.action=s}function dd(t){var s=Ze(),o=De;if(o!==null)return fd(s,o,t);Ze(),s=s.memoizedState,o=Ze();var l=o.queue.dispatch;return o.memoizedState=t,[s,l,!1]}function _n(t,s,o,l){return t={tag:t,create:o,deps:l,inst:s,next:null},s=ve.updateQueue,s===null&&(s=wc(),ve.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=t.next=t:(l=o.next,o.next=t,t.next=l,s.lastEffect=t),t}function Jo(){return{destroy:void 0,resource:void 0}}function gd(){return Ze().memoizedState}function er(t,s,o,l){var f=At();l=l===void 0?null:l,ve.flags|=t,f.memoizedState=_n(1|s,Jo(),o,l)}function Na(t,s,o,l){var f=Ze();l=l===void 0?null:l;var p=f.memoizedState.inst;De!==null&&l!==null&&bc(l,De.memoizedState.deps)?f.memoizedState=_n(s,p,o,l):(ve.flags|=t,f.memoizedState=_n(1|s,p,o,l))}function pd(t,s){er(8390656,8,t,s)}function md(t,s){Na(2048,8,t,s)}function yd(t,s){return Na(4,2,t,s)}function vd(t,s){return Na(4,4,t,s)}function bd(t,s){if(typeof s=="function"){t=t();var o=s(t);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function Sd(t,s,o){o=o!=null?o.concat([t]):null,Na(4,4,bd.bind(null,s,t),o)}function Ic(){}function Md(t,s){var o=Ze();s=s===void 0?null:s;var l=o.memoizedState;return s!==null&&bc(s,l[1])?l[0]:(o.memoizedState=[t,s],t)}function Cd(t,s){var o=Ze();s=s===void 0?null:s;var l=o.memoizedState;if(s!==null&&bc(s,l[1]))return l[0];if(l=t(),zs){Qi(!0);try{t()}finally{Qi(!1)}}return o.memoizedState=[l,s],l}function _c(t,s,o){return o===void 0||(ns&1073741824)!==0?t.memoizedState=s:(t.memoizedState=o,t=A0(),ve.lanes|=t,us|=t,o)}function Td(t,s,o,l){return Dt(o,s)?o:Rn.current!==null?(t=_c(t,o,l),Dt(t,s)||(et=!0),t):(ns&42)===0?(et=!0,t.memoizedState=o):(t=A0(),ve.lanes|=t,us|=t,s)}function wd(t,s,o,l,f){var p=X.p;X.p=p!==0&&8>p?p:8;var S=D.T,T={};D.T=T,Pc(t,!1,s,o);try{var B=f(),O=D.S;if(O!==null&&O(T,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var V=Ky(B,l);Ha(t,s,V,Ut(t))}else Ha(t,s,l,Ut(t))}catch(j){Ha(t,s,{then:function(){},status:"rejected",reason:j},Ut())}finally{X.p=p,D.T=S}}function tv(){}function xc(t,s,o,l){if(t.tag!==5)throw Error(n(476));var f=Ad(t).queue;wd(t,f,s,te,o===null?tv:function(){return kd(t),o(l)})}function Ad(t){var s=t.memoizedState;if(s!==null)return s;s={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ii,lastRenderedState:te},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ii,lastRenderedState:o},next:null},t.memoizedState=s,t=t.alternate,t!==null&&(t.memoizedState=s),s}function kd(t){var s=Ad(t).next.queue;Ha(t,s,{},Ut())}function Dc(){return dt(no)}function Bd(){return Ze().memoizedState}function Rd(){return Ze().memoizedState}function iv(t){for(var s=t.return;s!==null;){switch(s.tag){case 24:case 3:var o=Ut();t=is(o);var l=ss(s,t,o);l!==null&&(Nt(l,s,o),Pa(l,s,o)),s={cache:cc()},t.payload=s;return}s=s.return}}function sv(t,s,o){var l=Ut();o={lane:l,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},tr(t)?Id(s,o):(o=Jl(t,s,o,l),o!==null&&(Nt(o,t,l),_d(o,s,l)))}function Ed(t,s,o){var l=Ut();Ha(t,s,o,l)}function Ha(t,s,o,l){var f={lane:l,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(tr(t))Id(s,f);else{var p=t.alternate;if(t.lanes===0&&(p===null||p.lanes===0)&&(p=s.lastRenderedReducer,p!==null))try{var S=s.lastRenderedState,T=p(S,o);if(f.hasEagerState=!0,f.eagerState=T,Dt(T,S))return Uo(t,s,f,0),Ue===null&&Fo(),!1}catch{}finally{}if(o=Jl(t,s,f,l),o!==null)return Nt(o,t,l),_d(o,s,l),!0}return!1}function Pc(t,s,o,l){if(l={lane:2,revertLane:fh(),action:l,hasEagerState:!1,eagerState:null,next:null},tr(t)){if(s)throw Error(n(479))}else s=Jl(t,o,l,2),s!==null&&Nt(s,t,2)}function tr(t){var s=t.alternate;return t===ve||s!==null&&s===ve}function Id(t,s){En=Zo=!0;var o=t.pending;o===null?s.next=s:(s.next=o.next,o.next=s),t.pending=s}function _d(t,s,o){if((o&4194048)!==0){var l=s.lanes;l&=t.pendingLanes,o|=l,s.lanes=o,Uu(t,o)}}var ir={readContext:dt,use:Qo,useCallback:Xe,useContext:Xe,useEffect:Xe,useImperativeHandle:Xe,useLayoutEffect:Xe,useInsertionEffect:Xe,useMemo:Xe,useReducer:Xe,useRef:Xe,useState:Xe,useDebugValue:Xe,useDeferredValue:Xe,useTransition:Xe,useSyncExternalStore:Xe,useId:Xe,useHostTransitionStatus:Xe,useFormState:Xe,useActionState:Xe,useOptimistic:Xe,useMemoCache:Xe,useCacheRefresh:Xe},xd={readContext:dt,use:Qo,useCallback:function(t,s){return At().memoizedState=[t,s===void 0?null:s],t},useContext:dt,useEffect:pd,useImperativeHandle:function(t,s,o){o=o!=null?o.concat([t]):null,er(4194308,4,bd.bind(null,s,t),o)},useLayoutEffect:function(t,s){return er(4194308,4,t,s)},useInsertionEffect:function(t,s){er(4,2,t,s)},useMemo:function(t,s){var o=At();s=s===void 0?null:s;var l=t();if(zs){Qi(!0);try{t()}finally{Qi(!1)}}return o.memoizedState=[l,s],l},useReducer:function(t,s,o){var l=At();if(o!==void 0){var f=o(s);if(zs){Qi(!0);try{o(s)}finally{Qi(!1)}}}else f=s;return l.memoizedState=l.baseState=f,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:f},l.queue=t,t=t.dispatch=sv.bind(null,ve,t),[l.memoizedState,t]},useRef:function(t){var s=At();return t={current:t},s.memoizedState=t},useState:function(t){t=Rc(t);var s=t.queue,o=Ed.bind(null,ve,s);return s.dispatch=o,[t.memoizedState,o]},useDebugValue:Ic,useDeferredValue:function(t,s){var o=At();return _c(o,t,s)},useTransition:function(){var t=Rc(!1);return t=wd.bind(null,ve,t.queue,!0,!1),At().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,s,o){var l=ve,f=At();if(ke){if(o===void 0)throw Error(n(407));o=o()}else{if(o=s(),Ue===null)throw Error(n(349));(Te&124)!==0||Jf(l,s,o)}f.memoizedState=o;var p={value:o,getSnapshot:s};return f.queue=p,pd(td.bind(null,l,p,t),[t]),l.flags|=2048,_n(9,Jo(),ed.bind(null,l,p,o,s),null),o},useId:function(){var t=At(),s=Ue.identifierPrefix;if(ke){var o=Bi,l=ki;o=(l&~(1<<32-xt(l)-1)).toString(32)+o,s="«"+s+"R"+o,o=Ko++,0<o&&(s+="H"+o.toString(32)),s+="»"}else o=Qy++,s="«"+s+"r"+o.toString(32)+"»";return t.memoizedState=s},useHostTransitionStatus:Dc,useFormState:hd,useActionState:hd,useOptimistic:function(t){var s=At();s.memoizedState=s.baseState=t;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=Pc.bind(null,ve,!0,o),o.dispatch=s,[t,s]},useMemoCache:Ac,useCacheRefresh:function(){return At().memoizedState=iv.bind(null,ve)}},Dd={readContext:dt,use:Qo,useCallback:Md,useContext:dt,useEffect:md,useImperativeHandle:Sd,useInsertionEffect:yd,useLayoutEffect:vd,useMemo:Cd,useReducer:$o,useRef:gd,useState:function(){return $o(Ii)},useDebugValue:Ic,useDeferredValue:function(t,s){var o=Ze();return Td(o,De.memoizedState,t,s)},useTransition:function(){var t=$o(Ii)[0],s=Ze().memoizedState;return[typeof t=="boolean"?t:Ua(t),s]},useSyncExternalStore:$f,useId:Bd,useHostTransitionStatus:Dc,useFormState:ud,useActionState:ud,useOptimistic:function(t,s){var o=Ze();return nd(o,De,t,s)},useMemoCache:Ac,useCacheRefresh:Rd},nv={readContext:dt,use:Qo,useCallback:Md,useContext:dt,useEffect:md,useImperativeHandle:Sd,useInsertionEffect:yd,useLayoutEffect:vd,useMemo:Cd,useReducer:Bc,useRef:gd,useState:function(){return Bc(Ii)},useDebugValue:Ic,useDeferredValue:function(t,s){var o=Ze();return De===null?_c(o,t,s):Td(o,De.memoizedState,t,s)},useTransition:function(){var t=Bc(Ii)[0],s=Ze().memoizedState;return[typeof t=="boolean"?t:Ua(t),s]},useSyncExternalStore:$f,useId:Bd,useHostTransitionStatus:Dc,useFormState:dd,useActionState:dd,useOptimistic:function(t,s){var o=Ze();return De!==null?nd(o,De,t,s):(o.baseState=t,[t,o.queue.dispatch])},useMemoCache:Ac,useCacheRefresh:Rd},xn=null,Wa=0;function sr(t){var s=Wa;return Wa+=1,xn===null&&(xn=[]),Vf(xn,t,s)}function za(t,s){s=s.props.ref,t.ref=s!==void 0?s:null}function nr(t,s){throw s.$$typeof===y?Error(n(525)):(t=Object.prototype.toString.call(s),Error(n(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t)))}function Pd(t){var s=t._init;return s(t._payload)}function Ld(t){function s(P,E){if(t){var L=P.deletions;L===null?(P.deletions=[E],P.flags|=16):L.push(E)}}function o(P,E){if(!t)return null;for(;E!==null;)s(P,E),E=E.sibling;return null}function l(P){for(var E=new Map;P!==null;)P.key!==null?E.set(P.key,P):E.set(P.index,P),P=P.sibling;return E}function f(P,E){return P=Ai(P,E),P.index=0,P.sibling=null,P}function p(P,E,L){return P.index=L,t?(L=P.alternate,L!==null?(L=L.index,L<E?(P.flags|=67108866,E):L):(P.flags|=67108866,E)):(P.flags|=1048576,E)}function S(P){return t&&P.alternate===null&&(P.flags|=67108866),P}function T(P,E,L,Y){return E===null||E.tag!==6?(E=tc(L,P.mode,Y),E.return=P,E):(E=f(E,L),E.return=P,E)}function B(P,E,L,Y){var re=L.type;return re===b?V(P,E,L.props.children,Y,L.key):E!==null&&(E.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===z&&Pd(re)===E.type)?(E=f(E,L.props),za(E,L),E.return=P,E):(E=Ho(L.type,L.key,L.props,null,P.mode,Y),za(E,L),E.return=P,E)}function O(P,E,L,Y){return E===null||E.tag!==4||E.stateNode.containerInfo!==L.containerInfo||E.stateNode.implementation!==L.implementation?(E=ic(L,P.mode,Y),E.return=P,E):(E=f(E,L.children||[]),E.return=P,E)}function V(P,E,L,Y,re){return E===null||E.tag!==7?(E=Ps(L,P.mode,Y,re),E.return=P,E):(E=f(E,L),E.return=P,E)}function j(P,E,L){if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return E=tc(""+E,P.mode,L),E.return=P,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case v:return L=Ho(E.type,E.key,E.props,null,P.mode,L),za(L,E),L.return=P,L;case M:return E=ic(E,P.mode,L),E.return=P,E;case z:var Y=E._init;return E=Y(E._payload),j(P,E,L)}if(se(E)||K(E))return E=Ps(E,P.mode,L,null),E.return=P,E;if(typeof E.then=="function")return j(P,sr(E),L);if(E.$$typeof===I)return j(P,Vo(P,E),L);nr(P,E)}return null}function F(P,E,L,Y){var re=E!==null?E.key:null;if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return re!==null?null:T(P,E,""+L,Y);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case v:return L.key===re?B(P,E,L,Y):null;case M:return L.key===re?O(P,E,L,Y):null;case z:return re=L._init,L=re(L._payload),F(P,E,L,Y)}if(se(L)||K(L))return re!==null?null:V(P,E,L,Y,null);if(typeof L.then=="function")return F(P,E,sr(L),Y);if(L.$$typeof===I)return F(P,E,Vo(P,L),Y);nr(P,L)}return null}function U(P,E,L,Y,re){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return P=P.get(L)||null,T(E,P,""+Y,re);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case v:return P=P.get(Y.key===null?L:Y.key)||null,B(E,P,Y,re);case M:return P=P.get(Y.key===null?L:Y.key)||null,O(E,P,Y,re);case z:var be=Y._init;return Y=be(Y._payload),U(P,E,L,Y,re)}if(se(Y)||K(Y))return P=P.get(L)||null,V(E,P,Y,re,null);if(typeof Y.then=="function")return U(P,E,L,sr(Y),re);if(Y.$$typeof===I)return U(P,E,L,Vo(E,Y),re);nr(E,Y)}return null}function ge(P,E,L,Y){for(var re=null,be=null,ce=E,de=E=0,it=null;ce!==null&&de<L.length;de++){ce.index>de?(it=ce,ce=null):it=ce.sibling;var Ae=F(P,ce,L[de],Y);if(Ae===null){ce===null&&(ce=it);break}t&&ce&&Ae.alternate===null&&s(P,ce),E=p(Ae,E,de),be===null?re=Ae:be.sibling=Ae,be=Ae,ce=it}if(de===L.length)return o(P,ce),ke&&Os(P,de),re;if(ce===null){for(;de<L.length;de++)ce=j(P,L[de],Y),ce!==null&&(E=p(ce,E,de),be===null?re=ce:be.sibling=ce,be=ce);return ke&&Os(P,de),re}for(ce=l(ce);de<L.length;de++)it=U(ce,P,de,L[de],Y),it!==null&&(t&&it.alternate!==null&&ce.delete(it.key===null?de:it.key),E=p(it,E,de),be===null?re=it:be.sibling=it,be=it);return t&&ce.forEach(function(Ss){return s(P,Ss)}),ke&&Os(P,de),re}function fe(P,E,L,Y){if(L==null)throw Error(n(151));for(var re=null,be=null,ce=E,de=E=0,it=null,Ae=L.next();ce!==null&&!Ae.done;de++,Ae=L.next()){ce.index>de?(it=ce,ce=null):it=ce.sibling;var Ss=F(P,ce,Ae.value,Y);if(Ss===null){ce===null&&(ce=it);break}t&&ce&&Ss.alternate===null&&s(P,ce),E=p(Ss,E,de),be===null?re=Ss:be.sibling=Ss,be=Ss,ce=it}if(Ae.done)return o(P,ce),ke&&Os(P,de),re;if(ce===null){for(;!Ae.done;de++,Ae=L.next())Ae=j(P,Ae.value,Y),Ae!==null&&(E=p(Ae,E,de),be===null?re=Ae:be.sibling=Ae,be=Ae);return ke&&Os(P,de),re}for(ce=l(ce);!Ae.done;de++,Ae=L.next())Ae=U(ce,P,de,Ae.value,Y),Ae!==null&&(t&&Ae.alternate!==null&&ce.delete(Ae.key===null?de:Ae.key),E=p(Ae,E,de),be===null?re=Ae:be.sibling=Ae,be=Ae);return t&&ce.forEach(function(ab){return s(P,ab)}),ke&&Os(P,de),re}function Le(P,E,L,Y){if(typeof L=="object"&&L!==null&&L.type===b&&L.key===null&&(L=L.props.children),typeof L=="object"&&L!==null){switch(L.$$typeof){case v:e:{for(var re=L.key;E!==null;){if(E.key===re){if(re=L.type,re===b){if(E.tag===7){o(P,E.sibling),Y=f(E,L.props.children),Y.return=P,P=Y;break e}}else if(E.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===z&&Pd(re)===E.type){o(P,E.sibling),Y=f(E,L.props),za(Y,L),Y.return=P,P=Y;break e}o(P,E);break}else s(P,E);E=E.sibling}L.type===b?(Y=Ps(L.props.children,P.mode,Y,L.key),Y.return=P,P=Y):(Y=Ho(L.type,L.key,L.props,null,P.mode,Y),za(Y,L),Y.return=P,P=Y)}return S(P);case M:e:{for(re=L.key;E!==null;){if(E.key===re)if(E.tag===4&&E.stateNode.containerInfo===L.containerInfo&&E.stateNode.implementation===L.implementation){o(P,E.sibling),Y=f(E,L.children||[]),Y.return=P,P=Y;break e}else{o(P,E);break}else s(P,E);E=E.sibling}Y=ic(L,P.mode,Y),Y.return=P,P=Y}return S(P);case z:return re=L._init,L=re(L._payload),Le(P,E,L,Y)}if(se(L))return ge(P,E,L,Y);if(K(L)){if(re=K(L),typeof re!="function")throw Error(n(150));return L=re.call(L),fe(P,E,L,Y)}if(typeof L.then=="function")return Le(P,E,sr(L),Y);if(L.$$typeof===I)return Le(P,E,Vo(P,L),Y);nr(P,L)}return typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint"?(L=""+L,E!==null&&E.tag===6?(o(P,E.sibling),Y=f(E,L),Y.return=P,P=Y):(o(P,E),Y=tc(L,P.mode,Y),Y.return=P,P=Y),S(P)):o(P,E)}return function(P,E,L,Y){try{Wa=0;var re=Le(P,E,L,Y);return xn=null,re}catch(ce){if(ce===xa||ce===Yo)throw ce;var be=Pt(29,ce,null,P.mode);return be.lanes=Y,be.return=P,be}finally{}}}var Dn=Ld(!0),Od=Ld(!1),jt=H(null),gi=null;function as(t){var s=t.alternate;$(Qe,Qe.current&1),$(jt,t),gi===null&&(s===null||Rn.current!==null||s.memoizedState!==null)&&(gi=t)}function Fd(t){if(t.tag===22){if($(Qe,Qe.current),$(jt,t),gi===null){var s=t.alternate;s!==null&&s.memoizedState!==null&&(gi=t)}}else os()}function os(){$(Qe,Qe.current),$(jt,jt.current)}function _i(t){J(jt),gi===t&&(gi=null),J(Qe)}var Qe=H(0);function ar(t){for(var s=t;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||wh(o)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Lc(t,s,o,l){s=t.memoizedState,o=o(l,s),o=o==null?s:m({},s,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var Oc={enqueueSetState:function(t,s,o){t=t._reactInternals;var l=Ut(),f=is(l);f.payload=s,o!=null&&(f.callback=o),s=ss(t,f,l),s!==null&&(Nt(s,t,l),Pa(s,t,l))},enqueueReplaceState:function(t,s,o){t=t._reactInternals;var l=Ut(),f=is(l);f.tag=1,f.payload=s,o!=null&&(f.callback=o),s=ss(t,f,l),s!==null&&(Nt(s,t,l),Pa(s,t,l))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var o=Ut(),l=is(o);l.tag=2,s!=null&&(l.callback=s),s=ss(t,l,o),s!==null&&(Nt(s,t,o),Pa(s,t,o))}};function Ud(t,s,o,l,f,p,S){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,p,S):s.prototype&&s.prototype.isPureReactComponent?!wa(o,l)||!wa(f,p):!0}function Nd(t,s,o,l){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,l),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,l),s.state!==t&&Oc.enqueueReplaceState(s,s.state,null)}function Gs(t,s){var o=s;if("ref"in s){o={};for(var l in s)l!=="ref"&&(o[l]=s[l])}if(t=t.defaultProps){o===s&&(o=m({},o));for(var f in t)o[f]===void 0&&(o[f]=t[f])}return o}var or=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function Hd(t){or(t)}function Wd(t){console.error(t)}function zd(t){or(t)}function rr(t,s){try{var o=t.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(l){setTimeout(function(){throw l})}}function Gd(t,s,o){try{var l=t.onCaughtError;l(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(f){setTimeout(function(){throw f})}}function Fc(t,s,o){return o=is(o),o.tag=3,o.payload={element:null},o.callback=function(){rr(t,s)},o}function Vd(t){return t=is(t),t.tag=3,t}function Xd(t,s,o,l){var f=o.type.getDerivedStateFromError;if(typeof f=="function"){var p=l.value;t.payload=function(){return f(p)},t.callback=function(){Gd(s,o,l)}}var S=o.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(t.callback=function(){Gd(s,o,l),typeof f!="function"&&(fs===null?fs=new Set([this]):fs.add(this));var T=l.stack;this.componentDidCatch(l.value,{componentStack:T!==null?T:""})})}function av(t,s,o,l,f){if(o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(s=o.alternate,s!==null&&Ea(s,o,f,!0),o=jt.current,o!==null){switch(o.tag){case 13:return gi===null?rh():o.alternate===null&&Ve===0&&(Ve=3),o.flags&=-257,o.flags|=65536,o.lanes=f,l===fc?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([l]):s.add(l),ch(t,l,f)),!1;case 22:return o.flags|=65536,l===fc?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([l])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([l]):o.add(l)),ch(t,l,f)),!1}throw Error(n(435,o.tag))}return ch(t,l,f),rh(),!1}if(ke)return s=jt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=f,l!==ac&&(t=Error(n(422),{cause:l}),Ra(Vt(t,o)))):(l!==ac&&(s=Error(n(423),{cause:l}),Ra(Vt(s,o))),t=t.current.alternate,t.flags|=65536,f&=-f,t.lanes|=f,l=Vt(l,o),f=Fc(t.stateNode,l,f),pc(t,f),Ve!==4&&(Ve=2)),!1;var p=Error(n(520),{cause:l});if(p=Vt(p,o),Za===null?Za=[p]:Za.push(p),Ve!==4&&(Ve=2),s===null)return!0;l=Vt(l,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,t=f&-f,o.lanes|=t,t=Fc(o.stateNode,l,t),pc(o,t),!1;case 1:if(s=o.type,p=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(fs===null||!fs.has(p))))return o.flags|=65536,f&=-f,o.lanes|=f,f=Vd(f),Xd(f,t,o,l),pc(o,f),!1}o=o.return}while(o!==null);return!1}var Yd=Error(n(461)),et=!1;function nt(t,s,o,l){s.child=t===null?Od(s,null,o,l):Dn(s,t.child,o,l)}function qd(t,s,o,l,f){o=o.render;var p=s.ref;if("ref"in l){var S={};for(var T in l)T!=="ref"&&(S[T]=l[T])}else S=l;return Hs(s),l=Sc(t,s,o,S,p,f),T=Mc(),t!==null&&!et?(Cc(t,s,f),xi(t,s,f)):(ke&&T&&sc(s),s.flags|=1,nt(t,s,l,f),s.child)}function jd(t,s,o,l,f){if(t===null){var p=o.type;return typeof p=="function"&&!ec(p)&&p.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=p,Zd(t,s,p,l,f)):(t=Ho(o.type,null,l,s,s.mode,f),t.ref=s.ref,t.return=s,s.child=t)}if(p=t.child,!Xc(t,f)){var S=p.memoizedProps;if(o=o.compare,o=o!==null?o:wa,o(S,l)&&t.ref===s.ref)return xi(t,s,f)}return s.flags|=1,t=Ai(p,l),t.ref=s.ref,t.return=s,s.child=t}function Zd(t,s,o,l,f){if(t!==null){var p=t.memoizedProps;if(wa(p,l)&&t.ref===s.ref)if(et=!1,s.pendingProps=l=p,Xc(t,f))(t.flags&131072)!==0&&(et=!0);else return s.lanes=t.lanes,xi(t,s,f)}return Uc(t,s,o,l,f)}function Kd(t,s,o){var l=s.pendingProps,f=l.children,p=t!==null?t.memoizedState:null;if(l.mode==="hidden"){if((s.flags&128)!==0){if(l=p!==null?p.baseLanes|o:o,t!==null){for(f=s.child=t.child,p=0;f!==null;)p=p|f.lanes|f.childLanes,f=f.sibling;s.childLanes=p&~l}else s.childLanes=0,s.child=null;return Qd(t,s,l,o)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},t!==null&&Xo(s,p!==null?p.cachePool:null),p!==null?Zf(s,p):yc(),Fd(s);else return s.lanes=s.childLanes=536870912,Qd(t,s,p!==null?p.baseLanes|o:o,o)}else p!==null?(Xo(s,p.cachePool),Zf(s,p),os(),s.memoizedState=null):(t!==null&&Xo(s,null),yc(),os());return nt(t,s,f,o),s.child}function Qd(t,s,o,l){var f=uc();return f=f===null?null:{parent:Ke._currentValue,pool:f},s.memoizedState={baseLanes:o,cachePool:f},t!==null&&Xo(s,null),yc(),Fd(s),t!==null&&Ea(t,s,l,!0),null}function lr(t,s){var o=s.ref;if(o===null)t!==null&&t.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(n(284));(t===null||t.ref!==o)&&(s.flags|=4194816)}}function Uc(t,s,o,l,f){return Hs(s),o=Sc(t,s,o,l,void 0,f),l=Mc(),t!==null&&!et?(Cc(t,s,f),xi(t,s,f)):(ke&&l&&sc(s),s.flags|=1,nt(t,s,o,f),s.child)}function $d(t,s,o,l,f,p){return Hs(s),s.updateQueue=null,o=Qf(s,l,o,f),Kf(t),l=Mc(),t!==null&&!et?(Cc(t,s,p),xi(t,s,p)):(ke&&l&&sc(s),s.flags|=1,nt(t,s,o,p),s.child)}function Jd(t,s,o,l,f){if(Hs(s),s.stateNode===null){var p=Tn,S=o.contextType;typeof S=="object"&&S!==null&&(p=dt(S)),p=new o(l,p),s.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Oc,s.stateNode=p,p._reactInternals=s,p=s.stateNode,p.props=l,p.state=s.memoizedState,p.refs={},dc(s),S=o.contextType,p.context=typeof S=="object"&&S!==null?dt(S):Tn,p.state=s.memoizedState,S=o.getDerivedStateFromProps,typeof S=="function"&&(Lc(s,o,S,l),p.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(S=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),S!==p.state&&Oc.enqueueReplaceState(p,p.state,null),Oa(s,l,p,f),La(),p.state=s.memoizedState),typeof p.componentDidMount=="function"&&(s.flags|=4194308),l=!0}else if(t===null){p=s.stateNode;var T=s.memoizedProps,B=Gs(o,T);p.props=B;var O=p.context,V=o.contextType;S=Tn,typeof V=="object"&&V!==null&&(S=dt(V));var j=o.getDerivedStateFromProps;V=typeof j=="function"||typeof p.getSnapshotBeforeUpdate=="function",T=s.pendingProps!==T,V||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(T||O!==S)&&Nd(s,p,l,S),ts=!1;var F=s.memoizedState;p.state=F,Oa(s,l,p,f),La(),O=s.memoizedState,T||F!==O||ts?(typeof j=="function"&&(Lc(s,o,j,l),O=s.memoizedState),(B=ts||Ud(s,o,B,l,F,O,S))?(V||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(s.flags|=4194308)):(typeof p.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=l,s.memoizedState=O),p.props=l,p.state=O,p.context=S,l=B):(typeof p.componentDidMount=="function"&&(s.flags|=4194308),l=!1)}else{p=s.stateNode,gc(t,s),S=s.memoizedProps,V=Gs(o,S),p.props=V,j=s.pendingProps,F=p.context,O=o.contextType,B=Tn,typeof O=="object"&&O!==null&&(B=dt(O)),T=o.getDerivedStateFromProps,(O=typeof T=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(S!==j||F!==B)&&Nd(s,p,l,B),ts=!1,F=s.memoizedState,p.state=F,Oa(s,l,p,f),La();var U=s.memoizedState;S!==j||F!==U||ts||t!==null&&t.dependencies!==null&&Go(t.dependencies)?(typeof T=="function"&&(Lc(s,o,T,l),U=s.memoizedState),(V=ts||Ud(s,o,V,l,F,U,B)||t!==null&&t.dependencies!==null&&Go(t.dependencies))?(O||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(l,U,B),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(l,U,B)),typeof p.componentDidUpdate=="function"&&(s.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof p.componentDidUpdate!="function"||S===t.memoizedProps&&F===t.memoizedState||(s.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||S===t.memoizedProps&&F===t.memoizedState||(s.flags|=1024),s.memoizedProps=l,s.memoizedState=U),p.props=l,p.state=U,p.context=B,l=V):(typeof p.componentDidUpdate!="function"||S===t.memoizedProps&&F===t.memoizedState||(s.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||S===t.memoizedProps&&F===t.memoizedState||(s.flags|=1024),l=!1)}return p=l,lr(t,s),l=(s.flags&128)!==0,p||l?(p=s.stateNode,o=l&&typeof o.getDerivedStateFromError!="function"?null:p.render(),s.flags|=1,t!==null&&l?(s.child=Dn(s,t.child,null,f),s.child=Dn(s,null,o,f)):nt(t,s,o,f),s.memoizedState=p.state,t=s.child):t=xi(t,s,f),t}function e0(t,s,o,l){return Ba(),s.flags|=256,nt(t,s,o,l),s.child}var Nc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Hc(t){return{baseLanes:t,cachePool:Wf()}}function Wc(t,s,o){return t=t!==null?t.childLanes&~o:0,s&&(t|=Zt),t}function t0(t,s,o){var l=s.pendingProps,f=!1,p=(s.flags&128)!==0,S;if((S=p)||(S=t!==null&&t.memoizedState===null?!1:(Qe.current&2)!==0),S&&(f=!0,s.flags&=-129),S=(s.flags&32)!==0,s.flags&=-33,t===null){if(ke){if(f?as(s):os(),ke){var T=Ge,B;if(B=T){e:{for(B=T,T=di;B.nodeType!==8;){if(!T){T=null;break e}if(B=ai(B.nextSibling),B===null){T=null;break e}}T=B}T!==null?(s.memoizedState={dehydrated:T,treeContext:Ls!==null?{id:ki,overflow:Bi}:null,retryLane:536870912,hydrationErrors:null},B=Pt(18,null,null,0),B.stateNode=T,B.return=s,s.child=B,bt=s,Ge=null,B=!0):B=!1}B||Us(s)}if(T=s.memoizedState,T!==null&&(T=T.dehydrated,T!==null))return wh(T)?s.lanes=32:s.lanes=536870912,null;_i(s)}return T=l.children,l=l.fallback,f?(os(),f=s.mode,T=cr({mode:"hidden",children:T},f),l=Ps(l,f,o,null),T.return=s,l.return=s,T.sibling=l,s.child=T,f=s.child,f.memoizedState=Hc(o),f.childLanes=Wc(t,S,o),s.memoizedState=Nc,l):(as(s),zc(s,T))}if(B=t.memoizedState,B!==null&&(T=B.dehydrated,T!==null)){if(p)s.flags&256?(as(s),s.flags&=-257,s=Gc(t,s,o)):s.memoizedState!==null?(os(),s.child=t.child,s.flags|=128,s=null):(os(),f=l.fallback,T=s.mode,l=cr({mode:"visible",children:l.children},T),f=Ps(f,T,o,null),f.flags|=2,l.return=s,f.return=s,l.sibling=f,s.child=l,Dn(s,t.child,null,o),l=s.child,l.memoizedState=Hc(o),l.childLanes=Wc(t,S,o),s.memoizedState=Nc,s=f);else if(as(s),wh(T)){if(S=T.nextSibling&&T.nextSibling.dataset,S)var O=S.dgst;S=O,l=Error(n(419)),l.stack="",l.digest=S,Ra({value:l,source:null,stack:null}),s=Gc(t,s,o)}else if(et||Ea(t,s,o,!1),S=(o&t.childLanes)!==0,et||S){if(S=Ue,S!==null&&(l=o&-o,l=(l&42)!==0?1:Al(l),l=(l&(S.suspendedLanes|o))!==0?0:l,l!==0&&l!==B.retryLane))throw B.retryLane=l,Cn(t,l),Nt(S,t,l),Yd;T.data==="$?"||rh(),s=Gc(t,s,o)}else T.data==="$?"?(s.flags|=192,s.child=t.child,s=null):(t=B.treeContext,Ge=ai(T.nextSibling),bt=s,ke=!0,Fs=null,di=!1,t!==null&&(Yt[qt++]=ki,Yt[qt++]=Bi,Yt[qt++]=Ls,ki=t.id,Bi=t.overflow,Ls=s),s=zc(s,l.children),s.flags|=4096);return s}return f?(os(),f=l.fallback,T=s.mode,B=t.child,O=B.sibling,l=Ai(B,{mode:"hidden",children:l.children}),l.subtreeFlags=B.subtreeFlags&65011712,O!==null?f=Ai(O,f):(f=Ps(f,T,o,null),f.flags|=2),f.return=s,l.return=s,l.sibling=f,s.child=l,l=f,f=s.child,T=t.child.memoizedState,T===null?T=Hc(o):(B=T.cachePool,B!==null?(O=Ke._currentValue,B=B.parent!==O?{parent:O,pool:O}:B):B=Wf(),T={baseLanes:T.baseLanes|o,cachePool:B}),f.memoizedState=T,f.childLanes=Wc(t,S,o),s.memoizedState=Nc,l):(as(s),o=t.child,t=o.sibling,o=Ai(o,{mode:"visible",children:l.children}),o.return=s,o.sibling=null,t!==null&&(S=s.deletions,S===null?(s.deletions=[t],s.flags|=16):S.push(t)),s.child=o,s.memoizedState=null,o)}function zc(t,s){return s=cr({mode:"visible",children:s},t.mode),s.return=t,t.child=s}function cr(t,s){return t=Pt(22,t,null,s),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Gc(t,s,o){return Dn(s,t.child,null,o),t=zc(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function i0(t,s,o){t.lanes|=s;var l=t.alternate;l!==null&&(l.lanes|=s),rc(t.return,s,o)}function Vc(t,s,o,l,f){var p=t.memoizedState;p===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:l,tail:o,tailMode:f}:(p.isBackwards=s,p.rendering=null,p.renderingStartTime=0,p.last=l,p.tail=o,p.tailMode=f)}function s0(t,s,o){var l=s.pendingProps,f=l.revealOrder,p=l.tail;if(nt(t,s,l.children,o),l=Qe.current,(l&2)!==0)l=l&1|2,s.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&i0(t,o,s);else if(t.tag===19)i0(t,o,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}l&=1}switch($(Qe,l),f){case"forwards":for(o=s.child,f=null;o!==null;)t=o.alternate,t!==null&&ar(t)===null&&(f=o),o=o.sibling;o=f,o===null?(f=s.child,s.child=null):(f=o.sibling,o.sibling=null),Vc(s,!1,f,o,p);break;case"backwards":for(o=null,f=s.child,s.child=null;f!==null;){if(t=f.alternate,t!==null&&ar(t)===null){s.child=f;break}t=f.sibling,f.sibling=o,o=f,f=t}Vc(s,!0,o,null,p);break;case"together":Vc(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function xi(t,s,o){if(t!==null&&(s.dependencies=t.dependencies),us|=s.lanes,(o&s.childLanes)===0)if(t!==null){if(Ea(t,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(t!==null&&s.child!==t.child)throw Error(n(153));if(s.child!==null){for(t=s.child,o=Ai(t,t.pendingProps),s.child=o,o.return=s;t.sibling!==null;)t=t.sibling,o=o.sibling=Ai(t,t.pendingProps),o.return=s;o.sibling=null}return s.child}function Xc(t,s){return(t.lanes&s)!==0?!0:(t=t.dependencies,!!(t!==null&&Go(t)))}function ov(t,s,o){switch(s.tag){case 3:Fe(s,s.stateNode.containerInfo),es(s,Ke,t.memoizedState.cache),Ba();break;case 27:case 5:ua(s);break;case 4:Fe(s,s.stateNode.containerInfo);break;case 10:es(s,s.type,s.memoizedProps.value);break;case 13:var l=s.memoizedState;if(l!==null)return l.dehydrated!==null?(as(s),s.flags|=128,null):(o&s.child.childLanes)!==0?t0(t,s,o):(as(s),t=xi(t,s,o),t!==null?t.sibling:null);as(s);break;case 19:var f=(t.flags&128)!==0;if(l=(o&s.childLanes)!==0,l||(Ea(t,s,o,!1),l=(o&s.childLanes)!==0),f){if(l)return s0(t,s,o);s.flags|=128}if(f=s.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),$(Qe,Qe.current),l)break;return null;case 22:case 23:return s.lanes=0,Kd(t,s,o);case 24:es(s,Ke,t.memoizedState.cache)}return xi(t,s,o)}function n0(t,s,o){if(t!==null)if(t.memoizedProps!==s.pendingProps)et=!0;else{if(!Xc(t,o)&&(s.flags&128)===0)return et=!1,ov(t,s,o);et=(t.flags&131072)!==0}else et=!1,ke&&(s.flags&1048576)!==0&&Pf(s,zo,s.index);switch(s.lanes=0,s.tag){case 16:e:{t=s.pendingProps;var l=s.elementType,f=l._init;if(l=f(l._payload),s.type=l,typeof l=="function")ec(l)?(t=Gs(l,t),s.tag=1,s=Jd(null,s,l,t,o)):(s.tag=0,s=Uc(null,s,l,t,o));else{if(l!=null){if(f=l.$$typeof,f===_){s.tag=11,s=qd(null,s,l,t,o);break e}else if(f===W){s.tag=14,s=jd(null,s,l,t,o);break e}}throw s=Z(l)||l,Error(n(306,s,""))}}return s;case 0:return Uc(t,s,s.type,s.pendingProps,o);case 1:return l=s.type,f=Gs(l,s.pendingProps),Jd(t,s,l,f,o);case 3:e:{if(Fe(s,s.stateNode.containerInfo),t===null)throw Error(n(387));l=s.pendingProps;var p=s.memoizedState;f=p.element,gc(t,s),Oa(s,l,null,o);var S=s.memoizedState;if(l=S.cache,es(s,Ke,l),l!==p.cache&&lc(s,[Ke],o,!0),La(),l=S.element,p.isDehydrated)if(p={element:l,isDehydrated:!1,cache:S.cache},s.updateQueue.baseState=p,s.memoizedState=p,s.flags&256){s=e0(t,s,l,o);break e}else if(l!==f){f=Vt(Error(n(424)),s),Ra(f),s=e0(t,s,l,o);break e}else{switch(t=s.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Ge=ai(t.firstChild),bt=s,ke=!0,Fs=null,di=!0,o=Od(s,null,l,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(Ba(),l===f){s=xi(t,s,o);break e}nt(t,s,l,o)}s=s.child}return s;case 26:return lr(t,s),t===null?(o=lg(s.type,null,s.pendingProps,null))?s.memoizedState=o:ke||(o=s.type,t=s.pendingProps,l=Tr(ue.current).createElement(o),l[ft]=s,l[Tt]=t,ot(l,o,t),Je(l),s.stateNode=l):s.memoizedState=lg(s.type,t.memoizedProps,s.pendingProps,t.memoizedState),null;case 27:return ua(s),t===null&&ke&&(l=s.stateNode=ag(s.type,s.pendingProps,ue.current),bt=s,di=!0,f=Ge,ps(s.type)?(Ah=f,Ge=ai(l.firstChild)):Ge=f),nt(t,s,s.pendingProps.children,o),lr(t,s),t===null&&(s.flags|=4194304),s.child;case 5:return t===null&&ke&&((f=l=Ge)&&(l=Pv(l,s.type,s.pendingProps,di),l!==null?(s.stateNode=l,bt=s,Ge=ai(l.firstChild),di=!1,f=!0):f=!1),f||Us(s)),ua(s),f=s.type,p=s.pendingProps,S=t!==null?t.memoizedProps:null,l=p.children,Mh(f,p)?l=null:S!==null&&Mh(f,S)&&(s.flags|=32),s.memoizedState!==null&&(f=Sc(t,s,$y,null,null,o),no._currentValue=f),lr(t,s),nt(t,s,l,o),s.child;case 6:return t===null&&ke&&((t=o=Ge)&&(o=Lv(o,s.pendingProps,di),o!==null?(s.stateNode=o,bt=s,Ge=null,t=!0):t=!1),t||Us(s)),null;case 13:return t0(t,s,o);case 4:return Fe(s,s.stateNode.containerInfo),l=s.pendingProps,t===null?s.child=Dn(s,null,l,o):nt(t,s,l,o),s.child;case 11:return qd(t,s,s.type,s.pendingProps,o);case 7:return nt(t,s,s.pendingProps,o),s.child;case 8:return nt(t,s,s.pendingProps.children,o),s.child;case 12:return nt(t,s,s.pendingProps.children,o),s.child;case 10:return l=s.pendingProps,es(s,s.type,l.value),nt(t,s,l.children,o),s.child;case 9:return f=s.type._context,l=s.pendingProps.children,Hs(s),f=dt(f),l=l(f),s.flags|=1,nt(t,s,l,o),s.child;case 14:return jd(t,s,s.type,s.pendingProps,o);case 15:return Zd(t,s,s.type,s.pendingProps,o);case 19:return s0(t,s,o);case 31:return l=s.pendingProps,o=s.mode,l={mode:l.mode,children:l.children},t===null?(o=cr(l,o),o.ref=s.ref,s.child=o,o.return=s,s=o):(o=Ai(t.child,l),o.ref=s.ref,s.child=o,o.return=s,s=o),s;case 22:return Kd(t,s,o);case 24:return Hs(s),l=dt(Ke),t===null?(f=uc(),f===null&&(f=Ue,p=cc(),f.pooledCache=p,p.refCount++,p!==null&&(f.pooledCacheLanes|=o),f=p),s.memoizedState={parent:l,cache:f},dc(s),es(s,Ke,f)):((t.lanes&o)!==0&&(gc(t,s),Oa(s,null,null,o),La()),f=t.memoizedState,p=s.memoizedState,f.parent!==l?(f={parent:l,cache:l},s.memoizedState=f,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=f),es(s,Ke,l)):(l=p.cache,es(s,Ke,l),l!==f.cache&&lc(s,[Ke],o,!0))),nt(t,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(n(156,s.tag))}function Di(t){t.flags|=4}function a0(t,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!dg(s)){if(s=jt.current,s!==null&&((Te&4194048)===Te?gi!==null:(Te&62914560)!==Te&&(Te&536870912)===0||s!==gi))throw Da=fc,zf;t.flags|=8192}}function hr(t,s){s!==null&&(t.flags|=4),t.flags&16384&&(s=t.tag!==22?Ou():536870912,t.lanes|=s,Fn|=s)}function Ga(t,s){if(!ke)switch(t.tailMode){case"hidden":s=t.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function ze(t){var s=t.alternate!==null&&t.alternate.child===t.child,o=0,l=0;if(s)for(var f=t.child;f!==null;)o|=f.lanes|f.childLanes,l|=f.subtreeFlags&65011712,l|=f.flags&65011712,f.return=t,f=f.sibling;else for(f=t.child;f!==null;)o|=f.lanes|f.childLanes,l|=f.subtreeFlags,l|=f.flags,f.return=t,f=f.sibling;return t.subtreeFlags|=l,t.childLanes=o,s}function rv(t,s,o){var l=s.pendingProps;switch(nc(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ze(s),null;case 1:return ze(s),null;case 3:return o=s.stateNode,l=null,t!==null&&(l=t.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Ei(Ke),ui(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(ka(s)?Di(s):t===null||t.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ff())),ze(s),null;case 26:return o=s.memoizedState,t===null?(Di(s),o!==null?(ze(s),a0(s,o)):(ze(s),s.flags&=-16777217)):o?o!==t.memoizedState?(Di(s),ze(s),a0(s,o)):(ze(s),s.flags&=-16777217):(t.memoizedProps!==l&&Di(s),ze(s),s.flags&=-16777217),null;case 27:Ki(s),o=ue.current;var f=s.type;if(t!==null&&s.stateNode!=null)t.memoizedProps!==l&&Di(s);else{if(!l){if(s.stateNode===null)throw Error(n(166));return ze(s),null}t=oe.current,ka(s)?Lf(s):(t=ag(f,l,o),s.stateNode=t,Di(s))}return ze(s),null;case 5:if(Ki(s),o=s.type,t!==null&&s.stateNode!=null)t.memoizedProps!==l&&Di(s);else{if(!l){if(s.stateNode===null)throw Error(n(166));return ze(s),null}if(t=oe.current,ka(s))Lf(s);else{switch(f=Tr(ue.current),t){case 1:t=f.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:t=f.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":t=f.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":t=f.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":t=f.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof l.is=="string"?f.createElement("select",{is:l.is}):f.createElement("select"),l.multiple?t.multiple=!0:l.size&&(t.size=l.size);break;default:t=typeof l.is=="string"?f.createElement(o,{is:l.is}):f.createElement(o)}}t[ft]=s,t[Tt]=l;e:for(f=s.child;f!==null;){if(f.tag===5||f.tag===6)t.appendChild(f.stateNode);else if(f.tag!==4&&f.tag!==27&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===s)break e;for(;f.sibling===null;){if(f.return===null||f.return===s)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}s.stateNode=t;e:switch(ot(t,o,l),o){case"button":case"input":case"select":case"textarea":t=!!l.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&Di(s)}}return ze(s),s.flags&=-16777217,null;case 6:if(t&&s.stateNode!=null)t.memoizedProps!==l&&Di(s);else{if(typeof l!="string"&&s.stateNode===null)throw Error(n(166));if(t=ue.current,ka(s)){if(t=s.stateNode,o=s.memoizedProps,l=null,f=bt,f!==null)switch(f.tag){case 27:case 5:l=f.memoizedProps}t[ft]=s,t=!!(t.nodeValue===o||l!==null&&l.suppressHydrationWarning===!0||$0(t.nodeValue,o)),t||Us(s)}else t=Tr(t).createTextNode(l),t[ft]=s,s.stateNode=t}return ze(s),null;case 13:if(l=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(f=ka(s),l!==null&&l.dehydrated!==null){if(t===null){if(!f)throw Error(n(318));if(f=s.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(n(317));f[ft]=s}else Ba(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;ze(s),f=!1}else f=Ff(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=f),f=!0;if(!f)return s.flags&256?(_i(s),s):(_i(s),null)}if(_i(s),(s.flags&128)!==0)return s.lanes=o,s;if(o=l!==null,t=t!==null&&t.memoizedState!==null,o){l=s.child,f=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(f=l.alternate.memoizedState.cachePool.pool);var p=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==f&&(l.flags|=2048)}return o!==t&&o&&(s.child.flags|=8192),hr(s,s.updateQueue),ze(s),null;case 4:return ui(),t===null&&mh(s.stateNode.containerInfo),ze(s),null;case 10:return Ei(s.type),ze(s),null;case 19:if(J(Qe),f=s.memoizedState,f===null)return ze(s),null;if(l=(s.flags&128)!==0,p=f.rendering,p===null)if(l)Ga(f,!1);else{if(Ve!==0||t!==null&&(t.flags&128)!==0)for(t=s.child;t!==null;){if(p=ar(t),p!==null){for(s.flags|=128,Ga(f,!1),t=p.updateQueue,s.updateQueue=t,hr(s,t),s.subtreeFlags=0,t=o,o=s.child;o!==null;)Df(o,t),o=o.sibling;return $(Qe,Qe.current&1|2),s.child}t=t.sibling}f.tail!==null&&fi()>dr&&(s.flags|=128,l=!0,Ga(f,!1),s.lanes=4194304)}else{if(!l)if(t=ar(p),t!==null){if(s.flags|=128,l=!0,t=t.updateQueue,s.updateQueue=t,hr(s,t),Ga(f,!0),f.tail===null&&f.tailMode==="hidden"&&!p.alternate&&!ke)return ze(s),null}else 2*fi()-f.renderingStartTime>dr&&o!==536870912&&(s.flags|=128,l=!0,Ga(f,!1),s.lanes=4194304);f.isBackwards?(p.sibling=s.child,s.child=p):(t=f.last,t!==null?t.sibling=p:s.child=p,f.last=p)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=fi(),s.sibling=null,t=Qe.current,$(Qe,l?t&1|2:t&1),s):(ze(s),null);case 22:case 23:return _i(s),vc(),l=s.memoizedState!==null,t!==null?t.memoizedState!==null!==l&&(s.flags|=8192):l&&(s.flags|=8192),l?(o&536870912)!==0&&(s.flags&128)===0&&(ze(s),s.subtreeFlags&6&&(s.flags|=8192)):ze(s),o=s.updateQueue,o!==null&&hr(s,o.retryQueue),o=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),l=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),l!==o&&(s.flags|=2048),t!==null&&J(Ws),null;case 24:return o=null,t!==null&&(o=t.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),Ei(Ke),ze(s),null;case 25:return null;case 30:return null}throw Error(n(156,s.tag))}function lv(t,s){switch(nc(s),s.tag){case 1:return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return Ei(Ke),ui(),t=s.flags,(t&65536)!==0&&(t&128)===0?(s.flags=t&-65537|128,s):null;case 26:case 27:case 5:return Ki(s),null;case 13:if(_i(s),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(n(340));Ba()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return J(Qe),null;case 4:return ui(),null;case 10:return Ei(s.type),null;case 22:case 23:return _i(s),vc(),t!==null&&J(Ws),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 24:return Ei(Ke),null;case 25:return null;default:return null}}function o0(t,s){switch(nc(s),s.tag){case 3:Ei(Ke),ui();break;case 26:case 27:case 5:Ki(s);break;case 4:ui();break;case 13:_i(s);break;case 19:J(Qe);break;case 10:Ei(s.type);break;case 22:case 23:_i(s),vc(),t!==null&&J(Ws);break;case 24:Ei(Ke)}}function Va(t,s){try{var o=s.updateQueue,l=o!==null?o.lastEffect:null;if(l!==null){var f=l.next;o=f;do{if((o.tag&t)===t){l=void 0;var p=o.create,S=o.inst;l=p(),S.destroy=l}o=o.next}while(o!==f)}}catch(T){Oe(s,s.return,T)}}function rs(t,s,o){try{var l=s.updateQueue,f=l!==null?l.lastEffect:null;if(f!==null){var p=f.next;l=p;do{if((l.tag&t)===t){var S=l.inst,T=S.destroy;if(T!==void 0){S.destroy=void 0,f=s;var B=o,O=T;try{O()}catch(V){Oe(f,B,V)}}}l=l.next}while(l!==p)}}catch(V){Oe(s,s.return,V)}}function r0(t){var s=t.updateQueue;if(s!==null){var o=t.stateNode;try{jf(s,o)}catch(l){Oe(t,t.return,l)}}}function l0(t,s,o){o.props=Gs(t.type,t.memoizedProps),o.state=t.memoizedState;try{o.componentWillUnmount()}catch(l){Oe(t,s,l)}}function Xa(t,s){try{var o=t.ref;if(o!==null){switch(t.tag){case 26:case 27:case 5:var l=t.stateNode;break;case 30:l=t.stateNode;break;default:l=t.stateNode}typeof o=="function"?t.refCleanup=o(l):o.current=l}}catch(f){Oe(t,s,f)}}function pi(t,s){var o=t.ref,l=t.refCleanup;if(o!==null)if(typeof l=="function")try{l()}catch(f){Oe(t,s,f)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(f){Oe(t,s,f)}else o.current=null}function c0(t){var s=t.type,o=t.memoizedProps,l=t.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&l.focus();break e;case"img":o.src?l.src=o.src:o.srcSet&&(l.srcset=o.srcSet)}}catch(f){Oe(t,t.return,f)}}function Yc(t,s,o){try{var l=t.stateNode;Ev(l,t.type,o,s),l[Tt]=s}catch(f){Oe(t,t.return,f)}}function h0(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&ps(t.type)||t.tag===4}function qc(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||h0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&ps(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function jc(t,s,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(t,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(t),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=Cr));else if(l!==4&&(l===27&&ps(t.type)&&(o=t.stateNode,s=null),t=t.child,t!==null))for(jc(t,s,o),t=t.sibling;t!==null;)jc(t,s,o),t=t.sibling}function ur(t,s,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,s?o.insertBefore(t,s):o.appendChild(t);else if(l!==4&&(l===27&&ps(t.type)&&(o=t.stateNode),t=t.child,t!==null))for(ur(t,s,o),t=t.sibling;t!==null;)ur(t,s,o),t=t.sibling}function u0(t){var s=t.stateNode,o=t.memoizedProps;try{for(var l=t.type,f=s.attributes;f.length;)s.removeAttributeNode(f[0]);ot(s,l,o),s[ft]=t,s[Tt]=o}catch(p){Oe(t,t.return,p)}}var Pi=!1,Ye=!1,Zc=!1,f0=typeof WeakSet=="function"?WeakSet:Set,tt=null;function cv(t,s){if(t=t.containerInfo,bh=Er,t=Tf(t),ql(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var l=o.getSelection&&o.getSelection();if(l&&l.rangeCount!==0){o=l.anchorNode;var f=l.anchorOffset,p=l.focusNode;l=l.focusOffset;try{o.nodeType,p.nodeType}catch{o=null;break e}var S=0,T=-1,B=-1,O=0,V=0,j=t,F=null;t:for(;;){for(var U;j!==o||f!==0&&j.nodeType!==3||(T=S+f),j!==p||l!==0&&j.nodeType!==3||(B=S+l),j.nodeType===3&&(S+=j.nodeValue.length),(U=j.firstChild)!==null;)F=j,j=U;for(;;){if(j===t)break t;if(F===o&&++O===f&&(T=S),F===p&&++V===l&&(B=S),(U=j.nextSibling)!==null)break;j=F,F=j.parentNode}j=U}o=T===-1||B===-1?null:{start:T,end:B}}else o=null}o=o||{start:0,end:0}}else o=null;for(Sh={focusedElem:t,selectionRange:o},Er=!1,tt=s;tt!==null;)if(s=tt,t=s.child,(s.subtreeFlags&1024)!==0&&t!==null)t.return=s,tt=t;else for(;tt!==null;){switch(s=tt,p=s.alternate,t=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((t&1024)!==0&&p!==null){t=void 0,o=s,f=p.memoizedProps,p=p.memoizedState,l=o.stateNode;try{var ge=Gs(o.type,f,o.elementType===o.type);t=l.getSnapshotBeforeUpdate(ge,p),l.__reactInternalSnapshotBeforeUpdate=t}catch(fe){Oe(o,o.return,fe)}}break;case 3:if((t&1024)!==0){if(t=s.stateNode.containerInfo,o=t.nodeType,o===9)Th(t);else if(o===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Th(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(n(163))}if(t=s.sibling,t!==null){t.return=s.return,tt=t;break}tt=s.return}}function d0(t,s,o){var l=o.flags;switch(o.tag){case 0:case 11:case 15:ls(t,o),l&4&&Va(5,o);break;case 1:if(ls(t,o),l&4)if(t=o.stateNode,s===null)try{t.componentDidMount()}catch(S){Oe(o,o.return,S)}else{var f=Gs(o.type,s.memoizedProps);s=s.memoizedState;try{t.componentDidUpdate(f,s,t.__reactInternalSnapshotBeforeUpdate)}catch(S){Oe(o,o.return,S)}}l&64&&r0(o),l&512&&Xa(o,o.return);break;case 3:if(ls(t,o),l&64&&(t=o.updateQueue,t!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{jf(t,s)}catch(S){Oe(o,o.return,S)}}break;case 27:s===null&&l&4&&u0(o);case 26:case 5:ls(t,o),s===null&&l&4&&c0(o),l&512&&Xa(o,o.return);break;case 12:ls(t,o);break;case 13:ls(t,o),l&4&&m0(t,o),l&64&&(t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(o=vv.bind(null,o),Ov(t,o))));break;case 22:if(l=o.memoizedState!==null||Pi,!l){s=s!==null&&s.memoizedState!==null||Ye,f=Pi;var p=Ye;Pi=l,(Ye=s)&&!p?cs(t,o,(o.subtreeFlags&8772)!==0):ls(t,o),Pi=f,Ye=p}break;case 30:break;default:ls(t,o)}}function g0(t){var s=t.alternate;s!==null&&(t.alternate=null,g0(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&Rl(s)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var We=null,kt=!1;function Li(t,s,o){for(o=o.child;o!==null;)p0(t,s,o),o=o.sibling}function p0(t,s,o){if(_t&&typeof _t.onCommitFiberUnmount=="function")try{_t.onCommitFiberUnmount(fa,o)}catch{}switch(o.tag){case 26:Ye||pi(o,s),Li(t,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Ye||pi(o,s);var l=We,f=kt;ps(o.type)&&(We=o.stateNode,kt=!1),Li(t,s,o),eo(o.stateNode),We=l,kt=f;break;case 5:Ye||pi(o,s);case 6:if(l=We,f=kt,We=null,Li(t,s,o),We=l,kt=f,We!==null)if(kt)try{(We.nodeType===9?We.body:We.nodeName==="HTML"?We.ownerDocument.body:We).removeChild(o.stateNode)}catch(p){Oe(o,s,p)}else try{We.removeChild(o.stateNode)}catch(p){Oe(o,s,p)}break;case 18:We!==null&&(kt?(t=We,sg(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,o.stateNode),lo(t)):sg(We,o.stateNode));break;case 4:l=We,f=kt,We=o.stateNode.containerInfo,kt=!0,Li(t,s,o),We=l,kt=f;break;case 0:case 11:case 14:case 15:Ye||rs(2,o,s),Ye||rs(4,o,s),Li(t,s,o);break;case 1:Ye||(pi(o,s),l=o.stateNode,typeof l.componentWillUnmount=="function"&&l0(o,s,l)),Li(t,s,o);break;case 21:Li(t,s,o);break;case 22:Ye=(l=Ye)||o.memoizedState!==null,Li(t,s,o),Ye=l;break;default:Li(t,s,o)}}function m0(t,s){if(s.memoizedState===null&&(t=s.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{lo(t)}catch(o){Oe(s,s.return,o)}}function hv(t){switch(t.tag){case 13:case 19:var s=t.stateNode;return s===null&&(s=t.stateNode=new f0),s;case 22:return t=t.stateNode,s=t._retryCache,s===null&&(s=t._retryCache=new f0),s;default:throw Error(n(435,t.tag))}}function Kc(t,s){var o=hv(t);s.forEach(function(l){var f=bv.bind(null,t,l);o.has(l)||(o.add(l),l.then(f,f))})}function Lt(t,s){var o=s.deletions;if(o!==null)for(var l=0;l<o.length;l++){var f=o[l],p=t,S=s,T=S;e:for(;T!==null;){switch(T.tag){case 27:if(ps(T.type)){We=T.stateNode,kt=!1;break e}break;case 5:We=T.stateNode,kt=!1;break e;case 3:case 4:We=T.stateNode.containerInfo,kt=!0;break e}T=T.return}if(We===null)throw Error(n(160));p0(p,S,f),We=null,kt=!1,p=f.alternate,p!==null&&(p.return=null),f.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)y0(s,t),s=s.sibling}var ni=null;function y0(t,s){var o=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Lt(s,t),Ot(t),l&4&&(rs(3,t,t.return),Va(3,t),rs(5,t,t.return));break;case 1:Lt(s,t),Ot(t),l&512&&(Ye||o===null||pi(o,o.return)),l&64&&Pi&&(t=t.updateQueue,t!==null&&(l=t.callbacks,l!==null&&(o=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=o===null?l:o.concat(l))));break;case 26:var f=ni;if(Lt(s,t),Ot(t),l&512&&(Ye||o===null||pi(o,o.return)),l&4){var p=o!==null?o.memoizedState:null;if(l=t.memoizedState,o===null)if(l===null)if(t.stateNode===null){e:{l=t.type,o=t.memoizedProps,f=f.ownerDocument||f;t:switch(l){case"title":p=f.getElementsByTagName("title")[0],(!p||p[pa]||p[ft]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=f.createElement(l),f.head.insertBefore(p,f.querySelector("head > title"))),ot(p,l,o),p[ft]=t,Je(p),l=p;break e;case"link":var S=ug("link","href",f).get(l+(o.href||""));if(S){for(var T=0;T<S.length;T++)if(p=S[T],p.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&p.getAttribute("rel")===(o.rel==null?null:o.rel)&&p.getAttribute("title")===(o.title==null?null:o.title)&&p.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){S.splice(T,1);break t}}p=f.createElement(l),ot(p,l,o),f.head.appendChild(p);break;case"meta":if(S=ug("meta","content",f).get(l+(o.content||""))){for(T=0;T<S.length;T++)if(p=S[T],p.getAttribute("content")===(o.content==null?null:""+o.content)&&p.getAttribute("name")===(o.name==null?null:o.name)&&p.getAttribute("property")===(o.property==null?null:o.property)&&p.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&p.getAttribute("charset")===(o.charSet==null?null:o.charSet)){S.splice(T,1);break t}}p=f.createElement(l),ot(p,l,o),f.head.appendChild(p);break;default:throw Error(n(468,l))}p[ft]=t,Je(p),l=p}t.stateNode=l}else fg(f,t.type,t.stateNode);else t.stateNode=hg(f,l,t.memoizedProps);else p!==l?(p===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):p.count--,l===null?fg(f,t.type,t.stateNode):hg(f,l,t.memoizedProps)):l===null&&t.stateNode!==null&&Yc(t,t.memoizedProps,o.memoizedProps)}break;case 27:Lt(s,t),Ot(t),l&512&&(Ye||o===null||pi(o,o.return)),o!==null&&l&4&&Yc(t,t.memoizedProps,o.memoizedProps);break;case 5:if(Lt(s,t),Ot(t),l&512&&(Ye||o===null||pi(o,o.return)),t.flags&32){f=t.stateNode;try{pn(f,"")}catch(U){Oe(t,t.return,U)}}l&4&&t.stateNode!=null&&(f=t.memoizedProps,Yc(t,f,o!==null?o.memoizedProps:f)),l&1024&&(Zc=!0);break;case 6:if(Lt(s,t),Ot(t),l&4){if(t.stateNode===null)throw Error(n(162));l=t.memoizedProps,o=t.stateNode;try{o.nodeValue=l}catch(U){Oe(t,t.return,U)}}break;case 3:if(kr=null,f=ni,ni=wr(s.containerInfo),Lt(s,t),ni=f,Ot(t),l&4&&o!==null&&o.memoizedState.isDehydrated)try{lo(s.containerInfo)}catch(U){Oe(t,t.return,U)}Zc&&(Zc=!1,v0(t));break;case 4:l=ni,ni=wr(t.stateNode.containerInfo),Lt(s,t),Ot(t),ni=l;break;case 12:Lt(s,t),Ot(t);break;case 13:Lt(s,t),Ot(t),t.child.flags&8192&&t.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(ih=fi()),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Kc(t,l)));break;case 22:f=t.memoizedState!==null;var B=o!==null&&o.memoizedState!==null,O=Pi,V=Ye;if(Pi=O||f,Ye=V||B,Lt(s,t),Ye=V,Pi=O,Ot(t),l&8192)e:for(s=t.stateNode,s._visibility=f?s._visibility&-2:s._visibility|1,f&&(o===null||B||Pi||Ye||Vs(t)),o=null,s=t;;){if(s.tag===5||s.tag===26){if(o===null){B=o=s;try{if(p=B.stateNode,f)S=p.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{T=B.stateNode;var j=B.memoizedProps.style,F=j!=null&&j.hasOwnProperty("display")?j.display:null;T.style.display=F==null||typeof F=="boolean"?"":(""+F).trim()}}catch(U){Oe(B,B.return,U)}}}else if(s.tag===6){if(o===null){B=s;try{B.stateNode.nodeValue=f?"":B.memoizedProps}catch(U){Oe(B,B.return,U)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===t)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;s.sibling===null;){if(s.return===null||s.return===t)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}l&4&&(l=t.updateQueue,l!==null&&(o=l.retryQueue,o!==null&&(l.retryQueue=null,Kc(t,o))));break;case 19:Lt(s,t),Ot(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Kc(t,l)));break;case 30:break;case 21:break;default:Lt(s,t),Ot(t)}}function Ot(t){var s=t.flags;if(s&2){try{for(var o,l=t.return;l!==null;){if(h0(l)){o=l;break}l=l.return}if(o==null)throw Error(n(160));switch(o.tag){case 27:var f=o.stateNode,p=qc(t);ur(t,p,f);break;case 5:var S=o.stateNode;o.flags&32&&(pn(S,""),o.flags&=-33);var T=qc(t);ur(t,T,S);break;case 3:case 4:var B=o.stateNode.containerInfo,O=qc(t);jc(t,O,B);break;default:throw Error(n(161))}}catch(V){Oe(t,t.return,V)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function v0(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var s=t;v0(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),t=t.sibling}}function ls(t,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)d0(t,s.alternate,s),s=s.sibling}function Vs(t){for(t=t.child;t!==null;){var s=t;switch(s.tag){case 0:case 11:case 14:case 15:rs(4,s,s.return),Vs(s);break;case 1:pi(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&l0(s,s.return,o),Vs(s);break;case 27:eo(s.stateNode);case 26:case 5:pi(s,s.return),Vs(s);break;case 22:s.memoizedState===null&&Vs(s);break;case 30:Vs(s);break;default:Vs(s)}t=t.sibling}}function cs(t,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var l=s.alternate,f=t,p=s,S=p.flags;switch(p.tag){case 0:case 11:case 15:cs(f,p,o),Va(4,p);break;case 1:if(cs(f,p,o),l=p,f=l.stateNode,typeof f.componentDidMount=="function")try{f.componentDidMount()}catch(O){Oe(l,l.return,O)}if(l=p,f=l.updateQueue,f!==null){var T=l.stateNode;try{var B=f.shared.hiddenCallbacks;if(B!==null)for(f.shared.hiddenCallbacks=null,f=0;f<B.length;f++)qf(B[f],T)}catch(O){Oe(l,l.return,O)}}o&&S&64&&r0(p),Xa(p,p.return);break;case 27:u0(p);case 26:case 5:cs(f,p,o),o&&l===null&&S&4&&c0(p),Xa(p,p.return);break;case 12:cs(f,p,o);break;case 13:cs(f,p,o),o&&S&4&&m0(f,p);break;case 22:p.memoizedState===null&&cs(f,p,o),Xa(p,p.return);break;case 30:break;default:cs(f,p,o)}s=s.sibling}}function Qc(t,s){var o=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),t=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(t=s.memoizedState.cachePool.pool),t!==o&&(t!=null&&t.refCount++,o!=null&&Ia(o))}function $c(t,s){t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Ia(t))}function mi(t,s,o,l){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)b0(t,s,o,l),s=s.sibling}function b0(t,s,o,l){var f=s.flags;switch(s.tag){case 0:case 11:case 15:mi(t,s,o,l),f&2048&&Va(9,s);break;case 1:mi(t,s,o,l);break;case 3:mi(t,s,o,l),f&2048&&(t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Ia(t)));break;case 12:if(f&2048){mi(t,s,o,l),t=s.stateNode;try{var p=s.memoizedProps,S=p.id,T=p.onPostCommit;typeof T=="function"&&T(S,s.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(B){Oe(s,s.return,B)}}else mi(t,s,o,l);break;case 13:mi(t,s,o,l);break;case 23:break;case 22:p=s.stateNode,S=s.alternate,s.memoizedState!==null?p._visibility&2?mi(t,s,o,l):Ya(t,s):p._visibility&2?mi(t,s,o,l):(p._visibility|=2,Pn(t,s,o,l,(s.subtreeFlags&10256)!==0)),f&2048&&Qc(S,s);break;case 24:mi(t,s,o,l),f&2048&&$c(s.alternate,s);break;default:mi(t,s,o,l)}}function Pn(t,s,o,l,f){for(f=f&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var p=t,S=s,T=o,B=l,O=S.flags;switch(S.tag){case 0:case 11:case 15:Pn(p,S,T,B,f),Va(8,S);break;case 23:break;case 22:var V=S.stateNode;S.memoizedState!==null?V._visibility&2?Pn(p,S,T,B,f):Ya(p,S):(V._visibility|=2,Pn(p,S,T,B,f)),f&&O&2048&&Qc(S.alternate,S);break;case 24:Pn(p,S,T,B,f),f&&O&2048&&$c(S.alternate,S);break;default:Pn(p,S,T,B,f)}s=s.sibling}}function Ya(t,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=t,l=s,f=l.flags;switch(l.tag){case 22:Ya(o,l),f&2048&&Qc(l.alternate,l);break;case 24:Ya(o,l),f&2048&&$c(l.alternate,l);break;default:Ya(o,l)}s=s.sibling}}var qa=8192;function Ln(t){if(t.subtreeFlags&qa)for(t=t.child;t!==null;)S0(t),t=t.sibling}function S0(t){switch(t.tag){case 26:Ln(t),t.flags&qa&&t.memoizedState!==null&&Zv(ni,t.memoizedState,t.memoizedProps);break;case 5:Ln(t);break;case 3:case 4:var s=ni;ni=wr(t.stateNode.containerInfo),Ln(t),ni=s;break;case 22:t.memoizedState===null&&(s=t.alternate,s!==null&&s.memoizedState!==null?(s=qa,qa=16777216,Ln(t),qa=s):Ln(t));break;default:Ln(t)}}function M0(t){var s=t.alternate;if(s!==null&&(t=s.child,t!==null)){s.child=null;do s=t.sibling,t.sibling=null,t=s;while(t!==null)}}function ja(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var l=s[o];tt=l,T0(l,t)}M0(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)C0(t),t=t.sibling}function C0(t){switch(t.tag){case 0:case 11:case 15:ja(t),t.flags&2048&&rs(9,t,t.return);break;case 3:ja(t);break;case 12:ja(t);break;case 22:var s=t.stateNode;t.memoizedState!==null&&s._visibility&2&&(t.return===null||t.return.tag!==13)?(s._visibility&=-3,fr(t)):ja(t);break;default:ja(t)}}function fr(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var l=s[o];tt=l,T0(l,t)}M0(t)}for(t=t.child;t!==null;){switch(s=t,s.tag){case 0:case 11:case 15:rs(8,s,s.return),fr(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,fr(s));break;default:fr(s)}t=t.sibling}}function T0(t,s){for(;tt!==null;){var o=tt;switch(o.tag){case 0:case 11:case 15:rs(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var l=o.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Ia(o.memoizedState.cache)}if(l=o.child,l!==null)l.return=o,tt=l;else e:for(o=t;tt!==null;){l=tt;var f=l.sibling,p=l.return;if(g0(l),l===o){tt=null;break e}if(f!==null){f.return=p,tt=f;break e}tt=p}}}var uv={getCacheForType:function(t){var s=dt(Ke),o=s.data.get(t);return o===void 0&&(o=t(),s.data.set(t,o)),o}},fv=typeof WeakMap=="function"?WeakMap:Map,Ie=0,Ue=null,Se=null,Te=0,_e=0,Ft=null,hs=!1,On=!1,Jc=!1,Oi=0,Ve=0,us=0,Xs=0,eh=0,Zt=0,Fn=0,Za=null,Bt=null,th=!1,ih=0,dr=1/0,gr=null,fs=null,at=0,ds=null,Un=null,Nn=0,sh=0,nh=null,w0=null,Ka=0,ah=null;function Ut(){if((Ie&2)!==0&&Te!==0)return Te&-Te;if(D.T!==null){var t=kn;return t!==0?t:fh()}return Nu()}function A0(){Zt===0&&(Zt=(Te&536870912)===0||ke?Lu():536870912);var t=jt.current;return t!==null&&(t.flags|=32),Zt}function Nt(t,s,o){(t===Ue&&(_e===2||_e===9)||t.cancelPendingCommit!==null)&&(Hn(t,0),gs(t,Te,Zt,!1)),ga(t,o),((Ie&2)===0||t!==Ue)&&(t===Ue&&((Ie&2)===0&&(Xs|=o),Ve===4&&gs(t,Te,Zt,!1)),yi(t))}function k0(t,s,o){if((Ie&6)!==0)throw Error(n(327));var l=!o&&(s&124)===0&&(s&t.expiredLanes)===0||da(t,s),f=l?pv(t,s):lh(t,s,!0),p=l;do{if(f===0){On&&!l&&gs(t,s,0,!1);break}else{if(o=t.current.alternate,p&&!dv(o)){f=lh(t,s,!1),p=!1;continue}if(f===2){if(p=s,t.errorRecoveryDisabledLanes&p)var S=0;else S=t.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){s=S;e:{var T=t;f=Za;var B=T.current.memoizedState.isDehydrated;if(B&&(Hn(T,S).flags|=256),S=lh(T,S,!1),S!==2){if(Jc&&!B){T.errorRecoveryDisabledLanes|=p,Xs|=p,f=4;break e}p=Bt,Bt=f,p!==null&&(Bt===null?Bt=p:Bt.push.apply(Bt,p))}f=S}if(p=!1,f!==2)continue}}if(f===1){Hn(t,0),gs(t,s,0,!0);break}e:{switch(l=t,p=f,p){case 0:case 1:throw Error(n(345));case 4:if((s&4194048)!==s)break;case 6:gs(l,s,Zt,!hs);break e;case 2:Bt=null;break;case 3:case 5:break;default:throw Error(n(329))}if((s&62914560)===s&&(f=ih+300-fi(),10<f)){if(gs(l,s,Zt,!hs),Ao(l,0,!0)!==0)break e;l.timeoutHandle=tg(B0.bind(null,l,o,Bt,gr,th,s,Zt,Xs,Fn,hs,p,2,-0,0),f);break e}B0(l,o,Bt,gr,th,s,Zt,Xs,Fn,hs,p,0,-0,0)}}break}while(!0);yi(t)}function B0(t,s,o,l,f,p,S,T,B,O,V,j,F,U){if(t.timeoutHandle=-1,j=s.subtreeFlags,(j&8192||(j&16785408)===16785408)&&(so={stylesheets:null,count:0,unsuspend:jv},S0(s),j=Kv(),j!==null)){t.cancelPendingCommit=j(P0.bind(null,t,s,p,o,l,f,S,T,B,V,1,F,U)),gs(t,p,S,!O);return}P0(t,s,p,o,l,f,S,T,B)}function dv(t){for(var s=t;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var l=0;l<o.length;l++){var f=o[l],p=f.getSnapshot;f=f.value;try{if(!Dt(p(),f))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function gs(t,s,o,l){s&=~eh,s&=~Xs,t.suspendedLanes|=s,t.pingedLanes&=~s,l&&(t.warmLanes|=s),l=t.expirationTimes;for(var f=s;0<f;){var p=31-xt(f),S=1<<p;l[p]=-1,f&=~S}o!==0&&Fu(t,o,s)}function pr(){return(Ie&6)===0?(Qa(0),!1):!0}function oh(){if(Se!==null){if(_e===0)var t=Se.return;else t=Se,Ri=Ns=null,Tc(t),xn=null,Wa=0,t=Se;for(;t!==null;)o0(t.alternate,t),t=t.return;Se=null}}function Hn(t,s){var o=t.timeoutHandle;o!==-1&&(t.timeoutHandle=-1,_v(o)),o=t.cancelPendingCommit,o!==null&&(t.cancelPendingCommit=null,o()),oh(),Ue=t,Se=o=Ai(t.current,null),Te=s,_e=0,Ft=null,hs=!1,On=da(t,s),Jc=!1,Fn=Zt=eh=Xs=us=Ve=0,Bt=Za=null,th=!1,(s&8)!==0&&(s|=s&32);var l=t.entangledLanes;if(l!==0)for(t=t.entanglements,l&=s;0<l;){var f=31-xt(l),p=1<<f;s|=t[f],l&=~p}return Oi=s,Fo(),o}function R0(t,s){ve=null,D.H=ir,s===xa||s===Yo?(s=Xf(),_e=3):s===zf?(s=Xf(),_e=4):_e=s===Yd?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ft=s,Se===null&&(Ve=1,rr(t,Vt(s,t.current)))}function E0(){var t=D.H;return D.H=ir,t===null?ir:t}function I0(){var t=D.A;return D.A=uv,t}function rh(){Ve=4,hs||(Te&4194048)!==Te&&jt.current!==null||(On=!0),(us&134217727)===0&&(Xs&134217727)===0||Ue===null||gs(Ue,Te,Zt,!1)}function lh(t,s,o){var l=Ie;Ie|=2;var f=E0(),p=I0();(Ue!==t||Te!==s)&&(gr=null,Hn(t,s)),s=!1;var S=Ve;e:do try{if(_e!==0&&Se!==null){var T=Se,B=Ft;switch(_e){case 8:oh(),S=6;break e;case 3:case 2:case 9:case 6:jt.current===null&&(s=!0);var O=_e;if(_e=0,Ft=null,Wn(t,T,B,O),o&&On){S=0;break e}break;default:O=_e,_e=0,Ft=null,Wn(t,T,B,O)}}gv(),S=Ve;break}catch(V){R0(t,V)}while(!0);return s&&t.shellSuspendCounter++,Ri=Ns=null,Ie=l,D.H=f,D.A=p,Se===null&&(Ue=null,Te=0,Fo()),S}function gv(){for(;Se!==null;)_0(Se)}function pv(t,s){var o=Ie;Ie|=2;var l=E0(),f=I0();Ue!==t||Te!==s?(gr=null,dr=fi()+500,Hn(t,s)):On=da(t,s);e:do try{if(_e!==0&&Se!==null){s=Se;var p=Ft;t:switch(_e){case 1:_e=0,Ft=null,Wn(t,s,p,1);break;case 2:case 9:if(Gf(p)){_e=0,Ft=null,x0(s);break}s=function(){_e!==2&&_e!==9||Ue!==t||(_e=7),yi(t)},p.then(s,s);break e;case 3:_e=7;break e;case 4:_e=5;break e;case 7:Gf(p)?(_e=0,Ft=null,x0(s)):(_e=0,Ft=null,Wn(t,s,p,7));break;case 5:var S=null;switch(Se.tag){case 26:S=Se.memoizedState;case 5:case 27:var T=Se;if(!S||dg(S)){_e=0,Ft=null;var B=T.sibling;if(B!==null)Se=B;else{var O=T.return;O!==null?(Se=O,mr(O)):Se=null}break t}}_e=0,Ft=null,Wn(t,s,p,5);break;case 6:_e=0,Ft=null,Wn(t,s,p,6);break;case 8:oh(),Ve=6;break e;default:throw Error(n(462))}}mv();break}catch(V){R0(t,V)}while(!0);return Ri=Ns=null,D.H=l,D.A=f,Ie=o,Se!==null?0:(Ue=null,Te=0,Fo(),Ve)}function mv(){for(;Se!==null&&!Um();)_0(Se)}function _0(t){var s=n0(t.alternate,t,Oi);t.memoizedProps=t.pendingProps,s===null?mr(t):Se=s}function x0(t){var s=t,o=s.alternate;switch(s.tag){case 15:case 0:s=$d(o,s,s.pendingProps,s.type,void 0,Te);break;case 11:s=$d(o,s,s.pendingProps,s.type.render,s.ref,Te);break;case 5:Tc(s);default:o0(o,s),s=Se=Df(s,Oi),s=n0(o,s,Oi)}t.memoizedProps=t.pendingProps,s===null?mr(t):Se=s}function Wn(t,s,o,l){Ri=Ns=null,Tc(s),xn=null,Wa=0;var f=s.return;try{if(av(t,f,s,o,Te)){Ve=1,rr(t,Vt(o,t.current)),Se=null;return}}catch(p){if(f!==null)throw Se=f,p;Ve=1,rr(t,Vt(o,t.current)),Se=null;return}s.flags&32768?(ke||l===1?t=!0:On||(Te&536870912)!==0?t=!1:(hs=t=!0,(l===2||l===9||l===3||l===6)&&(l=jt.current,l!==null&&l.tag===13&&(l.flags|=16384))),D0(s,t)):mr(s)}function mr(t){var s=t;do{if((s.flags&32768)!==0){D0(s,hs);return}t=s.return;var o=rv(s.alternate,s,Oi);if(o!==null){Se=o;return}if(s=s.sibling,s!==null){Se=s;return}Se=s=t}while(s!==null);Ve===0&&(Ve=5)}function D0(t,s){do{var o=lv(t.alternate,t);if(o!==null){o.flags&=32767,Se=o;return}if(o=t.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(t=t.sibling,t!==null)){Se=t;return}Se=t=o}while(t!==null);Ve=6,Se=null}function P0(t,s,o,l,f,p,S,T,B){t.cancelPendingCommit=null;do yr();while(at!==0);if((Ie&6)!==0)throw Error(n(327));if(s!==null){if(s===t.current)throw Error(n(177));if(p=s.lanes|s.childLanes,p|=$l,jm(t,o,p,S,T,B),t===Ue&&(Se=Ue=null,Te=0),Un=s,ds=t,Nn=o,sh=p,nh=f,w0=l,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Sv(Co,function(){return N0(),null})):(t.callbackNode=null,t.callbackPriority=0),l=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||l){l=D.T,D.T=null,f=X.p,X.p=2,S=Ie,Ie|=4;try{cv(t,s,o)}finally{Ie=S,X.p=f,D.T=l}}at=1,L0(),O0(),F0()}}function L0(){if(at===1){at=0;var t=ds,s=Un,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=D.T,D.T=null;var l=X.p;X.p=2;var f=Ie;Ie|=4;try{y0(s,t);var p=Sh,S=Tf(t.containerInfo),T=p.focusedElem,B=p.selectionRange;if(S!==T&&T&&T.ownerDocument&&Cf(T.ownerDocument.documentElement,T)){if(B!==null&&ql(T)){var O=B.start,V=B.end;if(V===void 0&&(V=O),"selectionStart"in T)T.selectionStart=O,T.selectionEnd=Math.min(V,T.value.length);else{var j=T.ownerDocument||document,F=j&&j.defaultView||window;if(F.getSelection){var U=F.getSelection(),ge=T.textContent.length,fe=Math.min(B.start,ge),Le=B.end===void 0?fe:Math.min(B.end,ge);!U.extend&&fe>Le&&(S=Le,Le=fe,fe=S);var P=Mf(T,fe),E=Mf(T,Le);if(P&&E&&(U.rangeCount!==1||U.anchorNode!==P.node||U.anchorOffset!==P.offset||U.focusNode!==E.node||U.focusOffset!==E.offset)){var L=j.createRange();L.setStart(P.node,P.offset),U.removeAllRanges(),fe>Le?(U.addRange(L),U.extend(E.node,E.offset)):(L.setEnd(E.node,E.offset),U.addRange(L))}}}}for(j=[],U=T;U=U.parentNode;)U.nodeType===1&&j.push({element:U,left:U.scrollLeft,top:U.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<j.length;T++){var Y=j[T];Y.element.scrollLeft=Y.left,Y.element.scrollTop=Y.top}}Er=!!bh,Sh=bh=null}finally{Ie=f,X.p=l,D.T=o}}t.current=s,at=2}}function O0(){if(at===2){at=0;var t=ds,s=Un,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=D.T,D.T=null;var l=X.p;X.p=2;var f=Ie;Ie|=4;try{d0(t,s.alternate,s)}finally{Ie=f,X.p=l,D.T=o}}at=3}}function F0(){if(at===4||at===3){at=0,Nm();var t=ds,s=Un,o=Nn,l=w0;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?at=5:(at=0,Un=ds=null,U0(t,t.pendingLanes));var f=t.pendingLanes;if(f===0&&(fs=null),kl(o),s=s.stateNode,_t&&typeof _t.onCommitFiberRoot=="function")try{_t.onCommitFiberRoot(fa,s,void 0,(s.current.flags&128)===128)}catch{}if(l!==null){s=D.T,f=X.p,X.p=2,D.T=null;try{for(var p=t.onRecoverableError,S=0;S<l.length;S++){var T=l[S];p(T.value,{componentStack:T.stack})}}finally{D.T=s,X.p=f}}(Nn&3)!==0&&yr(),yi(t),f=t.pendingLanes,(o&4194090)!==0&&(f&42)!==0?t===ah?Ka++:(Ka=0,ah=t):Ka=0,Qa(0)}}function U0(t,s){(t.pooledCacheLanes&=s)===0&&(s=t.pooledCache,s!=null&&(t.pooledCache=null,Ia(s)))}function yr(t){return L0(),O0(),F0(),N0()}function N0(){if(at!==5)return!1;var t=ds,s=sh;sh=0;var o=kl(Nn),l=D.T,f=X.p;try{X.p=32>o?32:o,D.T=null,o=nh,nh=null;var p=ds,S=Nn;if(at=0,Un=ds=null,Nn=0,(Ie&6)!==0)throw Error(n(331));var T=Ie;if(Ie|=4,C0(p.current),b0(p,p.current,S,o),Ie=T,Qa(0,!1),_t&&typeof _t.onPostCommitFiberRoot=="function")try{_t.onPostCommitFiberRoot(fa,p)}catch{}return!0}finally{X.p=f,D.T=l,U0(t,s)}}function H0(t,s,o){s=Vt(o,s),s=Fc(t.stateNode,s,2),t=ss(t,s,2),t!==null&&(ga(t,2),yi(t))}function Oe(t,s,o){if(t.tag===3)H0(t,t,o);else for(;s!==null;){if(s.tag===3){H0(s,t,o);break}else if(s.tag===1){var l=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(fs===null||!fs.has(l))){t=Vt(o,t),o=Vd(2),l=ss(s,o,2),l!==null&&(Xd(o,l,s,t),ga(l,2),yi(l));break}}s=s.return}}function ch(t,s,o){var l=t.pingCache;if(l===null){l=t.pingCache=new fv;var f=new Set;l.set(s,f)}else f=l.get(s),f===void 0&&(f=new Set,l.set(s,f));f.has(o)||(Jc=!0,f.add(o),t=yv.bind(null,t,s,o),s.then(t,t))}function yv(t,s,o){var l=t.pingCache;l!==null&&l.delete(s),t.pingedLanes|=t.suspendedLanes&o,t.warmLanes&=~o,Ue===t&&(Te&o)===o&&(Ve===4||Ve===3&&(Te&62914560)===Te&&300>fi()-ih?(Ie&2)===0&&Hn(t,0):eh|=o,Fn===Te&&(Fn=0)),yi(t)}function W0(t,s){s===0&&(s=Ou()),t=Cn(t,s),t!==null&&(ga(t,s),yi(t))}function vv(t){var s=t.memoizedState,o=0;s!==null&&(o=s.retryLane),W0(t,o)}function bv(t,s){var o=0;switch(t.tag){case 13:var l=t.stateNode,f=t.memoizedState;f!==null&&(o=f.retryLane);break;case 19:l=t.stateNode;break;case 22:l=t.stateNode._retryCache;break;default:throw Error(n(314))}l!==null&&l.delete(s),W0(t,o)}function Sv(t,s){return Cl(t,s)}var vr=null,zn=null,hh=!1,br=!1,uh=!1,Ys=0;function yi(t){t!==zn&&t.next===null&&(zn===null?vr=zn=t:zn=zn.next=t),br=!0,hh||(hh=!0,Cv())}function Qa(t,s){if(!uh&&br){uh=!0;do for(var o=!1,l=vr;l!==null;){if(t!==0){var f=l.pendingLanes;if(f===0)var p=0;else{var S=l.suspendedLanes,T=l.pingedLanes;p=(1<<31-xt(42|t)+1)-1,p&=f&~(S&~T),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(o=!0,X0(l,p))}else p=Te,p=Ao(l,l===Ue?p:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(p&3)===0||da(l,p)||(o=!0,X0(l,p));l=l.next}while(o);uh=!1}}function Mv(){z0()}function z0(){br=hh=!1;var t=0;Ys!==0&&(Iv()&&(t=Ys),Ys=0);for(var s=fi(),o=null,l=vr;l!==null;){var f=l.next,p=G0(l,s);p===0?(l.next=null,o===null?vr=f:o.next=f,f===null&&(zn=o)):(o=l,(t!==0||(p&3)!==0)&&(br=!0)),l=f}Qa(t)}function G0(t,s){for(var o=t.suspendedLanes,l=t.pingedLanes,f=t.expirationTimes,p=t.pendingLanes&-62914561;0<p;){var S=31-xt(p),T=1<<S,B=f[S];B===-1?((T&o)===0||(T&l)!==0)&&(f[S]=qm(T,s)):B<=s&&(t.expiredLanes|=T),p&=~T}if(s=Ue,o=Te,o=Ao(t,t===s?o:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l=t.callbackNode,o===0||t===s&&(_e===2||_e===9)||t.cancelPendingCommit!==null)return l!==null&&l!==null&&Tl(l),t.callbackNode=null,t.callbackPriority=0;if((o&3)===0||da(t,o)){if(s=o&-o,s===t.callbackPriority)return s;switch(l!==null&&Tl(l),kl(o)){case 2:case 8:o=Du;break;case 32:o=Co;break;case 268435456:o=Pu;break;default:o=Co}return l=V0.bind(null,t),o=Cl(o,l),t.callbackPriority=s,t.callbackNode=o,s}return l!==null&&l!==null&&Tl(l),t.callbackPriority=2,t.callbackNode=null,2}function V0(t,s){if(at!==0&&at!==5)return t.callbackNode=null,t.callbackPriority=0,null;var o=t.callbackNode;if(yr()&&t.callbackNode!==o)return null;var l=Te;return l=Ao(t,t===Ue?l:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l===0?null:(k0(t,l,s),G0(t,fi()),t.callbackNode!=null&&t.callbackNode===o?V0.bind(null,t):null)}function X0(t,s){if(yr())return null;k0(t,s,!0)}function Cv(){xv(function(){(Ie&6)!==0?Cl(xu,Mv):z0()})}function fh(){return Ys===0&&(Ys=Lu()),Ys}function Y0(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Io(""+t)}function q0(t,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,t.id&&o.setAttribute("form",t.id),s.parentNode.insertBefore(o,s),t=new FormData(t),o.parentNode.removeChild(o),t}function Tv(t,s,o,l,f){if(s==="submit"&&o&&o.stateNode===f){var p=Y0((f[Tt]||null).action),S=l.submitter;S&&(s=(s=S[Tt]||null)?Y0(s.formAction):S.getAttribute("formAction"),s!==null&&(p=s,S=null));var T=new Po("action","action",null,l,f);t.push({event:T,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Ys!==0){var B=S?q0(f,S):new FormData(f);xc(o,{pending:!0,data:B,method:f.method,action:p},null,B)}}else typeof p=="function"&&(T.preventDefault(),B=S?q0(f,S):new FormData(f),xc(o,{pending:!0,data:B,method:f.method,action:p},p,B))},currentTarget:f}]})}}for(var dh=0;dh<Ql.length;dh++){var gh=Ql[dh],wv=gh.toLowerCase(),Av=gh[0].toUpperCase()+gh.slice(1);si(wv,"on"+Av)}si(kf,"onAnimationEnd"),si(Bf,"onAnimationIteration"),si(Rf,"onAnimationStart"),si("dblclick","onDoubleClick"),si("focusin","onFocus"),si("focusout","onBlur"),si(zy,"onTransitionRun"),si(Gy,"onTransitionStart"),si(Vy,"onTransitionCancel"),si(Ef,"onTransitionEnd"),fn("onMouseEnter",["mouseout","mouseover"]),fn("onMouseLeave",["mouseout","mouseover"]),fn("onPointerEnter",["pointerout","pointerover"]),fn("onPointerLeave",["pointerout","pointerover"]),Is("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Is("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Is("onBeforeInput",["compositionend","keypress","textInput","paste"]),Is("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Is("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Is("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $a="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($a));function j0(t,s){s=(s&4)!==0;for(var o=0;o<t.length;o++){var l=t[o],f=l.event;l=l.listeners;e:{var p=void 0;if(s)for(var S=l.length-1;0<=S;S--){var T=l[S],B=T.instance,O=T.currentTarget;if(T=T.listener,B!==p&&f.isPropagationStopped())break e;p=T,f.currentTarget=O;try{p(f)}catch(V){or(V)}f.currentTarget=null,p=B}else for(S=0;S<l.length;S++){if(T=l[S],B=T.instance,O=T.currentTarget,T=T.listener,B!==p&&f.isPropagationStopped())break e;p=T,f.currentTarget=O;try{p(f)}catch(V){or(V)}f.currentTarget=null,p=B}}}}function Me(t,s){var o=s[Bl];o===void 0&&(o=s[Bl]=new Set);var l=t+"__bubble";o.has(l)||(Z0(s,t,2,!1),o.add(l))}function ph(t,s,o){var l=0;s&&(l|=4),Z0(o,t,l,s)}var Sr="_reactListening"+Math.random().toString(36).slice(2);function mh(t){if(!t[Sr]){t[Sr]=!0,Wu.forEach(function(o){o!=="selectionchange"&&(kv.has(o)||ph(o,!1,t),ph(o,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[Sr]||(s[Sr]=!0,ph("selectionchange",!1,s))}}function Z0(t,s,o,l){switch(bg(s)){case 2:var f=Jv;break;case 8:f=eb;break;default:f=Ih}o=f.bind(null,s,o,t),f=void 0,!Ul||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(f=!0),l?f!==void 0?t.addEventListener(s,o,{capture:!0,passive:f}):t.addEventListener(s,o,!0):f!==void 0?t.addEventListener(s,o,{passive:f}):t.addEventListener(s,o,!1)}function yh(t,s,o,l,f){var p=l;if((s&1)===0&&(s&2)===0&&l!==null)e:for(;;){if(l===null)return;var S=l.tag;if(S===3||S===4){var T=l.stateNode.containerInfo;if(T===f)break;if(S===4)for(S=l.return;S!==null;){var B=S.tag;if((B===3||B===4)&&S.stateNode.containerInfo===f)return;S=S.return}for(;T!==null;){if(S=cn(T),S===null)return;if(B=S.tag,B===5||B===6||B===26||B===27){l=p=S;continue e}T=T.parentNode}}l=l.return}tf(function(){var O=p,V=Ol(o),j=[];e:{var F=If.get(t);if(F!==void 0){var U=Po,ge=t;switch(t){case"keypress":if(xo(o)===0)break e;case"keydown":case"keyup":U=Sy;break;case"focusin":ge="focus",U=zl;break;case"focusout":ge="blur",U=zl;break;case"beforeblur":case"afterblur":U=zl;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":U=af;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":U=ly;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":U=Ty;break;case kf:case Bf:case Rf:U=uy;break;case Ef:U=Ay;break;case"scroll":case"scrollend":U=oy;break;case"wheel":U=By;break;case"copy":case"cut":case"paste":U=dy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":U=rf;break;case"toggle":case"beforetoggle":U=Ey}var fe=(s&4)!==0,Le=!fe&&(t==="scroll"||t==="scrollend"),P=fe?F!==null?F+"Capture":null:F;fe=[];for(var E=O,L;E!==null;){var Y=E;if(L=Y.stateNode,Y=Y.tag,Y!==5&&Y!==26&&Y!==27||L===null||P===null||(Y=ya(E,P),Y!=null&&fe.push(Ja(E,Y,L))),Le)break;E=E.return}0<fe.length&&(F=new U(F,ge,null,o,V),j.push({event:F,listeners:fe}))}}if((s&7)===0){e:{if(F=t==="mouseover"||t==="pointerover",U=t==="mouseout"||t==="pointerout",F&&o!==Ll&&(ge=o.relatedTarget||o.fromElement)&&(cn(ge)||ge[ln]))break e;if((U||F)&&(F=V.window===V?V:(F=V.ownerDocument)?F.defaultView||F.parentWindow:window,U?(ge=o.relatedTarget||o.toElement,U=O,ge=ge?cn(ge):null,ge!==null&&(Le=c(ge),fe=ge.tag,ge!==Le||fe!==5&&fe!==27&&fe!==6)&&(ge=null)):(U=null,ge=O),U!==ge)){if(fe=af,Y="onMouseLeave",P="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(fe=rf,Y="onPointerLeave",P="onPointerEnter",E="pointer"),Le=U==null?F:ma(U),L=ge==null?F:ma(ge),F=new fe(Y,E+"leave",U,o,V),F.target=Le,F.relatedTarget=L,Y=null,cn(V)===O&&(fe=new fe(P,E+"enter",ge,o,V),fe.target=L,fe.relatedTarget=Le,Y=fe),Le=Y,U&&ge)t:{for(fe=U,P=ge,E=0,L=fe;L;L=Gn(L))E++;for(L=0,Y=P;Y;Y=Gn(Y))L++;for(;0<E-L;)fe=Gn(fe),E--;for(;0<L-E;)P=Gn(P),L--;for(;E--;){if(fe===P||P!==null&&fe===P.alternate)break t;fe=Gn(fe),P=Gn(P)}fe=null}else fe=null;U!==null&&K0(j,F,U,fe,!1),ge!==null&&Le!==null&&K0(j,Le,ge,fe,!0)}}e:{if(F=O?ma(O):window,U=F.nodeName&&F.nodeName.toLowerCase(),U==="select"||U==="input"&&F.type==="file")var re=pf;else if(df(F))if(mf)re=Ny;else{re=Fy;var be=Oy}else U=F.nodeName,!U||U.toLowerCase()!=="input"||F.type!=="checkbox"&&F.type!=="radio"?O&&Pl(O.elementType)&&(re=pf):re=Uy;if(re&&(re=re(t,O))){gf(j,re,o,V);break e}be&&be(t,F,O),t==="focusout"&&O&&F.type==="number"&&O.memoizedProps.value!=null&&Dl(F,"number",F.value)}switch(be=O?ma(O):window,t){case"focusin":(df(be)||be.contentEditable==="true")&&(bn=be,jl=O,Aa=null);break;case"focusout":Aa=jl=bn=null;break;case"mousedown":Zl=!0;break;case"contextmenu":case"mouseup":case"dragend":Zl=!1,wf(j,o,V);break;case"selectionchange":if(Wy)break;case"keydown":case"keyup":wf(j,o,V)}var ce;if(Vl)e:{switch(t){case"compositionstart":var de="onCompositionStart";break e;case"compositionend":de="onCompositionEnd";break e;case"compositionupdate":de="onCompositionUpdate";break e}de=void 0}else vn?uf(t,o)&&(de="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(de="onCompositionStart");de&&(lf&&o.locale!=="ko"&&(vn||de!=="onCompositionStart"?de==="onCompositionEnd"&&vn&&(ce=sf()):(Ji=V,Nl="value"in Ji?Ji.value:Ji.textContent,vn=!0)),be=Mr(O,de),0<be.length&&(de=new of(de,t,null,o,V),j.push({event:de,listeners:be}),ce?de.data=ce:(ce=ff(o),ce!==null&&(de.data=ce)))),(ce=_y?xy(t,o):Dy(t,o))&&(de=Mr(O,"onBeforeInput"),0<de.length&&(be=new of("onBeforeInput","beforeinput",null,o,V),j.push({event:be,listeners:de}),be.data=ce)),Tv(j,t,O,o,V)}j0(j,s)})}function Ja(t,s,o){return{instance:t,listener:s,currentTarget:o}}function Mr(t,s){for(var o=s+"Capture",l=[];t!==null;){var f=t,p=f.stateNode;if(f=f.tag,f!==5&&f!==26&&f!==27||p===null||(f=ya(t,o),f!=null&&l.unshift(Ja(t,f,p)),f=ya(t,s),f!=null&&l.push(Ja(t,f,p))),t.tag===3)return l;t=t.return}return[]}function Gn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function K0(t,s,o,l,f){for(var p=s._reactName,S=[];o!==null&&o!==l;){var T=o,B=T.alternate,O=T.stateNode;if(T=T.tag,B!==null&&B===l)break;T!==5&&T!==26&&T!==27||O===null||(B=O,f?(O=ya(o,p),O!=null&&S.unshift(Ja(o,O,B))):f||(O=ya(o,p),O!=null&&S.push(Ja(o,O,B)))),o=o.return}S.length!==0&&t.push({event:s,listeners:S})}var Bv=/\r\n?/g,Rv=/\u0000|\uFFFD/g;function Q0(t){return(typeof t=="string"?t:""+t).replace(Bv,`
`).replace(Rv,"")}function $0(t,s){return s=Q0(s),Q0(t)===s}function Cr(){}function Pe(t,s,o,l,f,p){switch(o){case"children":typeof l=="string"?s==="body"||s==="textarea"&&l===""||pn(t,l):(typeof l=="number"||typeof l=="bigint")&&s!=="body"&&pn(t,""+l);break;case"className":Bo(t,"class",l);break;case"tabIndex":Bo(t,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Bo(t,o,l);break;case"style":Ju(t,l,p);break;case"data":if(s!=="object"){Bo(t,"data",l);break}case"src":case"href":if(l===""&&(s!=="a"||o!=="href")){t.removeAttribute(o);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Io(""+l),t.setAttribute(o,l);break;case"action":case"formAction":if(typeof l=="function"){t.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(o==="formAction"?(s!=="input"&&Pe(t,s,"name",f.name,f,null),Pe(t,s,"formEncType",f.formEncType,f,null),Pe(t,s,"formMethod",f.formMethod,f,null),Pe(t,s,"formTarget",f.formTarget,f,null)):(Pe(t,s,"encType",f.encType,f,null),Pe(t,s,"method",f.method,f,null),Pe(t,s,"target",f.target,f,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Io(""+l),t.setAttribute(o,l);break;case"onClick":l!=null&&(t.onclick=Cr);break;case"onScroll":l!=null&&Me("scroll",t);break;case"onScrollEnd":l!=null&&Me("scrollend",t);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(n(61));if(o=l.__html,o!=null){if(f.children!=null)throw Error(n(60));t.innerHTML=o}}break;case"multiple":t.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":t.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){t.removeAttribute("xlink:href");break}o=Io(""+l),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""+l):t.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""):t.removeAttribute(o);break;case"capture":case"download":l===!0?t.setAttribute(o,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,l):t.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?t.setAttribute(o,l):t.removeAttribute(o);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?t.removeAttribute(o):t.setAttribute(o,l);break;case"popover":Me("beforetoggle",t),Me("toggle",t),ko(t,"popover",l);break;case"xlinkActuate":Ti(t,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":Ti(t,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":Ti(t,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":Ti(t,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":Ti(t,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":Ti(t,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":Ti(t,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":Ti(t,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":Ti(t,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":ko(t,"is",l);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=ny.get(o)||o,ko(t,o,l))}}function vh(t,s,o,l,f,p){switch(o){case"style":Ju(t,l,p);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(n(61));if(o=l.__html,o!=null){if(f.children!=null)throw Error(n(60));t.innerHTML=o}}break;case"children":typeof l=="string"?pn(t,l):(typeof l=="number"||typeof l=="bigint")&&pn(t,""+l);break;case"onScroll":l!=null&&Me("scroll",t);break;case"onScrollEnd":l!=null&&Me("scrollend",t);break;case"onClick":l!=null&&(t.onclick=Cr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zu.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(f=o.endsWith("Capture"),s=o.slice(2,f?o.length-7:void 0),p=t[Tt]||null,p=p!=null?p[o]:null,typeof p=="function"&&t.removeEventListener(s,p,f),typeof l=="function")){typeof p!="function"&&p!==null&&(o in t?t[o]=null:t.hasAttribute(o)&&t.removeAttribute(o)),t.addEventListener(s,l,f);break e}o in t?t[o]=l:l===!0?t.setAttribute(o,""):ko(t,o,l)}}}function ot(t,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Me("error",t),Me("load",t);var l=!1,f=!1,p;for(p in o)if(o.hasOwnProperty(p)){var S=o[p];if(S!=null)switch(p){case"src":l=!0;break;case"srcSet":f=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,s));default:Pe(t,s,p,S,o,null)}}f&&Pe(t,s,"srcSet",o.srcSet,o,null),l&&Pe(t,s,"src",o.src,o,null);return;case"input":Me("invalid",t);var T=p=S=f=null,B=null,O=null;for(l in o)if(o.hasOwnProperty(l)){var V=o[l];if(V!=null)switch(l){case"name":f=V;break;case"type":S=V;break;case"checked":B=V;break;case"defaultChecked":O=V;break;case"value":p=V;break;case"defaultValue":T=V;break;case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(n(137,s));break;default:Pe(t,s,l,V,o,null)}}Zu(t,p,T,B,O,S,f,!1),Ro(t);return;case"select":Me("invalid",t),l=S=p=null;for(f in o)if(o.hasOwnProperty(f)&&(T=o[f],T!=null))switch(f){case"value":p=T;break;case"defaultValue":S=T;break;case"multiple":l=T;default:Pe(t,s,f,T,o,null)}s=p,o=S,t.multiple=!!l,s!=null?gn(t,!!l,s,!1):o!=null&&gn(t,!!l,o,!0);return;case"textarea":Me("invalid",t),p=f=l=null;for(S in o)if(o.hasOwnProperty(S)&&(T=o[S],T!=null))switch(S){case"value":l=T;break;case"defaultValue":f=T;break;case"children":p=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(n(91));break;default:Pe(t,s,S,T,o,null)}Qu(t,l,f,p),Ro(t);return;case"option":for(B in o)if(o.hasOwnProperty(B)&&(l=o[B],l!=null))switch(B){case"selected":t.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Pe(t,s,B,l,o,null)}return;case"dialog":Me("beforetoggle",t),Me("toggle",t),Me("cancel",t),Me("close",t);break;case"iframe":case"object":Me("load",t);break;case"video":case"audio":for(l=0;l<$a.length;l++)Me($a[l],t);break;case"image":Me("error",t),Me("load",t);break;case"details":Me("toggle",t);break;case"embed":case"source":case"link":Me("error",t),Me("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(O in o)if(o.hasOwnProperty(O)&&(l=o[O],l!=null))switch(O){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,s));default:Pe(t,s,O,l,o,null)}return;default:if(Pl(s)){for(V in o)o.hasOwnProperty(V)&&(l=o[V],l!==void 0&&vh(t,s,V,l,o,void 0));return}}for(T in o)o.hasOwnProperty(T)&&(l=o[T],l!=null&&Pe(t,s,T,l,o,null))}function Ev(t,s,o,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var f=null,p=null,S=null,T=null,B=null,O=null,V=null;for(U in o){var j=o[U];if(o.hasOwnProperty(U)&&j!=null)switch(U){case"checked":break;case"value":break;case"defaultValue":B=j;default:l.hasOwnProperty(U)||Pe(t,s,U,null,l,j)}}for(var F in l){var U=l[F];if(j=o[F],l.hasOwnProperty(F)&&(U!=null||j!=null))switch(F){case"type":p=U;break;case"name":f=U;break;case"checked":O=U;break;case"defaultChecked":V=U;break;case"value":S=U;break;case"defaultValue":T=U;break;case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(n(137,s));break;default:U!==j&&Pe(t,s,F,U,l,j)}}xl(t,S,T,B,O,V,p,f);return;case"select":U=S=T=F=null;for(p in o)if(B=o[p],o.hasOwnProperty(p)&&B!=null)switch(p){case"value":break;case"multiple":U=B;default:l.hasOwnProperty(p)||Pe(t,s,p,null,l,B)}for(f in l)if(p=l[f],B=o[f],l.hasOwnProperty(f)&&(p!=null||B!=null))switch(f){case"value":F=p;break;case"defaultValue":T=p;break;case"multiple":S=p;default:p!==B&&Pe(t,s,f,p,l,B)}s=T,o=S,l=U,F!=null?gn(t,!!o,F,!1):!!l!=!!o&&(s!=null?gn(t,!!o,s,!0):gn(t,!!o,o?[]:"",!1));return;case"textarea":U=F=null;for(T in o)if(f=o[T],o.hasOwnProperty(T)&&f!=null&&!l.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:Pe(t,s,T,null,l,f)}for(S in l)if(f=l[S],p=o[S],l.hasOwnProperty(S)&&(f!=null||p!=null))switch(S){case"value":F=f;break;case"defaultValue":U=f;break;case"children":break;case"dangerouslySetInnerHTML":if(f!=null)throw Error(n(91));break;default:f!==p&&Pe(t,s,S,f,l,p)}Ku(t,F,U);return;case"option":for(var ge in o)if(F=o[ge],o.hasOwnProperty(ge)&&F!=null&&!l.hasOwnProperty(ge))switch(ge){case"selected":t.selected=!1;break;default:Pe(t,s,ge,null,l,F)}for(B in l)if(F=l[B],U=o[B],l.hasOwnProperty(B)&&F!==U&&(F!=null||U!=null))switch(B){case"selected":t.selected=F&&typeof F!="function"&&typeof F!="symbol";break;default:Pe(t,s,B,F,l,U)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var fe in o)F=o[fe],o.hasOwnProperty(fe)&&F!=null&&!l.hasOwnProperty(fe)&&Pe(t,s,fe,null,l,F);for(O in l)if(F=l[O],U=o[O],l.hasOwnProperty(O)&&F!==U&&(F!=null||U!=null))switch(O){case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(n(137,s));break;default:Pe(t,s,O,F,l,U)}return;default:if(Pl(s)){for(var Le in o)F=o[Le],o.hasOwnProperty(Le)&&F!==void 0&&!l.hasOwnProperty(Le)&&vh(t,s,Le,void 0,l,F);for(V in l)F=l[V],U=o[V],!l.hasOwnProperty(V)||F===U||F===void 0&&U===void 0||vh(t,s,V,F,l,U);return}}for(var P in o)F=o[P],o.hasOwnProperty(P)&&F!=null&&!l.hasOwnProperty(P)&&Pe(t,s,P,null,l,F);for(j in l)F=l[j],U=o[j],!l.hasOwnProperty(j)||F===U||F==null&&U==null||Pe(t,s,j,F,l,U)}var bh=null,Sh=null;function Tr(t){return t.nodeType===9?t:t.ownerDocument}function J0(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function eg(t,s){if(t===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&s==="foreignObject"?0:t}function Mh(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Ch=null;function Iv(){var t=window.event;return t&&t.type==="popstate"?t===Ch?!1:(Ch=t,!0):(Ch=null,!1)}var tg=typeof setTimeout=="function"?setTimeout:void 0,_v=typeof clearTimeout=="function"?clearTimeout:void 0,ig=typeof Promise=="function"?Promise:void 0,xv=typeof queueMicrotask=="function"?queueMicrotask:typeof ig<"u"?function(t){return ig.resolve(null).then(t).catch(Dv)}:tg;function Dv(t){setTimeout(function(){throw t})}function ps(t){return t==="head"}function sg(t,s){var o=s,l=0,f=0;do{var p=o.nextSibling;if(t.removeChild(o),p&&p.nodeType===8)if(o=p.data,o==="/$"){if(0<l&&8>l){o=l;var S=t.ownerDocument;if(o&1&&eo(S.documentElement),o&2&&eo(S.body),o&4)for(o=S.head,eo(o),S=o.firstChild;S;){var T=S.nextSibling,B=S.nodeName;S[pa]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&S.rel.toLowerCase()==="stylesheet"||o.removeChild(S),S=T}}if(f===0){t.removeChild(p),lo(s);return}f--}else o==="$"||o==="$?"||o==="$!"?f++:l=o.charCodeAt(0)-48;else l=0;o=p}while(o);lo(s)}function Th(t){var s=t.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Th(o),Rl(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}t.removeChild(o)}}function Pv(t,s,o,l){for(;t.nodeType===1;){var f=o;if(t.nodeName.toLowerCase()!==s.toLowerCase()){if(!l&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(l){if(!t[pa])switch(s){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(p=t.getAttribute("rel"),p==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(p!==f.rel||t.getAttribute("href")!==(f.href==null||f.href===""?null:f.href)||t.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin)||t.getAttribute("title")!==(f.title==null?null:f.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(p=t.getAttribute("src"),(p!==(f.src==null?null:f.src)||t.getAttribute("type")!==(f.type==null?null:f.type)||t.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin))&&p&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(s==="input"&&t.type==="hidden"){var p=f.name==null?null:""+f.name;if(f.type==="hidden"&&t.getAttribute("name")===p)return t}else return t;if(t=ai(t.nextSibling),t===null)break}return null}function Lv(t,s,o){if(s==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!o||(t=ai(t.nextSibling),t===null))return null;return t}function wh(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function Ov(t,s){var o=t.ownerDocument;if(t.data!=="$?"||o.readyState==="complete")s();else{var l=function(){s(),o.removeEventListener("DOMContentLoaded",l)};o.addEventListener("DOMContentLoaded",l),t._reactRetry=l}}function ai(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return t}var Ah=null;function ng(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"){if(s===0)return t;s--}else o==="/$"&&s++}t=t.previousSibling}return null}function ag(t,s,o){switch(s=Tr(o),t){case"html":if(t=s.documentElement,!t)throw Error(n(452));return t;case"head":if(t=s.head,!t)throw Error(n(453));return t;case"body":if(t=s.body,!t)throw Error(n(454));return t;default:throw Error(n(451))}}function eo(t){for(var s=t.attributes;s.length;)t.removeAttributeNode(s[0]);Rl(t)}var Kt=new Map,og=new Set;function wr(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Fi=X.d;X.d={f:Fv,r:Uv,D:Nv,C:Hv,L:Wv,m:zv,X:Vv,S:Gv,M:Xv};function Fv(){var t=Fi.f(),s=pr();return t||s}function Uv(t){var s=hn(t);s!==null&&s.tag===5&&s.type==="form"?kd(s):Fi.r(t)}var Vn=typeof document>"u"?null:document;function rg(t,s,o){var l=Vn;if(l&&typeof s=="string"&&s){var f=Gt(s);f='link[rel="'+t+'"][href="'+f+'"]',typeof o=="string"&&(f+='[crossorigin="'+o+'"]'),og.has(f)||(og.add(f),t={rel:t,crossOrigin:o,href:s},l.querySelector(f)===null&&(s=l.createElement("link"),ot(s,"link",t),Je(s),l.head.appendChild(s)))}}function Nv(t){Fi.D(t),rg("dns-prefetch",t,null)}function Hv(t,s){Fi.C(t,s),rg("preconnect",t,s)}function Wv(t,s,o){Fi.L(t,s,o);var l=Vn;if(l&&t&&s){var f='link[rel="preload"][as="'+Gt(s)+'"]';s==="image"&&o&&o.imageSrcSet?(f+='[imagesrcset="'+Gt(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(f+='[imagesizes="'+Gt(o.imageSizes)+'"]')):f+='[href="'+Gt(t)+'"]';var p=f;switch(s){case"style":p=Xn(t);break;case"script":p=Yn(t)}Kt.has(p)||(t=m({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:t,as:s},o),Kt.set(p,t),l.querySelector(f)!==null||s==="style"&&l.querySelector(to(p))||s==="script"&&l.querySelector(io(p))||(s=l.createElement("link"),ot(s,"link",t),Je(s),l.head.appendChild(s)))}}function zv(t,s){Fi.m(t,s);var o=Vn;if(o&&t){var l=s&&typeof s.as=="string"?s.as:"script",f='link[rel="modulepreload"][as="'+Gt(l)+'"][href="'+Gt(t)+'"]',p=f;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=Yn(t)}if(!Kt.has(p)&&(t=m({rel:"modulepreload",href:t},s),Kt.set(p,t),o.querySelector(f)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(io(p)))return}l=o.createElement("link"),ot(l,"link",t),Je(l),o.head.appendChild(l)}}}function Gv(t,s,o){Fi.S(t,s,o);var l=Vn;if(l&&t){var f=un(l).hoistableStyles,p=Xn(t);s=s||"default";var S=f.get(p);if(!S){var T={loading:0,preload:null};if(S=l.querySelector(to(p)))T.loading=5;else{t=m({rel:"stylesheet",href:t,"data-precedence":s},o),(o=Kt.get(p))&&kh(t,o);var B=S=l.createElement("link");Je(B),ot(B,"link",t),B._p=new Promise(function(O,V){B.onload=O,B.onerror=V}),B.addEventListener("load",function(){T.loading|=1}),B.addEventListener("error",function(){T.loading|=2}),T.loading|=4,Ar(S,s,l)}S={type:"stylesheet",instance:S,count:1,state:T},f.set(p,S)}}}function Vv(t,s){Fi.X(t,s);var o=Vn;if(o&&t){var l=un(o).hoistableScripts,f=Yn(t),p=l.get(f);p||(p=o.querySelector(io(f)),p||(t=m({src:t,async:!0},s),(s=Kt.get(f))&&Bh(t,s),p=o.createElement("script"),Je(p),ot(p,"link",t),o.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},l.set(f,p))}}function Xv(t,s){Fi.M(t,s);var o=Vn;if(o&&t){var l=un(o).hoistableScripts,f=Yn(t),p=l.get(f);p||(p=o.querySelector(io(f)),p||(t=m({src:t,async:!0,type:"module"},s),(s=Kt.get(f))&&Bh(t,s),p=o.createElement("script"),Je(p),ot(p,"link",t),o.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},l.set(f,p))}}function lg(t,s,o,l){var f=(f=ue.current)?wr(f):null;if(!f)throw Error(n(446));switch(t){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=Xn(o.href),o=un(f).hoistableStyles,l=o.get(s),l||(l={type:"style",instance:null,count:0,state:null},o.set(s,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){t=Xn(o.href);var p=un(f).hoistableStyles,S=p.get(t);if(S||(f=f.ownerDocument||f,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(t,S),(p=f.querySelector(to(t)))&&!p._p&&(S.instance=p,S.state.loading=5),Kt.has(t)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},Kt.set(t,o),p||Yv(f,t,o,S.state))),s&&l===null)throw Error(n(528,""));return S}if(s&&l!==null)throw Error(n(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Yn(o),o=un(f).hoistableScripts,l=o.get(s),l||(l={type:"script",instance:null,count:0,state:null},o.set(s,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,t))}}function Xn(t){return'href="'+Gt(t)+'"'}function to(t){return'link[rel="stylesheet"]['+t+"]"}function cg(t){return m({},t,{"data-precedence":t.precedence,precedence:null})}function Yv(t,s,o,l){t.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=t.createElement("link"),l.preload=s,s.addEventListener("load",function(){return l.loading|=1}),s.addEventListener("error",function(){return l.loading|=2}),ot(s,"link",o),Je(s),t.head.appendChild(s))}function Yn(t){return'[src="'+Gt(t)+'"]'}function io(t){return"script[async]"+t}function hg(t,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var l=t.querySelector('style[data-href~="'+Gt(o.href)+'"]');if(l)return s.instance=l,Je(l),l;var f=m({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return l=(t.ownerDocument||t).createElement("style"),Je(l),ot(l,"style",f),Ar(l,o.precedence,t),s.instance=l;case"stylesheet":f=Xn(o.href);var p=t.querySelector(to(f));if(p)return s.state.loading|=4,s.instance=p,Je(p),p;l=cg(o),(f=Kt.get(f))&&kh(l,f),p=(t.ownerDocument||t).createElement("link"),Je(p);var S=p;return S._p=new Promise(function(T,B){S.onload=T,S.onerror=B}),ot(p,"link",l),s.state.loading|=4,Ar(p,o.precedence,t),s.instance=p;case"script":return p=Yn(o.src),(f=t.querySelector(io(p)))?(s.instance=f,Je(f),f):(l=o,(f=Kt.get(p))&&(l=m({},o),Bh(l,f)),t=t.ownerDocument||t,f=t.createElement("script"),Je(f),ot(f,"link",l),t.head.appendChild(f),s.instance=f);case"void":return null;default:throw Error(n(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(l=s.instance,s.state.loading|=4,Ar(l,o.precedence,t));return s.instance}function Ar(t,s,o){for(var l=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),f=l.length?l[l.length-1]:null,p=f,S=0;S<l.length;S++){var T=l[S];if(T.dataset.precedence===s)p=T;else if(p!==f)break}p?p.parentNode.insertBefore(t,p.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(t,s.firstChild))}function kh(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.title==null&&(t.title=s.title)}function Bh(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.integrity==null&&(t.integrity=s.integrity)}var kr=null;function ug(t,s,o){if(kr===null){var l=new Map,f=kr=new Map;f.set(o,l)}else f=kr,l=f.get(o),l||(l=new Map,f.set(o,l));if(l.has(t))return l;for(l.set(t,null),o=o.getElementsByTagName(t),f=0;f<o.length;f++){var p=o[f];if(!(p[pa]||p[ft]||t==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var S=p.getAttribute(s)||"";S=t+S;var T=l.get(S);T?T.push(p):l.set(S,[p])}}return l}function fg(t,s,o){t=t.ownerDocument||t,t.head.insertBefore(o,s==="title"?t.querySelector("head > title"):null)}function qv(t,s,o){if(o===1||s.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return t=s.disabled,typeof s.precedence=="string"&&t==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function dg(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}var so=null;function jv(){}function Zv(t,s,o){if(so===null)throw Error(n(475));var l=so;if(s.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var f=Xn(o.href),p=t.querySelector(to(f));if(p){t=p._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(l.count++,l=Br.bind(l),t.then(l,l)),s.state.loading|=4,s.instance=p,Je(p);return}p=t.ownerDocument||t,o=cg(o),(f=Kt.get(f))&&kh(o,f),p=p.createElement("link"),Je(p);var S=p;S._p=new Promise(function(T,B){S.onload=T,S.onerror=B}),ot(p,"link",o),s.instance=p}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(s,t),(t=s.state.preload)&&(s.state.loading&3)===0&&(l.count++,s=Br.bind(l),t.addEventListener("load",s),t.addEventListener("error",s))}}function Kv(){if(so===null)throw Error(n(475));var t=so;return t.stylesheets&&t.count===0&&Rh(t,t.stylesheets),0<t.count?function(s){var o=setTimeout(function(){if(t.stylesheets&&Rh(t,t.stylesheets),t.unsuspend){var l=t.unsuspend;t.unsuspend=null,l()}},6e4);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(o)}}:null}function Br(){if(this.count--,this.count===0){if(this.stylesheets)Rh(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Rr=null;function Rh(t,s){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Rr=new Map,s.forEach(Qv,t),Rr=null,Br.call(t))}function Qv(t,s){if(!(s.state.loading&4)){var o=Rr.get(t);if(o)var l=o.get(null);else{o=new Map,Rr.set(t,o);for(var f=t.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<f.length;p++){var S=f[p];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(o.set(S.dataset.precedence,S),l=S)}l&&o.set(null,l)}f=s.instance,S=f.getAttribute("data-precedence"),p=o.get(S)||l,p===l&&o.set(null,f),o.set(S,f),this.count++,l=Br.bind(this),f.addEventListener("load",l),f.addEventListener("error",l),p?p.parentNode.insertBefore(f,p.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(f,t.firstChild)),s.state.loading|=4}}var no={$$typeof:I,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function $v(t,s,o,l,f,p,S,T){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=wl(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wl(0),this.hiddenUpdates=wl(null),this.identifierPrefix=l,this.onUncaughtError=f,this.onCaughtError=p,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=T,this.incompleteTransitions=new Map}function gg(t,s,o,l,f,p,S,T,B,O,V,j){return t=new $v(t,s,o,S,T,B,O,j),s=1,p===!0&&(s|=24),p=Pt(3,null,null,s),t.current=p,p.stateNode=t,s=cc(),s.refCount++,t.pooledCache=s,s.refCount++,p.memoizedState={element:l,isDehydrated:o,cache:s},dc(p),t}function pg(t){return t?(t=Tn,t):Tn}function mg(t,s,o,l,f,p){f=pg(f),l.context===null?l.context=f:l.pendingContext=f,l=is(s),l.payload={element:o},p=p===void 0?null:p,p!==null&&(l.callback=p),o=ss(t,l,s),o!==null&&(Nt(o,t,s),Pa(o,t,s))}function yg(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<s?o:s}}function Eh(t,s){yg(t,s),(t=t.alternate)&&yg(t,s)}function vg(t){if(t.tag===13){var s=Cn(t,67108864);s!==null&&Nt(s,t,67108864),Eh(t,67108864)}}var Er=!0;function Jv(t,s,o,l){var f=D.T;D.T=null;var p=X.p;try{X.p=2,Ih(t,s,o,l)}finally{X.p=p,D.T=f}}function eb(t,s,o,l){var f=D.T;D.T=null;var p=X.p;try{X.p=8,Ih(t,s,o,l)}finally{X.p=p,D.T=f}}function Ih(t,s,o,l){if(Er){var f=_h(l);if(f===null)yh(t,s,l,Ir,o),Sg(t,l);else if(ib(f,t,s,o,l))l.stopPropagation();else if(Sg(t,l),s&4&&-1<tb.indexOf(t)){for(;f!==null;){var p=hn(f);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var S=Es(p.pendingLanes);if(S!==0){var T=p;for(T.pendingLanes|=2,T.entangledLanes|=2;S;){var B=1<<31-xt(S);T.entanglements[1]|=B,S&=~B}yi(p),(Ie&6)===0&&(dr=fi()+500,Qa(0))}}break;case 13:T=Cn(p,2),T!==null&&Nt(T,p,2),pr(),Eh(p,2)}if(p=_h(l),p===null&&yh(t,s,l,Ir,o),p===f)break;f=p}f!==null&&l.stopPropagation()}else yh(t,s,l,null,o)}}function _h(t){return t=Ol(t),xh(t)}var Ir=null;function xh(t){if(Ir=null,t=cn(t),t!==null){var s=c(t);if(s===null)t=null;else{var o=s.tag;if(o===13){if(t=h(s),t!==null)return t;t=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null)}}return Ir=t,null}function bg(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Hm()){case xu:return 2;case Du:return 8;case Co:case Wm:return 32;case Pu:return 268435456;default:return 32}default:return 32}}var Dh=!1,ms=null,ys=null,vs=null,ao=new Map,oo=new Map,bs=[],tb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Sg(t,s){switch(t){case"focusin":case"focusout":ms=null;break;case"dragenter":case"dragleave":ys=null;break;case"mouseover":case"mouseout":vs=null;break;case"pointerover":case"pointerout":ao.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":oo.delete(s.pointerId)}}function ro(t,s,o,l,f,p){return t===null||t.nativeEvent!==p?(t={blockedOn:s,domEventName:o,eventSystemFlags:l,nativeEvent:p,targetContainers:[f]},s!==null&&(s=hn(s),s!==null&&vg(s)),t):(t.eventSystemFlags|=l,s=t.targetContainers,f!==null&&s.indexOf(f)===-1&&s.push(f),t)}function ib(t,s,o,l,f){switch(s){case"focusin":return ms=ro(ms,t,s,o,l,f),!0;case"dragenter":return ys=ro(ys,t,s,o,l,f),!0;case"mouseover":return vs=ro(vs,t,s,o,l,f),!0;case"pointerover":var p=f.pointerId;return ao.set(p,ro(ao.get(p)||null,t,s,o,l,f)),!0;case"gotpointercapture":return p=f.pointerId,oo.set(p,ro(oo.get(p)||null,t,s,o,l,f)),!0}return!1}function Mg(t){var s=cn(t.target);if(s!==null){var o=c(s);if(o!==null){if(s=o.tag,s===13){if(s=h(o),s!==null){t.blockedOn=s,Zm(t.priority,function(){if(o.tag===13){var l=Ut();l=Al(l);var f=Cn(o,l);f!==null&&Nt(f,o,l),Eh(o,l)}});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function _r(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var o=_h(t.nativeEvent);if(o===null){o=t.nativeEvent;var l=new o.constructor(o.type,o);Ll=l,o.target.dispatchEvent(l),Ll=null}else return s=hn(o),s!==null&&vg(s),t.blockedOn=o,!1;s.shift()}return!0}function Cg(t,s,o){_r(t)&&o.delete(s)}function sb(){Dh=!1,ms!==null&&_r(ms)&&(ms=null),ys!==null&&_r(ys)&&(ys=null),vs!==null&&_r(vs)&&(vs=null),ao.forEach(Cg),oo.forEach(Cg)}function xr(t,s){t.blockedOn===s&&(t.blockedOn=null,Dh||(Dh=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,sb)))}var Dr=null;function Tg(t){Dr!==t&&(Dr=t,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){Dr===t&&(Dr=null);for(var s=0;s<t.length;s+=3){var o=t[s],l=t[s+1],f=t[s+2];if(typeof l!="function"){if(xh(l||o)===null)continue;break}var p=hn(o);p!==null&&(t.splice(s,3),s-=3,xc(p,{pending:!0,data:f,method:o.method,action:l},l,f))}}))}function lo(t){function s(B){return xr(B,t)}ms!==null&&xr(ms,t),ys!==null&&xr(ys,t),vs!==null&&xr(vs,t),ao.forEach(s),oo.forEach(s);for(var o=0;o<bs.length;o++){var l=bs[o];l.blockedOn===t&&(l.blockedOn=null)}for(;0<bs.length&&(o=bs[0],o.blockedOn===null);)Mg(o),o.blockedOn===null&&bs.shift();if(o=(t.ownerDocument||t).$$reactFormReplay,o!=null)for(l=0;l<o.length;l+=3){var f=o[l],p=o[l+1],S=f[Tt]||null;if(typeof p=="function")S||Tg(o);else if(S){var T=null;if(p&&p.hasAttribute("formAction")){if(f=p,S=p[Tt]||null)T=S.formAction;else if(xh(f)!==null)continue}else T=S.action;typeof T=="function"?o[l+1]=T:(o.splice(l,3),l-=3),Tg(o)}}}function Ph(t){this._internalRoot=t}Pr.prototype.render=Ph.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(n(409));var o=s.current,l=Ut();mg(o,l,t,s,null,null)},Pr.prototype.unmount=Ph.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;mg(t.current,2,null,t,null,null),pr(),s[ln]=null}};function Pr(t){this._internalRoot=t}Pr.prototype.unstable_scheduleHydration=function(t){if(t){var s=Nu();t={blockedOn:null,target:t,priority:s};for(var o=0;o<bs.length&&s!==0&&s<bs[o].priority;o++);bs.splice(o,0,t),o===0&&Mg(t)}};var wg=e.version;if(wg!=="19.1.0")throw Error(n(527,wg,"19.1.0"));X.findDOMNode=function(t){var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(n(188)):(t=Object.keys(t).join(","),Error(n(268,t)));return t=d(s),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var nb={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lr.isDisabled&&Lr.supportsFiber)try{fa=Lr.inject(nb),_t=Lr}catch{}}return uo.createRoot=function(t,s){if(!r(t))throw Error(n(299));var o=!1,l="",f=Hd,p=Wd,S=zd,T=null;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(l=s.identifierPrefix),s.onUncaughtError!==void 0&&(f=s.onUncaughtError),s.onCaughtError!==void 0&&(p=s.onCaughtError),s.onRecoverableError!==void 0&&(S=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(T=s.unstable_transitionCallbacks)),s=gg(t,1,!1,null,null,o,l,f,p,S,T,null),t[ln]=s.current,mh(t),new Ph(s)},uo.hydrateRoot=function(t,s,o){if(!r(t))throw Error(n(299));var l=!1,f="",p=Hd,S=Wd,T=zd,B=null,O=null;return o!=null&&(o.unstable_strictMode===!0&&(l=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(p=o.onUncaughtError),o.onCaughtError!==void 0&&(S=o.onCaughtError),o.onRecoverableError!==void 0&&(T=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(B=o.unstable_transitionCallbacks),o.formState!==void 0&&(O=o.formState)),s=gg(t,1,!0,s,o??null,l,f,p,S,T,B,O),s.context=pg(null),o=s.current,l=Ut(),l=Al(l),f=is(l),f.callback=null,ss(o,f,l),o=l,s.current.lanes=o,ga(s,o),yi(s),t[ln]=s.current,mh(t),new Pr(s)},uo.version="19.1.0",uo}var Hg;function tS(){if(Hg)return Fh.exports;Hg=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),Fh.exports=eS(),Fh.exports}var iS=tS();const sS=ob(iS);var il=mu();function Mi(a){const e=a.replace(/^\/+/,""),i=window.location.pathname.startsWith("/shipwright-survivors");return i&&e.startsWith("shipwright-survivors/")?"/"+e:(i?"/shipwright-survivors/":"./")+e}const zh=.2;class nS{constructor(){this.bufferCache=new Map,this.currentlyPlaying=new Map,this.activeLoops=new Map,this.loopStartLocks=new Map,this.currentMusicSource=null,this.currentMusicFile=null,this.isMusicLooping=!1,this.context=new AudioContext,this.masterGain=this.context.createGain(),this.masterGain.connect(this.context.destination),this.channelGains={music:this.context.createGain(),sfx:this.context.createGain(),dialogue:this.context.createGain()};for(const e of Object.values(this.channelGains))e.connect(this.masterGain)}async play(e,i,n){const r=(n==null?void 0:n.maxSimultaneous)??1,c=Math.max(0,Math.min(1,(n==null?void 0:n.volume)??1)),h=Math.max(-1,Math.min(1,(n==null?void 0:n.pan)??0)),u=this.currentlyPlaying.get(e)??0;if(u>=r)return!1;let d=this.bufferCache.get(e);if(!d)try{const M=await(await fetch(Mi(e))).arrayBuffer();d=await this.context.decodeAudioData(M),this.bufferCache.set(e,d)}catch(v){return console.warn(`Failed to load audio file: ${e}`,v),!1}const g=this.context.createBufferSource();g.buffer=d,g.playbackRate.value=(n==null?void 0:n.pitch)??1;const m=this.context.createGain();m.gain.value=c;const y=this.context.createStereoPanner();return y.pan.value=h,g.connect(m),m.connect(y),y.connect(this.channelGains[i]),this.currentlyPlaying.set(e,u+1),g.onended=()=>{const v=this.currentlyPlaying.get(e)??1,M=Math.max(0,v-1);M===0?this.currentlyPlaying.delete(e):this.currentlyPlaying.set(e,M)},g.start(0),!0}async startLoop(e,i,n){if(this.activeLoops.has(e)&&this.activeLoops.get(e).size>0)return;if(this.loopStartLocks.has(e)){await this.loopStartLocks.get(e);return}const r=this._startLoopInternal(e,i,n);this.loopStartLocks.set(e,r),await r,this.loopStartLocks.delete(e)}async _startLoopInternal(e,i,n){let r=this.bufferCache.get(e);if(!r)try{const b=await(await fetch(Mi(e))).arrayBuffer();r=await this.context.decodeAudioData(b),this.bufferCache.set(e,r)}catch(M){console.warn(`[AudioManager] Failed to load audio file: ${e}`,M);return}const c=Math.max(0,Math.min(1,(n==null?void 0:n.volume)??1)),h=Math.max(-1,Math.min(1,(n==null?void 0:n.pan)??0)),u=(n==null?void 0:n.pitch)??1,d=this.context.createBufferSource();d.buffer=r,d.loop=!0,d.playbackRate.value=u;const g=this.context.createGain(),m=this.context.currentTime;g.gain.setValueAtTime(0,m),g.gain.linearRampToValueAtTime(c,m+zh);const y=this.context.createStereoPanner();y.pan.value=h,d.connect(g),g.connect(y),y.connect(this.channelGains[i]);const v={source:d,gain:g,pan:y};this.activeLoops.has(e)||this.activeLoops.set(e,new Set),this.activeLoops.get(e).add(v),d.start(0)}stopLoop(e){const i=this.activeLoops.get(e);if(!i||i.size===0)return;const n=this.context.currentTime;for(const{source:r,gain:c,pan:h}of i){try{c.gain.cancelScheduledValues(n),c.gain.setValueAtTime(c.gain.value,n),c.gain.linearRampToValueAtTime(0,n+zh)}catch(u){console.warn(`[AudioManager] Fade-out error for ${e}`,u)}setTimeout(()=>{try{r.stop()}catch(u){console.warn(`[AudioManager] Failed to stop source for ${e}`,u)}try{r.disconnect(),c.disconnect(),h.disconnect()}catch(u){console.warn(`[AudioManager] Failed to disconnect nodes for ${e}`,u)}},zh*1e3)}this.activeLoops.delete(e)}stopAllLoops(){for(const e of this.activeLoops.keys())this.stopLoop(e)}setChannelVolume(e,i){const n=Math.max(0,Math.min(1,i));this.channelGains[e].gain.value=n}getChannelVolume(e){return this.channelGains[e].gain.value}setMasterVolume(e){this.masterGain.gain.value=Math.max(0,Math.min(1,e))}getMasterVolume(){return this.masterGain.gain.value}unlock(){this.context.state==="suspended"&&this.context.resume()}clearCache(){this.bufferCache.clear()}async playMusic(e){const{file:i,loopStartMs:n=0}=e;if(this.currentMusicFile===i&&this.isMusicLooping)return;this.stopMusic();let r=this.bufferCache.get(i);if(!r)try{const h=await(await fetch(Mi(i))).arrayBuffer();r=await this.context.decodeAudioData(h),this.bufferCache.set(i,r)}catch(c){console.warn(`Failed to load music file: ${i}`,c);return}if(n>0){const c=this.context.createBufferSource();c.buffer=r,c.loop=!1,c.connect(this.channelGains.music),c.start(0),this.currentMusicSource=c,this.currentMusicFile=i,this.isMusicLooping=!1,c.onended=()=>{if(this.currentMusicSource===c){const h=this.context.createBufferSource();h.buffer=r,h.loop=!0,h.loopStart=n/1e3,h.loopEnd=r.duration,h.connect(this.channelGains.music),h.start(0,n/1e3),this.currentMusicSource=h,this.currentMusicFile=i,this.isMusicLooping=!0}}}else{const c=this.context.createBufferSource();c.buffer=r,c.loop=!0,c.connect(this.channelGains.music),c.start(0),this.currentMusicSource=c,this.currentMusicFile=i,this.isMusicLooping=!0}}stopMusic(){this.currentMusicSource&&(this.currentMusicSource.stop(),this.currentMusicSource.disconnect(),this.currentMusicSource=null,this.currentMusicFile=null,this.isMusicLooping=!1)}}const Q=new nS;class aS{constructor(){this.listeners=new Map}on(e,i){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(i)}off(e,i){var n;(n=this.listeners.get(e))==null||n.delete(i)}emit(e,i){var n;(n=this.listeners.get(e))==null||n.forEach(r=>r(i))}}const Ee=new aS;function Wg(a,e){Ee.emit("resolution:changed",{width:a,height:e})}class we{constructor(){this.masterVolume=1,this.musicVolume=1,this.sfxVolume=1,this.dialogueVolume=1,this.particlesEnabled=!0,this.lightingEnabled=!0,this.collisionsEnabled=!0,this.viewportWidth=1920,this.viewportHeight=1080,this.resolutionChangeCallbacks=[],this.interfaceScaleChangeCallbacks=[],this.interfaceScale=1}static getInstance(){return we.instance||(we.instance=new we),we.instance}onResolutionChange(e){return this.resolutionChangeCallbacks.push(e),()=>{this.resolutionChangeCallbacks=this.resolutionChangeCallbacks.filter(i=>i!==e)}}notifyResolutionChange(){for(const e of this.resolutionChangeCallbacks)e()}onInterfaceScaleChange(e){return this.interfaceScaleChangeCallbacks.push(e),()=>{this.interfaceScaleChangeCallbacks=this.interfaceScaleChangeCallbacks.filter(i=>i!==e)}}notifyInterfaceScaleChange(){for(const e of this.interfaceScaleChangeCallbacks)e()}setViewportWidth(e){this.viewportWidth=Math.max(640,e),this.notifyResolutionChange(),Wg(this.viewportWidth,this.viewportHeight)}setViewportHeight(e){this.viewportHeight=Math.max(480,e),this.notifyResolutionChange(),Wg(this.viewportWidth,this.viewportHeight)}getViewportWidth(){return this.viewportWidth}getViewportHeight(){return this.viewportHeight}setInterfaceScale(e){const i=Math.max(.5,Math.min(2,e));this.interfaceScale!==i&&(this.interfaceScale=i,this.notifyInterfaceScaleChange())}getInterfaceScale(){return 2}setMasterVolume(e){this.masterVolume=this.clampVolume(e),Q.setMasterVolume(this.masterVolume)}setMusicVolume(e){this.musicVolume=this.clampVolume(e),Q.setChannelVolume("music",this.musicVolume)}setSfxVolume(e){this.sfxVolume=this.clampVolume(e),Q.setChannelVolume("sfx",this.sfxVolume)}setDialogueVolume(e){this.dialogueVolume=this.clampVolume(e),Q.setChannelVolume("dialogue",this.dialogueVolume)}setParticlesEnabled(e){this.particlesEnabled=e}setLightingEnabled(e){this.lightingEnabled=e}setCollisionsEnabled(e){this.collisionsEnabled=e}getMasterVolume(){return this.masterVolume}getMusicVolume(){return this.musicVolume}getSfxVolume(){return this.sfxVolume}getDialogueVolume(){return this.dialogueVolume}isCollisionsEnabled(){return this.collisionsEnabled}isParticlesEnabled(){return this.particlesEnabled}isLightingEnabled(){return this.lightingEnabled}toJSON(){return JSON.stringify({masterVolume:this.masterVolume,musicVolume:this.musicVolume,sfxVolume:this.sfxVolume,dialogueVolume:this.dialogueVolume,particlesEnabled:this.particlesEnabled,lightingEnabled:this.lightingEnabled,viewportWidth:this.viewportWidth,viewportHeight:this.viewportHeight,interfaceScale:this.interfaceScale})}fromJSON(e){try{const i=JSON.parse(e);typeof i=="object"&&i!==null&&(this.setMasterVolume(i.masterVolume??this.masterVolume),this.setMusicVolume(i.musicVolume??this.musicVolume),this.setSfxVolume(i.sfxVolume??this.sfxVolume),this.setDialogueVolume(i.dialogueVolume??this.dialogueVolume),this.particlesEnabled=!!(i.particlesEnabled??this.particlesEnabled),this.lightingEnabled=!!(i.lightingEnabled??this.lightingEnabled),this.viewportWidth=Math.max(640,i.viewportWidth??this.viewportWidth),this.viewportHeight=Math.max(480,i.viewportHeight??this.viewportHeight),this.interfaceScale=Math.max(.5,Math.min(2,i.interfaceScale??this.interfaceScale)))}catch(i){console.warn("Failed to load player settings from JSON:",i)}}reset(){this.masterVolume=1,this.musicVolume=1,this.sfxVolume=1,this.dialogueVolume=1,this.particlesEnabled=!0,this.lightingEnabled=!0,this.interfaceScale=1}clampVolume(e){return Math.min(1,Math.max(0,e))}}const Kp=1280,Qp=720;function au(a){return a*ri()/Kp}function aa(a){return a*bi()/Qp}function sl(a){return{x:au(a.x),y:aa(a.y),width:au(a.width),height:aa(a.height)}}function ri(){return we.getInstance().getViewportWidth()}function bi(){return we.getInstance().getViewportHeight()}function oS(){return ri()/Kp}function rS(){return bi()/Qp}function ne(){return Math.min(oS(),rS())}function lS(){const a=ri(),e=bi();return a>=3840?1.8:a>=2560?1.2:e>=1200?1:.8}const zg={background:"background-canvas",backgroundgl:"backgroundgl-canvas",entities:"entity-canvas",entitygl:"entitygl-canvas",polygon:"polygon-canvas",lighting:"lighting-canvas",fx:"fx-canvas",particles:"particles-canvas",ui:"ui-canvas",overlay:"overlay-canvas",dialogue:"dialogue-canvas",unifiedgl2:"unifiedgl2-canvas"},Ks=class Ks{constructor(){this.canvases={},this.contexts={},performance.mark("canvasManager-init-start"),this.initializeCanvases(),this.setFixedSize(),performance.mark("canvasManager-init-end"),performance.measure("CanvasManager Initialization","canvasManager-init-start","canvasManager-init-end")}static getInstance(){return Ks._instance||(Ks._instance=new Ks),Ks._instance}initializeCanvases(){for(const e of Object.keys(zg)){const i=zg[e],n=document.getElementById(i);if(!n||!(n instanceof HTMLCanvasElement))throw new Error(`CanvasManager error: element with ID "${i}" not found. Ensure canvases are in the DOM before sceneManager.setScene(...)`);if(!["lighting","entitygl","backgroundgl","polygon","unifiedgl2"].includes(e)){const r=n.getContext("2d",{willReadFrequently:!1});if(!r)throw new Error(`2D context not supported for "${i}"`);this.contexts[e]=r}n.style.zIndex=this.getZIndexForLayer(e).toString(),n.style.pointerEvents=e==="ui"?"auto":"none",n.style.position="absolute",this.canvases[e]=n}}setFixedSize(){const e=ri(),i=bi();for(const[n,r]of Object.entries(this.canvases))r.width=e,r.height=i,r.style.width=`${e}px`,r.style.height=`${i}px`}getZIndexForLayer(e){switch(e){case"background":return 1;case"backgroundgl":return 0;case"entitygl":return 2;case"polygon":return 3;case"entities":return 4;case"lighting":return 5;case"unifiedgl2":return 6;case"fx":return 7;case"particles":return 8;case"ui":return 9;case"overlay":return 10;case"dialogue":return 11}}getCanvas(e){return this.canvases[e]}getContext(e){return this.contexts[e]}getWebGLContext(e){const n=this.getCanvas(e).getContext("webgl");if(!n)throw new Error(`WebGL context not supported for "${e}"`);return n}getWebGL2Context(e){const n=this.getCanvas(e).getContext("webgl2");if(!n)throw new Error(`WebGL2 context not supported for layer "${e}"`);return n}clearLayer(e){e==="lighting"?this.clearWebGLLayer(e):this.getContext(e).clearRect(0,0,ri(),bi())}clearWebGLLayer(e,i=[0,0,0,0]){const n=this.getCanvas(e),r=n.getContext("webgl");if(!r)throw new Error(`Cannot clear WebGL layer '${e}': no WebGL context available`);r.viewport(0,0,n.width,n.height),r.clearColor(...i),r.clear(r.COLOR_BUFFER_BIT)}clearWebGL2Layer(e,i=[0,0,0,0]){const n=this.getCanvas(e),r=n.getContext("webgl2");if(!r)throw new Error(`Cannot clear WebGL2 layer '${e}': no WebGL2 context available`);r.viewport(0,0,n.width,n.height),r.clearColor(...i),r.clear(r.COLOR_BUFFER_BIT)}clearAll(){for(const e of Object.keys(this.contexts))this.clearLayer(e)}getWidth(){return ri()}getHeight(){return bi()}getDimensions(){return{width:ri(),height:bi()}}resize(){performance.mark("canvasManager-resize-start");const e=ri(),i=bi();for(const[n,r]of Object.entries(this.canvases))r.width=e,r.height=i,r.style.width=`${e}px`,r.style.height=`${i}px`;performance.mark("canvasManager-resize-end"),performance.measure("CanvasManager Resize","canvasManager-resize-start","canvasManager-resize-end")}};Ks._instance=null;let ii=Ks;function cS(){if(document.fullscreenElement)document.exitFullscreen?document.exitFullscreen().catch(a=>{console.warn("Failed to exit fullscreen:",a)}):document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen();else{const a=document.documentElement;a.requestFullscreen?a.requestFullscreen().catch(e=>{console.warn("Failed to enter fullscreen:",e)}):a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():console.warn("Fullscreen API not supported in this browser")}}const Qs=class Qs{constructor(){this.lastUsed="keyboard",this.lastUsedTimestamp=performance.now()}static getInstance(){return Qs._instance||(Qs._instance=new Qs),Qs._instance}updateDevice(e){this.lastUsed!==e&&(this.lastUsed=e,this.lastUsedTimestamp=performance.now())}getLastUsed(){return this.lastUsed}getLastUsedTimestamp(){return this.lastUsedTimestamp}};Qs._instance=null;let It=Qs;const Gh=.2;class hS{constructor(){this.connected=!1,this.prevButtons=new Set,this.currentButtons=new Set,this.justPressed=new Set,this.justReleased=new Set,this.leftStick={x:0,y:0},this.rightStick={x:0,y:0}}updateFrame(){this.justPressed.clear(),this.justReleased.clear();const e=this.getPrimaryGamepad();if(!e){this.connected=!1,this.currentButtons.clear();return}this.connected=!0;const i={...this.leftStick},n={...this.rightStick};this.currentButtons.size,this.pollButtons(e),this.pollSticks(e);const r=this.justPressed.size>0||this.justReleased.size>0,c=Math.abs(i.x-this.leftStick.x)>.05||Math.abs(i.y-this.leftStick.y)>.05,h=Math.abs(n.x-this.rightStick.x)>.05||Math.abs(n.y-this.rightStick.y)>.05;(r||c||h)&&It.getInstance().updateDevice("gamepad")}isActionPressed(e){return this.currentButtons.has(e)}wasActionJustPressed(e){return this.justPressed.has(e)}wasActionJustReleased(e){return this.justReleased.has(e)}getLeftStick(){return this.leftStick}getRightStick(){return this.rightStick}isConnected(){return this.connected}getPrimaryGamepad(){var i;const e=((i=navigator.getGamepads)==null?void 0:i.call(navigator))??[];for(const n of e)if(n&&n.connected&&n.mapping==="standard")return n;return null}pollButtons(e){const i=new Set,n=this.prevButtons;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r].pressed){const h=this.mapButtonIndexToAlias(r);h&&i.add(h)}for(const r of i)n.has(r)||this.justPressed.add(r);for(const r of n)i.has(r)||this.justReleased.add(r);this.prevButtons=new Set(i),this.currentButtons=i}pollSticks(e){const i=e.axes[0]??0,n=e.axes[1]??0,r=Math.hypot(i,n);if(r<Gh)this.leftStick={x:0,y:0};else{const d=i/r,g=n/r;this.leftStick={x:d,y:g}}const c=e.axes[2]??0,h=e.axes[3]??0,u=Math.hypot(c,h);if(u<Gh)this.rightStick={x:0,y:0};else{const d=c/u,g=h/u;this.rightStick={x:d,y:g}}}applyDeadzone(e){return Math.abs(e)<Gh?0:e}mapButtonIndexToAlias(e){switch(e){case 0:return"A";case 1:return"B";case 2:return"X";case 3:return"Y";case 4:return"leftBumper";case 5:return"rightBumper";case 6:return"leftTrigger";case 7:return"rightTrigger";case 8:return"start";case 9:return"select";case 10:return"leftStickButton";case 11:return"rightStickButton";case 12:return"dpadUp";case 13:return"dpadDown";case 14:return"dpadLeft";case 15:return"dpadRight";case 16:return"home";default:return null}}normalize(e,i){const n=Math.hypot(e,i);return n>1e-5?{x:e/n,y:i/n}:{x:0,y:0}}}const Ui={thrustForward:{keys:["KeyW"],gamepadButtons:["leftTrigger"]},afterburner:{keys:["ShiftLeft"],gamepadButtons:["leftBumper"]},brake:{keys:["KeyS"],gamepadButtons:["B"]},powerSlide:{keys:[],gamepadButtons:[]},rotateLeft:{keys:["KeyA"],gamepadButtons:[]},rotateRight:{keys:["KeyD"],gamepadButtons:[]},strafeLeft:{keys:["KeyQ"],gamepadButtons:["dpadLeft"]},strafeRight:{keys:["KeyE"],gamepadButtons:["dpadRight"]},firePrimary:{keys:["MouseLeft"],gamepadButtons:["rightBumper"]},fireSecondary:{keys:["MouseRight"],gamepadButtons:["rightTrigger"]},fireTertiary:{keys:["Space"],gamepadButtons:["leftTrigger"]},fireQuaternary:{keys:["KeyC"],gamepadButtons:[]},switchFiringMode:{keys:["KeyX"],gamepadButtons:["X"]},openMenu:{keys:["Escape"],gamepadButtons:["start"]},openShipBuilder:{keys:["Tab"],gamepadButtons:["Y"]},select:{keys:["Enter"],gamepadButtons:["A"]},cancel:{keys:["Escape"],gamepadButtons:["B"]},pause:{keys:["Escape"],gamepadButtons:["start"]}};function yu(){return typeof window<"u"&&typeof navigator=="object"&&navigator.userAgent.toLowerCase().includes("electron")}class uS{constructor(){this.strength=0,this.duration=0,this.maxDuration=0,this.frequency=30,this.time=0,this.phaseX=0,this.phaseY=0,this.offsetX=0,this.offsetY=0}trigger(e,i,n=30){this.strength=e,this.duration=i,this.maxDuration=i,this.frequency=n,this.time=0,this.phaseX=Math.random()*Math.PI*2,this.phaseY=Math.random()*Math.PI*2}update(e){if(this.duration<=0){this.offsetX=0,this.offsetY=0;return}this.time+=e,this.duration-=e;const i=Math.max(0,this.duration/this.maxDuration),n=this.frequency*2*Math.PI,r=this.strength*i;this.offsetX=Math.sin(this.time*n+this.phaseX)*r,this.offsetY=Math.sin(this.time*n+this.phaseY)*r}getOffset(){return{x:this.offsetX,y:this.offsetY}}isActive(){return this.duration>0}stop(){this.duration=0,this.offsetX=0,this.offsetY=0}}const vi=class vi{constructor(e,i){this.screenShake=new uS,this.x=0,this.y=0,this.zoom=.3,this.targetX=0,this.targetY=0,this.skipSmoothingThisFrame=!1,this.deadZoneRadius=12,this.zoomAnimationTarget=null,this.zoomAnimationSpeed=.025,this.handleShakeEvent=({strength:n,duration:r,frequency:c})=>{this.screenShake.trigger(n,r,c)},this.viewportWidth=e,this.viewportHeight=i,Ee.on("camera:shake",this.handleShakeEvent)}static getInstance(e,i){if(!vi._instance){if(e==null||i==null)throw new Error("[Camera] Must supply viewport dimensions on first initialization");vi._instance=new vi(e,i)}return vi._instance}static destroy(){vi._instance&&(vi._instance.cleanup(),vi._instance=null)}update(e){this.screenShake.update(e);const i=this.targetX-this.x,n=this.targetY-this.y,r=i*i+n*n;if(this.skipSmoothingThisFrame)this.x=this.targetX,this.y=this.targetY;else if(r>this.deadZoneRadius*this.deadZoneRadius){const u=(d,g,m)=>d+(g-d)*m;this.x=u(this.x,this.targetX,1.05),this.y=u(this.y,this.targetY,1.05)}const c=this.screenShake.getOffset();if(this.x+=c.x/this.zoom,this.y+=c.y/this.zoom,this.zoomAnimationTarget!==null){const h=this.zoomAnimationTarget-this.zoom;if(Math.abs(h)>.001){const u=this.zoomAnimationSpeed*h,d=this.zoom+u,g=Math.log(d/this.zoom)/Math.log(1.08);this.adjustZoom(g)}else this.zoom=this.zoomAnimationTarget,this.zoomAnimationTarget=null}this.skipSmoothingThisFrame=!1}follow(e){this.targetX=e.x-this.viewportWidth/2/this.zoom,this.targetY=e.y-this.viewportHeight/2/this.zoom}worldToScreen(e,i){return{x:(e-this.x)*this.zoom,y:(i-this.y)*this.zoom}}screenToWorld(e,i){return{x:e/this.zoom+this.x,y:i/this.zoom+this.y}}getOffset(){return{x:this.x,y:this.y}}getPosition(){return{x:this.x+this.viewportWidth/2/this.zoom,y:this.y+this.viewportHeight/2/this.zoom}}adjustZoom(e){const n=Math.max(-1,Math.min(1,e)),r=this.screenToWorld(this.viewportWidth/2,this.viewportHeight/2),c=n>0?this.zoom*Math.pow(1.08,n):this.zoom/Math.pow(1.08,-n),h=ne(),u=.15*h,d=.5*h;this.zoom=Math.min(d,Math.max(u,c));const g=this.screenToWorld(this.viewportWidth/2,this.viewportHeight/2),m=r.x-g.x,y=r.y-g.y;this.x+=m,this.y+=y,this.targetX+=m,this.targetY+=y,this.skipSmoothingThisFrame=!0}animateZoomTo(e,i=.025){const n=ne(),r=.15*n,c=.5*n;this.zoomAnimationTarget=Math.min(c,Math.max(r,e)),this.zoomAnimationSpeed=i}getZoom(){return this.zoom}abortZoomAnimation(){this.zoomAnimationTarget=null}getViewportBounds(){const e=this.viewportWidth/this.zoom,i=this.viewportHeight/this.zoom;return{x:this.x,y:this.y,width:e,height:i}}getViewBounds(e){const i=e.getCanvas("entitygl"),n=i.width/this.zoom,r=i.height/this.zoom;return{left:this.x,right:this.x+n,bottom:this.y+r,top:this.y}}getViewportWidth(){return this.viewportWidth}getViewportHeight(){return this.viewportHeight}resize(e,i){this.viewportWidth=e,this.viewportHeight=i}cleanup(){Ee.off("camera:shake",this.handleShakeEvent),this.x=0,this.y=0,this.zoom=.3,this.targetX=0,this.targetY=0,this.skipSmoothingThisFrame=!1,this.viewportWidth=0,this.viewportHeight=0,this.screenShake.trigger(0,0)}};vi._instance=null;let Ct=vi;class $p{constructor(e){this.canvasElement=e,this.gamepadManager=new hS,this.keyState={},this.prevKeyState={},this.justPressedKeys=new Set,this.justReleasedKeys=new Set,this.disabledKeys=new Set,this.disabledGamepadButtons=new Set,this.inputDisabled=!1,this.leftStickDisabled=!1,this.rightStickDisabled=!1,this.mouseMoved=!1,this.mouseState={x:0,y:0,leftDown:!1,rightDown:!1},this.scrollUpDetected=!1,this.scrollDownDetected=!1,this.initialized=!1,this.mouseMoveHandler=i=>{const n=i.target,r=n.getBoundingClientRect(),c=n.width/r.width,h=n.height/r.height,u=(i.clientX-r.left)*c,d=(i.clientY-r.top)*h;(u!==this.mouseState.x||d!==this.mouseState.y)&&(this.mouseMoved=!0,It.getInstance().updateDevice("mouse")),this.mouseState.x=u,this.mouseState.y=d},this.keyDownHandler=i=>{this.keyState[i.code]={pressed:!0},It.getInstance().updateDevice("keyboard")},this.keyUpHandler=i=>{this.keyState[i.code]={pressed:!1}},this.mouseDownHandler=i=>{i.button===0&&(this.mouseState.leftDown=!0),i.button===2&&(this.mouseState.rightDown=!0),It.getInstance().updateDevice("mouse")},this.mouseUpHandler=i=>{i.button===0&&(this.mouseState.leftDown=!1),i.button===2&&(this.mouseState.rightDown=!1)},this.wheelHandler=i=>{const n=Math.sign(i.deltaY);n<0?this.scrollUpDetected=!0:n>0&&(this.scrollDownDetected=!0)},this.contextMenuHandler=i=>{i.preventDefault()},this.initialize()}disableInput(){this.inputDisabled=!0}enableInput(){this.inputDisabled=!1}getMousePosition(){return{x:this.mouseState.x,y:this.mouseState.y}}initialize(){this.initialized||(this.initialized=!0,window.addEventListener("keydown",this.keyDownHandler),window.addEventListener("keyup",this.keyUpHandler),window.addEventListener("mousedown",this.mouseDownHandler),window.addEventListener("mouseup",this.mouseUpHandler),this.canvasElement.addEventListener("mousemove",this.mouseMoveHandler),window.addEventListener("wheel",this.wheelHandler),window.addEventListener("contextmenu",this.contextMenuHandler))}destroy(){this.initialized&&(this.initialized=!1,window.removeEventListener("keydown",this.keyDownHandler),window.removeEventListener("keyup",this.keyUpHandler),window.removeEventListener("mousedown",this.mouseDownHandler),window.removeEventListener("mouseup",this.mouseUpHandler),this.canvasElement.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("wheel",this.wheelHandler),window.removeEventListener("contextmenu",this.contextMenuHandler))}updateFrame(){var e,i;this.gamepadManager.updateFrame(),this.mouseMoved=!1,this.justPressedKeys.clear(),this.justReleasedKeys.clear(),this.scrollUpDetected=!1,this.scrollDownDetected=!1,!this.prevKeyState.MouseLeft&&this.mouseState.leftDown&&this.justPressedKeys.add("MouseLeft"),this.prevKeyState.MouseLeft&&!this.mouseState.leftDown&&this.justReleasedKeys.add("MouseLeft"),!this.prevKeyState.MouseRight&&this.mouseState.rightDown&&this.justPressedKeys.add("MouseRight"),this.prevKeyState.MouseRight&&!this.mouseState.rightDown&&this.justReleasedKeys.add("MouseRight"),this.prevKeyState.MouseLeft=this.mouseState.leftDown,this.prevKeyState.MouseRight=this.mouseState.rightDown;for(const n in this.keyState){if(this.disabledKeys.has(n))continue;const r=((e=this.keyState[n])==null?void 0:e.pressed)??!1,c=this.prevKeyState[n]??!1;!c&&r&&this.justPressedKeys.add(n),c&&!r&&this.justReleasedKeys.add(n),this.prevKeyState[n]=r}this.wasKeyJustPressed("KeyY")&&(yu()&&((i=window.electronAPI)!=null&&i.toggleFullscreen)?window.electronAPI.toggleFullscreen():cS())}disableKey(e){this.disabledKeys.add(e)}enableKey(e){this.disabledKeys.delete(e)}enableAllKeys(){this.disabledKeys.clear()}isKeyPressed(e){var i;return this.inputDisabled||this.disabledKeys.has(e)?!1:e==="MouseLeft"?this.mouseState.leftDown:e==="MouseRight"?this.mouseState.rightDown:((i=this.keyState[e])==null?void 0:i.pressed)??!1}wasKeyJustPressed(e){return this.inputDisabled||this.disabledKeys.has(e)?!1:this.justPressedKeys.has(e)}wasKeyJustReleased(e){return this.inputDisabled||this.disabledKeys.has(e)?!1:this.justReleasedKeys.has(e)}wasMouseClicked(){return this.inputDisabled?!1:this.wasKeyJustPressed("MouseLeft")}wasLeftClicked(){return this.inputDisabled?!1:this.wasKeyJustPressed("MouseLeft")}wasRightClicked(){return this.inputDisabled?!1:this.wasKeyJustPressed("MouseRight")}wasMouseMoved(){return this.inputDisabled?!1:this.mouseMoved}wasScrollWheelUp(){return this.inputDisabled?!1:this.scrollUpDetected}wasScrollWheelDown(){return this.inputDisabled?!1:this.scrollDownDetected}isShiftPressed(){return this.inputDisabled?!1:this.isKeyPressed("ShiftLeft")||this.isKeyPressed("ShiftRight")}consumeZoomDelta(){if(this.inputDisabled)return 0;const e=this.scrollUpDetected||this.isKeyPressed("KeyR"),i=this.scrollDownDetected||this.isKeyPressed("KeyT");return(e||i)&&Ct.getInstance().abortZoomAnimation(),(e?10:0)+(i?-10:0)}isEscapePressed(){return this.isKeyPressed("Escape")}isMouseLeftPressed(){return this.isKeyPressed("MouseLeft")}isMouseRightPressed(){return this.isKeyPressed("MouseRight")}isTabPressed(){return this.isKeyPressed("Tab")}is0Pressed(){return this.isKeyPressed("Digit0")}isLPressed(){return this.isKeyPressed("KeyL")}wasLeftBracketPressed(){return this.wasKeyJustPressed("BracketLeft")}wasRightBracketPressed(){return this.wasKeyJustPressed("BracketRight")}isGamepadConnected(){return this.gamepadManager.isConnected()}getGamepadMovementVector(){return this.leftStickDisabled?{x:0,y:0}:this.gamepadManager.getLeftStick()}getGamepadAimVector(){return this.rightStickDisabled?{x:0,y:0}:this.gamepadManager.getRightStick()}disableGamepadButton(e){this.disabledGamepadButtons.add(e)}enableGamepadButton(e){this.disabledGamepadButtons.delete(e)}enableAllGamepadButtons(){this.disabledGamepadButtons.clear()}disableLeftStick(){this.leftStickDisabled=!0}enableLeftStick(){this.leftStickDisabled=!1}disableRightStick(){this.rightStickDisabled=!0}enableRightStick(){this.rightStickDisabled=!1}enableAllSticks(){this.leftStickDisabled=!1,this.rightStickDisabled=!1}isLeftStickMoved(){if(this.leftStickDisabled)return!1;const{x:e,y:i}=this.gamepadManager.getLeftStick();return Math.abs(e)>0||Math.abs(i)>0}isRightStickMoved(){if(this.rightStickDisabled)return!1;const{x:e,y:i}=this.gamepadManager.getRightStick();return Math.abs(e)>0||Math.abs(i)>0}isLeftTriggerPressed(){return!this.disabledGamepadButtons.has("leftTrigger")&&this.gamepadManager.isActionPressed("leftTrigger")}disableAllActions(){var e,i;for(const n in Ui){const r=Ui[n];(e=r.keys)==null||e.forEach(c=>this.disableKey(c)),(i=r.gamepadButtons)==null||i.forEach(c=>this.disableGamepadButton(c)),this.disableLeftStick(),this.disableRightStick()}}enableAllActions(){var e,i;for(const n in Ui){const r=Ui[n];(e=r.keys)==null||e.forEach(c=>this.enableKey(c)),(i=r.gamepadButtons)==null||i.forEach(c=>this.enableGamepadButton(c)),this.enableLeftStick(),this.enableRightStick()}}disableAction(e){var n,r;const i=Ui[e];(n=i.keys)==null||n.forEach(c=>this.disableKey(c)),(r=i.gamepadButtons)==null||r.forEach(c=>this.disableGamepadButton(c))}enableAction(e){var n,r;const i=Ui[e];(n=i.keys)==null||n.forEach(c=>this.enableKey(c)),(r=i.gamepadButtons)==null||r.forEach(c=>this.enableGamepadButton(c))}isActionPressed(e){var c,h;const i=Ui[e],n=((c=i.keys)==null?void 0:c.some(u=>this.isKeyPressed(u)))??!1,r=((h=i.gamepadButtons)==null?void 0:h.some(u=>!this.disabledGamepadButtons.has(u)&&this.gamepadManager.isActionPressed(u)))??!1;return n||r}wasActionJustPressed(e){var c,h;const i=Ui[e],n=((c=i.keys)==null?void 0:c.some(u=>this.wasKeyJustPressed(u)))??!1,r=((h=i.gamepadButtons)==null?void 0:h.some(u=>!this.disabledGamepadButtons.has(u)&&this.gamepadManager.wasActionJustPressed(u)))??!1;return n||r}wasActionJustReleased(e){var c,h;const i=Ui[e],n=((c=i.keys)==null?void 0:c.some(u=>this.wasKeyJustReleased(u)))??!1,r=((h=i.gamepadButtons)==null?void 0:h.some(u=>!this.disabledGamepadButtons.has(u)&&this.gamepadManager.wasActionJustReleased(u)))??!1;return n||r}}class Jp{constructor(){this.lastFrameTime=performance.now(),this.startTime=this.lastFrameTime,this.isRunning=!1,this.updateCallbacks=[],this.renderCallbacks=[],this.frameRequestId=null,this.currentDeltaTime=0,this.tick=e=>{if(!this.isRunning)return;const i=(e-this.lastFrameTime)/1e3;this.lastFrameTime=e,this.currentDeltaTime=i,this.updateCallbacks.forEach(n=>n(i)),this.renderCallbacks.forEach(n=>n(i)),this.frameRequestId=requestAnimationFrame(this.tick)}}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=performance.now(),this.startTime=this.lastFrameTime,this.frameRequestId=requestAnimationFrame(this.tick))}stop(){this.isRunning=!1,this.frameRequestId!==null&&(cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)}getElapsedSeconds(){return(performance.now()-this.startTime)/1e3}getDeltaTime(){return this.currentDeltaTime}onUpdate(e){this.updateCallbacks.push(e)}offUpdate(e){this.updateCallbacks=this.updateCallbacks.filter(i=>i!==e)}onRender(e){this.renderCallbacks.push(e)}offRender(e){this.renderCallbacks=this.renderCallbacks.filter(i=>i!==e)}}const Gg={"mission.mission_001.unlocked":{description:"Unlocks the first mission in the campaign."},"mission.mission_001.complete":{description:"Marks the first mission as completed."},"mission.mission_002.unlocked":{description:"Unlocks the second mission."},"mission.mission_002.complete":{description:"Marks the second mission as completed."},"mission.scrapper-revenant.unlocked":{description:"Unlocks the third mission."},"mission.mission_003_00.unlocked":{description:"Unlocks the third mission."},"mission.mission_003_00.complete":{description:"Marks the third mission as completed."},"mission.mission_004_00.unlocked":{description:"Unlocks the fourth mission."},"mission.mission_004_00.complete":{description:"Marks the fourth mission as completed."},"mission.mission_005_00.unlocked":{description:"Unlocks the fifth mission."},"mission.mission_005_00.complete":{description:"Marks the fifth mission as completed."},"mission.mission_006_00.unlocked":{description:"Unlocks the sixth mission."},"mission.mission_006_00.complete":{description:"Marks the sixth mission as completed."},"mission.intro-briefing.complete":{description:"Marks the intro briefing as completed."},"hub.mission-computer.unlocked":{description:"Unlocks the mission computer in the hub."},"hub.passive-terminal.unlocked":{description:"Unlocks the passive terminal in the hub."},"hub.breakroom.unlocked":{description:"Unlocks the breakroom in the hub."},"hub.introduction-1.complete":{description:"Marks the first introduction dialogue as completed."},"hub.introduction-2.complete":{description:"Marks the second introduction dialogue as completed."},"hub.introduction-3.complete":{description:"Marks the third introduction dialogue as completed."}};class fS{constructor(){this.flags=new Set}set(e){this.flags.add(e)}unset(e){this.flags.delete(e)}has(e){return this.flags.has(e)}clear(){this.flags.clear()}toJSON(){return JSON.stringify(Array.from(this.flags))}fromJSON(e){try{const i=JSON.parse(e);if(Array.isArray(i)){const n=i.filter(r=>r in Gg);this.flags=new Set(n)}}catch(i){console.warn("Failed to load player flags from JSON:",i)}}getAll(){return Array.from(this.flags)}unlockAllFlags(){Object.keys(Gg).forEach(e=>{this.flags.add(e)})}}const Be=new fS;class dS{constructor(){this.result=null}initialize(){this.result={outcome:"victory",enemiesDestroyed:0,currencyGathered:0,blocksUnlocked:[],blockPlacedCount:0,passivePointsEarned:0,bonusObjectives:[],timeTakenSeconds:0,blocksLost:0,blockRefinedCount:0,blocksCollected:0,wavesCleared:0,incidentsCompleted:0,massAchieved:0}}finalize(e,i){this.ensureInitialized(),this.result.outcome=e,this.result.timeTakenSeconds=Math.round(i)}setOutcome(e){this.ensureInitialized(),this.result.outcome=e}addCurrency(e){this.ensureInitialized(),this.result.currencyGathered+=e}incrementKillCount(e=1){this.ensureInitialized(),Ee.emit("camera:shake",{strength:10,duration:.2,frequency:10}),this.result.enemiesDestroyed+=e}incrementBlockCollectedCount(e=1){this.ensureInitialized(),this.result.blocksCollected+=e}incrementWavesCleared(e=1){this.ensureInitialized(),this.result.wavesCleared+=e}incrementIncidentsCompleted(e=1){this.ensureInitialized(),this.result.incidentsCompleted+=e}incrementMassAchieved(e){this.ensureInitialized(),e>this.result.massAchieved&&(this.result.massAchieved=e)}incrementBlockPlacedCount(e=1){this.ensureInitialized(),this.result.blockPlacedCount+=e}incrementBlockRefinedCount(e=1){this.ensureInitialized(),this.result.blockRefinedCount+=e}addBlockPickup(e){this.ensureInitialized();const i=this.result.blocksUnlocked;i.includes(e)||i.push(e)}incrementBlocksLost(e=1){this.ensureInitialized(),this.result.blocksLost+=e}getBlocksLost(){return this.ensureInitialized(),this.result.blocksLost}addBonusObjective(e){this.ensureInitialized(),this.result.bonusObjectives.push(e)}setPassivePoints(e){this.ensureInitialized(),this.result.passivePointsEarned=e}get(){return this.ensureInitialized(),this.result}clear(){this.result=null}hasResult(){return this.result!==null}ensureInitialized(){if(!this.result)throw new Error("MissionResultStore accessed before initialize()")}}const Ce=new dS;class ei{constructor(){this.unlockedBlockIds=new Set}static getInstance(){return ei.instance||(ei.instance=new ei),ei.instance}unlock(e){this.unlockedBlockIds.add(e),Ce.addBlockPickup(e)}unlockMany(e){e.forEach(i=>this.unlockedBlockIds.add(i))}unlockAll(){So().map(i=>i.id).forEach(i=>this.unlockedBlockIds.add(i))}isUnlocked(e){return this.unlockedBlockIds.has(e)}getUnlockedBlockIds(){return Array.from(this.unlockedBlockIds)}reset(){this.unlockedBlockIds.clear()}destroy(){this.unlockedBlockIds.clear()}toJSON(){return JSON.stringify(Array.from(this.unlockedBlockIds))}fromJSON(e){try{const i=JSON.parse(e);Array.isArray(i)&&(this.unlockedBlockIds=new Set(i))}catch(i){console.warn("Failed to load player technology from JSON:",i)}}}class yt{constructor(){this.metaCurrency=0}static getInstance(){return yt.instance||(yt.instance=new yt),yt.instance}getMetaCurrency(){return this.metaCurrency}setMetaCurrency(e){this.metaCurrency=Math.max(0,Math.floor(e))}addMetaCurrency(e){this.metaCurrency=Math.max(0,this.metaCurrency+Math.floor(e))}subtractMetaCurrency(e){const i=Math.floor(e);return this.metaCurrency<i?!1:(this.metaCurrency-=i,!0)}canAfford(e){return this.metaCurrency>=Math.floor(e)}toJSON(){return JSON.stringify({metaCurrency:this.metaCurrency})}fromJSON(e){try{const i=JSON.parse(e);typeof i=="object"&&i!==null&&typeof i.metaCurrency=="number"&&this.setMetaCurrency(i.metaCurrency)}catch(i){console.warn("Failed to parse PlayerMetaCurrencyManager data:",i)}}reset(){this.metaCurrency=0}}class ct{constructor(){this.passives=new Map,this.passivePoints=0}static getInstance(){return ct.instance||(ct.instance=new ct),ct.instance}addPassivePoints(e){yt.getInstance().addMetaCurrency(e)}getAvailablePoints(){return yt.getInstance().getMetaCurrency()}getUpgradeCost(e,i=null){const n=i??0,r=h=>{switch(h){case 1:return 5;case 2:return 10;case 3:return 15;default:return 0}};let c=0;for(let h=n+1;h<=e;h++)c+=r(h);return c}canAfford(e){return yt.getInstance().canAfford(e)}setPassiveTier(e,i){const n=this.passives.get(e)??null,r=this.getUpgradeCost(i,n);return r<0||!yt.getInstance().canAfford(r)?!1:(yt.getInstance().subtractMetaCurrency(r),this.passives.set(e,i),!0)}getPassiveTier(e){return this.passives.get(e)??null}hasPassive(e){return this.passives.has(e)}getAllPassives(){return new Map(this.passives)}getTotalPassivesSpent(){let e=0;for(const i of this.passives.values())e+=i;return e}hasAnyPassives(){return this.passives.size>0}refundAll(){let e=0;for(const i of this.passives.values())e+=i;yt.getInstance().addMetaCurrency(e),this.passives.clear()}clear(){this.passives.clear(),this.passivePoints=0}toJSON(){const e={passivePoints:this.passivePoints,passives:{}};for(const[i,n]of this.passives.entries())e.passives[i]=n;return JSON.stringify(e)}fromJSON(e){this.passives.clear(),this.passivePoints=0;try{const i=JSON.parse(e);if(typeof i.passivePoints=="number"&&(this.passivePoints=i.passivePoints),i.passives&&typeof i.passives=="object")for(const[n,r]of Object.entries(i.passives))this.isValidPassiveId(n)&&this.isValidTier(r)&&this.passives.set(n,r)}catch(i){console.warn("Failed to parse PlayerPassiveManager data:",i)}}isValidPassiveId(e){return["harvester-range","laser-damage","laser-energy-drain","laser-block-cost","explosive-lance-radius","explosive-lance-firing-rate","block-durability","fin-turn-power","engine-thrust","charger-rate","battery-capacity","turret-firing-rate","turret-damage","turret-accuracy","shield-energy-drain","shield-radius","shield-efficiency","facetplate-armor","hull-armor","hull-mass","cockpit-armor","block-repair-cost","entropium-pickup-bonus","block-drop-rate"].includes(e)}isValidTier(e){return e===1||e===2||e===3}}const Vg="lastSaveSlot";class lt{constructor(e){this.saveSlot=e}static initialize(e=0){lt.instance||(lt.instance=new lt(e))}static getInstance(){if(!lt.instance)throw new Error("SaveGameManager not initialized. Call initialize(slot) first.");return lt.instance}getStorageKey(){return`save${this.saveSlot}`}loadData(){const e=localStorage.getItem(this.getStorageKey());if(!e)return{flags:[],unlockedBlockIds:[]};try{return JSON.parse(e)}catch(i){return console.warn(`Failed to parse save data from ${this.getStorageKey()}:`,i),{flags:[],unlockedBlockIds:[]}}}writeData(e){localStorage.setItem(this.getStorageKey(),JSON.stringify(e))}saveAll(){const e={flags:JSON.parse(Be.toJSON()),unlockedBlockIds:JSON.parse(ei.getInstance().toJSON()),settings:we.getInstance().toJSON(),passives:JSON.parse(ct.getInstance().toJSON()),metaCurrency:JSON.parse(yt.getInstance().toJSON()),version:1};this.writeData(e),localStorage.setItem(Vg,String(this.saveSlot))}loadAll(){const e=this.loadData();Be.fromJSON(JSON.stringify(e.flags??[])),ei.getInstance().fromJSON(JSON.stringify(e.unlockedBlockIds??[])),e.settings&&we.getInstance().fromJSON(e.settings),e.passives&&ct.getInstance().fromJSON(JSON.stringify(e.passives)),e.metaCurrency&&yt.getInstance().fromJSON(JSON.stringify(e.metaCurrency))}changeSlot(e){this.saveSlot=e}static eraseSave(e){const i=`save${e}`;localStorage.removeItem(i),console.log(`Save slot ${e} erased.`)}static getFirstAvailableResolution(){const e={width:1920,height:1080},i=lt.getLastSaveSlot();if(i!==null){const n=`save${i}`,r=localStorage.getItem(n);if(r)try{const c=JSON.parse(r);if(c.settings){const h=JSON.parse(c.settings),u=parseInt(h.viewportWidth),d=parseInt(h.viewportHeight);if(Number.isFinite(u)&&u>0&&Number.isFinite(d)&&d>0)return{width:u,height:d}}}catch(c){console.warn(`Failed to parse save data from last slot ${i}:`,c)}}return e}static getLastSaveSlot(){const e=localStorage.getItem(Vg),i=parseInt(e??"",10);return Number.isInteger(i)?i:null}saveFlags(){const e=this.loadData();e.flags=JSON.parse(Be.toJSON()),this.writeData(e)}saveTechnology(){const e=this.loadData();e.unlockedBlockIds=JSON.parse(ei.getInstance().toJSON()),this.writeData(e)}saveSettings(){const e=this.loadData();e.settings=we.getInstance().toJSON(),this.writeData(e)}savePassives(){const e=this.loadData();e.passives=JSON.parse(ct.getInstance().toJSON()),this.writeData(e)}saveMetaCurrency(){const e=this.loadData();e.metaCurrency=JSON.parse(yt.getInstance().toJSON()),this.writeData(e)}loadFlags(){const e=this.loadData();Be.fromJSON(JSON.stringify(e.flags??[]))}loadTechnology(){const e=this.loadData();ei.getInstance().fromJSON(JSON.stringify(e.unlockedBlockIds??[]))}loadSettings(){const e=this.loadData();e.settings&&we.getInstance().fromJSON(e.settings)}loadPassives(){const e=this.loadData();e.passives&&ct.getInstance().fromJSON(JSON.stringify(e.passives))}loadMetaCurrency(){const e=this.loadData();e.metaCurrency&&yt.getInstance().fromJSON(JSON.stringify(e.metaCurrency))}}function oa(a,e,i,n,r){const c=e.width*r,h=e.height*r;a.drawImage(e,i-c/2,n-h/2,c,h)}const dl=document.createElement("canvas");dl.width=24;dl.height=24;const Ne=dl.getContext("2d");Ne.clearRect(0,0,24,24);const Ci=12;Ne.strokeStyle="black";Ne.lineWidth=5;Ne.beginPath();Ne.moveTo(Ci,2);Ne.lineTo(Ci,22);Ne.moveTo(2,Ci);Ne.lineTo(22,Ci);Ne.stroke();Ne.strokeStyle="#00ff00";Ne.lineWidth=2;Ne.shadowColor="#00ff00";Ne.shadowBlur=4;Ne.beginPath();Ne.moveTo(Ci,2);Ne.lineTo(Ci,22);Ne.moveTo(2,Ci);Ne.lineTo(22,Ci);Ne.stroke();Ne.shadowBlur=6;Ne.fillStyle="#00ff00";Ne.beginPath();Ne.arc(Ci,Ci,2.2,0,Math.PI*2);Ne.fill();Ne.shadowBlur=0;Ne.shadowColor="transparent";function nn(){return dl}const gl=document.createElement("canvas");gl.width=24;gl.height=24;{const a=gl.getContext("2d");a.clearRect(0,0,24,24);const e=12;a.strokeStyle="black",a.lineWidth=5,a.beginPath(),a.moveTo(e,2),a.lineTo(e,7),a.moveTo(e,17),a.lineTo(e,22),a.moveTo(2,e),a.lineTo(7,e),a.moveTo(17,e),a.lineTo(22,e),a.stroke(),a.strokeStyle="#00ff00",a.lineWidth=2,a.shadowColor="#00ff00",a.shadowBlur=4,a.beginPath(),a.moveTo(e,2),a.lineTo(e,7),a.moveTo(e,17),a.lineTo(e,22),a.moveTo(2,e),a.lineTo(7,e),a.moveTo(17,e),a.lineTo(22,e),a.stroke(),a.shadowBlur=6,a.fillStyle="#00ff00",a.beginPath(),a.arc(e,e,2.2,0,Math.PI*2),a.fill(),a.shadowBlur=0,a.shadowColor="transparent"}function gS(){return gl}const pl=document.createElement("canvas");pl.width=28;pl.height=28;{const a=pl.getContext("2d");a.clearRect(0,0,28,28);const e=14,i=14;a.strokeStyle="black",a.lineWidth=4,a.beginPath(),a.moveTo(e,i-10),a.lineTo(e+10,i),a.lineTo(e,i+10),a.lineTo(e-10,i),a.closePath(),a.stroke(),a.strokeStyle="#00ff00",a.lineWidth=2,a.shadowColor="#00ff00",a.shadowBlur=4,a.beginPath(),a.moveTo(e,i-10),a.lineTo(e+10,i),a.lineTo(e,i+10),a.lineTo(e-10,i),a.closePath(),a.stroke(),a.fillStyle="#00ff00",a.shadowBlur=6,a.beginPath(),a.arc(e,i,2.2,0,Math.PI*2),a.fill(),a.shadowBlur=0,a.shadowColor="transparent"}function vu(){return pl}function ml(a){const i=document.createElement("canvas");i.width=28,i.height=28;const n=i.getContext("2d");n.clearRect(0,0,28,28),n.lineJoin="round";const r=28/2,c=28/2,h=new Path2D;switch(h.moveTo(r,c-10),h.lineTo(r-6,c+6),h.lineTo(r,c+2),h.lineTo(r+6,c+6),h.closePath(),n.save(),n.translate(r,c),a){case"right":n.rotate(Math.PI/2);break;case"down":n.rotate(Math.PI);break;case"left":n.rotate(-Math.PI/2);break}return n.translate(-14,-14),n.strokeStyle="black",n.lineWidth=5,n.stroke(h),n.strokeStyle="#00ff00",n.lineWidth=2,n.shadowColor="#00ff00",n.shadowBlur=4,n.stroke(h),n.shadowBlur=6,n.fillStyle="#00ff00",n.beginPath(),n.arc(r,c,2.2,0,Math.PI*2),n.fill(),n.shadowBlur=0,n.shadowColor="transparent",n.restore(),i}const pS=ml("up"),mS=ml("right"),yS=ml("down"),vS=ml("left");function bS(a){switch(a){case"up":return pS;case"right":return mS;case"down":return yS;case"left":return vS}}const yl=document.createElement("canvas");yl.width=28;yl.height=28;{const a=yl.getContext("2d");a.clearRect(0,0,28,28);const e=14,i=14;a.lineJoin="round",a.lineCap="round";const n=new Path2D;n.moveTo(e,i+8),n.lineTo(e,i-4),n.moveTo(e-4,i-8),n.lineTo(e+4,i-8),n.lineTo(e+4,i-4),n.moveTo(e-4,i-4),n.lineTo(e-4,i-8),a.strokeStyle="black",a.lineWidth=5,a.stroke(n),a.strokeStyle="#00ff00",a.lineWidth=2,a.shadowColor="#00ff00",a.shadowBlur=4,a.stroke(n),a.shadowBlur=6,a.fillStyle="#00ff00",a.beginPath(),a.arc(e,i,1.5,0,Math.PI*2),a.fill(),a.shadowBlur=0,a.shadowColor="transparent"}function SS(){return yl}const vl=document.createElement("canvas");vl.width=18;vl.height=18;{const a=vl.getContext("2d");a.clearRect(0,0,18,18);const e=9;a.shadowBlur=4,a.fillStyle="#00ff00",a.beginPath(),a.arc(e,e,1.5,0,Math.PI*2),a.fill(),a.shadowBlur=0,a.shadowColor="transparent"}function MS(){return vl}function CS(a,e,i,n=255){const r=m=>Math.max(0,Math.min(255,Math.round(m))),c=m=>r(m).toString(16).padStart(2,"0"),h=c(a),u=c(e),d=c(i),g=c(n);return n===255?`#${h}${u}${d}`:`#${h}${u}${d}${g}`}function TS(a){if(!a)return"#ffffff";if(a.startsWith("#"))return a;try{return wS(a)}catch{return console.warn("[ExplosionSystem] Invalid color format, defaulting to white:",a),"#ffffff"}}function wS(a){const e=a.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([.\d]+))?\)/i);if(!e)throw new Error(`Invalid rgba() color string: ${a}`);const i=parseInt(e[1],10),n=parseInt(e[2],10),r=parseInt(e[3],10),c=e[4]!==void 0?Math.round(parseFloat(e[4])*255):255;return CS(i,n,r,c)}function Vi(a,e){const i=u=>Math.max(0,Math.min(255,u)),n=parseInt(a.slice(1),16),r=i((n>>16)+255*e),c=i((n>>8&255)+255*e),h=i((n&255)+255*e);return`rgb(${r}, ${c}, ${h})`}function $t(a,e){if(/^#[0-9a-f]{3}$/i.test(a)){const[i,n,r]=a.slice(1);return`#${i}${i}${n}${n}${r}${r}${e}`}if(/^#[0-9a-f]{6}$/i.test(a))return`${a}${e}`;throw new Error(`Invalid hex color format: ${a}`)}function ht(a,e,i=1){const{x:n,y:r,width:c,height:h,label:u,isHovered:d,style:g={},disabled:m=!1}=e,{borderRadius:y=6,backgroundColor:v,borderColor:M="#666",textColor:b="#fff",textFont:C="13px monospace",alpha:w=1,backgroundGradient:A}=g,R=c*i,I=h*i,_=C.replace(/(\d+)(px)/,(q,ie,ee)=>`${Math.round(parseInt(ie)*i)}${ee}`),x=m?.4:w,N=m?"#444":M,W=m?"#888":b;a.save(),a.globalAlpha=x;let z;if(A){const{type:q,stops:ie,from:ee=[n,r],to:K=[n+R,r+I],radius:le=R/2}=A,Z=q==="linear"?a.createLinearGradient(ee[0],ee[1],K[0],K[1]):a.createRadialGradient(ee[0],ee[1],0,ee[0],ee[1],le),se=ie.map(D=>({offset:D.offset,color:m?"#111":d?Vi(D.color,.1):D.color}));for(const D of se)Z.addColorStop(D.offset,D.color);z=Z}else z=m?"#111":d?"#333":v??"#222";a.fillStyle=z,a.strokeStyle=N,a.lineWidth=1*i,a.beginPath(),a.roundRect(n,r,R,I,y),a.fill(),a.stroke(),a.fillStyle=W,a.font=_,a.textAlign="center",a.textBaseline="middle",a.fillText(u,n+R/2,r+I/2),a.restore()}function Bs(a,e,i,n,r=1){if(a.disabled)return a.isHovered=!1,a.wasHovered=!1,!1;const c=a.width*r,h=a.height*r,u=e>=a.x&&e<=a.x+c&&i>=a.y&&i<=a.y+h,d=u&&!a.wasHovered,g=!u&&a.wasHovered;return a.isHovered=u,a.wasHovered=u,d&&(a.onHover?a.onHover():Q.play("assets/sounds/sfx/ui/hover_00.wav","sfx",{maxSimultaneous:4}),Ee.emit("cursor:change",{type:"hovered"})),g&&Ee.emit("cursor:restore",void 0),u&&n?(a.onClick(),!0):!1}function Mt(a){const{ctx:e,x:i,y:n,width:r,height:c,title:h,tabs:u,mouse:d,clicked:g,options:m={},uiScale:y=1}=a,{borderRadius:v=8,backgroundColor:M="#111",borderColor:b="#555",alpha:C=1,activeTabColor:w=b,backgroundGradient:A}=m,R=r*y,I=c*y,_=v*y;e.save(),e.globalAlpha=C;let x=M;if(A){const{type:ee,stops:K,from:le=[i,n],to:Z=[i+r,n+c],radius:se=r/2}=A,D=[le[0]*y,le[1]*y],X=[Z[0]*y,Z[1]*y],te=ee==="linear"?e.createLinearGradient(D[0],D[1],X[0],X[1]):e.createRadialGradient(D[0],D[1],0,D[0],D[1],se*y);for(const ae of K)te.addColorStop(ae.offset,ae.color);x=te}e.fillStyle=x,e.strokeStyle=b,e.lineWidth=2*y,e.beginPath(),e.roundRect(i,n,R,I,_),e.fill(),e.stroke(),h&&(e.fillStyle="#fff",e.font=`bold ${Math.round(14*y)}px monospace`,e.textAlign="start",e.textBaseline="top",e.fillText(h,i+42*y,n+8*y));let N=!1;if(!(u!=null&&u.length))return e.restore(),!1;const W=ne(),z=24*y*W,q=8*y*W,ie=Math.floor((R-2*q)/u.length);for(let ee=0;ee<u.length;ee++){const K=u[ee],le=i+q+ee*ie,Z=n-z,se=ie-4*y,D=d&&d.x>=le&&d.x<=le+se&&d.y>=Z&&d.y<=Z+z;g&&D&&(u.forEach(X=>X.isActive=!1),K.isActive=!0,K.onClick(),N=!0),e.fillStyle=K.isActive?w:x,e.strokeStyle=b,e.beginPath(),e.roundRect(le,Z,se,z,[_,_,0,0]),e.fill(),e.stroke(),e.font=`${Math.round(12*y*W)}px monospace`,e.fillStyle=K.isActive?"#000":b,e.textAlign="center",e.textBaseline="middle",e.fillText(K.label,le+se/2,Z+z/2)}return e.textAlign="start",e.textBaseline="alphabetic",e.restore(),N}const Vh=new Map;async function ra(a){const e=Mi(a);return Vh.has(e)?Vh.get(e):new Promise((i,n)=>{const r=new Image;r.src=e,r.onload=()=>{Vh.set(e,r),i(r)},r.onerror=n})}const Xg=[{id:1,type:"wave",mods:[],ships:[{shipId:"wave_0_00",count:40},{shipId:"wave_0_01",count:40},{shipId:"wave_0_02",count:32,hunter:!0},{shipId:"wave_0_03",count:24,hunter:!0},{shipId:"wave_0_04",count:12,hunter:!0}]},{id:2,type:"wave",mods:["extra-aggressive"],ships:[{shipId:"ship_0_00",count:20},{shipId:"ship_0_01",count:18},{shipId:"ship_0_02",count:12},{shipId:"ship_0_03",count:8,hunter:!0},{shipId:"ship_0_04",count:6,hunter:!0},{shipId:"ship_0_station",count:6}]},{id:3,type:"wave",mods:["shielded"],ships:[{shipId:"ship_scrapper_0",count:12,hunter:!0},{shipId:"ship_scrapper_1",count:10},{shipId:"ship_scrapper_2",count:8,hunter:!0},{shipId:"ship_scrapper_3",count:6},{shipId:"ship_scrapper_4",count:5,hunter:!0},{shipId:"ship_scrapper_5",count:4,hunter:!0},{shipId:"ship_scrapper_6",count:3,hunter:!0}]},{id:4,type:"boss",mods:["shielded","extra-aggressive"],ships:[{shipId:"boss_0_00",count:1,hunter:!0}],music:{file:"assets/sounds/music/track_03_boss.mp3"},lightingSettings:{clearColor:[.25,0,0,0]}}],AS={attack:"orbit",seek:"direct"},Jn={attack:"ram",seek:"direct"},fo={rammingDamageInflictMultiplier:2,thrustPowerMulti:2,turnPowerMulti:2},qs={thrustPowerMulti:3,turnPowerMulti:3},kS=[{id:1,type:"wave",mods:[],ships:[{shipId:"wave_0_00",count:24},{shipId:"wave_0_01",count:22},{shipId:"wave_0_02",count:16},{shipId:"wave_0_03",count:16},{shipId:"wave_0_04",count:18},{shipId:"wave_0_00",count:8,hunter:!0,affixes:qs},{shipId:"wave_0_01",count:6,hunter:!0,affixes:qs},{shipId:"wave_0_02",count:8,hunter:!0,affixes:qs},{shipId:"wave_0_03",count:4,hunter:!0,affixes:qs},{shipId:"wave_0_04",count:6,hunter:!0,affixes:qs},{shipId:"/earlygame/ship_turret_00",count:4},{shipId:"/earlygame/ship_miniturret_00",count:8},{shipId:"/earlygame/ship_rammerspear_00",count:4,hunter:!0,behaviorProfile:Jn,affixes:fo}]},{id:2,type:"wave",mods:["extra-aggressive"],ships:[{shipId:"wave_0_02",count:16,affixes:qs},{shipId:"wave_0_03",count:16,affixes:qs},{shipId:"/earlygame/ship_turret_00",count:10},{shipId:"/earlygame/ship_miniturret_00",count:8},{shipId:"/earlygame/ship_rammerspear_00",count:6,hunter:!0,behaviorProfile:Jn,affixes:fo},{shipId:"/earlygame/ship_rammerhead_00",count:2,hunter:!0,behaviorProfile:Jn,affixes:fo},{shipId:"/earlygame/ship_dragonfly_00",count:8,hunter:!0},{shipId:"/earlygame/ship_minifly_00",count:12,hunter:!0},{shipId:"/earlygame/ship_lanceturret_00",count:10},{shipId:"/earlygame/ship_sentry_00",count:12},{shipId:"/earlygame/ship_stalker_00",count:4,hunter:!0}]},{id:3,type:"wave",mods:["shielded"],ships:[{shipId:"/earlygame/ship_turret_00",count:14},{shipId:"/earlygame/ship_miniturret_00",count:22},{shipId:"/earlygame/ship_rammerspear_00",count:10,hunter:!0,behaviorProfile:Jn,affixes:fo},{shipId:"/earlygame/ship_rammerhead_00",count:4,hunter:!0,behaviorProfile:Jn,affixes:fo},{shipId:"/earlygame/ship_dragonfly_00",count:10,hunter:!0},{shipId:"/earlygame/ship_minifly_00",count:12,hunter:!0}]},{id:4,type:"boss",mods:["shielded","extra-aggressive"],ships:[{shipId:"boss_0_00",count:1,hunter:!0}],music:{file:"assets/sounds/music/track_03_boss.mp3"},lightingSettings:{clearColor:[.25,0,0,0]}}],BS={rammingDamageInflictMultiplier:2,thrustPowerMulti:2,turnPowerMulti:2},jn={thrustPowerMulti:3,turnPowerMulti:3},Xh=[{id:1,type:"wave",mods:[],ships:[{shipId:"wave_0_00",count:24},{shipId:"wave_0_01",count:22},{shipId:"wave_0_02",count:34},{shipId:"wave_0_03",count:22},{shipId:"wave_0_04",count:32},{shipId:"/earlygame/ship_rammerspear_00",count:4,hunter:!0,behaviorProfile:Jn,affixes:BS},{shipId:"mission_03/haloblade_pod_00",count:12},{shipId:"mission_03/haloblade_pod_01",count:8},{shipId:"mission_03/haloblade_pod_mini_00",count:10},{shipId:"mission_03/haloblade_speeder_00",count:4},{shipId:"mission_03/haloblade_beatle_00",count:2},{shipId:"mission_03/haloblade_beatle_01",count:4},{shipId:"mission_03/lance_miner_00",count:8},{shipId:"mission_03/lance_miner_00",count:2,hunter:!0},{shipId:"mission_03/lance_miner_station_00",count:4}]},{id:2,type:"wave",mods:[],ships:[{shipId:"wave_0_02",count:16,affixes:jn},{shipId:"wave_0_03",count:16,affixes:jn},{shipId:"mission_03/haloblade_pod_00",count:12},{shipId:"mission_03/haloblade_pod_01",count:8},{shipId:"mission_03/haloblade_pod_mini_00",count:12},{shipId:"mission_03/haloblade_speeder_00",count:4,hunter:!0},{shipId:"mission_03/haloblade_beetle_00",count:4,hunter:!0},{shipId:"mission_03/lance_miner_00",count:2},{shipId:"mission_03/lance_miner_station_00",count:4},{shipId:"mission_03/lance_miner_station_01",count:4},{shipId:"mission_03/haloblade_cruiser_00",count:2},{shipId:"mission_03/haloblade_minicruiser_00",count:2},{shipId:"mission_03/haloblade_minicruiser_00",count:6},{shipId:"mission_03/lance_miner_00",count:12}]},{id:3,type:"wave",mods:[],ships:[{shipId:"mission_03/haloblade_minicruiser_00",count:4},{shipId:"mission_03/haloblade_cruiser_00",count:6},{shipId:"mission_03/horrorhunter_00",count:4,hunter:!0},{shipId:"mission_03/horror_station_00",count:2},{shipId:"mission_03/horrorhunter_01",count:2,hunter:!0},{shipId:"mission_03/horrorhunter_02",count:2,hunter:!0},{shipId:"mission_03/horrorhunter_00",count:6},{shipId:"mission_03/horrorhunter_01",count:6},{shipId:"mission_03/horrorhunter_02",count:6},{shipId:"mission_03/speedhunter_00",count:4},{shipId:"mission_03/haloblade_cruiser_00",count:4}]},{id:4,type:"wave",mods:[],ships:[{shipId:"mission_03/haloblade_minicruiser_00",count:4},{shipId:"mission_03/haloblade_cruiser_00",count:6},{shipId:"mission_03/horrorhunter_00",count:4},{shipId:"mission_03/horror_station_00",count:2},{shipId:"mission_03/horrorhunter_01",count:2,hunter:!0},{shipId:"mission_03/horrorhunter_02",count:2,hunter:!0},{shipId:"mission_03/speedhunter_00",count:4},{shipId:"mission_03/haloblade_cruiser_00",count:2,hunter:!0}]},{id:5,type:"wave",mods:[],ships:[{shipId:"mission_03/haloblade_pod_00",count:6},{shipId:"mission_03/haloblade_pod_01",count:4},{shipId:"mission_03/haloblade_pod_mini_00",count:6,affixes:jn},{shipId:"mission_03/haloblade_speeder_00",count:6,hunter:!0,affixes:jn},{shipId:"mission_03/haloblade_beetle_00",count:4,hunter:!0,affixes:jn},{shipId:"mission_03/lance_miner_00",count:4,hunter:!0},{shipId:"mission_03/lance_miner_station_00",count:2},{shipId:"mission_03/lance_miner_station_01",count:2},{shipId:"mission_03/haloblade_cruiser_00",count:2,hunter:!0,affixes:jn},{shipId:"mission_03/haloblade_minicruiser_00",count:4,hunter:!0},{shipId:"mission_03/haloblade_minicruiser_00",count:6}]},{id:6,type:"boss",mods:["shielded","extra-aggressive"],ships:[{shipId:"boss_0_00",count:1,hunter:!0}],music:{file:"assets/sounds/music/track_03_boss.mp3"},lightingSettings:{clearColor:[0,0,0,0]}}],nl={mission_001:{id:"mission_001",name:"Shipwright Second-Class",dialogue:"intro-briefing",waves:Xg,dropMultiplier:1.5,environmentSettings:{backgroundId:"background_4_00.png",gravity:0},music:{file:"assets/sounds/music/track_02_mission1.mp3"},enemyPower:.5,bonusObjectives:["No damage taken","Destroy all enemies in under 5 minutes"],passiveReward:1,requiredFlag:"mission.mission_001.unlocked",missionPortrait:null},mission_002:{id:"mission_002",name:"Starfield Gauntlet",dialogue:"mission-generic",waves:Xg,dropMultiplier:1.5,environmentSettings:{backgroundId:"background_4_00.png",gravity:0},music:{file:"assets/sounds/music/track_02_mission1.mp3"},enemyPower:1,bonusObjectives:["No damage taken","Destroy all enemies in under 5 minutes"],passiveReward:1,requiredFlag:"mission.mission_002.unlocked",missionPortrait:"assets/characters/bosses/character_boss_wildjoe.png"},mission_003_00:{id:"mission_003_00",name:"The Scrapyard Revenant",dialogue:"mission_003_00",waves:kS,dropMultiplier:1.5,environmentSettings:{backgroundId:"background_9_00.png",gravity:0},planets:[{name:"Ferrust",x:-3e3,y:4e3},{name:"Gilipe",x:9e3,y:-4e3}],enemyPower:.25,music:{file:"assets/sounds/music/track_09_junkyard.mp3"},bonusObjectives:["No damage taken","Destroy all enemies in under 5 minutes"],passiveReward:1,sceneLighting:[0,0,0,0],requiredFlag:"mission.mission_003_00.unlocked",missionPortrait:"assets/characters/bosses/character_boss_crusher-mae.png"},mission_004_00:{id:"mission_004_00",name:"The Miner's Dillemma",dialogue:"mission-generic",waves:Xh,dropMultiplier:1.5,environmentSettings:{backgroundId:"background_10_00.png",gravity:0},planets:[{name:"Arsea",x:6e3,y:4e3}],enemyPower:.25,music:{file:"assets/sounds/music/track_05_mission3.mp3"},bonusObjectives:["No damage taken","Destroy all enemies in under 5 minutes"],passiveReward:1,sceneLighting:[0,0,0,0],requiredFlag:"mission.mission_004_00.unlocked",missionPortrait:"assets/characters/bosses/character_boss_executron-9b.png"},mission_005_00:{id:"mission_005_00",name:"WIP",dialogue:"mission-generic",waves:Xh,dropMultiplier:1.5,environmentSettings:{backgroundId:"background_10_00.png",gravity:0},planets:[{name:"Arsea",x:6e3,y:4e3}],enemyPower:.25,music:{file:"assets/sounds/music/track_05_mission3.mp3"},bonusObjectives:["No damage taken","Destroy all enemies in under 5 minutes"],passiveReward:1,sceneLighting:[0,0,0,0],requiredFlag:"mission.mission_005_00.unlocked",missionPortrait:"assets/characters/bosses/character_boss_jackpot-vera.png"},mission_006_00:{id:"mission_006_00",name:"WIP",dialogue:"mission-generic",waves:Xh,dropMultiplier:1.5,environmentSettings:{backgroundId:"background_10_00.png",gravity:0},planets:[{name:"Arsea",x:6e3,y:4e3}],enemyPower:.25,music:{file:"assets/sounds/music/track_05_mission3.mp3"},bonusObjectives:["No damage taken","Destroy all enemies in under 5 minutes"],passiveReward:1,sceneLighting:[0,0,0,0],requiredFlag:"mission.mission_006_00.unlocked",missionPortrait:"assets/characters/bosses/character_boss_admiral-pith.png"}};class RS{constructor(){this.currentMission=null}setMission(e){this.currentMission=e,e.music&&Q.playMusic(e.music)}getMission(){if(!this.currentMission)throw new Error("No mission loaded");return this.currentMission}getDropMultiplier(){if(!this.currentMission)throw new Error("No mission loaded");return this.currentMission.dropMultiplier??1}getMissionById(e){return nl[e]??null}getMissionDialogue(){if(!this.currentMission)throw new Error("No mission loaded");return this.currentMission.dialogue??null}getEnemyPower(){if(!this.currentMission)throw new Error("No mission loaded");return this.currentMission.enemyPower??1}getPlanetSpawnConfigs(){if(!this.currentMission)throw new Error("No mission loaded");return this.currentMission.planets??[]}clear(){this.currentMission=null}}const ji=new RS,ES="assets/title_screen.png";function IS(a){return!!localStorage.getItem(`save${a}`)}const Yg=300,_S=10,xS=16,DS=2,qg=280,jg=280,PS=320,LS=120;class OS{constructor(e,i,n){this.backgroundImage=null,this.buttons=[],this.saveSlotButtons=[],this.showingSaveSlots=!1,this.confirmingDeleteSlot=null,this.confirmationButtons=[],this.saveSlotYOffsets=[0,0,0],this.saveSlotAnimationPhase=null,this.isAnimatingSlots=!1,this.update=r=>{const c=ne(),h=_S*c,u=xS*c,d=DS*c,g=Yg*c;if(this.isAnimatingSlots){if(this.saveSlotAnimationPhase==="sliding-up"){for(let b=0;b<this.saveSlotYOffsets.length;b++)this.saveSlotYOffsets[b]-=h;this.saveSlotYOffsets[0]<=-u&&(this.saveSlotAnimationPhase="settling")}else if(this.saveSlotAnimationPhase==="settling"){for(let b=0;b<this.saveSlotYOffsets.length;b++)this.saveSlotYOffsets[b]+=d,this.saveSlotYOffsets[b]>0&&(this.saveSlotYOffsets[b]=0);this.saveSlotYOffsets.every(b=>b===0)&&(this.isAnimatingSlots=!1,this.saveSlotAnimationPhase=null)}else if(this.saveSlotAnimationPhase==="sliding-down"){for(let b=0;b<this.saveSlotYOffsets.length;b++)this.saveSlotYOffsets[b]+=h;this.saveSlotYOffsets[0]>=g&&(this.isAnimatingSlots=!1,this.saveSlotAnimationPhase=null,this.showingSaveSlots=!1,this.saveSlotButtons=[],this.buttons=this.createMainButtons(),this.saveSlotYOffsets=[0,0,0])}}this.inputManager.updateFrame();const{x:m,y}=this.inputManager.getMousePosition(),v=this.inputManager.wasMouseClicked(),M=this.confirmingDeleteSlot!==null?this.confirmationButtons:[...this.buttons,...this.saveSlotButtons];for(const b of M)Bs(b,m,y,v,c)},this.render=r=>{this.canvasManager.clearAll();const c=ne(),h=this.canvasManager.getContext("background"),u=this.canvasManager.getContext("ui");this.backgroundImage&&h.drawImage(this.backgroundImage,0,0,h.canvas.width,h.canvas.height);for(const m of this.buttons)ht(u,m,c);if(this.showingSaveSlots)for(const m of this.saveSlotButtons){const y=m.slotIndex,v=this.saveSlotYOffsets[y]??0,M=m.y;m.y+=v,ht(u,m,c),m.y=M}if(this.confirmingDeleteSlot!==null){Mt({ctx:u,x:qg*c,y:jg*c,width:PS,height:LS,title:"Confirm Deletion",mouse:this.inputManager.getMousePosition(),clicked:this.inputManager.wasMouseClicked(),uiScale:c,options:{borderColor:"#ff0000",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#200000"},{offset:1,color:"#100000"}]}}});const m=14*c;u.fillStyle="#ff4444",u.font=`${Math.round(m)}px monospace`,u.fillText("Erase this save file?",300*c,320*c);for(const y of this.confirmationButtons)ht(u,y,c)}const d=this.inputManager.getMousePosition(),g=nn();oa(u,g,d.x,d.y,c)},this.canvasManager=e,this.gameLoop=i,this.inputManager=n,this.buttons=this.createMainButtons()}async start(){Q.playMusic({file:"assets/sounds/music/track_08_debriefing.mp3"}),this.backgroundImage=await ra(ES),this.gameLoop.onUpdate(this.update),this.gameLoop.onRender(this.render),this.gameLoop.start()}stop(){this.gameLoop.offUpdate(this.update),this.gameLoop.offRender(this.render)}createMainButtons(){const e=ne(),i=40,n=460*e,r=200,c=60,h=10,u={borderRadius:10,alpha:1,borderColor:"#00ff00",textFont:"18px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}},d={borderRadius:10,alpha:1,borderColor:"#ffaa00",textFont:"18px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#221100"},{offset:1,color:"#150a00"}]}},g=[],m=c*e+h*e;return g.push({x:i,y:n+m*0,width:r,height:c,label:this.showingSaveSlots?"Back":"Play",isHovered:!1,onClick:()=>{if(Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:1}),this.showingSaveSlots)this.saveSlotAnimationPhase="sliding-down",this.isAnimatingSlots=!0;else{const y=Yg*e;this.saveSlotYOffsets=[y,y,y],this.saveSlotAnimationPhase="sliding-up",this.isAnimatingSlots=!0,this.showingSaveSlots=!0,this.saveSlotButtons=this.createSaveSlotButtons(),this.buttons=this.createMainButtons()}},style:this.showingSaveSlots?d:u}),g.push({x:i,y:n+m*1,width:r,height:c,label:"Credits",isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:1}),console.log("Credits clicked (not implemented)")},style:u}),yu()&&g.push({x:i,y:n+m*2,width:r,height:c,label:"Quit",isHovered:!1,onClick:()=>{var y;Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:1}),(y=window==null?void 0:window.electronAPI)!=null&&y.closeGame?window.electronAPI.closeGame():console.warn("Quit button pressed, but electronAPI.closeGame is not available.")},style:u}),g}createSaveSlotButtons(){const e=ne(),i=260,n=460*e,r=260,c=60,h=10,u={borderRadius:10,alpha:1,borderColor:"#00ff00",textFont:"18px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}},d=[];for(let g=0;g<3;g++){const m=IS(g),y=m?`Load Save ${g+1}`:"New Game",v=c*e+h*e,M=r*e+h*e,b=r*e;d.push({x:i*e,y:n+v*g,width:r,height:c,label:y,isHovered:!1,onClick:()=>{lt.initialize(g);const C=lt.getInstance();Q.play("assets/sounds/sfx/ui/start_00.wav","sfx"),C.changeSlot(g),m?(C.loadAll(),this.stop(),vt.fadeToScene("hub")):(ji.setMission(nl.mission_001),this.stop(),vt.fadeToScene("mission"))},style:u,slotIndex:g}),m&&d.push({x:i+M+.65*b,y:n+v*g,width:40,height:c,label:"X",isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:4}),this.confirmingDeleteSlot=g,this.createConfirmationButtons()},style:{...u,borderColor:"#ff0000",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#220000"},{offset:1,color:"#110000"}]}},slotIndex:g})}return d}createConfirmationButtons(){const e=ne(),i=qg*e,n=jg*e,r=i+40*e,c=n+60*e,h=100,u=40,g=h*e+20*e;this.confirmationButtons=[{x:r,y:c,width:h,height:u,label:"Yes",isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:1}),this.confirmingDeleteSlot!==null&&(lt.eraseSave(this.confirmingDeleteSlot),this.saveSlotButtons=this.createSaveSlotButtons()),this.confirmingDeleteSlot=null,this.confirmationButtons=[]},style:{borderRadius:6,borderColor:"#00ff00",textFont:"16px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#003300"},{offset:1,color:"#001900"}]}}},{x:r+g,y:c,width:h,height:u,label:"No",isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:1}),this.confirmingDeleteSlot=null,this.confirmationButtons=[]},style:{borderRadius:6,borderColor:"#ff0000",textFont:"16px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#330000"},{offset:1,color:"#190000"}]}}}]}}class ws{constructor(){this.stack=[],this.registry={}}static getInstance(){return ws.instance||(ws.instance=new ws),ws.instance}reset(){this.clearAll();for(const e in this.registry)delete this.registry[e];this.pauseFn=void 0,this.resumeFn=void 0}registerPauseHandlers(e,i){this.pauseFn=e,this.resumeFn=i}pause(){var e;(e=this.pauseFn)==null||e.call(this)}resume(){var e;(e=this.resumeFn)==null||e.call(this)}open(e){this.getTop()!==e&&(this.stack.includes(e)||this.stack.push(e),e.openMenu())}close(e){const i=this.stack.indexOf(e);i!==-1&&(this.stack.splice(i,1),e.closeMenu())}transition(e){this.pop(),this.open(e)}pop(){const e=this.stack.pop();e==null||e.closeMenu()}getTop(){return this.stack.length>0?this.stack[this.stack.length-1]:null}anyOpen(){return this.stack.length>0}clearAll(){var e;for(;this.stack.length>0;)(e=this.stack.pop())==null||e.closeMenu()}registerMenu(e,i){this.registry[e]=i}getMenu(e){return this.registry[e]}}function bu(a){const{mode:e,fontOverride:i,forceErgonomic:n=!0}=a,r=ne(),c=e==="inPerson";let h=a.side;n&&ws.getInstance().anyOpen()&&(h="right");const u=h==="right",d=c?{x:320*r,y:120*r,width:520*r,height:140*r}:u?{x:590*r,y:20*r,width:500*r,height:120*r}:{x:180*r,y:20*r,width:500*r,height:120*r},g=c?{x:80*r,y:420*r}:u?{x:1130*r,y:20*r}:{x:20*r,y:20*r},y=i??`${Math.round((c?24:20)*r)}px monospace`;return{textBoxRect:d,position:g,font:y}}class FS{constructor(){this.profiles=new Map,this.portraitCache=new Map,this.loadDefaults()}loadDefaults(){this.register({id:"marla",portrait:this.loadImage("assets/characters/character_marla-thinx.png"),blipAudioFile:"assets/sounds/bleeps/girl_ah.wav",basePitch:1.2,textSpeed:.04,pitchVariance:.3,syllableDuration:120,portraitOffset:{x:-100,y:-200}}),this.register({id:"rexor",portrait:this.loadImage("assets/characters/character_rexor-the-intern.png"),blipAudioFile:"assets/sounds/bleeps/man_eh.wav",textSpeed:.04,basePitch:.85,pitchVariance:.15,portraitOffset:{x:-100,y:-200}}),this.register({id:"carl",portrait:this.loadImage("assets/characters/character_carl.png"),blipAudioFile:"assets/sounds/bleeps/man_ah.wav",textSpeed:.04,pitchVariance:.5,syllableDuration:100,basePitch:.95}),this.register({id:"hero",portrait:this.loadImage("assets/characters/character_hero.png"),blipAudioFile:"assets/sounds/bleeps/man_ee.wav",basePitch:1}),this.register({id:"the-board",portrait:this.loadImage("assets/characters/character_the-board.png"),blipAudioFile:"assets/sounds/bleeps/girl_oh.wav",basePitch:1.1}),this.register({id:"crazy-moe",portrait:this.loadImage("assets/characters/bosses/character_boss_wildjoe.png"),blipAudioFile:"assets/sounds/bleeps/man_eh.wav",basePitch:.8,textSpeed:.05,pitchVariance:.5})}loadImage(e){const i=Mi(e);if(this.portraitCache.has(i))return this.portraitCache.get(i);const n=new Image;return n.src=i,this.portraitCache.set(i,n),n}register(e){this.profiles.set(e.id,e)}getProfile(e){return this.profiles.get(e)}getAll(){return this.profiles}}const Su=new FS;class US{constructor(e,i,n=()=>!1){this.events=e,this.orchestrator=i,this.shouldInterrupt=n,this.index=0,this.isBlocked=!1,this.pauseTimerMs=null,this.pendingCommand=null,this.requestedVisualFocus=!1,this.hasVisualFocus=!1,this.forceRightSide=!1,this.onMenuOpened=({id:r})=>{r==="blockDropDecisionMenu"&&(this.forceRightSide=!0)},this.onMenuClosed=({id:r})=>{r==="blockDropDecisionMenu"&&(this.forceRightSide=!1)},Ee.on("menu:opened",this.onMenuOpened),Ee.on("menu:closed",this.onMenuClosed)}destroy(){Ee.off("menu:opened",this.onMenuOpened),Ee.off("menu:closed",this.onMenuClosed),this.orchestrator.destroy()}update(e){var n,r,c,h,u,d;if(this.shouldInterrupt()){this.clear();return}if(this.orchestrator.update(e),this.pauseTimerMs!==null){this.pauseTimerMs-=e*1e3,this.pauseTimerMs<=0&&(this.pauseTimerMs=null,this.isBlocked=!1);return}if(this.pendingCommand||this.isBlocked&&!this.orchestrator.isFinished()||this.index>=this.events.length)return;const i=this.events[this.index++];switch(i.type){case"line":{if(this.requestedVisualFocus=!0,!this.hasVisualFocus){this.index--;return}this.orchestrator.setVisualsVisible(!0),this.isBlocked=!0;const g=((n=i.options)==null?void 0:n.side)??"left",m=this.forceRightSide?"right":g,y=((r=i.options)==null?void 0:r.mode)??"transmission",v=(c=i.options)==null?void 0:c.font,{textBoxRect:M,position:b,font:C}=bu({mode:y,side:m,fontOverride:v});this.orchestrator.startDialogue({speakerId:i.speakerId,text:i.text,textColor:(h=i.options)==null?void 0:h.textColor,font:C,textBoxRect:M,textBoxAlpha:((u=i.options)==null?void 0:u.textBoxAlpha)??.8,position:b,mode:y,side:m,textSpeed:(d=Su.getProfile(i.speakerId))==null?void 0:d.textSpeed});return}case"pause":{this.isBlocked=!0,this.pauseTimerMs=i.durationMs;return}case"command":{this.isBlocked=!0;const g=i.run();g instanceof Promise?this.pendingCommand=g.then(()=>{this.isBlocked=!1,this.pendingCommand=null}):this.isBlocked=!1;return}case"showUI":{this.orchestrator.setVisualsVisible(!0);return}case"hideUI":{this.orchestrator.setVisualsVisible(!1);return}case"endIf":{i.condition()&&this.clear();return}}}render(e){this.orchestrator.render(e)}isFinished(){return this.index>=this.events.length&&!this.isBlocked}wantsVisualFocus(){return this.requestedVisualFocus&&!this.hasVisualFocus}grantVisualFocus(){this.hasVisualFocus=!0}clear(){this.index=this.events.length,this.orchestrator.clear()}skipToEnd(){var e,i;(i=(e=this.orchestrator).skipToEnd)==null||i.call(e)}}class NS{constructor(e){this.orchestratorFactory=e,this.allRunners=new Set,this.renderQueue=[],this.currentRenderer=null,this.runnerMap=new Map}startAsync(e,i,n){if(n&&this.runnerMap.has(n))return;const r=new US(e,this.orchestratorFactory(),i);this.allRunners.add(r),n&&this.runnerMap.set(n,r)}update(e){for(const i of this.allRunners)if(i.update(e),i.wantsVisualFocus()&&!this.renderQueue.includes(i)&&this.renderQueue.push(i),i.isFinished()){this.allRunners.delete(i),i===this.currentRenderer&&(this.currentRenderer=null);for(const[n,r]of this.runnerMap.entries())if(r===i){this.runnerMap.delete(n);break}i.destroy()}!this.currentRenderer&&this.renderQueue.length>0&&(this.currentRenderer=this.renderQueue.shift(),this.currentRenderer.grantVisualFocus())}render(e){var i;(i=this.currentRenderer)==null||i.render(e)}clearAll(){for(const e of this.allRunners)e.clear();this.allRunners.clear(),this.runnerMap.clear(),this.renderQueue.length=0,this.currentRenderer=null}destroy(){for(const e of this.allRunners)e.destroy();this.allRunners.clear(),this.runnerMap.clear(),this.renderQueue.length=0,this.currentRenderer=null}hasActiveRunners(){return this.allRunners.size>0}getActiveRunnerCount(){return this.allRunners.size}}class HS{constructor(){this.vowels=new Set("aeiouyAEIOUY")}segment(e){if(!e)return[];const i=[];let n="";for(let r=0;r<e.length;r++){const c=e[r],h=e[r+1];if(n+=c,this.vowels.has(c)&&(!h||!this.vowels.has(h))){let u=r+1;for(;u<e.length&&!this.vowels.has(e[u]);)u++;(u-r===2&&u<e.length||u-r>2||u===e.length)&&(i.push(n),n="")}}return n&&i.push(n),i.length>0?i:[e]}}const WS=new HS;function zS(a,e){const i=a.trim().split(/\s+/),n=[];let r=0;const c=e.syllableDuration??120,h=e.pitchVariance??0;for(const u of i){const d=WS.segment(u);for(const g of d){const m=e.basePitch+h*(Math.random()-.5);n.push({syllable:g,timestamp:r/1e3,duration:c/1e3,audioFile:e.blipAudioFile,pitch:m}),r+=c}r+=80}return n}class GS{constructor(e,i,n,r,c){this.portraitRenderer=e,this.textboxRenderer=i,this.textRenderer=n,this.audioSynchronizer=r,this.speakerRegistry=c,this.activeLine=null,this.blipTimeline=[],this.elapsed=0,this.finished=!1,this.visualsVisible=!0,this.forceRightSide=!1,this.onMenuOpened=({id:h})=>{h==="blockDropDecisionMenu"&&(this.forceRightSide=!0)},this.onMenuClosed=({id:h})=>{h==="blockDropDecisionMenu"&&(this.forceRightSide=!1)},Ee.on("menu:opened",this.onMenuOpened),Ee.on("menu:closed",this.onMenuClosed)}destroy(){Ee.off("menu:opened",this.onMenuOpened),Ee.off("menu:closed",this.onMenuClosed)}startDialogue(e){const i=this.speakerRegistry.getProfile(e.speakerId);if(!i){console.warn(`Unknown speaker ID: ${e.speakerId}`);return}this.activeLine=e,this.elapsed=0,this.finished=!1,this.textRenderer.start(e),this.blipTimeline=zS(e.text,i),this.audioSynchronizer.start(this.blipTimeline)}update(e){!this.activeLine||this.finished||(this.elapsed+=e,this.textRenderer.update(e),this.audioSynchronizer.update(this.elapsed),this.textRenderer.isFinished()&&(this.finished=!0))}render(e){if(!this.visualsVisible||!this.activeLine)return;const i=this.activeLine,n=this.speakerRegistry.getProfile(i.speakerId);if(!n)return;const r=bu({mode:i.mode,side:this.forceRightSide?"right":i.side,fontOverride:i.font});this.portraitRenderer.render(e,r.position,i,n),this.textboxRenderer.render(e,r.textBoxRect,i,n),this.textRenderer.render(e,r.textBoxRect,r.font,i)}skipToEnd(){var e,i,n,r;!this.activeLine||this.finished||((i=(e=this.textRenderer).skipToEnd)==null||i.call(e),(r=(n=this.audioSynchronizer).skipToEnd)==null||r.call(n),this.finished=!0)}isFinished(){return this.finished}clear(){this.activeLine=null,this.elapsed=0,this.finished=!1,this.textRenderer.clear(),this.audioSynchronizer.clear()}setVisualsVisible(e){this.visualsVisible=e}getVisualsVisible(){return this.visualsVisible}}class VS{constructor(){this.baseLargePortraitSize={width:512,height:512},this.baseSmallPortraitSize={width:128,height:128}}render(e,i,n,r){const c=ne(),{portrait:h,portraitOffset:u}=r,{x:d,y:g}=i,m=n.mode==="transmission",y=((u==null?void 0:u.x)??0)*c,v=((u==null?void 0:u.y)??0)*c,M=d+y,b=g+v,C=m?this.baseSmallPortraitSize:this.baseLargePortraitSize,w=C.width*c,A=C.height*c;m&&this.drawTransmissionFrame(e,M,b,w,A,c),e.drawImage(h,M,b,w,A),m&&this.drawTransmissionOverlay(e,M,b,w,A,c)}drawTransmissionFrame(e,i,n,r,c,h){e.save(),e.strokeStyle="#00ff88",e.lineWidth=2*h;const u=4*h;e.strokeRect(i-u,n-u,r+2*u,c+2*u),e.restore()}drawTransmissionOverlay(e,i,n,r,c,h){e.save(),e.fillStyle="rgba(0, 255, 100, 0.05)",e.fillRect(i,n,r,c),e.strokeStyle="rgba(0, 255, 100, 0.12)",e.lineWidth=1*h;const u=4*h;for(let d=0;d<c;d+=u)e.beginPath(),e.moveTo(i,n+d),e.lineTo(i+r,n+d),e.stroke();e.restore()}}class XS{render(e,i,n,r){const{x:c,y:h,width:u,height:d}=i;n.mode==="transmission"||r.transmissionStyle?this.drawTransmissionBox(e,c,h,u,d):this.drawSpeechBubble(e,c,h,u,d,n.textBoxAlpha??.8)}drawSpeechBubble(e,i,n,r,c,h){e.save(),e.fillStyle="#000000",e.globalAlpha=h,e.beginPath(),e.moveTo(i+16,n),e.lineTo(i+r-16,n),e.quadraticCurveTo(i+r,n,i+r,n+16),e.lineTo(i+r,n+c-16),e.quadraticCurveTo(i+r,n+c,i+r-16,n+c),e.lineTo(i+16,n+c),e.quadraticCurveTo(i,n+c,i,n+c-16),e.lineTo(i,n+16),e.quadraticCurveTo(i,n,i+16,n),e.closePath(),e.fill(),e.beginPath(),e.moveTo(i+40,n+c),e.lineTo(i+32,n+c+12),e.lineTo(i+48,n+c),e.fill(),e.restore()}drawTransmissionBox(e,i,n,r,c){e.save(),e.fillStyle="rgba(0, 255, 100, 0.08)",e.fillRect(i,n,r,c),e.strokeStyle="#00ff88",e.lineWidth=2,e.strokeRect(i-1,n-1,r+2,c+2),e.strokeStyle="rgba(0, 255, 100, 0.07)";for(let h=2;h<c;h+=4)e.beginPath(),e.moveTo(i,n+h),e.lineTo(i+r,n+h),e.stroke();e.restore()}}class YS{constructor(){this.fullText="",this.lines=[],this.revealedCharCount=0,this.elapsed=0,this.charDelay=.075,this.paddingX=16,this.baseLineHeight=22}start(e){this.fullText=e.text,this.lines=this.wrapText(e),this.revealedCharCount=0,this.elapsed=0,this.charDelay=e.textSpeed??this.charDelay}update(e){this.elapsed+=e;const i=Math.floor(this.elapsed/this.charDelay);this.revealedCharCount=Math.min(i,this.fullText.length)}render(e,i,n,r){const c=ne(),{x:h,y:u,width:d,height:g}=i,m=r.textColor??(r.mode==="transmission"?"#00ff88":"#ffffff"),y=this.baseLineHeight*c,v=this.paddingX*c;e.save(),e.font=n,e.fillStyle=m,e.textAlign="left";const M=Math.floor(g/y)-1;let b=this.revealedCharCount,C=u+32*c;for(let w=0;w<this.lines.length&&w<M;w++){const A=this.lines[w];if(b<=0)break;const R=A.slice(0,b);e.fillText(R,h+v,C),C+=y,b-=A.length}this.lines.length>M&&b>0&&e.fillText("…",h+d-v-8*c,C-y),e.restore()}isFinished(){return this.revealedCharCount>=this.fullText.length}clear(){this.fullText="",this.lines=[],this.revealedCharCount=0,this.elapsed=0}skipToEnd(){this.revealedCharCount=this.fullText.length,this.elapsed=this.fullText.length*this.charDelay}wrapText(e){const{width:i}=e.textBoxRect,n=e.text.split(/\s+/),r=document.createElement("canvas").getContext("2d");r.font=e.font??"24px monospace";const c=ne(),h=this.paddingX*c,u=[];let d="";for(const g of n){const m=d?`${d} ${g}`:g;r.measureText(m).width>i-2*h&&d?(u.push(d),d=g):d=m}return d&&u.push(d),u}}class qS{constructor(e){this.playSound=e,this.timeline=[],this.currentIndex=0}start(e){this.timeline=e,this.currentIndex=0}update(e){for(;this.currentIndex<this.timeline.length&&this.timeline[this.currentIndex].timestamp<=e;){const i=this.timeline[this.currentIndex];this.playSound(i.audioFile,{pitch:i.pitch}),this.currentIndex++}}skipToEnd(){for(;this.currentIndex<this.timeline.length;this.currentIndex++){const e=this.timeline[this.currentIndex];this.playSound(e.audioFile,{pitch:e.pitch})}}clear(){this.timeline=[],this.currentIndex=0}}class em{static create(){return new GS(new VS,new XS,new YS,new qS((e,i)=>Q.play(e,"dialogue",i)),Su)}}const Zg=800;class jS{constructor(e){this.orchestrator=e,this.currentScript=null,this.currentIndex=0,this.isActive=!1,this.isBlocked=!1,this.pauseTimerMs=null,this.postLineDelay=0,this.pendingCommand=null,this.activeSpeakerId=null,this.activeSpeakerOptions={},this.asyncManager=new NS(()=>em.create())}startScript(e){this.currentScript=e,this.currentIndex=0,this.postLineDelay=0,this.isActive=!0,this.isBlocked=!1,this.pendingCommand=null,this.advance()}advance(){var i,n,r,c,h,u;if(!this.currentScript||this.currentIndex>=this.currentScript.events.length){this.clear();return}const e=this.currentScript.events[this.currentIndex];switch(this.currentIndex++,e.type){case"line":{this.orchestrator.setVisualsVisible(!0),this.isBlocked=!0;const d=this.currentScript.defaultMode??"inPerson",g=((i=e.options)==null?void 0:i.mode)??this.activeSpeakerOptions.mode??d,m=((n=e.options)==null?void 0:n.side)??this.activeSpeakerOptions.side??"left",y=e.speakerId??this.activeSpeakerId;if(!y){console.warn("No speaker defined for line event"),this.advance();return}const v=((r=e.options)==null?void 0:r.textColor)??this.activeSpeakerOptions.textColor,M=((c=e.options)==null?void 0:c.font)??this.activeSpeakerOptions.font,{textBoxRect:b,position:C,font:w}=bu({mode:g,side:m,fontOverride:M});this.orchestrator.startDialogue({speakerId:y,text:e.text,textColor:v,font:w,textBoxRect:b,textBoxAlpha:((h=e.options)==null?void 0:h.textBoxAlpha)??.8,position:C,mode:g,side:m,textSpeed:(u=Su.getProfile(y))==null?void 0:u.textSpeed});return}case"pause":{this.isBlocked=!0,this.pauseTimerMs=e.durationMs;return}case"command":{this.isBlocked=!0;const d=e.run();d instanceof Promise?this.pendingCommand=d.then(()=>{this.isBlocked=!1,this.pendingCommand=null}):this.isBlocked=!1;return}case"async":{this.asyncManager.startAsync(e.dialogue,()=>!this.isRunning()),this.advance();return}case"hideUI":{this.orchestrator.setVisualsVisible(!1),this.advance();return}case"showUI":{this.orchestrator.setVisualsVisible(!0),this.advance();return}case"endIf":{e.condition()?this.clear():this.advance();return}case"changespeaker":{this.activeSpeakerId=e.speakerId,this.activeSpeakerOptions=e.options??{},this.advance();return}default:{console.warn(`Unknown dialogue event type: ${e.type}`),this.advance();return}}}update(e){if(this.isActive){if(this.asyncManager.update(e),this.orchestrator.update(e),this.pauseTimerMs!==null){this.pauseTimerMs-=e*1e3,this.pauseTimerMs<=0&&(this.pauseTimerMs=null,this.isBlocked=!1,this.postLineDelay=Zg);return}if(this.postLineDelay>0){this.postLineDelay-=e*1e3;return}if(!this.pendingCommand){if(this.isBlocked){this.orchestrator.isFinished()&&(this.isBlocked=!1,this.postLineDelay=Zg);return}this.advance()}}}render(e){this.isActive&&(this.orchestrator.render(e),this.asyncManager.render(e))}skipOrAdvance(){var e,i;this.isActive&&(this.orchestrator.isFinished()?!this.pendingCommand&&!this.isBlocked&&this.postLineDelay<=0&&this.advance():(i=(e=this.orchestrator).skipToEnd)==null||i.call(e))}isRunning(){return this.isActive}clear(){this.currentScript=null,this.currentIndex=0,this.postLineDelay=0,this.isActive=!1,this.isBlocked=!1,this.pendingCommand=null,this.orchestrator.clear(),this.asyncManager.clearAll()}destroy(){this.clear(),this.orchestrator.destroy(),this.asyncManager.destroy()}}class Mo{static create(){const e=em.create();return new jS(e)}}function ZS(a){return{id:"test-script",defaultMode:"inPerson",events:[{type:"line",speakerId:"marla",text:"Excuse me. You are not authorized to take a break right now Shipwright!"}]}}function rt(a,e=100){return new Promise(i=>{const n=()=>{a()?i():setTimeout(n,e)};n()})}function KS(a){const{inputManager:e}=a;if(!e)throw new Error("Input manager is required for hub arrival dialogue");return{id:"hub-introduction-1",defaultMode:"inPerson",events:[{type:"pause",durationMs:500},{type:"line",speakerId:"marla",text:"Welcome to HQ. Please do not mistake this for a place of safety. It is merely where the paperwork lives."},{type:"line",speakerId:"marla",text:"I'm Marla Thinx, Account Liaison. My role is to observe, log, and gently discourage noncompliance. Occasionally I blink."},{type:"line",speakerId:"marla",text:"Your continued operation has triggered a provisional classification of 'survivor'. Please do not interpret this as encouragement."},{type:"line",speakerId:"marla",text:"You've been assigned a docking alcove, a breakroom with two functioning chairs, and access to the Passive Allocation Terminal."},{type:"line",speakerId:"marla",text:"You are now eligible for one (1) certified enhancement. The intern will explain. He insisted."},{type:"pause",durationMs:500},{type:"line",speakerId:"rexor",text:"Hey! You're not soup! That's great news!"},{type:"line",speakerId:"rexor",text:"You got your first passive point. The terminal still thinks it's a coffee machine, but it'll work."},{type:"line",speakerId:"rexor",text:"Go poke it and pick something. Might even help you not die. Or at least die slightly slower."},{type:"command",run:()=>{Be.set("hub.passive-terminal.unlocked"),Be.set("hub.introduction-1.complete")}}]}}function QS(a){const{inputManager:e}=a;if(!e)throw new Error("Input manager is required for hub arrival dialogue");return{id:"hub-introduction-2",defaultMode:"inPerson",events:[{type:"command",run:()=>{e.disableInput()}},{type:"pause",durationMs:2e3},{type:"line",options:{textBoxAlpha:1},speakerId:"rexor",text:"Pick a category—Offense, Defense, Utility. Then slap a point into whatever looks shiny."},{type:"line",options:{textBoxAlpha:1},speakerId:"rexor",text:"Each upgrade stacks up to three times. Click confirm to make it official and mildly irreversible."},{type:"command",run:()=>{ct.getInstance().getAvailablePoints()===0&&ct.getInstance().addPassivePoints(1)}},{type:"hideUI"},{type:"command",run:()=>{e.enableInput()}},{type:"command",run:()=>rt(()=>ct.getInstance().hasAnyPassives())},{type:"showUI"},{type:"line",speakerId:"rexor",text:"Nice! You're now technically enhanced. Should make it slightly easier to extract value from volatile assets."},{type:"command",run:()=>{Be.set("hub.introduction-2.complete")}}]}}function $S(a){const{inputManager:e}=a;if(!e)throw new Error("Input manager is required for hub arrival dialogue");return{id:"hub-introduction-3",defaultMode:"inPerson",events:[{type:"line",speakerId:"marla",text:"Now that you've invested in personal development, you're eligible for further hazard deployment."},{type:"line",speakerId:"marla",text:"We've identified an unsanctioned scrapper cluster operating in Entropium-positive territory under Deep Void jurisdiction."},{type:"line",speakerId:"marla",text:"They are not employees. Their ships are not assets. Their existence constitutes a yield inefficiency."},{type:"line",speakerId:"marla",text:"Your directive is to reclaim all viable matter. Structural integrity is optional. Entropium output is not."},{type:"line",speakerId:"marla",text:"Proceed to the mission terminal. Further delays will be logged."},{type:"command",run:()=>{Be.set("hub.introduction-3.complete"),Be.set("hub.mission-computer.unlocked"),Be.set("hub.breakroom.unlocked"),Be.set("mission.scrapper-revenant.unlocked")}}]}}class Re{constructor(){this.currency=0,this.blockQueue=[],this.onCurrencyChangeCallbacks=new Set}static getInstance(){return Re.instance||(Re.instance=new Re),Re.instance}initialize(e=0){this.currency=e}getCurrency(){return this.currency}hasEnoughCurrency(e){return this.currency>=e}addCurrency(e){return e<=0?this.currency:(this.currency+=e,this.notifyCurrencyChange(),this.currency)}spendCurrency(e){return e<=0?!0:this.currency<e?!1:(this.currency-=e,this.notifyCurrencyChange(),!0)}onCurrencyChange(e){return this.onCurrencyChangeCallbacks.add(e),()=>this.onCurrencyChangeCallbacks.delete(e)}notifyCurrencyChange(){for(const e of this.onCurrencyChangeCallbacks)e(this.currency)}enqueueBlock(e){console.log("[PlayerResources] Queue Size: ",this.blockQueue.length),this.blockQueue.push(e)}enqueueBlockToFront(e){console.log("[PlayerResources] Queue Size: ",this.blockQueue.length),this.blockQueue.unshift(e)}dequeueBlock(){return console.log("[PlayerResources] Queue size: ",this.blockQueue.length),this.blockQueue.shift()??null}getBlockQueue(){return this.blockQueue}getBlockCount(){return this.blockQueue.length}hasBlocks(){return this.blockQueue.length>0}queueSize(){return this.blockQueue.length}getLastGatheredBlock(){return this.blockQueue.length>0?this.blockQueue[this.blockQueue.length-1]:null}reset(){this.currency=0,this.blockQueue=[],this.notifyCurrencyChange()}destroy(){this.currency=0,this.blockQueue=[],this.onCurrencyChangeCallbacks.clear()}postMissionClear(){this.blockQueue=[],this.onCurrencyChangeCallbacks.clear()}}function JS(a,e,i){It.getInstance().getLastUsed()==="gamepad"?a.createScreenCoachMark("",e,i,{type:"gamepadShoulders",highlighted:["leftBumper"],width:160,height:80,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",duration:1/0}):a.createScreenCoachMark("",e,i,{type:"key",keyLabel:"Shift",width:60,height:60,fontSize:24,borderColor:"#00FFFF",fillColor:"#001122",textColor:"#00FFFF",duration:1/0})}function e1(a,e,i){It.getInstance().getLastUsed()==="gamepad"?a.createScreenCoachMark("",e,i,{type:"gamepadFaceButtons",highlightButton:"Y",radius:50,fontSize:18,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",textColor:"#FFFFFF",duration:1/0}):a.createScreenCoachMark("",e,i,{type:"key",keyLabel:"Tab",width:50,height:50,fontSize:24,borderColor:"#00FFFF",fillColor:"#001122",textColor:"#00FFFF",duration:1/0})}function t1(a,e,i){It.getInstance().getLastUsed()==="gamepad"?a.createScreenCoachMark("",e,i,{type:"gamepadFaceButtons",highlightButton:"X",radius:50,fontSize:18,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",textColor:"#FFFFFF",duration:1/0}):a.createScreenCoachMark("",e,i,{type:"key",keyLabel:"X",width:50,height:50,fontSize:24,borderColor:"#00FFFF",fillColor:"#001122",textColor:"#00FFFF",duration:1/0})}function i1(a,e,i){It.getInstance().getLastUsed()==="gamepad"?a.createScreenCoachMark("",e,i,{type:"gamepadSticks",wiggleStick:"right",highlightStick:"right",width:120,height:60,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",duration:1/0}):a.createScreenCoachMark("",e,i,{type:"mouse",interactionMode:"wiggle",width:60,height:90,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",duration:1/0})}function s1(a,e,i){It.getInstance().getLastUsed()==="gamepad"?a.createScreenCoachMark("",e,i,{type:"gamepadShoulders",highlighted:["rightBumper"],width:160,height:80,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",duration:1/0}):a.createScreenCoachMark("",e,i,{type:"mouse",interactionMode:"leftClick",width:60,height:90,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",duration:1/0})}function n1(a,e,i){if(It.getInstance().getLastUsed()==="gamepad")a.createScreenCoachMark("",e,i,{type:"gamepadSticks",wiggleStick:"left",highlightStick:"left",width:120,height:60,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",duration:1/0});else{const c={type:"key",width:50,height:50,fontSize:24,borderColor:"#00FFFF",fillColor:"#001122",textColor:"#00FFFF",duration:1/0};a.createScreenCoachMark("",e,i-80,{...c,keyLabel:"W"}),a.createScreenCoachMark("",e-80,i,{...c,keyLabel:"A"}),a.createScreenCoachMark("",e,i,{...c,keyLabel:"S"}),a.createScreenCoachMark("",e+80,i,{...c,keyLabel:"D"})}}const Kg=Re.getInstance();function a1(a){const{inputManager:e,waveSpawner:i,playerShip:n,coachMarkManager:r}=a;if(!e)throw new Error("Input manager is required for intro briefing");if(!i)throw new Error("Wave spawner is required for intro briefing");if(!n)throw new Error("Player ship is required for intro briefing");if(!r)throw new Error("Coach mark manager is required for intro briefing");return{id:"intro-briefing",defaultMode:"transmission",events:[{type:"endIf",condition:()=>Be.has("mission.intro-briefing.complete")},{type:"command",run:()=>{e.disableAllActions()}},{type:"pause",durationMs:1e3},{type:"line",speakerId:"carl",text:"Greetings, Shipwright Second Class. Assessing your consciousness status..."},{type:"pause",durationMs:500},{type:"line",speakerId:"carl",text:"Neural activity meets minimum viable contractor threshold. Initiating pre-flight checks."},{type:"line",speakerId:"carl",text:"Activating Engine Systems. Please do remain stationary until accidents are formally authorized."},{type:"command",run:()=>{Q.play("assets/sounds/sfx/ship/computing_00.wav","sfx")}},{type:"pause",durationMs:500},{type:"line",speakerId:"carl",text:"Thruster interface enabled. W, A, S, D keys mapped—pending your keyboard competency certification..."},{type:"command",run:()=>{e.enableAllActions(),e.disableAction("firePrimary"),e.disableAction("openShipBuilder"),e.disableAction("pause")}},{type:"command",run:()=>{n1(r,200,400)}},{type:"command",run:()=>new Promise(c=>{const h=()=>{e.isKeyPressed("KeyW")||e.isKeyPressed("KeyA")||e.isKeyPressed("KeyS")||e.isKeyPressed("KeyD")||e.isLeftStickMoved()?c():requestAnimationFrame(h)};h()})},{type:"line",speakerId:"carl",text:"Mobility nominal. Unexpectedly, your motor cortex appears to be functional."},{type:"command",run:()=>{r.clear()}},{type:"line",speakerId:"carl",text:"Now engage your Afterburner with Left Shift. Or Left Bumper, if you're using a thumb-calibrated stick."},{type:"command",run:()=>{JS(r,200,400)}},{type:"command",run:()=>new Promise(c=>{const h=()=>{e.isActionPressed("afterburner")?(r.clear(),c()):requestAnimationFrame(h)};h()})},{type:"line",speakerId:"carl",text:"Acceleration spike detected. Try not to hit anything valuable—like me."},{type:"pause",durationMs:300},{type:"line",speakerId:"carl",text:"Firing vector locked. Wiggle the mouse—yes, the rodent-shaped input relic—to express hostility."},{type:"command",run:()=>(i1(r,200,400),new Promise(c=>{const h=()=>{e.wasMouseMoved()||e.isRightStickMoved()?(r.clear(),c()):requestAnimationFrame(h)};h()}))},{type:"command",run:()=>{r.clear()}},{type:"line",speakerId:"carl",text:"Please Left-click to discharge kinetic discouragement..."},{type:"command",run:()=>{e.enableAction("firePrimary"),e.enableAction("pause"),s1(r,200,400)}},{type:"command",run:()=>new Promise(c=>{const h=()=>{e.isActionPressed("firePrimary")?(r.clear(),c()):requestAnimationFrame(h)};h()})},{type:"command",run:()=>{r.clear()}},{type:"line",speakerId:"carl",text:"Weapon discharge successful. No signs of sabotage by operator. Unexpected."},{type:"pause",durationMs:300},{type:"line",speakerId:"carl",text:"Press X to toggle between firing modes. 'Synced' for sustained fire, 'Sequence' for burst fire."},{type:"command",run:()=>{e.enableKey("KeyX")}},{type:"command",run:()=>{t1(r,200,400)}},{type:"command",run:()=>new Promise(c=>{const h=()=>{e.isActionPressed("switchFiringMode")?c():requestAnimationFrame(h)};h()})},{type:"command",run:()=>{r.clear()}},{type:"pause",durationMs:200},{type:"line",speakerId:"carl",text:"Use the scroll wheel or R/T to zoom in and out. Don't break it."},{type:"command",run:()=>{r.createScreenCoachMark("",200,400,{type:"mouse",interactionMode:"scroll",width:60,height:90,borderColor:"#00FFFF",fillColor:"#001122",highlightColor:"#00FFFF",duration:1/0})}},{type:"command",run:()=>new Promise(c=>{const h=()=>{e.wasScrollWheelUp()||e.wasScrollWheelDown()||e.isKeyPressed("KeyR")||e.isKeyPressed("KeyT")||e.isLeftTriggerPressed()&&e.isRightStickMoved()?c():requestAnimationFrame(h)};h()})},{type:"command",run:()=>{r.clear()}},{type:"line",speakerId:"carl",text:"Zoom functionality confirmed. Your biomechanics are improving... Slightly."},{type:"command",run:()=>{i.start()}},{type:"command",run:()=>{Q.play("assets/sounds/sfx/ship/computing_00.wav","sfx")}},{type:"line",speakerId:"carl",text:"Telemetry indicates unidentified salvage targets approaching. Classification: 'reclaimable liability clusters'."},{type:"line",speakerId:"carl",text:"Standard procedure: convert threats into revenue. Failure to do so may impact your survivability rating."},{type:"pause",durationMs:3e3},{type:"hideUI"},{type:"command",run:()=>rt(()=>Ce.get().enemiesDestroyed>=1)},{type:"showUI"},{type:"line",speakerId:"carl",text:"Enemy presence reduced. Efficiency confirmed. Continue extraction until Entropium reserves reach acceptable thresholds."},{type:"command",run:()=>rt(()=>Kg.getBlockCount()>=1)},{type:"line",speakerId:"carl",text:"Block acquisition confirmed. Your first salvage target has been neutralized."},{type:"pause",durationMs:300},{type:"line",speakerId:"carl",text:"Press Tab to access the shipbuilding module."},{type:"command",run:()=>{e1(r,200,400)}},{type:"command",run:()=>{e.enableAction("openShipBuilder")}},{type:"command",run:()=>new Promise(c=>{const h=()=>{e.wasActionJustPressed("openShipBuilder")?c():requestAnimationFrame(h)};h()})},{type:"command",run:()=>{r.clear()}},{type:"command",run:()=>{e.disableAction("openShipBuilder")}},{type:"line",speakerId:"carl",text:"Place the block on the ship by clicking on the ship. Alternatively, refine the block into Entropium by clicking on the refine button.",options:{side:"right"}},{type:"command",run:()=>rt(()=>Ce.get().blockRefinedCount>=1||Ce.get().blockPlacedCount>=1)},{type:"line",speakerId:"carl",text:"Block placement or refinement confirmed. Your ship's structural integrity has been bolstered.",options:{side:"right"}},{type:"command",run:()=>{e.enableAction("openShipBuilder"),e.enableAction("pause")}},{type:"line",speakerId:"carl",text:"While you have at least one block, press Tab to place more blocks.",options:{side:"right"}},{type:"line",speakerId:"carl",text:"TIP: Right-click on any block on your ship to sell. Press Spacebar to rotate a block before placing.",options:{side:"right"}},{type:"pause",durationMs:300},{type:"line",speakerId:"carl",text:"Gather Entropium to meet your quota. Your current target is 300 units.",options:{side:"right"}},{type:"hideUI"},{type:"command",run:()=>rt(()=>Kg.getCurrency()>=300)},{type:"showUI"},{type:"line",speakerId:"carl",text:"Entropium extraction threshold reached. Your contract remains marginally unbroken."},{type:"line",speakerId:"carl",text:"Entropium has many uses. For now, know that it is the lifeblood of Deep Void operations."},{type:"pause",durationMs:300},{type:"line",speakerId:"carl",text:"Survive incoming waves in order to receive permission to return to headquarters."},{type:"line",speakerId:"carl",text:"Remember: Always build toward revenue."},{type:"pause",durationMs:1e3},{type:"hideUI"},{type:"command",run:()=>rt(()=>i.isBossWaveActive())},{type:"showUI"},{type:"line",speakerId:"carl",text:"Powerful hostile detected. Proceed to center coordinates."},{type:"pause",durationMs:1e3},{type:"line",speakerId:"carl",text:"Survival probability: 0.0001%. But hey, you never know."},{type:"pause",durationMs:1e3},{type:"line",speakerId:"crazy-moe",text:"WELL WHADDYA KNOW! A flyin' lunchbox full'a alloys!"},{type:"pause",durationMs:500},{type:"line",speakerId:"crazy-moe",text:"Heh—I'ma pop yer cockpit like a soda tab and sniff the coolant fumes!"},{type:"pause",durationMs:1e3},{type:"hideUI"},{type:"command",run:()=>rt(()=>i.shouldCompleteMission())},{type:"command",run:()=>{console.log("Added passive point!"),ct.getInstance().addPassivePoints(1)}},{type:"command",run:()=>{Be.set("mission.intro-briefing.complete"),Be.set("mission.mission_002.unlocked"),Be.set("mission.mission_003_00.unlocked")}},{type:"showUI"},{type:"line",speakerId:"crazy-moe",text:"Y'got me! Sweet entropy, I see the light—*AND SHE'S MADE OF REBAR AND RADIATION!*"}]}}function o1(a){const{inputManager:e,waveSpawner:i,playerShip:n}=a;if(!e)throw new Error("Input manager is required for generic mission dialogue");if(!i)throw new Error("Wave spawner is required for generic mission dialogue");if(!n)throw new Error("Player ship is required for generic mission dialogue");return{id:"mission-generic",defaultMode:"transmission",events:[{type:"showUI"},{type:"command",run:()=>{i.start()}},{type:"line",speakerId:"carl",text:"Survive incoming waves in order to receive permission to return to headquarters."},{type:"line",speakerId:"carl",text:"Remember: Always build toward revenue."},{type:"pause",durationMs:1e3},{type:"hideUI"},{type:"command",run:()=>rt(()=>i.isBossWaveActive())},{type:"showUI"},{type:"line",speakerId:"carl",text:"Powerful hostile detected. Proceed to center coordinates."},{type:"pause",durationMs:1e3},{type:"line",speakerId:"carl",text:"Survival probability: 0.0001%. But hey, you never know."},{type:"pause",durationMs:1e3},{type:"line",speakerId:"crazy-moe",text:"WELL WHADDYA KNOW! A flyin' lunchbox full'a alloys!"},{type:"pause",durationMs:1e3},{type:"line",speakerId:"crazy-moe",text:"Heh—I'ma pop yer cockpit like a soda tab and sniff the coolant fumes!"},{type:"pause",durationMs:1e3},{type:"hideUI"},{type:"command",run:()=>rt(()=>i.shouldCompleteMission())},{type:"showUI"},{type:"line",speakerId:"crazy-moe",text:"Y'got me! Sweet entropy, I see the light—*AND SHE'S MADE OF REBAR AND RADIATION!*"},{type:"pause",durationMs:2e3}]}}function r1(a){const{inputManager:e,waveSpawner:i,playerShip:n}=a;if(!e)throw new Error("Input manager is required for generic planet dialogue");if(!i)throw new Error("Wave spawner is required for generic planet dialogue");if(!n)throw new Error("Player ship is required for generic planet dialogue");return{id:"planet-generic",defaultMode:"transmission",events:[{type:"command",run:()=>{Q.play("assets/sounds/sfx/ship/computing_00.wav","sfx")}},{type:"line",speakerId:"carl",text:"Nobody appears to be home."},{type:"pause",durationMs:1e3}]}}function l1(a){const{inputManager:e,waveSpawner:i,playerShip:n}=a;if(!e)throw new Error("Input manager is required for mission dialogue");if(!i)throw new Error("Wave spawner is required for mission dialogue");if(!n)throw new Error("Player ship is required for mission dialogue");return{id:"mission_003_00",defaultMode:"transmission",events:[{type:"showUI"},{type:"line",speakerId:"carl",text:"Deployment confirmed. SYSTEM: FERRUST. CONDITION: METALLURGICALLY HOSTILE."},{type:"command",run:()=>{i.start()}},{type:"pause",durationMs:400},{type:"line",speakerId:"carl",text:"OBJECTIVE: Convert hostile scrap into Entropium. Try not to die—but either outcome generates data."},{type:"pause",durationMs:400},{type:"line",speakerId:"carl",text:"Remember: Survival is admirable. Profitability is mandatory."},{type:"pause",durationMs:700},{type:"hideUI"},{type:"async",dialogue:[{type:"command",run:()=>rt(()=>Ce.get().enemiesDestroyed>=5)},{type:"showUI"},{type:"line",speakerId:"carl",text:"Five kills? I'll adjust your obituary."},{type:"pause",durationMs:1e3},{type:"hideUI"}]},{type:"async",dialogue:[{type:"command",run:()=>rt(()=>Ce.get().blocksUnlocked.length>=1)},{type:"showUI"},{type:"line",speakerId:"carl",text:"BLOCK UNLOCKED! Please be aware that all new technology is the intellectual property of Deep Void."},{type:"pause",durationMs:200},{type:"hideUI"}]},{type:"async",dialogue:[{type:"command",run:()=>rt(()=>Ce.get().blocksLost>=1)},{type:"showUI"},{type:"line",speakerId:"carl",text:"Please avoid asset loss. Repair damaged blocks in Ship Building Console before damage becomes permanent."},{type:"pause",durationMs:1e3},{type:"hideUI"}]},{type:"async",dialogue:[{type:"command",run:()=>rt(()=>Ce.get().enemiesDestroyed>=20)},{type:"showUI"},{type:"line",speakerId:"carl",text:"Twenty construct terminations logged. Exceeding expectations will not result in a raise."},{type:"pause",durationMs:1e3},{type:"hideUI"}]},{type:"async",dialogue:[{type:"command",run:()=>rt(()=>Ce.get().enemiesDestroyed>=50)},{type:"showUI"},{type:"line",speakerId:"carl",text:"Fifty? Very efficient. Disturbingly so. Filing a concern."},{type:"pause",durationMs:1e3},{type:"hideUI"}]},{type:"async",dialogue:[{type:"command",run:()=>rt(()=>Re.getInstance().getCurrency()>=1e3)},{type:"showUI"},{type:"line",speakerId:"carl",text:"Reminder: All Entropium is property of Deep Void Salvage Co. Unauthorized enrichment is discouraged."},{type:"pause",durationMs:1e3},{type:"hideUI"}]},{type:"command",run:()=>rt(()=>i.isBossWaveActive())},{type:"showUI"},{type:"line",speakerId:"carl",text:"Anomalous mass detected. Vessel constructed from repurposed hulls. Efficiency through cannibalism—commendable."},{type:"pause",durationMs:1e3},{type:"line",speakerId:"crazy-moe",text:"WELL WHADDYA KNOW! A flyin' lunchbox full'a alloys!"},{type:"pause",durationMs:1e3},{type:"line",speakerId:"crazy-moe",text:"Heh—I'ma pop yer cockpit like a soda tab and sniff the coolant fumes!"},{type:"pause",durationMs:1e3},{type:"hideUI"},{type:"command",run:()=>rt(()=>i.shouldCompleteMission())},{type:"command",run:()=>{console.log("Added passive point!"),ct.getInstance().addPassivePoints(1)}},{type:"command",run:()=>{Be.set("mission.mission_003_00.complete"),Be.set("mission.mission_004_00.unlocked")}},{type:"showUI"},{type:"line",speakerId:"crazy-moe",text:"Y'got me! Sweet entropy, I see the light—*AND SHE'S MADE OF REBAR AND RADIATION!*"},{type:"pause",durationMs:2e3}]}}const c1=new Map([["test-script",ZS],["hub-introduction-1",KS],["hub-introduction-2",QS],["hub-introduction-3",$S],["intro-briefing",a1],["mission-generic",o1],["planet-generic",r1],["mission_003_00",l1]]);function rn(a,e){const i=c1.get(a);return i?i(e):void 0}const h1="assets/hub/backgrounds/scene_main-room.png",go={terminal:{x:50,y:280,width:300,height:360},map:{x:440,y:160,width:490,height:380},breakroom:{x:970,y:230,width:230,height:300}},u1={terminal:"hub.passive-terminal.unlocked",map:"hub.mission-computer.unlocked",breakroom:"hub.breakroom.unlocked"};class f1{constructor(e,i,n){this.backgroundImage=null,this.dialogueQueueManager=null,this.isHoveringInteraction=!1,this.update=r=>{var d;this.inputManager.updateFrame(),this.inputManager.wasKeyJustPressed("KeyF")&&Be.clear();const c=this.inputManager.getMousePosition(),h=this.inputManager.wasMouseClicked();if((d=this.dialogueQueueManager)!=null&&d.isRunning()){this.dialogueQueueManager.update(this.gameLoop.getDeltaTime()),h&&this.dialogueQueueManager.skipOrAdvance();return}const u=g=>{const m=sl(g);return c.x>=m.x&&c.x<=m.x+m.width&&c.y>=m.y&&c.y<=m.y+m.height};if(this.isHoveringInteraction=Object.entries(go).some(([g,m])=>u(m)&&Be.has(u1[g])),h){if(Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:4}),u(go.terminal)&&Be.has("hub.passive-terminal.unlocked")){this.stop(),vt.fadeToScene("passives");return}else if(u(go.map)&&Be.has("hub.mission-computer.unlocked")){this.stop(),vt.fadeToScene("galaxy");return}else if(u(go.breakroom)&&Be.has("hub.breakroom.unlocked")){this.stop(),vt.fadeToScene("breakroom");return}}Bs(this.quitButton,c.x,c.y,h,ne())},this.render=r=>{var g;this.canvasManager.clearAll();const c=this.canvasManager.getContext("background"),h=this.canvasManager.getContext("ui"),u=this.inputManager.getMousePosition();this.backgroundImage&&c.drawImage(this.backgroundImage,0,0,c.canvas.width,c.canvas.height),(g=this.dialogueQueueManager)!=null&&g.isRunning()||ht(h,this.quitButton,ne()),this.dialogueQueueManager&&this.dialogueQueueManager.render(h);const d=this.isHoveringInteraction?vu():nn();oa(h,d,u.x,u.y,ne())},this.canvasManager=e,this.gameLoop=i,this.inputManager=n,this.quitButton={x:20,y:20,width:120,height:50,label:"← Quit",isHovered:!1,onClick:()=>{this.stop(),Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:1}),vt.fadeToScene("title")},style:{borderRadius:10,alpha:.85,borderColor:"#00ff00",textFont:"18px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}}}async start(){if(this.backgroundImage=await ra(h1),this.gameLoop.onUpdate(this.update),this.gameLoop.onRender(this.render),this.gameLoop.start(),lt.getInstance().saveAll(),Q.playMusic({file:"assets/sounds/music/track_01_hub.mp3"}),this.dialogueQueueManager=Mo.create(),Be.has("hub.introduction-1.complete")){if(Be.has("hub.introduction-1.complete")&&Be.has("hub.introduction-2.complete")&&!Be.has("hub.introduction-3.complete")){const e=rn("hub-introduction-3",{inputManager:this.inputManager});e&&this.dialogueQueueManager.startScript(e)}}else{const e=rn("hub-introduction-1",{inputManager:this.inputManager});e&&this.dialogueQueueManager.startScript(e)}}stop(){this.gameLoop.offUpdate(this.update),this.gameLoop.offRender(this.render)}drawInteractionZones(e){e.strokeStyle="#0f0",e.lineWidth=1;for(const i of Object.values(go)){const n=sl(i);e.strokeRect(n.x,n.y,n.width,n.height)}}}function d1(a,e,i=1){const{x:n,y:r,width:c,height:h,style:u={}}=e,{backgroundColor:d="#0a0a0a",borderColor:g="#00ff41",glow:m=!0,scanlineIntensity:y=.3,cornerBevel:v=!0,chromaticAberration:M=!0}=u,b=c*i,C=h*i,w=Math.min(3,h*.2);a.save(),v&&(a.beginPath(),a.moveTo(n+w,r),a.lineTo(n+b-w,r),a.lineTo(n+b,r+w),a.lineTo(n+b,r+C-w),a.lineTo(n+b-w,r+C),a.lineTo(n+w,r+C),a.lineTo(n,r+C-w),a.lineTo(n,r+w),a.closePath(),a.clip());const A=a.createLinearGradient(n,r,n,r+C);if(A.addColorStop(0,$t(d,"ff")),A.addColorStop(.5,$t(d,"cc")),A.addColorStop(1,$t(d,"ff")),a.fillStyle=A,a.fillRect(n,r,b,C),y>0){a.fillStyle=`rgba(255,255,255,${y*.05})`;for(let R=0;R<C;R+=2*i)a.fillRect(n,r+R,b,i)}a.restore(),m&&(a.save(),a.shadowColor=g,a.shadowBlur=10*i,a.strokeStyle=g,a.lineWidth=2*i,v?(a.beginPath(),a.moveTo(n+w,r),a.lineTo(n+b-w,r),a.lineTo(n+b,r+w),a.lineTo(n+b,r+C-w),a.lineTo(n+b-w,r+C),a.lineTo(n+w,r+C),a.lineTo(n,r+C-w),a.lineTo(n,r+w),a.closePath(),a.stroke()):a.strokeRect(n,r,b,C),a.restore()),M&&(a.save(),a.globalAlpha=.2,a.lineWidth=1*i,a.strokeStyle="#ff0000",a.strokeRect(n-.5*i,r,b,C),a.strokeStyle="#0000ff",a.strokeRect(n+.5*i,r,b,C),a.restore()),a.save(),a.strokeStyle=`${g}40`,a.lineWidth=1,a.strokeRect(n+1*i,r+1*i,b-2*i,C-2*i),a.restore()}function ou(a){const e=ji.getMissionById(a);return e?Be.has(e.requiredFlag):!1}function Qg(a,e,i){const n=a.createShader(e);return n?(a.shaderSource(n,i),a.compileShader(n),a.getShaderParameter(n,a.COMPILE_STATUS)?n:(console.error("Shader compile error:",a.getShaderInfoLog(n)),a.deleteShader(n),null)):(console.error("Failed to create shader"),null)}function g1(a,e,i){const n=a.createProgram();return n?(a.attachShader(n,e),a.attachShader(n,i),a.linkProgram(n),a.getProgramParameter(n,a.LINK_STATUS)?n:(console.error("Program link error:",a.getProgramInfoLog(n)),a.deleteProgram(n),null)):(console.error("Failed to create program"),null)}const p1=`
    attribute vec3 position;
    attribute vec3 normal;
    
    uniform mat4 modelMatrix;
    uniform mat4 viewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat3 normalMatrix;
    
    varying vec3 vNormal;
    varying vec3 vPosition;
    
    void main() {
        vec4 worldPosition = modelMatrix * vec4(position, 1.0);
        vPosition = worldPosition.xyz;
        vNormal = normalize(normalMatrix * normal);
        gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
`,m1=`
    precision mediump float;

    varying vec3 vNormal;
    varying vec3 vPosition;

    uniform vec3 color;
    uniform float alpha; // NEW
    uniform vec3 lightPosition;
    uniform vec3 lightColor;
    uniform vec3 ambientColor;

    void main() {
        vec3 lightDirection = normalize(lightPosition - vPosition);
        float lightIntensity = max(dot(vNormal, lightDirection), 0.0);

        vec3 ambient = ambientColor * color;
        vec3 diffuse = lightColor * color * lightIntensity;

        gl_FragColor = vec4(ambient + diffuse, alpha); // MODIFIED
    }
`;function zi(){return new Float32Array(3)}function y1(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])}function Qt(a,e,i){return new Float32Array([a,e,i])}function $g(a,e){const i=e[0]-a[0],n=e[1]-a[1],r=e[2]-a[2];return Math.sqrt(i*i+n*n+r*r)}function tm(a,e,i){return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],a}function v1(a,e,i){return a[0]=e[0]+i[0],a[1]=e[1]+i[1],a[2]=e[2]+i[2],a}function b1(a,e,i){return a[0]=e[0]*i,a[1]=e[1]*i,a[2]=e[2]*i,a}function im(a,e){const i=y1(e);return i>0&&(a[0]=e[0]/i,a[1]=e[1]/i,a[2]=e[2]/i),a}function S1(a,e){const i=[],n=[],r=[];for(let c=0;c<=e;c++){const h=c*Math.PI/e,u=Math.sin(h),d=Math.cos(h);for(let g=0;g<=e;g++){const m=g*2*Math.PI/e,y=Math.sin(m),M=Math.cos(m)*u,b=d,C=y*u;i.push(a*M,a*b,a*C),n.push(M,b,C)}}for(let c=0;c<e;c++)for(let h=0;h<e;h++){const u=c*(e+1)+h,d=u+e+1;r.push(u,d,u+1),r.push(d,d+1,u+1)}return{vertices:new Float32Array(i),normals:new Float32Array(n),indices:new Uint16Array(r)}}function $s(){return new Float32Array(16)}function sm(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function nm(a,e,i,n,r){const c=1/Math.tan(e/2),h=1/(n-r);return a[0]=c/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=c,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(r+n)*h,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*r*n*h,a[15]=0,a}function M1(a,e,i){const n=i[0],r=i[1],c=i[2];return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[0]*n+e[4]*r+e[8]*c+e[12],a[13]=e[1]*n+e[5]*r+e[9]*c+e[13],a[14]=e[2]*n+e[6]*r+e[10]*c+e[14],a[15]=e[3]*n+e[7]*r+e[11]*c+e[15],a}function C1(a,e,i){const n=Math.sin(i),r=Math.cos(i),c=e[0],h=e[1],u=e[2],d=e[3],g=e[8],m=e[9],y=e[10],v=e[11];return a[0]=c*r-g*n,a[1]=h*r-m*n,a[2]=u*r-y*n,a[3]=d*r-v*n,a[8]=c*n+g*r,a[9]=h*n+m*r,a[10]=u*n+y*r,a[11]=d*n+v*r,a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function T1(a,e,i){const n=i[0],r=i[1],c=i[2];return a[0]=e[0]*n,a[1]=e[1]*n,a[2]=e[2]*n,a[3]=e[3]*n,a[4]=e[4]*r,a[5]=e[5]*r,a[6]=e[6]*r,a[7]=e[7]*r,a[8]=e[8]*c,a[9]=e[9]*c,a[10]=e[10]*c,a[11]=e[11]*c,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function w1(a,e){const i=e[0],n=e[1],r=e[2],c=e[4],h=e[5],u=e[6],d=e[8],g=e[9],m=e[10],y=m*h-u*g,v=-m*c+u*d,M=g*c-h*d;let b=i*y+n*v+r*M;return b?(b=1/b,a[0]=y*b,a[1]=(-m*n+r*g)*b,a[2]=(u*n-r*h)*b,a[3]=v*b,a[4]=(m*i-r*d)*b,a[5]=(-u*i+r*c)*b,a[6]=M*b,a[7]=(-g*i+n*d)*b,a[8]=(h*i-n*c)*b,a):null}function Jg(a,e){const i=e[0],n=e[1],r=e[2],c=e[3],h=e[4],u=e[5],d=e[6],g=e[7],m=e[8],y=e[9],v=e[10],M=e[11],b=e[12],C=e[13],w=e[14],A=e[15],R=i*u-n*h,I=i*d-r*h,_=i*g-c*h,x=n*d-r*u,N=n*g-c*u,W=r*g-c*d,z=m*C-y*b,q=m*w-v*b,ie=m*A-M*b,ee=y*w-v*C,K=y*A-M*C,le=v*A-M*w;let Z=R*le-I*K+_*ee+x*ie-N*q+W*z;return Z?(Z=1/Z,a[0]=(u*le-d*K+g*ee)*Z,a[1]=(r*K-n*le-c*ee)*Z,a[2]=(C*W-w*N+A*x)*Z,a[3]=(v*N-y*W-M*x)*Z,a[4]=(d*ie-h*le-g*q)*Z,a[5]=(i*le-r*ie+c*q)*Z,a[6]=(w*_-b*W-A*I)*Z,a[7]=(m*W-v*_+M*I)*Z,a[8]=(h*K-u*ie+g*z)*Z,a[9]=(n*ie-i*K-c*z)*Z,a[10]=(b*N-C*_+A*R)*Z,a[11]=(y*_-m*N-M*R)*Z,a[12]=(u*q-h*ee-d*z)*Z,a[13]=(i*ee-n*q+r*z)*Z,a[14]=(C*I-b*x-w*R)*Z,a[15]=(m*x-y*I+v*R)*Z,a):null}function am(a,e,i,n){const r=e[0],c=e[1],h=e[2],u=i[0],d=i[1],g=i[2],m=n[0],y=n[1],v=n[2];if(Math.abs(r-u)<1e-6&&Math.abs(c-d)<1e-6&&Math.abs(h-g)<1e-6)return sm(a);let M=r-u,b=c-d,C=h-g,w=1/Math.hypot(M,b,C);M*=w,b*=w,C*=w;let A=y*C-v*b,R=v*M-m*C,I=m*b-y*M;w=Math.hypot(A,R,I),w>0?(w=1/w,A*=w,R*=w,I*=w):A=R=I=0;let _=b*I-C*R,x=C*A-M*I,N=M*R-b*A;return w=Math.hypot(_,x,N),w>0?(w=1/w,_*=w,x*=w,N*=w):_=x=N=0,a[0]=A,a[1]=_,a[2]=M,a[3]=0,a[4]=R,a[5]=x,a[6]=b,a[7]=0,a[8]=I,a[9]=N,a[10]=C,a[11]=0,a[12]=-(A*r+R*c+I*h),a[13]=-(_*r+x*c+N*h),a[14]=-(M*r+b*c+C*h),a[15]=1,a}class A1{constructor(e,i){this.program=null,this.sphere=S1(1,24),this.positionBuffer=null,this.normalBuffer=null,this.indexBuffer=null,this.locations=null,this.time=0,this.gl=e,this.camera=i}initialize(){const e=this.gl,i=Qg(e,e.VERTEX_SHADER,p1),n=Qg(e,e.FRAGMENT_SHADER,m1);this.program=g1(e,i,n),this.locations={position:e.getAttribLocation(this.program,"position"),normal:e.getAttribLocation(this.program,"normal"),modelMatrix:e.getUniformLocation(this.program,"modelMatrix"),viewMatrix:e.getUniformLocation(this.program,"viewMatrix"),projectionMatrix:e.getUniformLocation(this.program,"projectionMatrix"),normalMatrix:e.getUniformLocation(this.program,"normalMatrix"),color:e.getUniformLocation(this.program,"color"),lightPosition:e.getUniformLocation(this.program,"lightPosition"),lightColor:e.getUniformLocation(this.program,"lightColor"),ambientColor:e.getUniformLocation(this.program,"ambientColor"),alpha:e.getUniformLocation(this.program,"alpha")},this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sphere.vertices),e.STATIC_DRAW),this.normalBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.normalBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sphere.normals),e.STATIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.sphere.indices),e.STATIC_DRAW)}render(e,i){if(!this.program||!this.locations)return;const n=this.gl;this.time+=.016;const r=n.canvas;n.viewport(0,0,r.width,r.height),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);const c=$s(),h=$s(),u=$s(),d=new Float32Array(9);am(h,this.camera.position,this.camera.target,new Float32Array([0,1,0])),nm(u,Math.PI/4,r.width/r.height,.1,100),n.useProgram(this.program),n.uniform3f(this.locations.lightPosition,0,0,40),n.uniform3f(this.locations.lightColor,1,1,1),n.uniform3f(this.locations.ambientColor,.2,.2,.2),n.uniformMatrix4fv(this.locations.viewMatrix,!1,h),n.uniformMatrix4fv(this.locations.projectionMatrix,!1,u),n.bindBuffer(n.ARRAY_BUFFER,this.positionBuffer),n.enableVertexAttribArray(this.locations.position),n.vertexAttribPointer(this.locations.position,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.normalBuffer),n.enableVertexAttribArray(this.locations.normal),n.vertexAttribPointer(this.locations.normal,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(const g of e){sm(c),M1(c,c,g.position),C1(c,c,this.time*g.rotationSpeed),T1(c,c,Qt(g.scale,g.scale,g.scale)),w1(d,c);const m=ou(g.missionId),y=m?g.color:Qt(.25,.25,.25),v=zi();for(let C=0;C<3;C++)v[C]=Math.min(1,y[C]*1.5);const M=g===i?v:y,b=m?1:.3;n.uniform1f(this.locations.alpha,b),n.uniformMatrix4fv(this.locations.modelMatrix,!1,c),n.uniformMatrix3fv(this.locations.normalMatrix,!1,d),n.uniform3f(this.locations.color,M[0],M[1],M[2]),n.drawElements(n.TRIANGLES,this.sphere.indices.length,n.UNSIGNED_SHORT,0)}}destroy(){const e=this.gl;this.positionBuffer&&e.deleteBuffer(this.positionBuffer),this.normalBuffer&&e.deleteBuffer(this.normalBuffer),this.indexBuffer&&e.deleteBuffer(this.indexBuffer),this.program&&e.deleteProgram(this.program),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}}function ep(a,e,i){return a+(e-a)*i}class k1{constructor(){this.position=zi(),this.target=zi(),this.targetPosition=zi(),this.targetTarget=zi(),this.isMoving=!1,this.moveSpeed=.08,this.position[0]=0,this.position[1]=0,this.position[2]=60,this.target[0]=0,this.target[1]=0,this.target[2]=0,this.targetPosition.set(this.position),this.targetTarget.set(this.target)}update(){if(!this.isMoving)return;let e=!1;for(let i=0;i<3;i++){const n=this.position[i];this.position[i]=ep(this.position[i],this.targetPosition[i],this.moveSpeed),this.target[i]=ep(this.target[i],this.targetTarget[i],this.moveSpeed),Math.abs(this.position[i]-n)>.001&&(e=!0)}this.isMoving=e}focusOnLocation(e){const i=zi();tm(i,this.position,e.position),im(i,i);const n=e.scale*3;b1(i,i,n);const r=zi();v1(r,e.position,i),this.targetPosition.set(r),this.targetTarget.set(e.position),this.isMoving=!0}resetView(){this.targetPosition[0]=0,this.targetPosition[1]=0,this.targetPosition[2]=60,this.targetTarget[0]=0,this.targetTarget[1]=0,this.targetTarget[2]=0,this.isMoving=!0}destroy(){}}const B1=[{id:"casina",name:"Casina System",position:Qt(-22,-10,0),scale:2,color:Qt(.1,.4,.1),rotationSpeed:-.15,missionId:"mission_002"},{id:"naxos",name:"Naxos System",position:Qt(32,2,-20),scale:4,color:Qt(.4,0,0),rotationSpeed:-.3,missionId:"mission_003_00"},{id:"prexus",name:"Prexus System",position:Qt(20,18,-40),scale:8,color:Qt(.8,.3,.9),rotationSpeed:.3,missionId:"mission_004_00"},{id:"mitron",name:"Mitron System",position:Qt(-30,5,-10),scale:7,color:Qt(.2,.6,1),rotationSpeed:.2,missionId:"mission_005_00"},{id:"solarum",name:"Solarum System",position:Qt(0,0,0),scale:9,color:Qt(1,.8,.1),rotationSpeed:-.1,missionId:"mission_006_00"}],hl=class hl{constructor(){this.locationMap=new Map;for(const e of B1)this.locationMap.set(e.id.toLowerCase(),e)}static getInstance(){return this.instance||(this.instance=new hl),this.instance}static destroy(){this.instance=null}getLocationById(e){return this.locationMap.get(e.toLowerCase())??null}getAllLocations(){return Array.from(this.locationMap.values())}};hl.instance=null;let al=hl;function tp(a,e,i,n){const r=zi();tm(r,a,i);const c=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],h=2*(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2]-n*n,d=h*h-4*c*u;if(d<0)return!1;const g=(-h-Math.sqrt(d))/(2*c),m=(-h+Math.sqrt(d))/(2*c);return g>0||m>0}function R1(a,e,i,n){const r=2*a/i.width-1,c=1-2*e/i.height,h=i.width/i.height,u=$s(),d=$s(),g=$s(),m=$s();nm(u,Math.PI/4,h,.1,100),am(d,n.position,n.target,new Float32Array([0,1,0])),Jg(g,u),Jg(m,d);const y=[r,c,-1,1],v=[g[0]*y[0]+g[4]*y[1]+g[8]*y[2]+g[12]*y[3],g[1]*y[0]+g[5]*y[1]+g[9]*y[2]+g[13]*y[3],-1,0],M=new Float32Array([m[0]*v[0]+m[4]*v[1]+m[8]*v[2]+m[12]*v[3],m[1]*v[0]+m[5]*v[1]+m[9]*v[2]+m[13]*v[3],m[2]*v[0]+m[6]*v[1]+m[10]*v[2]+m[14]*v[3]]),b=zi();return b[0]=M[0],b[1]=M[1],b[2]=M[2],im(b,b),{origin:new Float32Array([n.position[0],n.position[1],n.position[2]]),direction:b}}class E1{constructor(e,i){this.canvasManager=e,this.inputManager=i,this.locations=al.getInstance().getAllLocations(),this.selectedLocation=null,this.hoveredLocation=null,this.locationHoverStates=new Map,this.HOVER_SCALE_MULTIPLIER=1.2,this.SCALE_LERP_SPEED=.15,this.gl=this.canvasManager.getWebGLContext("polygon"),this.camera=new k1,this.renderer=new A1(this.gl,this.camera),this.initializeHoverStates()}initializeHoverStates(){for(const e of this.locations)this.locationHoverStates.set(e.id||e.name,{location:e,currentScale:e.scale,targetScale:e.scale})}lerp(e,i,n){return e+(i-e)*n}updateHoverStates(){for(const e of this.locationHoverStates.values())Math.abs(e.currentScale-e.targetScale)>.001?e.currentScale=this.lerp(e.currentScale,e.targetScale,this.SCALE_LERP_SPEED):e.currentScale=e.targetScale}initialize(){this.renderer.initialize()}update(){const{x:e,y:i}=this.inputManager.getMousePosition(),{origin:n,direction:r}=R1(e,i,this.gl.canvas,this.camera);let c=null,h=1/0;for(const u of this.locations){const d=this.locationHoverStates.get(u.id||u.name),g=(d==null?void 0:d.currentScale)||u.scale;if(tp(n,r,u.position,g)&&ou(u.missionId)){const y=$g(n,u.position);y<h&&(h=y,c=u)}}if(c!==this.hoveredLocation){if(this.hoveredLocation&&this.hoveredLocation!==this.selectedLocation){const u=this.locationHoverStates.get(this.hoveredLocation.id||this.hoveredLocation.name);u&&(u.targetScale=this.hoveredLocation.scale)}if(this.hoveredLocation=c,this.hoveredLocation&&!this.selectedLocation&&Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:2}),this.hoveredLocation&&this.hoveredLocation!==this.selectedLocation){const u=this.locationHoverStates.get(this.hoveredLocation.id||this.hoveredLocation.name);u&&(u.targetScale=this.hoveredLocation.scale*this.HOVER_SCALE_MULTIPLIER)}}if(this.selectedLocation){const u=this.locationHoverStates.get(this.selectedLocation.id||this.selectedLocation.name);u&&(u.targetScale=this.selectedLocation.scale,u.currentScale=this.selectedLocation.scale)}if(this.inputManager.wasLeftClicked()){let u=null,d=1/0;for(const g of this.locations){const m=this.locationHoverStates.get(g.id||g.name),y=(m==null?void 0:m.currentScale)||g.scale;if(tp(n,r,g.position,y)){const M=$g(n,g.position);M<d&&(d=M,u=g)}}u?ou(u.missionId)&&(this.selectedLocation||(this.selectedLocation=u,this.camera.focusOnLocation(u),Q.play("assets/sounds/sfx/ui/planetselect_01.wav","sfx",{maxSimultaneous:2}))):(this.selectedLocation&&Q.play("assets/sounds/sfx/ui/planetselect_00.wav","sfx",{maxSimultaneous:2}),this.selectedLocation=null,this.camera.resetView())}this.updateHoverStates(),this.camera.update()}render(){const e=this.locations.map(i=>{const n=this.locationHoverStates.get(i.id||i.name),r=this.selectedLocation&&i.id===this.selectedLocation.id;return n&&!r&&n.currentScale!==i.scale?{...i,scale:n.currentScale}:i});this.renderer.render(e,this.selectedLocation)}destroy(){this.renderer.destroy(),this.camera.destroy(),this.locationHoverStates.clear(),al.destroy()}getSelectedLocation(){return this.selectedLocation}getHoveredLocation(){return this.hoveredLocation}}const I1="assets/hub/backgrounds/scene_galaxy-map.png",ip={borderRadius:10,alpha:.85,borderColor:"#00ff00",textFont:"18px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}};class _1{constructor(e,i,n){this.backgroundImage=null,this.missionPortraitCache=new Map,this.currentlyLoadingPortraitId=null,this.selectedLocationLaunchButton=null,this.update=()=>{this.inputManager.updateFrame();const r=ne(),{x:c,y:h}=this.inputManager.getMousePosition(),u=this.inputManager.wasMouseClicked();this.galaxyMapController.update();for(const g of this.buttons)g.isHovered=c>=g.x&&c<=g.x+g.width&&h>=g.y&&h<=g.y+g.height,Bs(g,c,h,u,r);const d=this.galaxyMapController.getSelectedLocation();if(d&&d.missionId){const g=nl[d.missionId];if(!g)return;this.selectedLocationLaunchButton={x:this.canvasManager.getContext("ui").canvas.width/2-180*r,y:this.canvasManager.getContext("ui").canvas.height/2+140*r,width:360,height:40,label:`Launch "${g.name}"`,isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/start_00.wav","sfx",{maxSimultaneous:4}),ji.setMission(g),this.stop(),vt.fadeToScene("mission")},style:ip};const m=g.missionPortrait;m&&!this.missionPortraitCache.has(m)&&this.currentlyLoadingPortraitId!==m&&(this.currentlyLoadingPortraitId=m,ra(Mi(m)).then(y=>{this.missionPortraitCache.set(m,y),this.currentlyLoadingPortraitId=null}).catch(y=>{console.warn(`Failed to load mission portrait: ${m}`,y),this.currentlyLoadingPortraitId=null}))}else this.selectedLocationLaunchButton=null;if(this.selectedLocationLaunchButton){const g=this.selectedLocationLaunchButton;g.isHovered=c>=g.x&&c<=g.x+g.width&&h>=g.y&&h<=g.y+g.height,Bs(g,c,h,u,r)}},this.render=()=>{var M;this.canvasManager.clearAll();const r=ne(),c=this.canvasManager.getContext("background"),h=this.canvasManager.getContext("ui"),{x:u,y:d}=this.inputManager.getMousePosition();this.backgroundImage&&c.drawImage(this.backgroundImage,0,0,c.canvas.width,c.canvas.height),this.galaxyMapController.render();for(const b of this.buttons)ht(h,b,r);this.selectedLocationLaunchButton&&ht(h,this.selectedLocationLaunchButton,r);const g=this.galaxyMapController.getSelectedLocation();if(g&&g.missionId){const b=nl[g.missionId];if(b&&b.missionPortrait){const C=this.missionPortraitCache.get(b.missionPortrait);if(C){const w=h.canvas,A=256*r,R=4*r,I=A-R*2,_=w.width/2-I/2,x=180*r;d1(h,{x:_,y:x,width:A,height:A}),h.drawImage(C,_+R,x+R,I,I)}}}let m=nn();const y=this.galaxyMapController.getHoveredLocation(),v=this.galaxyMapController.getSelectedLocation();(y&&!v||(M=this.selectedLocationLaunchButton)!=null&&M.isHovered)&&(m=vu()),oa(h,m,u,d,r)},this.canvasManager=e,this.gameLoop=i,this.inputManager=n,this.galaxyMapController=new E1(e,n),this.buttons=[{x:20,y:20,width:120,height:50,label:"← Back",isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:4}),this.stop(),vt.fadeToScene("hub")},style:ip}]}async start(){this.backgroundImage=await ra(I1),this.galaxyMapController.initialize(),this.gameLoop.onUpdate(this.update),this.gameLoop.onRender(this.render),this.gameLoop.start(),Q.play("assets/sounds/sfx/ui/galaxymap_00.wav","sfx",{maxSimultaneous:1})}stop(){this.galaxyMapController.destroy(),this.gameLoop.offUpdate(this.update),this.gameLoop.offRender(this.render)}}class x1{constructor(e,i,n,r,c={}){this.x=e,this.y=i,this.width=n,this.height=r,this.options=c,this.scanlineOffset=0,this.lastTime=0}update(e){this.lastTime===0&&(this.lastTime=e);const i=e-this.lastTime;this.lastTime=e;const n=this.options.scanlineSpacing??6;this.scanlineOffset=(this.scanlineOffset+i*.03)%n}draw(e,i=1){const{borderRadius:n=10,backgroundColor:r="#000a00",borderColor:c="#00ff41",glowColor:h="#00ff41",alpha:u=1,scanlineSpacing:d=6,backgroundGradient:g}=this.options;e.save(),e.globalAlpha=u;let m=r;if(g){const{type:y,stops:v,from:M=[this.x,this.y],to:b=[this.x+this.width*i,this.y+this.height*i],radius:C=this.width*i/2}=g,w=y==="linear"?e.createLinearGradient(M[0],M[1],b[0],b[1]):e.createRadialGradient(M[0],M[1],0,M[0],M[1],C);for(const A of v)w.addColorStop(A.offset,A.color);m=w}e.fillStyle=m,e.strokeStyle=c,e.lineWidth=2,e.shadowColor=h,e.shadowBlur=12,e.beginPath(),e.roundRect(this.x,this.y,this.width*i,this.height*i,n),e.fill(),e.stroke(),e.shadowBlur=0,e.globalAlpha=.06,e.fillStyle=h;for(let y=-this.scanlineOffset;y<this.height*i;y+=d)e.fillRect(this.x,this.y+y,this.width*i,1);e.restore()}}function Rt(a,e,i,n,r={},c=1){const{font:h='14px "Courier New", monospace',color:u="#00ff41",glow:d=!0,chromaticAberration:g=!0,align:m="left",baseline:y="top"}=r,v=h.replace(/(\d+)(px)/,(b,C,w)=>`${Math.round(parseInt(C)*c)}${w}`),M=.5*c;a.save(),a.font=v,a.textAlign=m,a.textBaseline=y,d&&(a.shadowColor=u,a.shadowBlur=4*c),g&&(a.save(),a.shadowBlur=0,a.globalAlpha=.25,a.fillStyle="#ff0000",a.fillText(n,e-M,i),a.fillStyle="#0000ff",a.fillText(n,e+M,i),a.restore()),a.globalAlpha=1,a.fillStyle=u,a.fillText(n,e,i),a.restore()}class Yh{constructor(e,i,n=0){this.fullText=e,this.baseDelayMs=i,this.jitter=n,this.currentLength=0,this.startTime=0,this.isFinished=!1,this.schedule=[]}start(e){this.startTime=e,this.currentLength=0,this.isFinished=!1,this.schedule=[];let i=0;for(let n=0;n<this.fullText.length;n++){const r=this.baseDelayMs+(Math.random()*2-1)*this.jitter;i+=Math.max(0,r),this.schedule.push(i)}}update(e){if(this.isFinished)return;const i=e-this.startTime;for(;this.currentLength<this.schedule.length&&i>=this.schedule[this.currentLength];)this.currentLength++;this.currentLength>=this.fullText.length&&(this.currentLength=this.fullText.length,this.isFinished=!0)}getText(){return this.fullText.slice(0,this.currentLength)}done(){return this.isFinished}}function D1(a,e="monospace"){return`${Math.round(aa(a))}px ${e}`}class P1{constructor(){this.phase="loginPrompt",this.timer=0,this.lastTime=0,this.username=new Yh("Shipwright SecondClass",30,40),this.password=new Yh("************",60,20),this.bootText=new Yh("VIEW_PASSIVES()    ",50,1),this.delayAfterPhaseComplete=600}update(e){const i=e-this.lastTime;switch(this.lastTime=e,this.timer+=i,this.phase){case"usernameInput":this.username.update(e),this.username.done()&&this.timer>this.delayAfterPhaseComplete&&this.advance("passwordPrompt");break;case"passwordInput":this.password.update(e),this.password.done()&&this.timer>this.delayAfterPhaseComplete&&this.advance("clear1");break;case"bootMessage":this.bootText.update(e),this.bootText.done()&&this.timer>this.delayAfterPhaseComplete&&this.advance("clear2");break}}draw(e){const i=au(300);let n=aa(160);const r={font:D1(18),color:"#00ff41",glow:!0,chromaticAberration:!0};switch(e.save(),e.fillStyle="#000",e.restore(),this.phase){case"loginPrompt":Rt(e,i,n,"login:",r),this.advance("usernameInput");break;case"usernameInput":Rt(e,i,n,"login: "+this.username.getText(),r);break;case"passwordPrompt":Rt(e,i,n,"login: Shipwright SecondClass",r),n+=aa(32),Rt(e,i,n,"password:",r),this.advance("passwordInput");break;case"passwordInput":Rt(e,i,n-aa(32),"login: Shipwright SecondClass",r),Rt(e,i,n,"password: "+this.password.getText(),r);break;case"clear1":this.advance("bootMessage");break;case"bootMessage":Rt(e,i,n,this.bootText.getText(),r);break;case"clear2":this.advance("done");break}}advance(e){this.phase=e,this.timer=0;const i=performance.now();e==="usernameInput"&&this.username.start(i),e==="passwordInput"&&this.password.start(i),e==="bootMessage"&&this.bootText.start(i)}isComplete(){return this.phase==="done"}}function qh(a,e,i=1){const{x:n,y:r,width:c,height:h,label:u,isHovered:d,style:g={}}=e,{backgroundColor:m="#001100",borderColor:y="#00ff41",textColor:v="#00ff41",font:M='13px "Courier New", monospace',glow:b=!0,chromaticAberration:C=!0,alpha:w=1}=g,A=c*i,R=h*i,I=M.replace(/(\d+)(px)/,(q,ie,ee)=>`${Math.round(parseInt(ie)*i)}${ee}`),_=.8,x=d?Vi(y,_):y,N=d?Vi(v,_):v;a.save(),a.globalAlpha=w,a.fillStyle=m,a.fillRect(n,r,A,R),b&&(a.shadowColor=x,a.shadowBlur=8*i),a.strokeStyle=x,a.lineWidth=2*i,a.strokeRect(n,r,A,R),a.restore();const W=n+A/2,z=r+R/2;a.save(),a.font=I,a.textAlign="center",a.textBaseline="middle",b&&(a.shadowColor=N,a.shadowBlur=4*i),C&&(a.save(),a.globalAlpha=.25,a.shadowBlur=0,a.fillStyle="#ff0000",a.fillText(u,W-.5*i,z),a.fillStyle="#0000ff",a.fillText(u,W+.5*i,z),a.restore()),a.globalAlpha=1,a.fillStyle=N,a.fillText(u,W,z),a.restore()}const sp={offense:"Offense",defense:"Defense",utility:"Utility"},L1={"harvester-range":{label:"Harvester Range",category:"utility",tiers:{1:20,2:40,3:60},unit:"%"},"laser-damage":{label:"Laser Damage",category:"offense",tiers:{1:5,2:10,3:15},unit:"%"},"laser-energy-drain":{label:"Laser Energy Drain",category:"offense",tiers:{1:-10,2:-20,3:-30},unit:"%"},"laser-block-cost":{label:"Laser Block Cost",category:"offense",tiers:{1:-10,2:-20,3:-30},unit:"%"},"explosive-lance-radius":{label:"Explosive Lance Radius",category:"offense",tiers:{1:1,2:2,3:3}},"explosive-lance-firing-rate":{label:"Explosive Lance Firing Rate",category:"offense",tiers:{1:5,2:10,3:15},unit:"%"},"block-durability":{label:"Block Durability",category:"defense",tiers:{1:5,2:10,3:15},unit:"%"},"fin-turn-power":{label:"Fin Turn Power",category:"utility",tiers:{1:10,2:20,3:30},unit:"%"},"engine-thrust":{label:"Engine Thrust",category:"utility",tiers:{1:10,2:20,3:30},unit:"%"},"charger-rate":{label:"Charger Rate",category:"utility",tiers:{1:10,2:20,3:30},unit:"%"},"battery-capacity":{label:"Battery Capacity",category:"utility",tiers:{1:10,2:20,3:30},unit:"%"},"turret-firing-rate":{label:"Turret Firing Rate",category:"offense",tiers:{1:5,2:10,3:15},unit:"%"},"turret-damage":{label:"Turret Damage",category:"offense",tiers:{1:5,2:10,3:15},unit:"%"},"turret-accuracy":{label:"Turret Accuracy",category:"offense",tiers:{1:10,2:20,3:30},unit:"%"},"shield-energy-drain":{label:"Shield Energy Drain",category:"defense",tiers:{1:-10,2:-20,3:-30},unit:"%"},"shield-radius":{label:"Shield Radius",category:"defense",tiers:{1:1,2:2,3:3}},"shield-efficiency":{label:"Shield Efficiency",category:"defense",tiers:{1:10,2:20,3:30},unit:"%"},"facetplate-armor":{label:"Facetplate Armor",category:"defense",tiers:{1:10,2:20,3:30},unit:"%"},"hull-armor":{label:"Hull Armor",category:"defense",tiers:{1:10,2:20,3:30},unit:"%"},"hull-mass":{label:"Hull Mass",category:"utility",tiers:{1:-10,2:-20,3:-30},unit:"%"},"cockpit-armor":{label:"Cockpit Armor",category:"defense",tiers:{1:30,2:60,3:100}},"block-repair-cost":{label:"Block Repair Cost",category:"utility",tiers:{1:-10,2:-20,3:-30},unit:"%"},"entropium-pickup-bonus":{label:"Entropium Pickup Bonus",category:"utility",tiers:{1:5,2:10,3:15},unit:"%"},"block-drop-rate":{label:"Block Drop Rate",category:"utility",tiers:{1:10,2:20,3:30},unit:"%"}};class O1{constructor(e,i,n){this.inputManager=e,this.passiveManager=i,this.bounds=n,this.scrollOffset=0,this.baseScrollSpeed=40,this.isDraggingThumb=!1,this.thumbDragOffsetY=0,this.contentHeight=0,this.activeButtons=[]}update(){const e=ne(),i=Math.floor(this.baseScrollSpeed*e),n=Math.floor(28*e),r=Math.floor(24*e),c=this.bounds.x+this.bounds.width-n,h=Math.max(0,this.contentHeight-this.bounds.height);(this.inputManager.wasScrollWheelDown()||this.inputManager.isKeyPressed("KeyS"))&&(this.scrollOffset=Math.min(this.scrollOffset+i,h)),(this.inputManager.wasScrollWheelUp()||this.inputManager.isKeyPressed("KeyW"))&&(this.scrollOffset=Math.max(0,this.scrollOffset-i));const{x:u,y:d}=this.inputManager.getMousePosition(),g=this.inputManager.wasMouseClicked(),m=this.inputManager.isKeyPressed("MouseLeft"),y=this.inputManager.wasKeyJustReleased("MouseLeft"),v=this.inputManager.wasKeyJustPressed("MouseLeft"),M=this.bounds.y+r,b=this.bounds.height-r*2,C=this.bounds.height/Math.max(this.contentHeight,1),w=Math.max(Math.floor(30*e),C*b),A=c+Math.floor(2*e),R=M+this.scrollOffset/h*(b-w),I=u>=A&&u<=A+(n-Math.floor(4*e))&&d>=R&&d<=R+w;if(v&&I&&(this.isDraggingThumb=!0,this.thumbDragOffsetY=d-R),this.isDraggingThumb&&m){const _=d-this.bounds.y-r-this.thumbDragOffsetY,x=b-w;if(x>0){const N=Math.floor(32*e),W=Math.max(0,this.contentHeight-this.bounds.height),z=Math.round(W/N)*N,ee=Math.max(0,Math.min(x,_))/x*z,K=Math.round(ee/N)*N;this.scrollOffset=Math.min(K,z)}else this.scrollOffset=0}y&&(this.isDraggingThumb=!1);for(const _ of this.activeButtons)if(_.isHovered=u>=_.x&&u<=_.x+_.width&&d>=_.y&&d<=_.y+_.height,_.isHovered&&g){_.onClick();break}}render(e){const i=ne(),{x:n,y:r,width:c,height:h}=this.bounds;e.save(),e.beginPath(),e.rect(n,r,c,h),e.clip();let u=r-this.scrollOffset;const d=Math.floor(32*i),g=Math.floor(28*i),m=Math.floor(70*i),y=n+Math.floor(320*i),v=Math.floor(28*i),M=Math.floor(24*i),b=n+c-v;this.activeButtons=[];let C=0;for(const q of Object.keys(sp)){const ie=sp[q];Rt(e,n+d,u,ie.toUpperCase(),{font:`${Math.floor(18*i)}px monospace`,color:"#00ff00"}),u+=g;for(const[ee,K]of Object.entries(L1)){if(K.category!==q)continue;const le=this.passiveManager.getPassiveTier(ee);Rt(e,n+d,u,K.label,{font:`${Math.floor(15*i)}px monospace`,color:"#ffffff"});let Z=0;for(const k of[1,2,3]){const J=`${K.tiers[k]}${K.unit??""}`,$=y+Z*m;Rt(e,$,u,J,{font:`${Math.floor(15*i)}px monospace`,color:le!==null&&k<=le?"#00ff41":"#666666"}),Z++}const se=(le??0)+1;se<=3&&this.passiveManager.canAfford(se);let D=y+3*m+Math.floor(10*i);const X=se<=3,te=X?this.passiveManager.getUpgradeCost(se,le):0,ae=X&&this.passiveManager.canAfford(se);if(X){const k={x:D,y:u-Math.floor(2*i),width:Math.floor(30*i),height:Math.floor(20*i),label:"+",onClick:ae?()=>{this.passiveManager.setPassiveTier(ee,se)}:()=>{},style:{font:`${Math.floor(14*i)}px monospace`,backgroundColor:"#111111",borderColor:ae?"#00ff00":"#444444",textColor:ae?"#00ff00":"#666666",alpha:.8,glow:ae,chromaticAberration:ae}};this.activeButtons.push(k),qh(e,k),Rt(e,k.x+k.width+Math.floor(8*i),u,`Cost: ${te}`,{font:`${Math.floor(13*i)}px monospace`,color:ae?"#00ff00":"#666666"}),D=k.x+k.width+Math.floor(80*i)}if(C===0){const k=this.passiveManager.getAvailablePoints();Rt(e,D,u,`Passive Licenses: ${k}`,{font:`${Math.floor(14*i)}px monospace`,color:"#00ff00"})}C++,u+=g}u+=Math.floor(6*i)}this.contentHeight=u-r;const w=Math.max(0,this.contentHeight-h);this.scrollOffset=Math.min(this.scrollOffset,w),e.restore(),e.save();const A=Math.floor(this.baseScrollSpeed*i),R={x:b,y:r+Math.floor(32*i),width:v,height:M,label:"▲",onClick:()=>{this.scrollOffset=Math.max(0,this.scrollOffset-A)},style:{font:`${Math.floor(13*i)}px monospace`,backgroundColor:"#001100",borderColor:"#00ff00",textColor:"#00ff00",alpha:1,glow:!0,chromaticAberration:!0}},I={x:b,y:r+h-M-Math.floor(32*i),width:v,height:M,label:"▼",onClick:()=>{this.scrollOffset=Math.min(this.scrollOffset+A,w)},style:R.style};this.activeButtons.push(R,I),qh(e,R),qh(e,I);const _=r+M+Math.floor(32*i),x=h-M*2-Math.floor(64*i),N=h/Math.max(this.contentHeight,1),W=Math.max(Math.floor(30*i),N*x),z=_+this.scrollOffset/w*(x-W);e.fillStyle="#00ff00",e.globalAlpha=.3,e.fillRect(b+Math.floor(2*i),z,v-Math.floor(4*i),W),e.restore()}}const F1="assets/hub/backgrounds/scene_passives-menu.png";class U1{constructor(e,i,n){this.backgroundImage=null,this.dialogueQueueManager=null,this.loopSoundStopped=!1,this.update=()=>{var y;const u=performance.now();this.inputManager.updateFrame(),this.crtMonitor.update(u),this.introAnimationController.update(u);const{x:d,y:g}=this.inputManager.getMousePosition(),m=this.inputManager.wasMouseClicked();if(this.introAnimationController.isComplete()){if(this.dialogueQueueManager&&!this.dialogueQueueManager.isRunning()&&!Be.has("hub.introduction-2.complete")){const v=rn("hub-introduction-2",{inputManager:this.inputManager});v&&this.dialogueQueueManager.startScript(v)}(y=this.dialogueQueueManager)!=null&&y.isRunning()&&(this.dialogueQueueManager.update(this.gameLoop.getDeltaTime()),m&&this.dialogueQueueManager.skipOrAdvance());for(const v of this.buttons)Bs(v,d,g,m,ne());this.inputManager.wasKeyJustPressed("KeyP")&&ct.getInstance().addPassivePoints(1),this.inputManager.wasKeyJustPressed("KeyR")&&ct.getInstance().refundAll(),this.passiveMenuManager.update()}},this.render=()=>{var M;this.canvasManager.clearAll();const u=this.canvasManager.getContext("background"),d=this.canvasManager.getContext("ui"),g=this.canvasManager.getContext("overlay"),{x:m,y}=this.inputManager.getMousePosition();if(this.backgroundImage&&u.drawImage(this.backgroundImage,0,0,u.canvas.width,u.canvas.height),this.crtMonitor.draw(d),!this.introAnimationController.isComplete())this.introAnimationController.draw(g);else{if(this.loopSoundStopped||(Q.stopLoop("assets/sounds/sfx/ui/typing_00.wav"),this.loopSoundStopped=!0),!((M=this.dialogueQueueManager)!=null&&M.isRunning()))for(const b of this.buttons)ht(d,b,ne());this.dialogueQueueManager&&this.dialogueQueueManager.render(g),this.passiveMenuManager.render(d)}const v=nn();oa(d,v,m,y,ne())},this.canvasManager=e,this.gameLoop=i,this.inputManager=n;const r={borderRadius:10,alpha:.85,borderColor:"#00ff00",textFont:"18px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}};this.buttons=[{x:20,y:20,width:120,height:50,label:"← Back",isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:4}),this.stop(),vt.fadeToScene("hub")},style:r}];const c=sl({x:275,y:98,width:885,height:542});this.crtMonitor=new x1(c.x,c.y,c.width,c.height,{alpha:.95,borderRadius:60,borderColor:"#00ff33",glowColor:"#00ff33",scanlineSpacing:6,backgroundGradient:{type:"linear",stops:[{offset:0,color:"#000900"},{offset:1,color:"#000000"}]}});const h=sl({x:285,y:108,width:865,height:522});this.passiveMenuManager=new O1(this.inputManager,ct.getInstance(),h),this.introAnimationController=new P1}async start(){Q.startLoop("assets/sounds/sfx/ui/typing_00.wav","sfx",{volume:1,pitch:1,pan:0}),this.backgroundImage=await ra(F1),this.gameLoop.onUpdate(this.update),this.gameLoop.onRender(this.render),this.gameLoop.start(),this.dialogueQueueManager=Mo.create()}stop(){this.gameLoop.offUpdate(this.update),this.gameLoop.offRender(this.render)}}const np=800;class Mu{constructor(e,i,n){this.inputManager=i,this.playerShip=n,this.cursorWorldPos={x:0,y:0},this.hasInitializedCursor=!1,this.cursorChangeHandler=r=>this.setCursorFromType(r.type),this.cursorRestoreHandler=()=>this.setDefaultCursor(),this.camera=n?Ct.getInstance():null,this.cursorSprite=nn(),this.ctx=e.getContext("overlay"),Ee.on("cursor:change",this.cursorChangeHandler),Ee.on("cursor:restore",this.cursorRestoreHandler)}render(){if(!this.cursorSprite)return;const e=ne(),i=It.getInstance().getLastUsed();if(i==="keyboard"||i==="mouse"){const n=this.inputManager.getMousePosition();oa(this.ctx,this.cursorSprite,n.x,n.y,e);return}if(i==="gamepad"){if(!this.playerShip)return;const n=this.inputManager.getGamepadAimVector(),r=n.x!==0||n.y!==0,c=this.playerShip.getTransform(),h=c.position,u=r?n:{x:Math.cos(c.rotation-Math.PI/2),y:Math.sin(c.rotation-Math.PI/2)},d=h.x+u.x*np,g=h.y+u.y*np;if(this.hasInitializedCursor?(this.cursorWorldPos.x+=(d-this.cursorWorldPos.x)*.25,this.cursorWorldPos.y+=(g-this.cursorWorldPos.y)*.25):(this.cursorWorldPos.x=d,this.cursorWorldPos.y=g,this.hasInitializedCursor=!0),!this.camera)return;const m=this.camera.worldToScreen(this.cursorWorldPos.x,this.cursorWorldPos.y);oa(this.ctx,this.cursorSprite,m.x,m.y,e)}}setCursorFromType(e){switch(e){case"crosshair":this.setCrosshairCursor();break;case"target":this.setTargetCrosshairCursor();break;case"hovered":this.setHoveredCursor();break;case"wrench":this.setWrenchCursor();break;case"up":this.setUpCursor();break;case"right":this.setRightCursor();break;case"down":this.setDownCursor();break;case"left":this.setLeftCursor();break;case"small-circle":this.setSmallCircleCursor();break}}setCursorSprite(e){this.cursorSprite=e}setDefaultCursor(){this.setCursorSprite(nn())}setCrosshairCursor(){this.setCursorSprite(nn())}setTargetCrosshairCursor(){this.setCursorSprite(gS())}setHoveredCursor(){this.setCursorSprite(vu())}setWrenchCursor(){this.setCursorSprite(SS())}setArrowCursor(e){this.setCursorSprite(bS(e))}setUpCursor(){this.setArrowCursor("up")}setRightCursor(){this.setArrowCursor("right")}setDownCursor(){this.setArrowCursor("down")}setLeftCursor(){this.setArrowCursor("left")}setSmallCircleCursor(){this.setCursorSprite(MS())}destroy(){Ee.off("cursor:change",this.cursorChangeHandler),Ee.off("cursor:restore",this.cursorRestoreHandler)}}const N1="assets/hub/backgrounds/scene_break-room.png";class H1{constructor(e,i,n){this.backgroundImage=null,this.dialogueQueueManager=null,this.update=()=>{var d;this.inputManager.updateFrame();const{x:c,y:h}=this.inputManager.getMousePosition(),u=this.inputManager.wasMouseClicked();if((d=this.dialogueQueueManager)!=null&&d.isRunning()){this.dialogueQueueManager.update(this.gameLoop.getDeltaTime()),u&&this.dialogueQueueManager.skipOrAdvance();return}Bs(this.buttons[0],c,h,u,ne())},this.render=()=>{var d;this.canvasManager.clearAll();const c=this.canvasManager.getContext("background"),h=this.canvasManager.getContext("ui"),u=this.canvasManager.getContext("overlay");if(this.backgroundImage&&c.drawImage(this.backgroundImage,0,0,c.canvas.width,c.canvas.height),!((d=this.dialogueQueueManager)!=null&&d.isRunning()))for(const g of this.buttons)ht(h,g,ne());this.dialogueQueueManager&&this.dialogueQueueManager.render(u),this.cursorRenderer.render()},this.canvasManager=e,this.gameLoop=i,this.inputManager=n,this.cursorRenderer=new Mu(e,n,null);const r={borderRadius:10,alpha:.85,borderColor:"#00ff00",textFont:"18px monospace",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}};this.buttons=[{x:20,y:20,width:120,height:50,label:"← Back",isHovered:!1,onClick:()=>{Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:4}),this.stop(),vt.fadeToScene("hub")},style:r}]}async start(){this.backgroundImage=await ra(N1),this.dialogueQueueManager=Mo.create();const e=rn("test-script",{});e&&this.dialogueQueueManager.startScript(e),this.gameLoop.onUpdate(this.update),this.gameLoop.onRender(this.render),this.gameLoop.start()}stop(){this.gameLoop.offUpdate(this.update),this.gameLoop.offRender(this.render),this.cursorRenderer.destroy()}}function He(a,e,i,n,r,c=1){const{font:h="12px monospace",align:u="left",alpha:d=1,shadowBlur:g=0,shadowColor:m="",glow:y=!1,color:v="#00ff00"}=r??{},M=h.replace(/(\d+)(px)/,(b,C,w)=>`${Math.round(parseInt(C)*c)}${w}`);if(a.save(),a.globalAlpha=d,a.font=M,a.textAlign=u,a.textBaseline="top",y?(a.shadowBlur=6*c,a.shadowColor="#00ff00"):g>0&&m&&(a.shadowBlur=g*c,a.shadowColor=m),typeof n=="string")a.fillStyle=v,a.fillText(n,e,i);else{let b=e;for(const C of n)a.fillStyle=C.color??v,a.fillText(C.text,b,i),b+=a.measureText(C.text).width}a.restore()}class ap{constructor(e,i,n,r,c=.8){this.timer=0,this.triggered=!1,this.text=e,this.x=i,this.y=n,this.options=r,this.duration=c}trigger(){this.timer=0,this.triggered=!0}update(e){this.triggered&&(this.timer+=e)}render(e,i){if(!this.triggered)return;const n=Math.min(this.timer/this.duration,1),r=n*n*(3-2*n),c=r,h=1+(1-r)*.4;e.save(),e.translate(this.x,this.y),e.scale(h,h),He(e,0,0,this.text,{...this.options,align:"center",alpha:c},i),e.restore()}hasCompleted(){return this.triggered&&this.timer>=this.duration}}function W1(){const a=Ce.get();return{fromWaves:a.wavesCleared*3,fromKills:Math.floor(a.enemiesDestroyed/25),fromBlocks:Math.floor(a.blocksCollected/100),fromCurrency:Math.floor(a.currencyGathered/1e3),fromMass:Math.floor(a.massAchieved/2e3),fromIncidents:a.incidentsCompleted,fromVictory:a.outcome==="victory"?5:0}}let Zn=null,he=null;function z1(a,e,i,n,r=1){if(!Zn){Zn=document.createElement("canvas"),Zn.width=64,Zn.height=64,he=Zn.getContext("2d"),he.clearRect(0,0,64,64),he.save();const c=32,h=32,u=28,d=he.createRadialGradient(c,h,u*.7,c,h,u);d.addColorStop(0,"#00ffff"),d.addColorStop(.8,"#0088ff"),d.addColorStop(1,"#0044aa"),he.strokeStyle=d,he.lineWidth=3,he.shadowColor="#00ffff",he.shadowBlur=8,he.beginPath(),he.arc(c,h,u,0,Math.PI*2),he.stroke();const g=he.createRadialGradient(c,h,0,c,h,u*.6);g.addColorStop(0,"#ffffff"),g.addColorStop(.3,"#00ffff"),g.addColorStop(.7,"#0088ff"),g.addColorStop(1,"#003366"),he.fillStyle=g,he.shadowBlur=12,he.beginPath(),he.arc(c,h,u*.6,0,Math.PI*2),he.fill(),he.strokeStyle="#ffffff",he.lineWidth=1.5,he.shadowBlur=4;for(let M=0;M<6;M++){const b=M*Math.PI/3,C=c+Math.cos(b)*u*.3,w=h+Math.sin(b)*u*.3,A=c+Math.cos(b)*u*.5,R=h+Math.sin(b)*u*.5;he.beginPath(),he.moveTo(C,w),he.lineTo(A,R),he.stroke()}const m=he.createRadialGradient(c,h,0,c,h,6);m.addColorStop(0,"#ffffff"),m.addColorStop(.5,"#00ffff"),m.addColorStop(1,"#0088ff"),he.fillStyle=m,he.shadowColor="#ffffff",he.shadowBlur=6,he.beginPath(),he.arc(c,h,4,0,Math.PI*2),he.fill(),he.strokeStyle="#00ffff",he.lineWidth=2,he.shadowBlur=4;const y=8,v=6;he.beginPath(),he.moveTo(v,v+y),he.lineTo(v,v),he.lineTo(v+y,v),he.stroke(),he.beginPath(),he.moveTo(64-v-y,v),he.lineTo(64-v,v),he.lineTo(64-v,v+y),he.stroke(),he.beginPath(),he.moveTo(64-v,64-v-y),he.lineTo(64-v,64-v),he.lineTo(64-v-y,64-v),he.stroke(),he.beginPath(),he.moveTo(v+y,64-v),he.lineTo(v,64-v),he.lineTo(v,64-v-y),he.stroke(),he.restore()}a.save(),a.globalAlpha=r,a.drawImage(Zn,e,i,n,n),a.restore()}class G1{constructor(e,i,n,r,c){this.phase="hidden",this.settleTimer=0,this.cores=[],this.isFloating=!1,this.floatTimer=0,this.settleDuration=.2,this.overshoot=20,this.pulseTimer=0,this.PULSE_DURATION=.5,this.targetX=e,this.y=i,this.width=n,this.height=r,this.x=e+200,this.slideSpeed=c??1200}trigger(){this.phase==="hidden"&&(this.phase="sliding-in")}setFloatingState(){this.isFloating=!0,this.floatTimer=0}update(e){switch(this.phase){case"sliding-in":{const i=this.targetX+this.overshoot,n=Math.sign(i-this.x);this.x+=n*this.slideSpeed*e,(n>0&&this.x>=i||n<0&&this.x<=i)&&(this.x=i,this.phase="settling",this.settleTimer=this.settleDuration);break}case"settling":{this.settleTimer-=e;const i=1-Math.max(0,this.settleTimer/this.settleDuration);this.x=this.targetX+this.overshoot*(1-i),this.settleTimer<=0&&(this.x=this.targetX,this.phase="appeared");break}}this.pulseTimer>0&&(this.pulseTimer-=e,this.pulseTimer<0&&(this.pulseTimer=0)),this.isFloating&&(this.floatTimer+=e)}render(e){if(this.phase==="hidden")return;const i=ne(),n=this.x,r=this.y,c=this.width*i,h=this.height*i;e.save(),e.lineWidth=2*i,e.strokeStyle="#00ff00",e.shadowBlur=6*i,e.shadowColor="#00ff00",e.globalAlpha=1,e.strokeRect(n,r,c,h);const u=`Cores Generated: ${this.cores.length}`,d=this.pulseTimer>0?this.pulseTimer/this.PULSE_DURATION:0,g=this.isFloating?.5+.5*Math.sin(this.floatTimer*3):0,m=6*i*(1+d*2+g);e.font=`${Math.round(18*i*(1+.1*d))}px monospace`,e.fillStyle="#00ff00",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="#00ff00",e.shadowBlur=m;const y=n+c/2,v=r-8*i;e.fillText(u,y,v);const M=16*i,b=12*i,C=32*i,w=4*i,A=c-2*M,R=this.cores.length;if(R>0){let I=C+w;R*C+(R-1)*w>A&&(I=(A-C)/(R-1));const x=C+(R-1)*I,N=n+M+(A-x)/2,W=r+b;for(let z=0;z<R;z++){const q=N+z*I,ie=this.isFloating?4*i*Math.sin(this.floatTimer*2+z*.6):0;z1(e,q,W+ie,C,1)}}e.restore()}addCore(){this.cores.push(this.cores.length),this.pulseTimer=this.PULSE_DURATION}isAppeared(){return this.phase==="appeared"}forceCoreCount(e){this.cores=[];for(let i=0;i<e;i++)this.cores.push(i);this.pulseTimer=0}}class V1{constructor(e,i,n,r){var u;this.phase="hidden",this.settleTimer=0,this.settleDuration=.2,this.overshoot=20,this.isActive=!1,this.originalText=e,this.targetX=i,this.y=n,this.slideSpeed=r??1200;const c=ne();this.x=i-200*c;const h=e.split(":");this.labelPrefix=h[0].trim(),this.displayedValue=parseInt(((u=h[1])==null?void 0:u.trim())??"0")}trigger(){this.phase==="hidden"&&(this.phase="sliding-in")}setActive(e){this.isActive=e}update(e){switch(this.phase){case"sliding-in":{const i=this.targetX+this.overshoot,n=Math.sign(i-this.x);this.x+=n*this.slideSpeed*e,(n>0&&this.x>=i||n<0&&this.x<=i)&&(this.x=i,this.phase="settling",this.settleTimer=this.settleDuration);break}case"settling":{this.settleTimer-=e;const i=1-Math.max(0,this.settleTimer/this.settleDuration);this.x=this.targetX+this.overshoot*(1-i),this.settleTimer<=0&&(this.x=this.targetX,this.phase="appeared");break}}}render(e){if(this.phase==="hidden")return;const i=ne();He(e,this.x*i,this.y*i,this.getRenderedText(),{font:`${Math.round(18*i)}px monospace`,color:this.isActive?"#ffffff":"#00ff00",glow:!0,align:"left"})}getRenderedText(){return`${this.labelPrefix}: ${this.displayedValue}`}decrementDynamic(e){return this.displayedValue<=0?!1:(this.displayedValue=Math.max(0,this.displayedValue-e),!0)}isAppeared(){return this.phase==="appeared"}}const op=200,rp=50,X1=300,Y1=160,q1=28,lp=520,j1=60;Ce.initialize();Ce.get().outcome="victory";Ce.incrementBlockCollectedCount(220);Ce.incrementWavesCleared(3);Ce.incrementKillCount(100);Ce.addCurrency(4542);Ce.incrementMassAchieved(4040);Ce.incrementIncidentsCompleted(2);class Z1{constructor(e,i,n){var I;this.state="reveal",this.flyInLabels=[],this.labelRevealTimer=1,this.nextLabelIndex=0,this.summaryBox=null,this.boxTriggered=!1,this.coresToAdd=[],this.tallyIndex=0,this.tallyTimer=0,this.tallyPitchAdd=0,this.totalCores=0,this.coresAdded=0,this.currentDecrement=1,this.decrementAcceleration=1.2,this.shipJsonLoaded=!1,this.missionResult=null,this.initialBlackoutTimer=1.2,this.introDelayTimer=1.2,this.update=()=>{var q;const _=this.gameLoop.getDeltaTime();if(this.initialBlackoutTimer>0){this.initialBlackoutTimer-=_;return}if(this.introDelayTimer>0){this.introDelayTimer-=_,this.introDelayTimer<=0&&(this.headerLabel.trigger(),this.subtitleLabel.trigger());return}const x=ne();this.inputManager.updateFrame();const{x:N,y:W}=this.inputManager.getMousePosition(),z=this.inputManager.wasMouseClicked();Bs(this.buttons[0],N,W,z,x),this.state==="reveal"?this.updateReveal(_):this.state==="tally"&&this.updateTally(_),this.headerLabel.update(_),this.subtitleLabel.update(_);for(const ie of this.flyInLabels)ie.update(_);(q=this.summaryBox)==null||q.update(_)},this.render=()=>{var N;if(this.initialBlackoutTimer>0)return;this.canvasManager.clearAll();const _=this.canvasManager.getContext("ui"),x=ne();if(this.headerLabel.render(_,x),this.subtitleLabel.render(_,x),!!this.hasHeaderFinished()){for(const W of this.flyInLabels)W.render(_);(N=this.summaryBox)==null||N.render(_);for(const W of this.buttons)ht(_,W);this.cursorRenderer.render()}},this.canvasManager=e,this.gameLoop=i,this.inputManager=n,this.cursorRenderer=new Mu(e,n,null),this.missionResult=Ce.get().outcome;const r=W1(),c=Object.values(r).reduce((_,x)=>_+x,0);yt.getInstance().addMetaCurrency(c),this.missionResult==="victory"?(Q.play("assets/sounds/sfx/debriefing/debriefing_succeeded_00.wav","sfx"),Q.playMusic({file:"assets/sounds/music/track_06_mission4.mp3"})):(Q.play("assets/sounds/sfx/debriefing/debriefing_failed_00.wav","sfx"),Q.playMusic({file:"assets/sounds/music/track_06_mission4.mp3"}));const h=ne(),u=ri(),d=bi(),g={borderRadius:10,alpha:.85,borderColor:"#00ff00",textFont:`${Math.round(18*h)}px monospace`,backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}};this.buttons=[{x:u/2-op*h/2,y:d-80*h-rp*h/2,width:op*h,height:rp*h,label:"Return to Base",isHovered:!1,onClick:()=>{if(Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:4}),this.state!=="done"){this.skipToDone();return}kb(this.canvasManager.getWebGL2Context("unifiedgl2")),ii.getInstance().clearWebGL2Layer("unifiedgl2"),this.stop(),vt.fadeToScene("hub")},style:g}];const m="Mission Debriefing",y=((I=this.missionResult)==null?void 0:I.toUpperCase())??"ERROR";this.headerLabel=new ap(m,u/2,40*h,{align:"center",font:`${Math.round(36)}px monospace`,color:"#00ff00",glow:!0}),this.subtitleLabel=new ap(y,u/2,80*h,{align:"center",font:`${Math.round(24)}px monospace`,color:this.missionResult==="victory"?"#00ff00":"#ff0000",glow:!0});const v=Y1,M=q1,b=X1,C=Ce.get(),w=[[`Waves Cleared: ${C.wavesCleared}`,r.fromWaves],[`Enemies Destroyed: ${C.enemiesDestroyed}`,r.fromKills],[`Blocks Collected: ${C.blocksCollected}`,r.fromBlocks],[`Entropium Gathered: ${C.currencyGathered}`,r.fromCurrency],[`Mass Achieved: ${C.massAchieved}`,r.fromMass],[`Incidents Completed: ${C.incidentsCompleted}`,r.fromIncidents]];this.missionResult==="victory"&&w.push(["Victory Bonus: 1000",r.fromVictory]),this.flyInLabels=w.map(([_],x)=>new V1(_,b,v+x*M)),this.coresToAdd=w.map(([_,x])=>x);const A=u/2-lp*h/2,R=d-220*h;this.summaryBox=new G1(A,R,lp,j1)}start(){this.gameLoop.onUpdate(this.update),this.gameLoop.onRender(this.render),this.gameLoop.start()}stop(){var e;this.gameLoop.offUpdate(this.update),this.gameLoop.offRender(this.render),this.cursorRenderer.destroy(),(e=this.previewRenderer)==null||e.destroy()}updateReveal(e){var i,n;this.labelRevealTimer-=e,this.labelRevealTimer<=0&&this.nextLabelIndex<this.flyInLabels.length&&(Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:5}),Q.play("assets/sounds/sfx/debriefing/debriefing_whoosh_00.wav","sfx",{maxSimultaneous:5}),Q.play("assets/sounds/sfx/debriefing/debriefing_whoosh_01.wav","sfx",{maxSimultaneous:5}),this.flyInLabels[this.nextLabelIndex].trigger(),this.nextLabelIndex++,this.labelRevealTimer=1),!this.boxTriggered&&this.nextLabelIndex===this.flyInLabels.length&&this.labelRevealTimer<=0&&((i=this.summaryBox)==null||i.trigger(),this.boxTriggered=!0),this.boxTriggered&&((n=this.summaryBox)!=null&&n.isAppeared())&&(this.beginTally(),this.state="tally")}beginTally(){var e;Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:10}),this.totalCores=this.coresToAdd.reduce((i,n)=>i+n,0),this.tallyIndex=0,this.tallyTimer=.5,this.currentDecrement=1,this.flyInLabels.forEach(i=>i.setActive(!1)),(e=this.flyInLabels[0])==null||e.setActive(!0)}updateTally(e){var c,h;if(this.tallyIndex>=this.coresToAdd.length){this.state="done",(c=this.summaryBox)==null||c.setFloatingState(),Q.play("assets/sounds/sfx/debriefing/debriefing_end_00.wav","sfx",{maxSimultaneous:2});return}if(this.tallyTimer-=e,this.tallyTimer>0)return;const i=this.coresToAdd[this.tallyIndex],n=this.flyInLabels[this.tallyIndex];n==null||n.setActive(!0),(n==null?void 0:n.decrementDynamic(Math.floor(this.currentDecrement)))??!1?(Q.play("assets/sounds/sfx/debriefing/debriefing_tally_01.wav","sfx",{maxSimultaneous:25,pitch:1+this.tallyPitchAdd}),this.currentDecrement*=this.decrementAcceleration,this.tallyTimer=.05,this.tallyPitchAdd-=.005):i>0?(Q.play("assets/sounds/sfx/debriefing/debriefing_addcores_00.wav","sfx",{maxSimultaneous:25}),(h=this.summaryBox)==null||h.addCore(),this.coresAdded++,this.coresToAdd[this.tallyIndex]--,this.tallyTimer=.15,this.currentDecrement=1):(Q.play("assets/sounds/sfx/ui/sub_00.wav","sfx",{maxSimultaneous:10}),n==null||n.setActive(!1),this.tallyIndex++,this.tallyPitchAdd=0,this.tallyIndex<this.flyInLabels.length&&this.flyInLabels[this.tallyIndex].setActive(!0),this.tallyTimer=.5,this.currentDecrement=1)}hasHeaderFinished(){return this.headerLabel.hasCompleted()&&this.subtitleLabel.hasCompleted()}skipToDone(){var i,n;for(const r of this.flyInLabels)r.trigger(),r.setActive(!1);this.summaryBox&&!this.boxTriggered&&(this.summaryBox.trigger(),this.boxTriggered=!0);const e=this.coresToAdd.reduce((r,c)=>r+c,0);(i=this.summaryBox)==null||i.forceCoreCount(e),this.coresAdded=e,this.coresToAdd=this.coresToAdd.map(()=>0),this.state="done",(n=this.summaryBox)==null||n.setFloatingState(),Q.play("assets/sounds/sfx/debriefing/debriefing_end_00.wav","sfx",{maxSimultaneous:2})}}class Js{constructor(){this.fadeAlpha=0,this.isFading=!1,this.fadeDuration=500,this.fadeStartTime=0,this.onComplete=null}static getInstance(){return Js.instance||(Js.instance=new Js),Js.instance}startFade(e,i=500){this.isFading||(this.isFading=!0,this.fadeDuration=i,this.fadeAlpha=0,this.fadeStartTime=performance.now(),this.onComplete=e)}update(){if(!this.isFading)return;const i=performance.now()-this.fadeStartTime,n=Math.min(i/this.fadeDuration,1);this.fadeAlpha=n,n>=1&&(this.isFading=!1,this.fadeAlpha=0,this.onComplete&&(this.onComplete(),this.onComplete=null))}render(){if(!this.isFading||this.fadeAlpha<=0)return;const e=ii.getInstance().getContext("overlay");e&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=`rgba(0, 0, 0, ${this.fadeAlpha})`,e.fillRect(0,0,e.canvas.width,e.canvas.height))}isFadeInProgress(){return this.isFading}}class K1{constructor(){this.currentScene=null,this.listeners=new Set,this.canvasManager=null,this.inputManager=null,this.gameLoop=new Jp,this.activeSceneManager=null;const e=Js.getInstance();this.gameLoop.onRender(()=>e.render()),this.gameLoop.onUpdate(()=>e.update())}ensureCanvasManager(){return this.canvasManager||(this.canvasManager=ii.getInstance()),this.canvasManager}ensureInputManager(){return this.inputManager||(this.canvasManager||(this.canvasManager=this.ensureCanvasManager()),this.inputManager=new $p(this.canvasManager.getCanvas("ui"))),this.inputManager}destroyTransientManagers(){this.inputManager&&(this.inputManager.destroy(),this.inputManager=null),this.canvasManager=null}setScene(e){if(Q.stopAllLoops(),this.currentScene!==e){switch(this.currentScene=e,this.activeSceneManager&&(this.activeSceneManager.stop(),this.activeSceneManager=null),e){case"title":{const i=new OS(this.ensureCanvasManager(),this.gameLoop,this.ensureInputManager());i.start(),this.activeSceneManager=i;break}case"hub":{const i=new f1(this.ensureCanvasManager(),this.gameLoop,this.ensureInputManager());i.start(),this.activeSceneManager=i;break}case"galaxy":{const i=new _1(this.ensureCanvasManager(),this.gameLoop,this.ensureInputManager());i.start(),this.activeSceneManager=i;break}case"passives":{const i=new U1(this.ensureCanvasManager(),this.gameLoop,this.ensureInputManager());i.start(),this.activeSceneManager=i;break}case"breakroom":{const i=new H1(this.ensureCanvasManager(),this.gameLoop,this.ensureInputManager());i.start(),this.activeSceneManager=i;break}case"debriefing":{const i=new Z1(this.ensureCanvasManager(),this.gameLoop,this.ensureInputManager());i.start(),this.activeSceneManager=i;break}case"mission":{this.destroyTransientManagers();break}}this.listeners.forEach(i=>i(e))}}getScene(){return this.currentScene??"title"}onSceneChange(e){return this.listeners.add(e),()=>this.listeners.delete(e)}getCanvasManager(){return this.canvasManager}getInputManager(){return this.inputManager}fadeToScene(e){const i=Js.getInstance();i.isFadeInProgress()||i.startFade(()=>this.setScene(e))}}const vt=new K1;function ol(a=null,e=null,i){const n=we.getInstance(),r=n.getViewportWidth(),c=n.getViewportHeight(),h=["background-canvas","backgroundgl-canvas","entitygl-canvas","entity-canvas","fx-canvas","particles-canvas","lighting-canvas","ui-canvas","overlay-canvas","dialogue-canvas"];for(const d of h){const g=document.getElementById(d);g&&(g.width=r,g.height=c,g.style.width=`${r}px`,g.style.height=`${c}px`)}a&&a.resize(),e&&e.resize(r,c);const u=document.getElementById("canvas-root");if(u){const d=window.innerWidth,g=window.innerHeight,m=d/r,y=g/c,v=Math.min(m,y);u.style.zoom=v.toString(),u.style.width=`${r}px`,u.style.height=`${c}px`,u.style.overflow="hidden"}}class Q1{constructor(){this.requests=[]}add(e){this.requests.push(e)}addMany(e){this.requests.push(...e)}getAndClear(){const e=this.requests;return this.requests=[],e}clear(){this.requests=[]}}const om=new Q1;function rm(a,e,i=1){const{x:n,y:r,size:c,sprite:h,overlaySprite:u,isHovered:d,isSelected:g,isLocked:m}=e,y=4*i,v=c-y;a.fillStyle=g?"#4f4":d?"#888":"#333",a.fillRect(n,r,v,v);const M=32*i*ne(),b=n+(c-M)/2,C=r+(c-M)/2;a.drawImage(h,b,C,M,M),u&&a.drawImage(u,b,C,M,M),m&&(a.fillStyle="rgba(0, 0, 0, 0.6)",a.fillRect(n,r,v,v),a.fillStyle="#ccc",a.font=`bold ${Math.round(12*i)}px sans-serif`,a.textAlign="center",a.textBaseline="middle",a.fillText("🔒",n+v/2,r+v/2)),g&&(a.strokeStyle="#0f0",a.lineWidth=2*i,a.strokeRect(n+1*i,r+1*i,v-2*i,v-2*i))}function lm(a,e,i=1){const{x:n,y:r,width:c,height:h,label:u,isHovered:d,isActive:g,style:m={}}=e,{borderRadius:y=0,backgroundColor:v,borderColor:M,alpha:b=1,activeColor:C,backgroundGradient:w}=m,A=c*i,R=h*i,I=y;a.save(),a.globalAlpha=b;let _;if(g&&C)_=C;else if(!g&&w){const{type:N,stops:W,from:z=[n,r],to:q=[n+c,r+h],radius:ie=c/2}=w,ee=N==="linear"?a.createLinearGradient(z[0],z[1],q[0],q[1]):a.createRadialGradient(z[0],z[1],0,z[0],z[1],ie*i);for(const K of W)ee.addColorStop(K.offset,d?Vi(K.color,.1):K.color);_=ee}else _=v??(g?"#4f4":d?"#444":"#222");const x=M??(g?"#0f0":"#888");a.fillStyle=_,a.strokeStyle=x,a.lineWidth=1*i,I>0?(a.beginPath(),a.roundRect(n,r,A,R,I),a.fill(),a.stroke()):(a.fillRect(n,r,A,R),a.strokeRect(n,r,A,R)),a.fillStyle="#fff",a.font=`${Math.round(12*i*ne())}px sans-serif`,a.textAlign="center",a.textBaseline="middle",a.fillText(u,n+A/2,r+R/2),a.restore()}function cm(a){var i,n;const e=new Map;for(const r of a){const c=((i=r.subcategory)==null?void 0:i.toLowerCase())??((n=r.id.match(/^[a-z]+/))==null?void 0:n[0])??"default";e.has(c)||e.set(c,[]),e.get(c).push(r)}return e}var xe=(a=>(a.PLACE="PLACE",a.REPAIR="REPAIR",a.REPAIR_ALL="REPAIR_ALL",a.SAVE="SAVE",a.LOAD="LOAD",a))(xe||{});function Si(a){const{type:e,hp:i}=a,n=Math.max(0,e.armor-i);if(n===0)return 0;const r=e.cost/e.armor;return Math.ceil(r*n)}function pe(a,e,i,n,r,c="#888",h,u=1){const g=`${Math.round(14*u)}px monospace`,m=16*u;a.font=g;const v=`${n}: ${r}`.split(" "),M=[];let b="";for(const C of v){const w=b?`${b} ${C}`:C;a.measureText(w).width>h&&b?(M.push(b),b=C):b=w}b&&M.push(b);for(const C of M){const w=C.indexOf(":"),A=w!==-1,R=A?C.slice(0,w+1):"",I=A?C.slice(w+1).trim():C;He(a,e,i,[...A?[{text:R+" ",color:c}]:[],{text:I,color:"#fff"}],{font:g,align:"left"}),i+=m}return i}function qr(){return we.getInstance().getInterfaceScale()||2}function jh(a){const e=ri(),i=1920,n=.75,c=n+(Math.min(e,3840)-i)*(1.25-n)/(3840-i);return a*c}const $1=new Set(["canThrust","canFire"]),J1=["hull","engine","weapon","utility"];class e2{constructor(e,i){this.repairAllHandler=null,this.activeTab="hull",this.selectedBlockId="hull1",this.activeTool=xe.PLACE,this.hoveredShipBlock=void 0,this.hoveredUtilityTool=null,this.open=!1,this.originalZoom=0,this.PADDING=0,this.TILE_SIZE=0,this.GRID_COLS=6,this.GRID_ROWS=6,this.WINDOW_HEADER_HEIGHT=0,this.BLOCK_INFO_OFFSET=0,this.INFO_WINDOW_HEIGHT=0,this.WINDOW_X=0,this.WINDOW_Y=0,this.WINDOW_WIDTH=0,this.WINDOW_HEIGHT=0,this.BLOCKINFO_WINDOW_WIDTH=0,this.UTILITY_WINDOW_WIDTH=0,this.UTILITY_BUTTON_VERTICAL_MARGIN=0,this.UTILITY_BUTTON_SPACING=0,this.UTILITY_BUTTON_HEIGHT=0,this.TOTAL_MENU_WIDTH=0,this.SLIDE_SPEED=0,this.OVERSHOOT_DISTANCE=0,this.SETTLE_SPEED=0,this.slideX=0,this.isAnimating=!1,this.animationPhase=null,this.targetX=0,this.resize(),this.inputManager=e,this.cursorRenderer=i,this.slideX=-(this.TOTAL_MENU_WIDTH+50)}resize(){const e=Math.max(1,qr()*lS());this.PADDING=16*e,this.TILE_SIZE=40*e,this.WINDOW_HEADER_HEIGHT=28*e,this.BLOCK_INFO_OFFSET=12*e,this.INFO_WINDOW_HEIGHT=200*e,this.WINDOW_X=20*e,this.WINDOW_Y=40*e,this.WINDOW_WIDTH=this.TILE_SIZE*this.GRID_COLS+this.PADDING*2,this.WINDOW_HEIGHT=this.TILE_SIZE*this.GRID_ROWS+60*e,this.BLOCKINFO_WINDOW_WIDTH=this.TILE_SIZE*(this.GRID_COLS-2)+this.PADDING*2,this.UTILITY_WINDOW_WIDTH=this.TILE_SIZE+this.PADDING*2,this.UTILITY_BUTTON_VERTICAL_MARGIN=14*e,this.UTILITY_BUTTON_SPACING=8*e,this.UTILITY_BUTTON_HEIGHT=32*e,this.TOTAL_MENU_WIDTH=this.WINDOW_WIDTH+this.BLOCKINFO_WINDOW_WIDTH+this.UTILITY_WINDOW_WIDTH+this.PADDING,this.SLIDE_SPEED=6*e,this.OVERSHOOT_DISTANCE=30*e,this.SETTLE_SPEED=2*e}render(e){const i=this.inputManager.getMousePosition(),n=this.inputManager.wasMouseClicked(),r=this.buildCategoryTabs(),c=Mt({ctx:e,x:this.WINDOW_X+this.slideX,y:this.WINDOW_Y,width:this.WINDOW_WIDTH,height:this.WINDOW_HEIGHT,title:"",tabs:r,mouse:i,clicked:n,options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",activeTabColor:"#66ff66",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}}),h=So(),u=h.filter(v=>v.category===this.activeTab),d=h.find(v=>v.id===this.selectedBlockId)??null,g=this.renderBlockGrid(e,u,i,n,this.WINDOW_X+this.PADDING+this.slideX,this.WINDOW_Y+this.WINDOW_HEADER_HEIGHT,c),m=this.WINDOW_X+this.slideX,y=this.WINDOW_Y+this.WINDOW_HEIGHT+this.BLOCK_INFO_OFFSET;if(this.hoveredUtilityTool)this.renderToolInfo(e,this.hoveredUtilityTool,m,y,this.BLOCKINFO_WINDOW_WIDTH),this.cursorRenderer.setHoveredCursor();else if(this.activeTool===xe.REPAIR)this.renderRepairInfoForBlock(e,this.hoveredShipBlock,m,y,this.BLOCKINFO_WINDOW_WIDTH),this.cursorRenderer.setWrenchCursor();else{const v=g??d??null;this.renderBlockInfo(e,v,m,y,this.BLOCKINFO_WINDOW_WIDTH),g?this.cursorRenderer.setHoveredCursor():this.activeTool===xe.PLACE&&!this.isPointInBounds(i.x,i.y)?this.cursorRenderer.setSmallCircleCursor():this.cursorRenderer.setDefaultCursor()}this.renderUtilityWindow(e,this.WINDOW_X+this.BLOCKINFO_WINDOW_WIDTH+.5*this.PADDING+this.slideX,this.WINDOW_Y+this.WINDOW_HEIGHT+this.BLOCK_INFO_OFFSET,this.UTILITY_WINDOW_WIDTH,this.INFO_WINDOW_HEIGHT,i,n)}buildCategoryTabs(){return J1.map(e=>({label:e.toUpperCase(),isActive:this.activeTab===e,onClick:()=>{this.activeTab!==e&&(this.activeTab=e)}}))}renderBlockGrid(e,i,n,r,c,h,u){const d=ei.getInstance(),g=cm(i),m=this.TILE_SIZE;let y=0,v=null;for(const[,M]of g){for(let b=0;b<M.length;b++){const C=M[b],w=b%this.GRID_COLS,A=y,R=c+w*this.TILE_SIZE,I=h+A*m,_=n.x>=R&&n.x<=R+this.TILE_SIZE&&n.y>=I&&n.y<=I+this.TILE_SIZE,x=this.selectedBlockId===C.id,N=d.isUnlocked(C.id),W=hi(C.id);rm(e,{x:R,y:I,size:this.TILE_SIZE,sprite:W.base,overlaySprite:W.overlay,isHovered:_,isSelected:x,isLocked:!N}),_&&(v=C),_&&r&&!u&&N&&(Q.play("assets/sounds/sfx/ui/click_00.wav","sfx"),this.selectedBlockId=C.id,this.setActiveTool(xe.PLACE),this.setHoveredShipBlock(void 0))}y++}return v}renderBlockInfo(e,i,n,r,c){Mt({ctx:e,x:n,y:r,width:c,height:this.INFO_WINDOW_HEIGHT,title:"Info",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const h=n+this.PADDING;let u=r+32;const d=c,g=v=>v.charAt(0).toUpperCase()+v.slice(1),m=v=>v===void 0?"—":typeof v=="boolean"?v?"Yes":"No":typeof v=="number"||typeof v=="string"?v:String(v);if(!i)return;const y=Math.max(.75,jh(qr()));u=pe(e,h,u,"Name",i.name,"#6cf",d,y),u=pe(e,h,u,"Armor",m(i.armor),"#09f",d,y),u=pe(e,h,u,"Mass",m(i.mass),"#999",d,y),u=pe(e,h,u,"Cost",m(i.cost),"#6f6",d,y),i.behavior&&Object.entries(i.behavior).forEach(([v,M])=>{$1.has(v)||(M&&typeof M=="object"&&!Array.isArray(M)?(u=pe(e,h,u,g(v),"","#fc6",d,y),Object.entries(M).forEach(([b,C])=>{const w=`• ${g(b)}`;u=pe(e,h,u,w,m(C),"#999",d,y)})):u=pe(e,h,u,g(v),m(M),"#fc6",d,y))})}renderRepairInfoForBlock(e,i,n,r,c){Mt({ctx:e,x:n,y:r,width:c,height:this.INFO_WINDOW_HEIGHT,title:"Repair Info",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const h=n+this.PADDING;let u=r+32;const d=c,g=Math.max(.75,jh(qr()));if(!i){u=pe(e,h,u,"Hover block","to inspect","#888",d,g),u=pe(e,h,u,"Repair","Left-click","#888",d,g);return}const{type:m,hp:y}=i,v=m.armor-y;u=pe(e,h,u,"Name",m.name,"#6cf",d,g),u=pe(e,h,u,"Armor",`${y} / ${m.armor}`,"#09f",d,g),u=pe(e,h,u,"Damage",v>0?v:"None","#f66",d,g),u=pe(e,h,u,"Repair Cost",v>0?Si(i):"—","#6f6",d,g)}renderUtilityWindow(e,i,n,r,c,h,u){Mt({ctx:e,x:i,y:n,width:r,height:c,title:"",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const d=this.UTILITY_BUTTON_SPACING,g=this.UTILITY_BUTTON_HEIGHT,m=r-this.PADDING*2,y=i+this.PADDING;let v=n+this.WINDOW_HEADER_HEIGHT+d-this.UTILITY_BUTTON_VERTICAL_MARGIN;this.hoveredUtilityTool=null;const M=[{label:"🔧",tool:xe.REPAIR,action:()=>{Q.play("assets/sounds/sfx/ui/click_00.wav","sfx"),this.setActiveTool(xe.REPAIR),this.setSelectedBlockId(null)}},{label:"🛠️",tool:xe.REPAIR_ALL,action:()=>{var b;Q.play("assets/sounds/sfx/ui/click_00.wav","sfx"),(b=this.repairAllHandler)==null||b.call(this)}},{label:"💾",tool:xe.SAVE,action:()=>{Q.play("assets/sounds/sfx/ui/click_00.wav","sfx")}},{label:"📂",tool:xe.LOAD,action:()=>{Q.play("assets/sounds/sfx/ui/click_00.wav","sfx")}}];for(const{label:b,tool:C,action:w}of M){const A=h.x>=y&&h.x<=y+m&&h.y>=v&&h.y<=v+g,R=C!=null&&this.getActiveTool()===C;A&&C&&(this.hoveredUtilityTool=C),lm(e,{x:y,y:v,width:m,height:g,label:b,isHovered:A,isActive:R,style:{alpha:.6,borderRadius:8,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}}),A&&u&&w(),v+=g+d}}renderToolInfo(e,i,n,r,c){Mt({ctx:e,x:n,y:r,width:c,height:this.INFO_WINDOW_HEIGHT,title:"Tool Info",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const h=n+this.PADDING;let u=r+32;const d=c-this.PADDING,g=Math.max(.75,jh(qr()));i===xe.REPAIR&&(u=pe(e,h,u,"Repair Mode","Individual block repair","#888",d,g),u=pe(e,h,u,"Cost","Based on damage","#888",d,g)),i===xe.REPAIR_ALL&&(u=pe(e,h,u,"Repair All","Repairs all damaged blocks","#888",d,g),u=pe(e,h,u,"Cost","As much as you can afford","#888",d,g),u=pe(e,h,u,"Order","Repairs most damaged blocks first","#888",d,g))}update(){Ct.getInstance(),this.isAnimating&&(this.animationPhase==="sliding-in"?(this.slideX+=this.SLIDE_SPEED,this.slideX>=this.targetX+this.OVERSHOOT_DISTANCE&&(this.animationPhase="settling")):this.animationPhase==="settling"?(this.slideX-=this.SETTLE_SPEED,this.slideX<=this.targetX&&(this.slideX=this.targetX,this.isAnimating=!1,this.animationPhase=null)):this.animationPhase==="sliding-out"&&(this.slideX-=this.SLIDE_SPEED,this.slideX<=this.targetX&&(this.slideX=this.targetX,this.animationPhase=null,this.isAnimating=!1,this.open=!1,this.cursorRenderer.setDefaultCursor())))}isBlocking(){return!0}getSelectedBlockId(){return this.selectedBlockId}setSelectedBlockId(e){this.selectedBlockId=e}setHoveredShipBlock(e){this.hoveredShipBlock=e}isOpen(){return this.open}openMenu(){this.resize(),Q.play("assets/sounds/sfx/ui/activate_01.wav","sfx"),this.open=!0;const e=Ct.getInstance();this.originalZoom=e.getZoom(),e.animateZoomTo(this.getMenuTargetZoom()),this.slideX=-(this.TOTAL_MENU_WIDTH+50),this.targetX=0,this.isAnimating=!0,this.animationPhase="sliding-in"}closeMenu(){this.targetX=-(this.TOTAL_MENU_WIDTH+50),this.animationPhase="sliding-out",this.isAnimating=!0,Ct.getInstance().animateZoomTo(this.originalZoom)}setActiveTool(e){this.activeTool=e}getActiveTool(){return this.activeTool}isPointInBounds(e,i){const n=this.WINDOW_X+this.WINDOW_WIDTH+this.slideX,r=this.WINDOW_Y+this.WINDOW_HEIGHT,c=this.WINDOW_X+this.BLOCKINFO_WINDOW_WIDTH+this.slideX,h=this.WINDOW_Y+this.WINDOW_HEIGHT+this.BLOCK_INFO_OFFSET+this.INFO_WINDOW_HEIGHT,u=this.WINDOW_X+this.BLOCKINFO_WINDOW_WIDTH+this.PADDING+this.slideX,d=u+this.UTILITY_WINDOW_WIDTH,g=this.WINDOW_Y+this.WINDOW_HEIGHT+this.BLOCK_INFO_OFFSET,m=g+this.INFO_WINDOW_HEIGHT,v=e>=this.WINDOW_X+this.slideX&&e<=n&&i>=this.WINDOW_Y-30*ne()&&i<=r,M=e>=this.WINDOW_X+this.slideX&&e<=c&&i>=this.WINDOW_Y+this.WINDOW_HEIGHT+this.BLOCK_INFO_OFFSET&&i<=h,b=e>=u&&e<=d&&i>=g&&i<=m;return v||M||b}setRepairAllHandler(e){this.repairAllHandler=e}getCursorRenderer(){return this.cursorRenderer}getMenuTargetZoom(){return .5*ne()}}const oi=16,Gi=40,Cu=6,t2=6,cp=28,po=12,Kn=200,Ni=20,Hi=40,hp=Gi*Cu+oi*2,js=Gi*t2+60,Qn=Gi*(Cu-2)+oi*3,up=Gi+oi,i2=14,fp=10,s2=30,n2=4,a2=new Set(["canThrust","canFire"]),o2=["hull","engine","weapon","utility"];class r2{constructor(e,i){this.repairAllHandler=null,this.activeTab="hull",this.selectedBlockId="hull1",this.activeTool=xe.PLACE,this.hoveredShipBlock=void 0,this.hoveredUtilityTool=null,this.open=!1,this.slideX=0,this.isAnimating=!1,this.animationPhase=null,this.targetX=0,this.inputManager=e,this.cursorRenderer=i,this.slideX=-602}render(e){const i=this.inputManager.getMousePosition(),n=this.inputManager.wasMouseClicked(),r=this.buildCategoryTabs(),c=Mt({ctx:e,x:Ni+this.slideX,y:Hi,width:hp,height:js,title:"",tabs:r,mouse:i,clicked:n,options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",activeTabColor:"#66ff66",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}}),h=So(),u=h.filter(v=>v.category===this.activeTab),d=h.find(v=>v.id===this.selectedBlockId)??null,g=this.renderBlockGrid(e,u,i,n,Ni+oi+this.slideX,Hi+cp,c),m=Ni+this.slideX,y=Hi+js+po;if(this.hoveredUtilityTool)this.renderToolInfo(e,this.hoveredUtilityTool,m,y,Qn),this.cursorRenderer.setHoveredCursor();else if(this.activeTool===xe.REPAIR)this.renderRepairInfoForBlock(e,this.hoveredShipBlock,m,y,Qn),this.cursorRenderer.setWrenchCursor();else{const v=g??d??null;this.renderBlockInfo(e,v,m,y,Qn),g?this.cursorRenderer.setHoveredCursor():this.activeTool===xe.PLACE&&!this.isPointInBounds(i.x,i.y)?this.cursorRenderer.setSmallCircleCursor():this.cursorRenderer.setDefaultCursor()}this.renderUtilityWindow(e,Ni+Qn+oi+this.slideX,Hi+js+po,up,Kn,i,n)}buildCategoryTabs(){return o2.map(e=>({label:e.toUpperCase(),isActive:this.activeTab===e,onClick:()=>{this.activeTab!==e&&(this.activeTab=e)}}))}renderBlockGrid(e,i,n,r,c,h,u){const d=ei.getInstance(),g=cm(i),m=Gi;let y=0,v=null;for(const[,M]of g){for(let b=0;b<M.length;b++){const C=M[b],w=b%Cu,A=y,R=c+w*Gi,I=h+A*m,_=n.x>=R&&n.x<=R+Gi&&n.y>=I&&n.y<=I+Gi,x=this.selectedBlockId===C.id,N=d.isUnlocked(C.id),W=hi(C.id);rm(e,{x:R,y:I,size:Gi,sprite:W.base,overlaySprite:W.overlay,isHovered:_,isSelected:x,isLocked:!N}),_&&(v=C),_&&r&&!u&&N&&(Q.play("assets/sounds/sfx/ui/click_00.wav","sfx"),this.selectedBlockId=C.id,this.setActiveTool(xe.PLACE),this.setHoveredShipBlock(void 0))}y++}return v}renderBlockInfo(e,i,n,r,c){Mt({ctx:e,x:n,y:r,width:c,height:Kn,title:"Info",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const h=n+oi;let u=r+32;const d=c+10,g=y=>y.charAt(0).toUpperCase()+y.slice(1),m=y=>y===void 0?"—":typeof y=="boolean"?y?"Yes":"No":typeof y=="number"||typeof y=="string"?y:String(y);i&&(u=pe(e,h,u,"Name",i.name,"#6cf",d),u=pe(e,h,u,"Armor",m(i.armor),"#09f",d),u=pe(e,h,u,"Mass",m(i.mass),"#999",d),u=pe(e,h,u,"Cost",m(i.cost),"#6f6",d),i.behavior&&Object.entries(i.behavior).forEach(([y,v])=>{a2.has(y)||(v&&typeof v=="object"&&!Array.isArray(v)?(u=pe(e,h,u,g(y),"","#fc6",d),Object.entries(v).forEach(([M,b])=>{const C=`• ${g(M)}`;u=pe(e,h,u,C,m(b),"#999",d)})):u=pe(e,h,u,g(y),m(v),"#fc6",d))}))}renderRepairInfoForBlock(e,i,n,r,c){Mt({ctx:e,x:n,y:r,width:c,height:Kn,title:"Repair Info",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const h=n+oi;let u=r+32;const d=c+10;if(!i){u=pe(e,h,u,"Hover block","to inspect","#888",d),u=pe(e,h,u,"Repair","Left-click","#888",d);return}const{type:g,hp:m}=i,y=g.armor-m;u=pe(e,h,u,"Name",g.name,"#6cf",d),u=pe(e,h,u,"Armor",`${m} / ${g.armor}`,"#09f",d),u=pe(e,h,u,"Damage",y>0?y:"None","#f66",d),u=pe(e,h,u,"Repair Cost",y>0?Si(i):"—","#6f6",d)}renderUtilityWindow(e,i,n,r,c,h,u){Mt({ctx:e,x:i,y:n,width:r,height:c,title:"",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const d=32,g=8,m=r-oi*2,y=i+oi;let v=n+cp+g-i2;this.hoveredUtilityTool=null;const M=[{label:"🔧",tool:xe.REPAIR,action:()=>{Q.play("assets/sounds/sfx/ui/click_00.wav","sfx"),this.setActiveTool(xe.REPAIR),this.setSelectedBlockId(null)}},{label:"🛠️",tool:xe.REPAIR_ALL,action:()=>{var b;Q.play("assets/sounds/sfx/ui/click_00.wav","sfx"),(b=this.repairAllHandler)==null||b.call(this)}},{label:"💾",tool:xe.SAVE,action:()=>{Q.play("assets/sounds/sfx/ui/click_00.wav","sfx")}},{label:"📂",tool:xe.LOAD,action:()=>{Q.play("assets/sounds/sfx/ui/click_00.wav","sfx")}}];for(const{label:b,tool:C,action:w}of M){const A=h.x>=y&&h.x<=y+m&&h.y>=v&&h.y<=v+d,R=C!=null&&this.getActiveTool()===C;A&&C&&(this.hoveredUtilityTool=C),lm(e,{x:y,y:v,width:m,height:d,label:b,isHovered:A,isActive:R,style:{alpha:.6,borderRadius:8,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}}),A&&u&&w(),v+=d+g}}renderToolInfo(e,i,n,r,c){Mt({ctx:e,x:n,y:r,width:c,height:Kn,title:"Tool Info",options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const h=n+oi;let u=r+32;const d=c+10;i===xe.REPAIR&&(u=pe(e,h,u,"Repair Mode","Individual block repair","#888",d),u=pe(e,h,u,"Cost","Based on damage","#888",d)),i===xe.REPAIR_ALL&&(u=pe(e,h,u,"Repair All","Repairs all damaged blocks","#888",d),u=pe(e,h,u,"Cost","As much as you can afford","#888",d),u=pe(e,h,u,"Order","Repairs most damaged blocks first","#888",d))}update(){this.isAnimating&&(this.animationPhase==="sliding-in"?(this.slideX+=fp,this.slideX>=this.targetX+s2&&(this.animationPhase="settling")):this.animationPhase==="settling"?(this.slideX-=n2,this.slideX<=this.targetX&&(this.slideX=this.targetX,this.isAnimating=!1,this.animationPhase=null)):this.animationPhase==="sliding-out"&&(this.slideX-=fp,this.slideX<=this.targetX&&(this.slideX=this.targetX,this.animationPhase=null,this.isAnimating=!1,this.open=!1,this.cursorRenderer.setDefaultCursor())))}isBlocking(){return!0}getSelectedBlockId(){return this.selectedBlockId}setSelectedBlockId(e){this.selectedBlockId=e}setHoveredShipBlock(e){this.hoveredShipBlock=e}isOpen(){return this.open}openMenu(){Q.play("assets/sounds/sfx/ui/activate_01.wav","sfx"),this.open=!0,this.slideX=-602,this.targetX=0,this.isAnimating=!0,this.animationPhase="sliding-in"}closeMenu(){this.targetX=-602,this.animationPhase="sliding-out",this.isAnimating=!0}setActiveTool(e){this.activeTool=e}getActiveTool(){return this.activeTool}isPointInBounds(e,i){const n=Ni+hp+this.slideX,r=Hi+js,c=Ni+Qn+this.slideX,h=Hi+js+po+Kn,u=Ni+Qn+oi+this.slideX,d=u+up,g=Hi+js+po,m=g+Kn,v=e>=Ni+this.slideX&&e<=n&&i>=Hi-30&&i<=r,M=e>=Ni+this.slideX&&e<=c&&i>=Hi+js+po&&i<=h,b=e>=u&&e<=d&&i>=g&&i<=m;return v||M||b}setRepairAllHandler(e){this.repairAllHandler=e}getCursorRenderer(){return this.cursorRenderer}}const dp=new Map;function hm(a,e,i=0,n="rgba(100, 255, 255, 0.4)"){const r=`${e}_${i}_${n}`;let c=dp.get(r);if(!c){const u=hi(e).base;if(!u)return;const d=document.createElement("canvas");d.width=G,d.height=G;const g=d.getContext("2d");g.fillStyle=n,g.fillRect(0,0,G,G),g.save(),g.translate(G/2,G/2),g.rotate(i*Math.PI/180),g.translate(-32/2,-32/2),g.globalCompositeOperation="destination-in",g.drawImage(u,0,0),g.restore(),g.globalCompositeOperation="source-over",c=d,dp.set(r,c)}a.drawImage(c,-32/2,-32/2)}function um(a,e="rgba(0,255,0,0.3)"){a.save(),a.fillStyle=e,a.fillRect(-32/2,-32/2,G,G),a.restore()}function Tu(a,e){a.save(),a.fillStyle=e?"rgba(0,255,0,0.3)":"rgba(255,0,0,0.3)",a.fillRect(-32/2,-32/2,G,G),a.restore()}function la(a,e,i,n){const r=e.screenToWorld(a.x,a.y),c=r.x-i.x,h=r.y-i.y,u=Math.cos(-n),d=Math.sin(-n),g=c*u-h*d,m=c*d+h*u;return{x:Math.round(g/G),y:Math.round(m/G)}}function wu(a,e){return[{x:e.x+1,y:e.y},{x:e.x-1,y:e.y},{x:e.x,y:e.y+1},{x:e.x,y:e.y-1}].some(n=>a.hasBlockAt(n))}class l2{constructor(e,i,n,r,c){this.spaceStation=e,this.menu=i,this.camera=n,this.shipBuilderEffects=r,this.inputManager=c,this.rotation=0,this.lastBlockId=null,this.hasSaved=!1,this.hoveredShipCoord=null}update(e){this.inputManager.wasKeyJustPressed("Space")&&(this.rotation=(this.rotation+90)%360);const i=this.inputManager.getMousePosition();if(this.isCursorOverMenu(i))return;const n=la(i,this.camera,e.position,e.rotation);if(this.menu.getActiveTool()===xe.REPAIR){const u=this.spaceStation.getBlock(n);this.menu.setHoveredShipBlock(u),u&&this.inputManager.wasMouseClicked()&&(Q.play("assets/sounds/sfx/ship/repair_00.wav","sfx"),this.repairBlockAt(n));return}const r=this.menu.getSelectedBlockId();if(!r||(r!==this.lastBlockId&&(this.rotation=0,this.lastBlockId=r),!hi(r)))return;const h=Vp(r);if(h!==void 0){if(this.inputManager.wasRightClicked()){const u=this.spaceStation.getBlock(n);if(!u)return;if(!u.type.id.startsWith("cockpit")){this.spaceStation.removeBlock(n),Q.play("assets/sounds/sfx/ui/click_00.wav","sfx",{maxSimultaneous:3});const d=Math.round(h/2);Re.getInstance().addCurrency(d)}}this.inputManager.wasMouseClicked()&&(this.spaceStation.placeBlockById(n,r,this.rotation),Q.play("assets/sounds/sfx/ship/attach_00.wav","sfx",{maxSimultaneous:3}),Re.getInstance().spendCurrency(h),Ce.incrementBlockPlacedCount()),this.inputManager.isLPressed()&&!this.hasSaved&&(this.hasSaved=!0),!this.inputManager.isLPressed()&&this.hasSaved&&(this.hasSaved=!1)}}render(e,i){const n=this.inputManager.getMousePosition();if(this.isCursorOverMenu(n))return;const r=la(n,this.camera,i.position,i.rotation),c=r.x*G,h=r.y*G,u=Math.cos(i.rotation),d=Math.sin(i.rotation),g=c*u-h*d,m=c*d+h*u,y=i.position.x+g,v=i.position.y+m,M=this.camera.worldToScreen(y,v);e.save(),e.translate(M.x,M.y),e.scale(this.camera.getZoom(),this.camera.getZoom()),e.rotate(i.rotation);const b=this.menu.getActiveTool();if(b===xe.REPAIR)this.spaceStation.getBlock(r)&&um(e,"rgba(0,255,0,0.3)");else if(b===xe.PLACE){const C=this.menu.getSelectedBlockId();if(!C){e.restore();return}if(this.spaceStation.getBlock(r)){const A=this.spaceStation.isDeletionSafe(r);Tu(e,A)}else{const A=hi(C);e.save(),e.rotate(this.rotation*Math.PI/180),e.globalAlpha=.6,e.drawImage(A.base,-32/2,-32/2,G,G),e.restore()}}e.restore()}isCursorOverMenu(e){return this.menu.isPointInBounds(e.x,e.y)}repairBlockAt(e){const i=this.spaceStation.getBlock(e);if(!i||i.type.armor-i.hp<=0)return;const r=Si(i),c=Re.getInstance();c.hasEnoughCurrency(r)&&(c.spendCurrency(r),i.hp=i.type.armor,this.shipBuilderEffects.createRepairEffect(i.position))}repairAllBlocks(){const e=Re.getInstance(),i=this.spaceStation.getAllBlocks().filter(([,n])=>n.hp<n.type.armor).map(([n,r])=>({coord:n,block:r})).sort((n,r)=>{const c=n.block.type.armor-n.block.hp,h=r.block.type.armor-r.block.hp;if(c!==h)return h-c;const u=Si(n.block),d=Si(r.block);return u-d});for(const{coord:n,block:r}of i){const c=Si(r);if(e.hasEnoughCurrency(c))Q.play("assets/sounds/sfx/ship/repair_00.wav","sfx"),this.repairBlockAt(n);else{console.log("Stopped repair: insufficient funds.");break}}}getHoveredShipBlock(){return this.hoveredShipCoord?this.spaceStation.getBlock(this.hoveredShipCoord):void 0}}const c2=[["#fff","#f90","#ff0"],["#fff","#f90","#ff0"],["#66ff66","#33cc33","#99ff99"],["#66ccff","#3399ff","#99ddff"],["#cc88ff","#9933ff","#ddaaff"]],ta=["#ffdd00","#ffaa00","#ff6600","#ff2200","#ffffff"],h2={engine0:["#ffeeb0","#ffc04d","#ffd966"],engine1:["#ffeeb0","#ffc04d","#ffd966"],engine2:["#66ff66","#33cc33","#99ff99"],engine3:["#66ccff","#3399ff","#99ddff"],engine4:["#cc88ff","#9933ff","#ddaaff"]},gp={turret0:["#ffff88","#ffaa00","#ffcc33"],turret1:["#ff8888","#ff3333","#ffaaaa"],turret2:["#88ff88","#33dd33","#aaffaa"],turret3:["#88ccff","#3399ff","#66ddff"],turret4:["#cc88ff","#9933ff","#ddaaff"]},pp={laser0:["#00CCFF","#00FFFF","#00faff"],laser1:["#00CCFF","#00FFFF","#00faff"],laser2:["#E6FFED","#76FF03","#33691E"],laser3:["#F3E5F5","#D500F9","#4A148C"]},fm={shield0:["#88ddff","#44bbff","#00aaff"],shield1:["#88ddff","#44bbff","#00aaff"],shield2:["#aaffaa","#66dd66","#22bb22"],shield3:["#ffbbff","#dd66dd","#cc33cc"]},u2={shield0:"rgba(100, 255, 255, 0.4)",shield1:"rgba(100, 255, 255, 0.4)",shield2:"rgba(91, 255, 91, 0.4)",shield3:"rgba(255, 86, 255, 0.4)"},mo={explosiveLance0:["#ffcc00","#ff6600","#cc2200"],explosiveLance1:["#ffcc00","#ff6600","#cc2200"],explosiveLance2:["#aaffaa","#66dd66","#228822"],explosiveLance3:["#ccccff","#9999ff","#4444aa"],explosiveLance4:["#ff66cc","#ff3399","#990066"]},mp={0:"#ffffff",1:"#ffffff",2:"#00aa33",3:"#0033cc",4:"#6600cc",5:"#ffcc00",10:"#ff3366"},dm={0:"#A9A9A9",1:"#A9A9A9",2:"#00aa33",3:"#0033cc",4:"#6600cc",5:"#ffcc00",10:"#ff3366"},f2={currency:"#FFD700",repair:"#FF4444",block:"#CC66FF"};function d2(a){Ee.emit("menu:opened",{id:a})}function yp(a){Ee.emit("menu:closed",{id:a})}const g2={id:"fighter",name:"Fighter",description:"Sleek fighter with forward hull and symmetric wings",primaryAxis:"vertical",symmetryAxis:"x",shapeScoreMap:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;let r=0;return n<=0&&(r+=20+Math.abs(n)*5),n>0&&n<=3&&(r+=15-n*2),Math.abs(i)>=2&&Math.abs(i)<=5&&n>=-1&&n<=2&&(r+=25),Math.abs(i)>1&&Math.abs(n)<=1&&(r-=15),r},featureZones:{leftWing:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return i<=-2&&n>=-1&&n<=3},rightWing:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return i>=2&&n>=-1&&n<=3},hull:(a,e)=>{const i=a.x-e.x;return Math.abs(i)<=1},nose:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)<=1&&n<=-1},engineBay:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)<=1&&n>=1&&n<=3}},blockBiases:{engine:{preferredZones:["engineBay","hull"],bonusInZone:30,penaltyOutsideZone:20},weapon:{preferredZones:["nose","leftWing","rightWing"],bonusInZone:25,penaltyOutsideZone:15},fin:{preferredZones:["leftWing","rightWing"],bonusInZone:35,penaltyOutsideZone:25,avoidZones:["hull"]},facetplate:{preferredZones:["leftWing","rightWing","nose"],bonusInZone:20,penaltyOutsideZone:10},hull:{preferredZones:["hull"],bonusInZone:15},system:{preferredZones:["hull"],bonusInZone:20,penaltyOutsideZone:15},utility:{preferredZones:["hull"],bonusInZone:15}},minimumStructureRules:[{zone:"leftWing",minCount:3,description:"Left wing needs structure"},{zone:"rightWing",minCount:3,description:"Right wing needs structure"},{zone:"engineBay",minCount:1,description:"Need rear propulsion"}],weights:{shapeScore:1,symmetryScore:.8,zoneAffinityScore:1.2,structuralGoalScore:1.5}},p2={id:"carrier",name:"Carrier",description:"Broad carrier with wide deck and central command",primaryAxis:"horizontal",symmetryAxis:"y",shapeScoreMap:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;let r=0;return Math.abs(i)<=6&&(r+=25-Math.abs(i)*2),Math.abs(n)<=2&&(r+=30),Math.abs(n)>3&&(r-=Math.abs(n)*8),r},featureZones:{centralHull:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)<=2&&Math.abs(n)<=1},deck:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)<=6&&Math.abs(n)<=2},leftFlank:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return i<=-3&&Math.abs(n)<=2},rightFlank:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return i>=3&&Math.abs(n)<=2},superstructure:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)<=1&&n<=-1}},blockBiases:{weapon:{preferredZones:["deck","leftFlank","rightFlank","superstructure"],bonusInZone:25,penaltyOutsideZone:10},engine:{preferredZones:["centralHull"],bonusInZone:30,penaltyOutsideZone:25},system:{preferredZones:["centralHull","superstructure"],bonusInZone:20,penaltyOutsideZone:15},utility:{preferredZones:["centralHull","deck"],bonusInZone:15},hull:{preferredZones:["deck"],bonusInZone:10},facetplate:{preferredZones:["leftFlank","rightFlank"],bonusInZone:20}},minimumStructureRules:[{zone:"deck",minCount:8,description:"Need substantial deck area"},{zone:"centralHull",minCount:4,description:"Need central structure"}],weights:{shapeScore:1.2,symmetryScore:1,zoneAffinityScore:1.1,structuralGoalScore:1.3}},m2={id:"interceptor",name:"Interceptor",description:"Compact, fast interceptor with minimal profile",primaryAxis:"vertical",symmetryAxis:"x",shapeScoreMap:(a,e)=>{const i=a.x-e.x,n=a.y-e.y,r=Math.sqrt(i*i+n*n);let c=0;return r<=3?c+=35-r*8:c-=r*15,n<=0&&(c+=5),Math.abs(i)<=1&&(c+=15),c},featureZones:{core:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)<=1&&Math.abs(n)<=2},wingtips:(a,e)=>{const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)===2&&Math.abs(n)<=1}},blockBiases:{engine:{preferredZones:["core"],bonusInZone:35,penaltyOutsideZone:30},weapon:{preferredZones:["core","wingtips"],bonusInZone:25,penaltyOutsideZone:20},fin:{preferredZones:["wingtips"],bonusInZone:30,penaltyOutsideZone:25}},minimumStructureRules:[{zone:"core",minCount:5,maxCount:12,description:"Compact core design"}],weights:{shapeScore:1.5,symmetryScore:.6,zoneAffinityScore:1.3,structuralGoalScore:1.4}},y2={fighter:g2,carrier:p2,interceptor:m2};function vp(a){return y2[a]||null}function bp(a,e,i,n){return i.some(r=>{const c=n.featureZones[r];return c&&c(a,e)})}function v2(a,e,i){const n=[];for(const[r,c]of Object.entries(i.featureZones))c(a,e)&&n.push(r);return n}function b2(a,e,i,n){if(!i||i==="none")return 0;let r=0;if(i==="x"||i==="both"){const c={x:e.x-(a.x-e.x),y:a.y};n.hasBlockAt(c)?r+=15:r-=5}if(i==="y"||i==="both"){const c={x:a.x,y:e.y-(a.y-e.y)};n.hasBlockAt(c)?r+=15:r-=5}return r}function S2(a,e,i,n){return a.name.toLowerCase().includes("facetplate")?pm(e,i,n):a.name.toLowerCase().includes("fin")?gm(e,i,n):!0}function M2(a,e){const i=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}];let n=!1;for(const r of i){const c={x:a.x+r.x,y:a.y+r.y},h=e.getBlock(c);if(h){const u=h.type.name.toLowerCase();if(!u.includes("fin")&&!u.includes("facetplate")){n=!0;break}}}return n}function gm(a,e,i){let n;switch(e){case 0:n=[{x:a.x+1,y:a.y},{x:a.x,y:a.y+1}];break;case 90:n=[{x:a.x-1,y:a.y},{x:a.x,y:a.y+1}];break;case 180:n=[{x:a.x-1,y:a.y},{x:a.x,y:a.y-1}];break;case 270:n=[{x:a.x+1,y:a.y},{x:a.x,y:a.y-1}];break;default:return!1}for(const r of n){const c=i.getBlock(r);if(c){const h=c.type.name.toLowerCase();if(!h.includes("facetplate")&&!h.includes("fin"))return!0}}return!1}function pm(a,e,i){let n;switch(e){case 0:n={x:a.x,y:a.y+1};break;case 90:n={x:a.x-1,y:a.y};break;case 180:n={x:a.x,y:a.y-1};break;case 270:n={x:a.x+1,y:a.y};break;default:return!1}const r=i.getBlock(n);if(!r)return!1;const c=r.type.name.toLowerCase();return!c.includes("facetplate")&&!c.includes("fin")}function C2(a,e,i){return a.name.toLowerCase().includes("fin")?e.x<i.x?0:90:a.name.toLowerCase().includes("facetplate")?T2(e,i):(a.category==="weapon"||a.category==="engine",0)}function T2(a,e){const i=a.x-e.x,n=a.y-e.y;return Math.abs(i)>=Math.abs(n)?i>0?90:i<0?270:0:n>0?180:0}function w2(a,e,i){const n=a.y-e.y;return n>0?30+n*5:n===0?10:-20}function A2(a,e,i){const n=a.y-e.y,r=Math.abs(a.x-e.x);return n<0?25:n===0&&r>0?20:n>0?5:0}function k2(a,e,i){return bl(a,i)*8}function B2(a,e,i){return Math.abs(a.x-e.x)+Math.abs(a.y-e.y)===1?15:5}function R2(a,e,i){const n=a.x<e.x,r=a.x>e.x;let c=10;if(n){const h={x:a.x-1,y:a.y};i.hasBlockAt(h)||(c+=25)}else if(r){const h={x:a.x+1,y:a.y};i.hasBlockAt(h)||(c+=25)}return c}function E2(a,e,i){const n=a.x<e.x,r=a.x>e.x;return n&&i===0||r&&i===90?20:n&&i===90||r&&i===0?-5:0}function I2(a,e,i,n){let r=5;const c=bl(a,i);c===1?r+=50:c===2?r+=25:c===3?r-=15:r-=30;const h=_2(a,e,n);r+=h;const d=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}].filter(m=>{const y={x:a.x+m.x,y:a.y+m.y};return!i.hasBlockAt(y)}).length;return r+=d*15,Math.abs(a.x-e.x)+Math.abs(a.y-e.y)>=2&&(r+=20),r}function _2(a,e,i){const n=a.x-e.x,r=a.y-e.y;let c;return Math.abs(n)>=Math.abs(r)?c=n>0?90:n<0?270:0:c=r>0?180:0,i===c?30:-10}function x2(a,e){return bl(a,e)*5}function bl(a,e){return[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}].reduce((n,r)=>{const c={x:a.x+r.x,y:a.y+r.y};return e.hasBlockAt(c)?n+1:n},0)}function D2(a,e,i){const n=P2(a,e,i);return n>3?-10*(n-3):bl(a,i)>=2?10:0}function P2(a,e,i){const n=[{coord:e,distance:0}],r=new Set;r.add(`${e.x},${e.y}`);const c=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}];for(;n.length>0;){const h=n.shift();if(h.coord.x===a.x&&h.coord.y===a.y)return h.distance;for(const u of c){const d={x:h.coord.x+u.x,y:h.coord.y+u.y},g=`${d.x},${d.y}`;!r.has(g)&&(i.hasBlockAt(d)||d.x===a.x&&d.y===a.y)&&(r.add(g),n.push({coord:d,distance:h.distance+1}))}}return 999}function Zh(a,e,i,n,r=0,c){let h=0;const u=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),d=c?.5:1;switch(h+=Math.max(0,50-u*3)*d,a.category){case"engine":h+=w2(e,i);break;case"weapon":h+=A2(e,i);break;case"hull":h+=k2(e,i,n);break;case"system":case"utility":h+=B2(e,i);break}if(a.name.toLowerCase().includes("fin")&&(h+=R2(e,i,n),h+=E2(e,i,r)),a.name.toLowerCase().includes("facetplate")&&(h+=I2(e,i,n,r)),h+=x2(e,n),h+=D2(e,i,n),c){const g=c.weights||{},m=c.shapeScoreMap(e,i);h+=m*(g.shapeScore??1);const y=b2(e,i,c.symmetryAxis,n);h+=y*(g.symmetryScore??1);const v=L2(a,e,i,c);h+=v*(g.zoneAffinityScore??1);const M=O2(e,i,n,c);h+=M*(g.structuralGoalScore??1)}return h}function L2(a,e,i,n){const r=n.blockBiases;if(!r)return 0;let c=r[a.name.toLowerCase()];if(!c&&a.category&&(c=r[a.category.toLowerCase()]),c||(a.name.toLowerCase().includes("fin")?c=r.fin:a.name.toLowerCase().includes("facetplate")&&(c=r.facetplate)),!c)return 0;let h=0;return c.preferredZones&&c.preferredZones.length>0&&(bp(e,i,c.preferredZones,n)?h+=c.bonusInZone??20:h-=c.penaltyOutsideZone??10),c.avoidZones&&c.avoidZones.length>0&&bp(e,i,c.avoidZones,n)&&(h-=25),h}function O2(a,e,i,n){if(!n.minimumStructureRules)return 0;let r=0;for(const c of n.minimumStructureRules){const h=n.featureZones[c.zone];if(!h)continue;let u=0;const d=i.getAllBlocks();for(const[g,m]of d)h(g,e)&&u++;if(h(a,e))if(u<c.minCount){const g=c.minCount-u;r+=30+g*10}else c.maxCount&&u>=c.maxCount&&(r-=20)}return r}function F2(a,e,i){const n=a.getCockpitCoord();if(!n)return null;const r=[],c=20;for(let h=-20;h<=c;h++)for(let u=-20;u<=c;u++){const d={x:h,y:u};if(!a.hasBlockAt(d)&&wu(a,d)&&M2(d,a))if(e.name.toLowerCase().includes("facetplate"))for(const g of[0,90,180,270]){if(!pm(d,g,a))continue;const m=Zh(e,d,n,a,g,i);r.push({coord:d,rotation:g,score:m})}else if(e.name.toLowerCase().includes("fin"))for(const g of[0,90,180,270]){if(!gm(d,g,a))continue;const m=Zh(e,d,n,a,g,i);r.push({coord:d,rotation:g,score:m})}else{const g=i?U2(e,d,n,i):C2(e,d,n);if(!S2(e,d,g,a))continue;const m=Zh(e,d,n,a,g,i);r.push({coord:d,rotation:g,score:m})}}return r.length>0?r.reduce((h,u)=>u.score>h.score?u:h):null}function U2(a,e,i,n){return a.category==="weapon"||a.category==="engine"||v2(e,i,n),0}function Sp(a,e,i,n){if(console.log("[autoPlaceBlockWithArchetype]",e.name,n==null?void 0:n.id),!e)return!1;const r=F2(a,e,n);if(!r||!a.placeBlockById(r.coord,e.id,r.rotation))return!1;const h=a.getBlock(r.coord);h!=null&&h.position&&i.createRepairEffect(h.position);const u=e.placementSound??"assets/sounds/sfx/ship/gather_00.wav";return Q.play(u,"sfx",{maxSimultaneous:3}),!0}class $r{constructor(e,i=1,n=2){this.blockType=e,this.baseSpinSpeed=i,this.overlaySpinSpeed=n,this.baseAngle=0,this.overlayAngle=0,this.size=G}update(e){this.baseAngle+=this.baseSpinSpeed*e,this.overlayAngle+=this.overlaySpinSpeed*e,this.baseAngle>Math.PI*2&&(this.baseAngle-=Math.PI*2),this.overlayAngle>Math.PI*2&&(this.overlayAngle-=Math.PI*2)}render(e,i,n,r,c,h=1,u=null){const d=u??this.blockType,g=hi(d.id),m=i+r/2,y=n+c/2;e.save(),e.translate(m,y),e.globalAlpha*=h,e.rotate(this.baseAngle),e.drawImage(g.base,-r/2,-c/2,r,c),e.restore(),g.overlay&&(e.save(),e.translate(m,y),e.globalAlpha*=h,e.rotate(this.overlayAngle),e.drawImage(g.overlay,-r/2,-c/2,r,c),e.restore())}}const N2=new Set(["type","icon","sprite","id","size","canFire","canThrust"]),H2=new Set(["fire.fireType","fire.detonationDelayMs","fire.lifetime","fire.projectileSpeed","haloBladeProperties.color","haloBladeProperties.size","haloBladeProperties.sprite"]);function Mp(a){return H2.has(a)}function W2(a,e,i,n,r,c){if(!e)return n;const h=g=>g.charAt(0).toUpperCase()+g.slice(1),u=g=>g===void 0?"—":typeof g=="boolean"?g?"Yes":"No":typeof g=="number"||typeof g=="string"?g:String(g);let d=n;if(d=pe(a,i,d,"Armor",u(e.armor),"#09f",r,c),d=pe(a,i,d,"Mass",u(e.mass),"#999",r,c),d=pe(a,i,d,"Cost",u(e.cost),"#6f6",r,c),e.behavior){for(const[g,m]of Object.entries(e.behavior))if(!N2.has(g))if(m&&typeof m=="object"&&!Array.isArray(m)){let y=!1;for(const[v,M]of Object.entries(m)){const b=`${g}.${v}`;if(Mp(b))continue;y||(d=pe(a,i,d,h(g),"","#fc6",r,c),y=!0);const C=`• ${h(v)}`;d=pe(a,i,d,C,u(M),"#999",r,c)}}else{if(Mp(g))continue;d=pe(a,i,d,h(g),u(m),"#fc6",r,c)}}return d}class z2{constructor(e,i,n,r,c){this.ship=e,this.inputManager=i,this.open=!1,this.queue=[],this.currentBlockType=null,this.blockPreviewRenderer=null,this.nextBlockPreviewRenderer=null,this.isAutoPlacingAll=!1,this.animationPhase=null,this.slideX=-800,this.targetX=0,this.isAnimating=!1,this.originalZoom=0,this.hoveredButton=null,this.clickedButton=null,this.didAdvance=!1,this.SLIDE_SPEED=1280,this.SETTLE_SPEED=320,this.OVERSHOOT_DISTANCE=40,this.preOpenTimer=0,this.PRE_OPEN_DURATION=300,this.LABEL_FONT_SIZE=14,this.BASE_WINDOW_X=20,this.BASE_WINDOW_Y=20,this.BASE_WINDOW_WIDTH=330,this.BASE_WINDOW_HEIGHT=500,this.BASE_BUTTON_WIDTH=120,this.BASE_BUTTON_HEIGHT=40,this.BASE_BUTTON_VERTICAL_GAP=10,this.BASE_BLOCK_PREVIEW_HEIGHT=82,this.BASE_BLOCK_PREVIEW_WIDTH=82,this.BASE_BLOCK_SPIN_SPEED=1,this.BASE_MINI_PREVIEW_HEIGHT=32,this.BASE_MINI_PREVIEW_WIDTH=32,this.refineButton={},this.autoplaceButton={},this.randomRollButton={},this.autoPlaceAllButton={},this.shipBuilderEffects=n,this.pause=r,this.resume=c,this.initialize()}initialize(){const e=ne(),i=32*e,n=this.BASE_BUTTON_WIDTH*2+i,r=this.BASE_WINDOW_X+(this.BASE_WINDOW_WIDTH-n)/2,c=this.BASE_WINDOW_Y+this.BASE_WINDOW_HEIGHT-(this.BASE_BUTTON_HEIGHT+32)*e;this.refineButton={x:r+this.slideX*e,y:c,width:this.BASE_BUTTON_WIDTH,height:this.BASE_BUTTON_HEIGHT,label:"Refine",onClick:()=>this.handleRefine(),style:{borderRadius:8,alpha:.9,borderColor:"#ffcc00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#332800"},{offset:1,color:"#1f1800"}]},textColor:"#ffffaa"}},this.randomRollButton={x:r+this.slideX*e,y:c-this.BASE_BUTTON_VERTICAL_GAP*e,width:this.BASE_BUTTON_WIDTH,height:this.BASE_BUTTON_HEIGHT,label:"Reroll",onClick:()=>this.handleRoll(),style:{borderRadius:8,alpha:.95,borderColor:"#cc66ff",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#330033"},{offset:1,color:"#1a0022"}]},textColor:"#ffccff"}},this.autoplaceButton={x:r+this.BASE_BUTTON_WIDTH+i+this.slideX*e,y:c,width:this.BASE_BUTTON_WIDTH,height:this.BASE_BUTTON_HEIGHT,label:"Attach",onClick:()=>this.handleAutoplace(),style:{borderRadius:8,alpha:.95,borderColor:"#00ccff",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#003344"},{offset:1,color:"#001a22"}]},textColor:"#aaffff"}},this.autoPlaceAllButton={x:r+this.BASE_BUTTON_WIDTH+i+this.slideX*e,y:c-this.BASE_BUTTON_VERTICAL_GAP*e,width:this.BASE_BUTTON_WIDTH,height:this.BASE_BUTTON_HEIGHT,label:"Attach All",onClick:()=>this.autoPlaceAll(),style:{borderRadius:8,alpha:.95,borderColor:"#66ff66",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#003300"},{offset:1,color:"#001a00"}]},textColor:"#ccffcc"}}}openMenu(){if(!this.queue.length){Q.play("assets/sounds/sfx/ui/error_00.wav","sfx");return}this.open||this.animationPhase!==null||(Q.play("assets/sounds/sfx/ui/activate_01.wav","sfx"),this.slideX=-this.BASE_WINDOW_WIDTH-320,this.animationPhase="pre-open",this.preOpenTimer=this.PRE_OPEN_DURATION,this.open=!0,d2("blockDropDecisionMenu"))}enqueueBlock(e){this.queue.push({blockType:e}),Re.getInstance().enqueueBlock(e),this.updateNextBlockPreview()}updateNextBlockPreview(){var i;const e=this.queue.length>0?(i=this.queue[0])==null?void 0:i.blockType:null;this.nextBlockPreviewRenderer=e?new $r(e,0,0):null}update(e){var d,g;if(!this.open)return;const i=this.inputManager.getMousePosition(),n=this.inputManager.wasMouseClicked(),r=ne();if((d=this.blockPreviewRenderer)==null||d.update(e),(g=this.nextBlockPreviewRenderer)==null||g.update(e),this.animationPhase==="pre-open"){this.preOpenTimer-=e*1e3,this.preOpenTimer<=0&&this.beginSlideIn();return}if(this.isAnimating){if(this.animationPhase==="sliding-in")this.pause(),Ct.getInstance().animateZoomTo(this.getMenuTargetZoom()),this.slideX+=this.SLIDE_SPEED*e,this.slideX>=this.targetX+this.OVERSHOOT_DISTANCE&&(this.animationPhase="settling",this.slideX=this.targetX+this.OVERSHOOT_DISTANCE);else if(this.animationPhase==="settling")this.slideX-=this.SETTLE_SPEED*e,this.slideX<=this.targetX&&(this.slideX=this.targetX,this.animationPhase="open",this.isAnimating=!1);else if(this.animationPhase==="sliding-out"&&(this.slideX-=this.SLIDE_SPEED*e,this.slideX<=-this.BASE_WINDOW_WIDTH-200)){const x=this.ship.getTotalMass();Ce.incrementMassAchieved(x),this.slideX=-this.BASE_WINDOW_WIDTH-320,this.animationPhase=null,this.isAnimating=!1,this.open=!1,this.currentBlockType=null,this.blockPreviewRenderer=null,this.nextBlockPreviewRenderer=null,this.hoveredButton=null,this.clickedButton=null,this.didAdvance=!1,this.resume()}const m=this.slideX*r,y=this.BASE_WINDOW_X*r,v=this.BASE_WINDOW_Y*r,M=this.BASE_WINDOW_WIDTH*r,b=this.BASE_WINDOW_HEIGHT*r,C=this.BASE_BUTTON_WIDTH*r,w=this.BASE_BUTTON_HEIGHT*r,A=32*r,R=C*2+A,I=y+m+(M-R)/2,_=v+b-(w+32);this.refineButton.x=I,this.refineButton.y=_,this.autoplaceButton.x=I+C+A,this.autoplaceButton.y=_,this.autoPlaceAllButton.x=I+C+A,this.autoPlaceAllButton.y=_-w-this.BASE_BUTTON_VERTICAL_GAP*r,this.randomRollButton.x=I,this.randomRollButton.y=_-w-this.BASE_BUTTON_VERTICAL_GAP*r;return}if(!i)return;const{x:c,y:h}=i;if(this.isAutoPlacingAll)return;this.hoveredButton=null,this.clickedButton=null,this.didAdvance=!1;const u=[[this.refineButton,"refine",()=>{this.clickedButton="refine"}],[this.autoplaceButton,"autoplace",()=>{this.clickedButton="autoplace"}],[this.randomRollButton,"roll",()=>{this.clickedButton="roll"}],[this.autoPlaceAllButton,"autoPlaceAll",()=>{this.clickedButton="autoPlaceAll"}]];for(const[m,y,v]of u){const M=Bs(m,c,h,n,r);m.isHovered&&(this.hoveredButton=y),M&&v()}this.inputManager.wasActionJustPressed("cancel")&&(this.refineButton.onClick(),this.clickedButton="refine"),this.inputManager.wasActionJustPressed("select")&&(this.autoplaceButton.onClick(),this.clickedButton="autoplace")}beginSlideIn(){var i;this.initialize(),this.open=!0,this.targetX=0,this.isAnimating=!0,this.animationPhase="sliding-in";const e=Ct.getInstance();this.originalZoom=e.getZoom(),this.currentBlockType=((i=this.queue.shift())==null?void 0:i.blockType)??null,this.blockPreviewRenderer=this.currentBlockType?new $r(this.currentBlockType):null,this.updateNextBlockPreview()}disableButton(e){e.disabled=!0}restoreButtons(){this.isAutoPlacingAll=!1,this.refineButton.disabled=!1,this.autoplaceButton.disabled=!1,this.randomRollButton.disabled=!1,this.autoPlaceAllButton.disabled=!1,this.refineButton.onClick=()=>this.handleRefine(),this.autoplaceButton.onClick=()=>this.handleAutoplace(),this.randomRollButton.onClick=()=>this.handleRoll(),this.autoPlaceAllButton.onClick=()=>this.autoPlaceAll()}handleRefine(){var e;Re.getInstance().addCurrency(((e=this.currentBlockType)==null?void 0:e.cost)??0),Re.getInstance().dequeueBlock(),Q.play("assets/sounds/sfx/ui/coin_00.wav","sfx",{maxSimultaneous:4}),Ce.incrementBlockRefinedCount(),this.advanceQueueOrClose(),this.clickedButton="refine"}handleAutoplace(){if(!this.currentBlockType)return;const e=vp("interceptor");if(!Sp(this.ship,this.currentBlockType,this.shipBuilderEffects,e??void 0)){Q.play("assets/sounds/sfx/ui/error_00.wav","sfx");return}Re.getInstance().dequeueBlock(),Ce.incrementBlockPlacedCount(),this.advanceQueueOrClose(),this.clickedButton="autoplace"}async autoPlaceAll(){if(this.isAutoPlacingAll)return;this.isAutoPlacingAll=!0,this.refineButton.onClick=()=>{},this.autoplaceButton.onClick=()=>{},this.randomRollButton.onClick=()=>{},this.autoPlaceAllButton.onClick=()=>{},this.disableButton(this.refineButton),this.disableButton(this.autoplaceButton),this.disableButton(this.randomRollButton),this.disableButton(this.autoPlaceAllButton);const e=vp("interceptor"),i=300,n=50,r=.85;let c=i;for(;this.currentBlockType&&this.queue.length>=0;){if(!Sp(this.ship,this.currentBlockType,this.shipBuilderEffects,e??void 0)){Q.play("assets/sounds/sfx/ui/error_00.wav","sfx"),this.restoreButtons();return}if(Re.getInstance().dequeueBlock(),Ce.incrementBlockPlacedCount(),this.advanceQueueOrClose(),!this.currentBlockType)break;await new Promise(u=>setTimeout(u,c)),c=Math.max(c*r,n)}this.currentBlockType&&this.restoreButtons(),this.clickedButton="autoPlaceAll"}handleRoll(){if(this.queue.length+1<3||!this.currentBlockType){Q.play("assets/sounds/sfx/ui/error_00.wav","sfx");return}const e=[this.currentBlockType,...this.queue.slice(0,2).map(m=>m.blockType)],i=Math.floor(e.reduce((m,y)=>m+Bg(y),0)/e.length);let n=i;const r=Math.random();r<.02?n=Math.min(i+2,4):r<.15&&(n=Math.min(i+1,4));const c=n-i,h=ub(n);if(!h.length){console.warn(`[handleRoll] No blocks found for tier ${n}`);return}const u=h[Math.floor(Math.random()*h.length)];Re.getInstance().dequeueBlock();for(let m=0;m<2;m++)this.queue.length>0&&(this.queue.shift(),Re.getInstance().dequeueBlock());this.queue.unshift({blockType:u}),Re.getInstance().enqueueBlockToFront(u);const d={0:"assets/sounds/sfx/ui/gamblewin_00.wav",1:"assets/sounds/sfx/ui/gamblewin_01.wav",2:"assets/sounds/sfx/ui/gamblewin_02.wav"},g=d[c]??d[0];Q.play(g,"sfx",{maxSimultaneous:5}),this.advanceQueueOrClose(),this.clickedButton="roll"}advanceQueueOrClose(){var e;this.currentBlockType=((e=this.queue.shift())==null?void 0:e.blockType)??null,this.blockPreviewRenderer=this.currentBlockType?new $r(this.currentBlockType,this.BASE_BLOCK_SPIN_SPEED,this.BASE_BLOCK_SPIN_SPEED*2):null,this.updateNextBlockPreview(),this.currentBlockType?this.didAdvance=!0:(this.isAnimating=!0,this.animationPhase="sliding-out",Ct.getInstance().animateZoomTo(this.originalZoom),this.isAutoPlacingAll=!1,yp("blockDropDecisionMenu"))}render(e){var C;if(this.animationPhase===null&&!this.open)return;const i=ne(),n=this.slideX*i,r=this.BASE_WINDOW_X*i,c=this.BASE_WINDOW_Y*i,h=this.BASE_WINDOW_WIDTH*i,u=this.BASE_WINDOW_HEIGHT*i,d=this.BASE_BLOCK_PREVIEW_HEIGHT*i,g=this.BASE_BLOCK_PREVIEW_WIDTH*i,m=Math.floor(this.LABEL_FONT_SIZE*i),y=this.BASE_MINI_PREVIEW_HEIGHT*i,v=this.BASE_MINI_PREVIEW_WIDTH*i;Mt({ctx:e,x:r+n,y:c,width:h,height:u,options:{borderRadius:12,alpha:.6,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}});const M=this.currentBlockType?Bg(this.currentBlockType):1,b=dm[M]??"#ffffff";if(He(e,r+n+h/2,c+42*i,((C=this.currentBlockType)==null?void 0:C.name)??"",{font:`${m}px monospace`,align:"center",color:Vi(b,.5)}),this.blockPreviewRenderer){const w=r+n+h/2-g/2,A=c+128*i;this.blockPreviewRenderer.render(e,w,A,g,d)}if(this.queue.length>0&&He(e,r+n+16*i,c+16*i,`+${this.queue.length} more`,{font:`${m}px monospace`,align:"left",glow:!1}),this.queue.length>0&&this.nextBlockPreviewRenderer){const w="Next:",A=r+n+h-16*i-v-8*i,R=c+16*i;He(e,A,R,w,{font:`${m}px monospace`,align:"right",glow:!1});const I=r+n+h-16*i-v,_=c+8*i;this.nextBlockPreviewRenderer.render(e,I,_,v,y)}if(this.currentBlockType){const w=r+n+32*i,A=c+128*i+d+32*i,R=h-64*i;W2(e,this.currentBlockType,w,A,R,i)}(this.animationPhase==="open"||this.currentBlockType)&&(ht(e,this.refineButton,i),ht(e,this.autoplaceButton,i),ht(e,this.randomRollButton,i),ht(e,this.autoPlaceAllButton,i))}getCurrentBlockType(){return this.currentBlockType}isOpen(){return this.open}closeMenu(){this.open=!1,this.queue.length=0,this.currentBlockType=null,this.nextBlockPreviewRenderer=null,yp("blockDropDecisionMenu")}isBlocking(){return this.open}isPointInBounds(e,i){const n=ne(),r=this.BASE_WINDOW_X+this.slideX*n,c=r+this.BASE_WINDOW_WIDTH*n,h=this.BASE_WINDOW_Y+this.BASE_WINDOW_HEIGHT*n;return e>=r&&e<=c&&i>=this.BASE_WINDOW_Y&&i<=h}hasBlocksInQueue(){return this.queue.length>0}getMenuTargetZoom(){return .5*ne()}getHoveredButton(){return this.hoveredButton}getClickedButton(){return this.clickedButton}didAdvanceQueue(){return this.didAdvance}destroy(){this.pause=()=>{},this.resume=()=>{},this.nextBlockPreviewRenderer=null}}class G2{constructor(e,i,n,r,c){this.ship=e,this.menu=i,this.camera=n,this.shipBuilderEffects=r,this.inputManager=c,this.rotation=0,this.lastBlockId=null,this.hoveredShipCoord=null}update(e){var h,u;this.inputManager.wasKeyJustPressed("Space")&&(this.rotation=(this.rotation+90)%360);const i=this.inputManager.getMousePosition();if(this.isCursorOverMenu(i))return;const n=la(i,this.camera,e.position,e.rotation);this.hoveredShipCoord=n;const r=this.menu.getCurrentBlockType(),c=(r==null?void 0:r.id)??null;if(!(!c||!r)){if(this.inputManager.wasRightClicked()&&this.hoveredShipCoord){const d=this.ship.getBlock(this.hoveredShipCoord);if(!d)return;if(!d.type.id.startsWith("cockpit")){if(!this.ship.isDeletionSafe(this.hoveredShipCoord)){Q.play("assets/sounds/sfx/ui/error_00.wav","sfx",{maxSimultaneous:3});return}const m=((h=ci(d.type.id))==null?void 0:h.cost)??0,y=Math.round(m/2);this.shipBuilderEffects.createSellEffect(d.position),this.ship.removeBlock(this.hoveredShipCoord),Q.play("assets/sounds/sfx/ui/click_00.wav","sfx",{maxSimultaneous:3}),Re.getInstance().addCurrency(y)}}if(c!==this.lastBlockId&&(this.rotation=0,this.lastBlockId=c),this.inputManager.wasMouseClicked()&&!this.ship.hasBlockAt(n)&&wu(this.ship,n)){this.ship.placeBlockById(n,c,this.rotation);const d=this.ship.getBlock(n);d!=null&&d.position&&this.shipBuilderEffects.createRepairEffect(d.position);const g=((u=ci(c))==null?void 0:u.placementSound)??"assets/sounds/sfx/ship/gather_00.wav";Q.play(g,"sfx",{maxSimultaneous:3}),Ce.incrementBlockPlacedCount(),Re.getInstance().dequeueBlock(),this.menu.advanceQueueOrClose()}}}render(e,i){const n=this.inputManager.getMousePosition();if(this.isCursorOverMenu(n))return;const r=la(n,this.camera,i.position,i.rotation),c=r.x*G,h=r.y*G,u=Math.cos(i.rotation),d=Math.sin(i.rotation),g=c*u-h*d,m=c*d+h*u,y=i.position.x+g,v=i.position.y+m,M=this.camera.worldToScreen(y,v);e.save(),e.translate(M.x,M.y),e.scale(this.camera.getZoom(),this.camera.getZoom()),e.rotate(i.rotation);const b=this.menu.getCurrentBlockType(),C=(b==null?void 0:b.id)??null;if(!C){e.restore();return}if(this.ship.getBlock(r)){const A=this.ship.isDeletionSafe(r);Tu(e,A)}else{const A=hi(C);e.save(),e.rotate(this.rotation*Math.PI/180),e.globalAlpha=.6,e.drawImage(A.base,-32/2,-32/2,G,G),e.restore()}e.restore()}isCursorOverMenu(e){return this.menu.isPointInBounds(e.x,e.y)}getHoveredShipBlock(){return this.hoveredShipCoord?this.ship.getBlock(this.hoveredShipCoord):void 0}}const V2={boxColor:"#222",checkColor:"#0f0",hoverColor:"#444",labelColor:"#ccc",borderColor:"#0f0",font:"12px monospace"};function Kh(a,e,i=1){const{x:n,y:r,size:c,label:h,checked:u,isHovered:d,style:g={}}=e,{boxColor:m,checkColor:y,hoverColor:v,labelColor:M,borderColor:b,font:C}={...V2,...g},w=c*i,A=C.replace(/(\d+)(px)/,(R,I,_)=>`${Math.round(parseInt(I)*i)}${_}`);a.fillStyle=d?v:m,a.fillRect(n,r,w,w),a.strokeStyle=b,a.lineWidth=1*i,a.strokeRect(n,r,w,w),u&&(a.strokeStyle=y,a.lineWidth=2*i,a.beginPath(),a.moveTo(n+3*i,r+w/2),a.lineTo(n+w/2,r+w-3*i),a.lineTo(n+w-3*i,r+3*i),a.stroke()),h&&(a.font=A,a.fillStyle=M,a.textAlign="left",a.textBaseline="middle",a.fillText(h,n+w+8*i,r+w/2))}function en(a,e,i,n){const r=i.x,c=i.y,h=i.width*n,u=i.height*n;return a>=r&&a<=r+h&&e>=c&&e<=c+u}function X2(a,e,i){const{x:n,y:r,width:c,height:h,isOpen:u,items:d}=a,g={x:n,y:r,width:c,height:h},m=en(e.x,e.y,g,i);if(!u)return{isHovered:m};const y=h*i;for(let v=0;v<d.length;v++){const M=r+h*i+v*y,b={x:n,y:M,width:c,height:h};if(en(e.x,e.y,b,i))return{isHovered:m,hoverIndex:v}}return{isHovered:m}}const Y2={barColor:"#0f0",knobColor:"#6f6",backgroundColor:"#111",borderColor:"#0f0",labelColor:"#ccc"};function q2(a,e,i=1,n,r=!0){const{x:c,y:h,width:u,height:d,value:g,style:m={},isHovered:y}=e,{barColor:v,knobColor:M,backgroundColor:b,borderColor:C,labelColor:w}={...Y2,...m},A=u*i,R=d*i,I=`${Math.round(12*i)}px monospace`,_=h+R/2;a.fillStyle=b,a.fillRect(c,h,A,R);const x=Math.round(g*A);a.fillStyle=v,a.fillRect(c,h,x,R);const N=c+x,W=R/2;a.beginPath(),a.arc(N,_,W,0,Math.PI*2),a.fillStyle=y?"#fff":M,a.fill(),a.strokeStyle=C,a.lineWidth=1*i,a.strokeRect(c,h,A,R);let z=c+A;if(a.font=I,a.fillStyle=w,a.textAlign="left",a.textBaseline="middle",r){const q=8*i;z+=q;const ie=`${Math.round(g*100)}%`;a.fillText(ie,z,_);const ee=a.measureText(ie);z+=ee.width}if(n){const q=12*i;z+=q,a.fillText(n,z,_)}}function j2(a,e,i=1,n){const{x:r,y:c,width:h,height:u,items:d,selectedIndex:g,isOpen:m,hoverIndex:y,isHovered:v,style:M={}}=e,{backgroundColor:b="#001100",borderColor:C="#00ff41",textColor:w="#00ff41",font:A='13px "Courier New", monospace',glow:R=!0,chromaticAberration:I=!0,alpha:_=1}=M,x=h*i,N=u*i,W=A.replace(/(\d+)(px)/,(Z,se,D)=>`${Math.round(parseInt(se)*i)}${D}`),z=.5*i,q=v?Vi(C,.8):C,ie=v?Vi(w,.8):w;a.save(),a.globalAlpha=_,a.fillStyle=b,a.fillRect(r,c,x,N),R&&(a.shadowColor=q,a.shadowBlur=8*i),a.strokeStyle=q,a.lineWidth=2*i,a.strokeRect(r,c,x,N),a.restore();const ee=r+6*i,K=c+N/2,le=d[g];if(a.save(),a.font=W,a.textAlign="left",a.textBaseline="middle",R&&(a.shadowColor=ie,a.shadowBlur=4*i),I&&(a.save(),a.globalAlpha=.25,a.shadowBlur=0,a.fillStyle="#ff0000",a.fillText(le.label,ee-z,K),a.fillStyle="#0000ff",a.fillText(le.label,ee+z,K),a.restore()),a.globalAlpha=1,a.fillStyle=ie,a.fillText(le.label,ee,K),a.restore(),He(a,r+x+12,c+N/2,n,{font:W,color:"#ccc",align:"left"}),m){const Z=N;d.forEach((se,D)=>{const X=c+N+D*Z,te=y===D,ae=te?Vi(b,.2):b,k=te?Vi(w,.8):w;a.save(),a.globalAlpha=_,a.fillStyle=ae,a.fillRect(r,X,x,Z),R&&(a.shadowColor=C,a.shadowBlur=6*i),a.strokeStyle=C,a.lineWidth=1*i,a.strokeRect(r,X,x,Z),a.font=W,a.textAlign="left",a.textBaseline="middle";const H=X+Z/2;I&&(a.save(),a.globalAlpha=.25,a.shadowBlur=0,a.fillStyle="#ff0000",a.fillText(se.label,ee-z,H),a.fillStyle="#0000ff",a.fillText(se.label,ee+z,H),a.restore()),a.globalAlpha=1,a.fillStyle=k,a.fillText(se.label,ee,H),a.restore()})}}const Z2=[{kind:"master"},{kind:"channel",channel:"music"},{kind:"channel",channel:"sfx"},{kind:"channel",channel:"dialogue"}],K2={master:()=>we.getInstance().getMasterVolume(),music:()=>we.getInstance().getMusicVolume(),sfx:()=>we.getInstance().getSfxVolume(),dialogue:()=>we.getInstance().getDialogueVolume()},Q2={master:a=>we.getInstance().setMasterVolume(a),music:a=>we.getInstance().setMusicVolume(a),sfx:a=>we.getInstance().setSfxVolume(a),dialogue:a=>we.getInstance().setDialogueVolume(a)};class $2{constructor(e,i,n,r){this.activeTab="display",this.open=!1,this.volumeLabels=["Master Volume","Music Volume","Sound Effects","Dialogue Volume"],this.closeButton=null,this.volumeSliders=[],this.particleCheckbox=null,this.lightingCheckbox=null,this.collisionsCheckbox=null,this.resolutionDropdown=null,this.windowX=120,this.windowY=80,this.windowHeight=460,this.windowWidth=440,this.headerStartY=20,this.headerStartX=80,this.headerHeight=40,this.headerItemWidth=80,this.headerHorizontalPadding=12,this.headerVerticalPadding=6,this.buttonWidth=120,this.buttonHeight=40,this.sliderWidth=120,this.sliderHeight=12,this.dropdownWidth=120,this.dropdownHeight=28,this.checkboxSize=14,this.itemVerticalSpacing=40,this.margin=20,this.inputManager=e,this.menuManager=i,this.canvasManager=n,this.camera=r,this.initialize()}initialize(){const e=we.getInstance(),i=ne(),n=this.margin*i,r=this.headerHeight*i,c=this.itemVerticalSpacing*i,h=this.windowHeight*i,u=this.windowWidth*i,d=this.buttonWidth*i,g=this.buttonHeight*i,m=160,y=this.windowY+n+r;this.closeButton={x:this.windowX+u-d-n,y:this.windowY+h-g-n,width:this.buttonWidth,height:this.buttonHeight,label:"Close",onClick:()=>{const b=this.menuManager.getMenu("pauseMenu");b&&this.menuManager.transition(b)},style:{borderRadius:10,alpha:.8,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}},this.volumeSliders=Z2.map((b,C)=>{const w=b.kind==="master"?"master":b.channel;return{x:m,y:y+C*c,width:this.sliderWidth,height:this.sliderHeight,value:K2[w](),onChange:A=>{Q2[w](A),lt.getInstance().saveSettings()}}}),this.particleCheckbox={x:m,y,size:this.checkboxSize,label:"Particles Enabled",checked:e.isParticlesEnabled(),onToggle:b=>{this.particleCheckbox.checked=b,e.setParticlesEnabled(b),lt.getInstance().saveSettings()}},this.lightingCheckbox={x:m,y:y+c,size:this.checkboxSize,label:"Lighting Enabled",checked:e.isLightingEnabled(),onToggle:b=>{this.lightingCheckbox.checked=b,e.setLightingEnabled(b),lt.getInstance().saveSettings()}},this.collisionsCheckbox={x:m,y:y+c*2,size:this.checkboxSize,label:"Collisions Enabled",checked:e.isCollisionsEnabled(),onToggle:b=>{this.collisionsCheckbox.checked=b,e.setCollisionsEnabled(b),lt.getInstance().saveSettings()}};const v=`${e.getViewportWidth()}x${e.getViewportHeight()}`,M=[{label:"1920x1080",value:"1920x1080"},{label:"1920x1200",value:"1920x1200"},{label:"2560x1440",value:"2560x1440"},{label:"3840x2160",value:"3840x2160"}];this.resolutionDropdown={x:m,y:y+c*3,width:this.dropdownWidth,height:this.dropdownHeight,items:M,selectedIndex:M.findIndex(b=>b.value===v)||0,isOpen:!1,onSelect:b=>{const[C,w]=b.value.split("x");e.setViewportWidth(parseInt(C,10)),e.setViewportHeight(parseInt(w,10)),ol(this.canvasManager,this.camera),lt.getInstance().saveSettings(),this.initialize()},style:{backgroundColor:"#001100",borderColor:"#00ff41",textColor:"#00ff41",glow:!0,chromaticAberration:!0,alpha:1}}}update(){var g,m,y,v,M;const e=this.inputManager.getMousePosition(),i=(m=(g=this.inputManager).wasLeftClicked)==null?void 0:m.call(g),n=(v=(y=this.inputManager).isMouseLeftPressed)==null?void 0:v.call(y),r=ne(),c=this.headerItemWidth*r,h=this.headerHorizontalPadding*r;if(i){const b=this.headerStartX+this.windowX,C=this.headerStartY+this.windowY,w=[{tab:"display",label:"General"},{tab:"volume",label:"Volume"},{tab:"controls",label:"Controls"},{tab:"keybinds",label:"Keybinds"}];for(let A=0;A<w.length;A++){const R=b+A*(c+h);if(en(e.x,e.y,{x:R,y:C+this.headerVerticalPadding*r,width:this.headerItemWidth,height:this.headerHeight},r)){this.activeTab=w[A].tab;break}}}if(this.activeTab==="display")for(const b of[this.particleCheckbox,this.lightingCheckbox,this.collisionsCheckbox]){if(!b)continue;const C={x:b.x,y:b.y,width:b.size,height:b.size};b.isHovered=en(e.x,e.y,C,r),i&&b.isHovered&&b.onToggle(!b.checked)}if(this.activeTab==="volume")for(const b of this.volumeSliders){const C={x:b.x,y:b.y,width:b.width,height:b.height};if(b.isHovered=en(e.x,e.y,C,r),n&&b.isHovered){const w=e.x-b.x,A=Math.min(1,Math.max(0,w/(b.width*r)));b.value=A,b.onChange(A),b.isDragging=!0}else n||(b.isDragging=!1)}const u=this.resolutionDropdown;if(u){const{isHovered:b,hoverIndex:C}=X2(u,e,r);u.isHovered=b,u.hoverIndex=C,i&&b&&C===void 0&&(u.isOpen=!u.isOpen),u.isOpen&&typeof C=="number"&&i&&(u.selectedIndex=C,u.isOpen=!1,(M=u.onSelect)==null||M.call(u,u.items[C]))}const d=this.closeButton;if(d){const b={x:d.x,y:d.y,width:d.width,height:d.height};d.isHovered=en(e.x,e.y,b,r),i&&d.isHovered&&d.onClick()}}render(e){const i=ne(),n=this.headerItemWidth*i,r=this.headerHorizontalPadding*i;if(Mt({ctx:e,x:this.windowX,y:this.windowY,width:this.windowWidth,height:this.windowHeight,uiScale:i,options:{alpha:.6,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}}),[{tab:"display",label:"General"},{tab:"volume",label:"Volume"},{tab:"controls",label:"Controls"},{tab:"keybinds",label:"Keybinds"}].forEach((h,u)=>{He(e,this.headerStartX+this.windowX+u*(n+r),this.headerStartY+this.windowY+this.headerVerticalPadding*i,h.label,{font:"16px monospace",align:"left",color:this.activeTab===h.tab?"#6f6":"#888"},i)}),this.activeTab==="display")Kh(e,this.particleCheckbox,i),Kh(e,this.lightingCheckbox,i),Kh(e,this.collisionsCheckbox,i),j2(e,this.resolutionDropdown,i,"Resolution");else if(this.activeTab==="volume")for(let h=0;h<this.volumeSliders.length;h++){const u=this.volumeSliders[h],d=this.volumeLabels[h];q2(e,u,i,d)}else this.activeTab==="controls"?He(e,this.windowX+this.margin*i,this.windowY+100*i,"Controls tab coming soon...",{font:"14px monospace",align:"left",color:"#ccc"},i):this.activeTab==="keybinds"&&He(e,this.windowX+this.margin*i,this.windowY+100*i,"Keybinds tab coming soon...",{font:"14px monospace",align:"left",color:"#ccc"},i);ht(e,this.closeButton,i)}isOpen(){return this.open}openMenu(){this.open=!0}closeMenu(){this.open=!1}isBlocking(){return!0}}class J2{constructor(e,i,n){this.inputManager=e,this.onAbandon=i,this.menuManager=n,this.open=!1,this.windowX=120,this.windowY=100,this.windowWidth=220,this.windowHeight=240,this.buttonWidth=140,this.buttonHeight=40,this.sharedStyle={borderRadius:10,alpha:.9,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}},this.disabledStyle={borderRadius:10,alpha:.5,borderColor:"#445544",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#111911"},{offset:1,color:"#0a120a"}]}},this.settingsButton={},this.abandonButton={},this.resumeButton={},this.initialize()}initialize(){const e=ne(),i=this.buttonHeight*e,n=i*.5,r=this.windowWidth*e,c=this.windowHeight*e,h=.2*r+this.windowX,u=.2*c+this.windowY;this.settingsButton={x:h,y:u,width:this.buttonWidth,height:this.buttonHeight,label:"Settings",onClick:()=>{const d=this.menuManager.getMenu("settingsMenu");d&&this.menuManager.transition(d)},style:this.sharedStyle},this.abandonButton={x:h,y:u+n*1+i*1,width:this.buttonWidth,height:this.buttonHeight,label:"Abandon Mission",onClick:Be.has("mission.intro-briefing.complete")?this.onAbandon:()=>{},style:Be.has("mission.intro-briefing.complete")?this.sharedStyle:this.disabledStyle},this.resumeButton={x:h,y:u+n*2+i*2,width:this.buttonWidth,height:this.buttonHeight,label:"Resume",onClick:()=>{this.menuManager.close(this),this.menuManager.resume()},style:this.sharedStyle}}update(){const e=ne(),i=this.inputManager.getMousePosition(),n=this.inputManager.wasMouseClicked();if(!i)return;const{x:r,y:c}=i,h=[this.settingsButton,this.abandonButton,this.resumeButton];for(const u of h){const d={x:u.x,y:u.y,width:u.width,height:u.height};u.isHovered=en(r,c,d,e)}n&&(this.settingsButton.isHovered?this.settingsButton.onClick():this.abandonButton.isHovered?this.abandonButton.onClick():this.resumeButton.isHovered&&this.resumeButton.onClick())}render(e){const i=ne();Mt({ctx:e,x:this.windowX,y:this.windowY,width:this.windowWidth,height:this.windowHeight,uiScale:i,options:{alpha:.5,borderRadius:12,borderColor:"#00ff00",backgroundGradient:{type:"linear",stops:[{offset:0,color:"#002200"},{offset:1,color:"#001500"}]}}}),He(e,this.windowX+this.windowWidth*i/2,this.windowY+10*i,"Game Paused",{font:"16px monospace",align:"center",glow:!0},i),ht(e,this.settingsButton,i),ht(e,this.abandonButton,i),ht(e,this.resumeButton,i)}isOpen(){return this.open}openMenu(){this.initialize(),this.open=!0}closeMenu(){this.open=!1}isBlocking(){return!0}}const ru={barColor:"#00ff41",backgroundColor:"#0a0a0a",borderColor:"#00ff41",textColor:"#00ff41",glow:!0,font:'11px "Courier New", monospace',scanlineIntensity:.3,chromaticAberration:!0,phosphorDecay:!0,cornerBevel:!0,warningThreshold:.3,criticalThreshold:.15,warningColor:"#ffaa00",criticalColor:"#ff0040",animated:!0};class ia{constructor(){this.cache=new Map,this.maxCacheSize=50,this.maxAge=3e4}static getInstance(){return ia.instance||(ia.instance=new ia),ia.instance}generateCacheKey(e,i){const{width:n,height:r,style:c={}}=e,h={...ru,...c},u=Math.max(0,Math.min(1,e.value));let d=h.borderColor;switch(u<=h.criticalThreshold?d=h.criticalColor:u<=h.warningThreshold&&(d=h.warningColor),i){case"background":return`bg_${n}_${r}_${h.backgroundColor}_${h.cornerBevel}`;case"border":return`border_${n}_${r}_${d}_${h.cornerBevel}`;case"scanlines":return`scan_${n}_${r}_${h.scanlineIntensity}`;default:return""}}getOrCreate(e,i){const n=this.generateCacheKey(e,i),r=this.cache.get(n);if(r&&Date.now()-r.timestamp<this.maxAge)return r;this.cleanup();const c=document.createElement("canvas");c.width=e.width+20,c.height=e.height+20;const h=c.getContext("2d"),u={canvas:c,ctx:h,cacheKey:n,timestamp:Date.now()};return this.renderStaticElement(e,i,h),this.cache.set(n,u),u}renderStaticElement(e,i,n){const{width:r,height:c,style:h={}}=e,u={...ru,...h},d=10,g=10;switch(i){case"background":this.renderBackground(n,d,g,r,c,u);break;case"border":const m=Math.max(0,Math.min(1,e.value));let y=u.borderColor;m<=u.criticalThreshold?y=u.criticalColor:m<=u.warningThreshold&&(y=u.warningColor),this.renderBorder(n,d,g,r,c,{...u,borderColor:y});break;case"scanlines":this.renderScanlines(n,d,g,r,c,u);break}}renderBackground(e,i,n,r,c,h){if(e.save(),h.cornerBevel){const d=Math.min(3,c*.2);e.beginPath(),e.moveTo(i+d,n),e.lineTo(i+r-d,n),e.lineTo(i+r,n+d),e.lineTo(i+r,n+c-d),e.lineTo(i+r-d,n+c),e.lineTo(i+d,n+c),e.lineTo(i,n+c-d),e.lineTo(i,n+d),e.closePath(),e.clip()}const u=e.createLinearGradient(i,n,i,n+c);u.addColorStop(0,$t(h.backgroundColor,"ff")),u.addColorStop(.5,$t(h.backgroundColor,"cc")),u.addColorStop(1,$t(h.backgroundColor,"ff")),e.fillStyle=u,e.fillRect(i,n,r,c),e.restore()}renderBorder(e,i,n,r,c,h){if(e.save(),e.strokeStyle=h.borderColor,e.lineWidth=2,h.cornerBevel){const d=Math.min(3,c*.2);e.beginPath(),e.moveTo(i+d,n),e.lineTo(i+r-d,n),e.lineTo(i+r,n+d),e.lineTo(i+r,n+c-d),e.lineTo(i+r-d,n+c),e.lineTo(i+d,n+c),e.lineTo(i,n+c-d),e.lineTo(i,n+d),e.closePath(),e.stroke()}else e.strokeRect(i,n,r,c);e.strokeStyle=`${h.borderColor}40`,e.lineWidth=1,e.strokeRect(i+1,n+1,r-2,c-2),e.strokeStyle=h.borderColor,e.lineWidth=2,e.globalAlpha=.7;const u=Math.min(8,c*.4);e.beginPath(),e.moveTo(i-4,n+u),e.lineTo(i-4,n-4),e.lineTo(i+u,n-4),e.stroke(),e.beginPath(),e.moveTo(i+r-u,n-4),e.lineTo(i+r+4,n-4),e.lineTo(i+r+4,n+u),e.stroke(),e.beginPath(),e.moveTo(i+r+4,n+c-u),e.lineTo(i+r+4,n+c+4),e.lineTo(i+r-u,n+c+4),e.stroke(),e.beginPath(),e.moveTo(i+u,n+c+4),e.lineTo(i-4,n+c+4),e.lineTo(i-4,n+c-u),e.stroke(),e.restore()}renderScanlines(e,i,n,r,c,h){if(h.scanlineIntensity<=0)return;e.save();const u=2,d=1;e.fillStyle=`rgba(255, 255, 255, ${h.scanlineIntensity*.08})`;for(let g=0;g<c+u;g+=u)n+g>=n&&n+g<n+c&&e.fillRect(i,n+g,r,d);e.restore()}cleanup(){if(this.cache.size<=this.maxCacheSize)return;const e=Date.now(),i=Array.from(this.cache.entries());i.forEach(([n,r])=>{e-r.timestamp>this.maxAge&&this.cache.delete(n)}),this.cache.size>this.maxCacheSize&&i.sort((r,c)=>r[1].timestamp-c[1].timestamp).slice(0,this.cache.size-this.maxCacheSize).forEach(([r])=>this.cache.delete(r))}clear(){this.cache.clear()}}class sa{constructor(){this.cache=new Map}static getInstance(){return sa.instance||(sa.instance=new sa),sa.instance}getBarGradient(e,i,n,r,c,h,u){const d=`bar_${r}_${c}_${h}_${u}`;if(!this.cache.has(d)){const g=e.createLinearGradient(i,n,i,n+c),m=Math.floor(u*255).toString(16).padStart(2,"0"),y=Math.floor(u*180).toString(16).padStart(2,"0");g.addColorStop(0,$t(h,m)),g.addColorStop(.5,$t(h,y)),g.addColorStop(1,$t(h,m)),this.cache.set(d,g)}return this.cache.get(d)}getPhosphorGradient(e,i,n,r,c){const h=`phosphor_${n}_${r}_${c}`;if(!this.cache.has(h)){const u=e.createLinearGradient(i,0,i+n,0);u.addColorStop(0,$t(r,"08")),u.addColorStop(.7,$t(r,"15")),u.addColorStop(1,$t(r,Math.floor(c*255).toString(16).padStart(2,"0"))),this.cache.set(h,u)}return this.cache.get(h)}clear(){this.cache.clear()}}function Cp(a,e,i=Date.now()){const{x:n,y:r,width:c,height:h,value:u,label:d,style:g={}}=e,m={...ru,...g},{barColor:y,glow:v,textColor:M,font:b,scanlineIntensity:C,chromaticAberration:w,phosphorDecay:A,warningThreshold:R,criticalThreshold:I,warningColor:_,criticalColor:x,animated:N}=m,W=Math.max(0,Math.min(1,u)),z=W*c;let q=y;W<=I?q=x:W<=R&&(q=_);let ie=1,ee=0;N&&(W<=I&&(ie=.7+.3*Math.sin(i*.008)),ee=i*.02%4);const K=ia.getInstance(),le=sa.getInstance(),Z=K.getOrCreate(e,"background");if(Z&&a.drawImage(Z.canvas,n-10,r-10),A&&z>0){const D=le.getPhosphorGradient(a,n,z,q,ie);a.fillStyle=D,a.fillRect(n,r,z,h)}if(z>0){const D=le.getBarGradient(a,n,r,c,h,q,ie);a.fillStyle=D,a.fillRect(n,r,z,h)}if(v&&z>0&&(a.save(),a.shadowColor=q,a.shadowBlur=12,a.shadowOffsetX=0,a.shadowOffsetY=0,a.globalAlpha=.4*ie,a.fillStyle=q,a.fillRect(n-1,r-1,z+2,h+2),a.shadowBlur=6,a.globalAlpha=.6*ie,a.fillRect(n,r,z,h),a.restore()),w&&z>0&&(a.save(),a.globalAlpha=.15,a.fillStyle="#ff0000",a.fillRect(n-.5,r,z,h),a.fillStyle="#0000ff",a.fillRect(n+.5,r,z,h),a.restore()),C>0){const D=K.getOrCreate(e,"scanlines");if(D){if(a.save(),a.globalAlpha=1,a.drawImage(D.canvas,n-10,r-10-ee),N&&Math.sin(i*.003)>.95){a.fillStyle=`rgba(255, 255, 255, ${C*.2})`;const X=r+(Math.sin(i*.007)*.5+.5)*h;a.fillRect(n,X,c,1)}a.restore()}}const se=K.getOrCreate(e,"border");se&&(a.save(),a.globalAlpha=ie,a.drawImage(se.canvas,n-10,r-10),a.restore()),d&&(a.save(),a.font=b,a.fillStyle=M,a.textAlign="center",a.textBaseline="middle",a.globalAlpha=ie,v&&(a.shadowColor=M,a.shadowBlur=4,a.shadowOffsetX=0,a.shadowOffsetY=0),w&&(a.save(),a.globalAlpha=.3,a.fillStyle="#ff000040",a.fillText(d,n+c/2-.5,r+h/2),a.fillStyle="#0000ff40",a.fillText(d,n+c/2+.5,r+h/2),a.restore()),a.fillText(d,n+c/2,r+h/2),a.restore()),W<=I&&(a.save(),a.fillStyle=x,a.globalAlpha=(Math.sin(i*.015)+1)*.3,a.fillRect(n-2,r-2,4,4),a.fillRect(n+c-2,r-2,4,4),a.restore())}const mm={barColor:"#0af",backgroundColor:"#111",borderColor:"#0ff",glow:!0,textColor:"#fff",showLabel:!0,unit:""};class na{constructor(){this.cache=new Map,this.maxAge=3e4}static getInstance(){return na.instance||(na.instance=new na),na.instance}getOrCreate(e,i){const{width:n,height:r,style:c={}}=e,h={...mm,...c},u=Math.round(n*i),d=Math.round(r*i),g=`vbar_${u}_${d}_${h.backgroundColor}_${h.borderColor}`,m=this.cache.get(g);if(m&&Date.now()-m.timestamp<this.maxAge)return m;const y=document.createElement("canvas");y.width=u+4,y.height=d+4;const v=y.getContext("2d");v.save(),v.fillStyle=h.backgroundColor,v.fillRect(2,2,u,d),v.strokeStyle=h.borderColor,v.lineWidth=1,v.strokeRect(1.5,1.5,u+1,d+1),v.fillStyle="rgba(255,255,255,0.05)";for(let b=0;b<d;b+=2)v.fillRect(2,2+b,u,1);v.restore();const M={canvas:y,ctx:v,cacheKey:g,timestamp:Date.now()};return this.cache.set(g,M),M}clear(){this.cache.clear()}}function eM(a,e,i=1){const{x:n,y:r,width:c,height:h,value:u,maxValue:d,style:g={}}=e,{barColor:m,glow:y,textColor:v,showLabel:M,unit:b}={...mm,...g},C=c*i,w=h*i,R=Math.max(0,Math.min(u,d))/d*w,I=r+w-R,_=na.getInstance().getOrCreate(e,i);if(a.drawImage(_.canvas,n-2,r-2),a.fillStyle=m,a.fillRect(n,I,C,R),y&&(a.save(),a.shadowColor=m,a.shadowBlur=8*i,a.shadowOffsetX=0,a.shadowOffsetY=0,a.fillStyle=m,a.fillRect(n,I,C,R),a.restore()),M){a.save(),a.font=`${Math.round(11*ne())}px monospace`,a.fillStyle=v,a.textAlign="center",a.textBaseline="bottom";const x=`${Math.round(u)}${b?` ${b}`:""}`;a.fillText(x,n+C/2,r-4*ne()),a.restore()}}var Ht=(a=>(a.Synced="synced",a.Sequence="sequence",a))(Ht||{});function tM(a,e,i=performance.now()){const{x:n,y:r,mode:c,style:h={}}=e,{width:u=120,height:d=24,backgroundColor:g="#001122",borderColor:m="#0066cc",activeColor:y="#00aaff",inactiveColor:v="#003366",textColor:M="#00ccff",glowColor:b="#00aaff",font:C='10px "Courier New", monospace',glow:w=!0,animated:A=!0,scanlineIntensity:R=.2,chromaticAberration:I=!0}=h,_=c===Ht.Synced,x=4,N=u*.45,W=d-6,z=r+3,q=_?n+3:n+u-N-3,ee=A?Math.sin(i*.008)*.5:0,K=q+ee;a.save(),w&&(a.shadowColor=b,a.shadowBlur=8,a.shadowOffsetX=0,a.shadowOffsetY=0),a.fillStyle=g,a.strokeStyle=m,a.lineWidth=1,a.beginPath(),a.roundRect(n,r,u,d,x),a.fill(),a.stroke(),a.shadowBlur=0,a.fillStyle=M,a.font=C,a.textAlign="center",a.textBaseline="middle";const le=_?1:.4;a.save(),a.globalAlpha=le,a.fillText("SYNC",n+u*.25,r+d*.5),a.restore();const Z=_?.4:1;a.save(),a.globalAlpha=Z,a.fillText("SEQ",n+u*.75,r+d*.5),a.restore();const se=_?y:"#ff6600";w&&(a.save(),a.shadowColor=se,a.shadowBlur=6,a.fillStyle=se,a.globalAlpha=.3,a.beginPath(),a.roundRect(K-2,z-2,N+4,W+4,x),a.fill(),a.restore()),a.fillStyle=se,a.strokeStyle=se,a.lineWidth=1,a.beginPath(),a.roundRect(K,z,N,W,x-1),a.fill();const D=a.createLinearGradient(K,z,K,z+W);if(D.addColorStop(0,"rgba(255, 255, 255, 0.3)"),D.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),D.addColorStop(1,"rgba(0, 0, 0, 0.2)"),a.fillStyle=D,a.beginPath(),a.roundRect(K,z,N,W*.6,x-1),a.fill(),R>0){a.save(),a.globalAlpha=R,a.strokeStyle="#00ffff",a.lineWidth=.5;for(let ae=0;ae<d;ae+=3)a.beginPath(),a.moveTo(n,r+ae),a.lineTo(n+u,r+ae),a.stroke();a.restore()}if(I&&A){const ae=Math.sin(i*.003)*.5;a.save(),a.globalAlpha=.1,a.globalCompositeOperation="screen",a.fillStyle="#ff0000",a.beginPath(),a.roundRect(n+ae,r,u,d,x),a.fill(),a.fillStyle="#0000ff",a.beginPath(),a.roundRect(n-ae,r,u,d,x),a.fill(),a.restore()}const X=2,te=r+d+8;a.fillStyle=_?y:v,a.beginPath(),a.arc(n+u*.25,te,X,0,Math.PI*2),a.fill(),a.fillStyle=_?v:"#ff6600",a.beginPath(),a.arc(n+u*.75,te,X,0,Math.PI*2),a.fill(),a.restore()}const Tp=new Map,iM={gray:{backgroundColor:"#444444",borderColor:"#888888"},green:{backgroundColor:"#003300",borderColor:"#00ff00"},blue:{backgroundColor:"#002244",borderColor:"#00ccff"},purple:{backgroundColor:"#220033",borderColor:"#cc66ff"}};function sM(a,e){const i=u=>Math.max(0,Math.min(255,u)),n=parseInt(a.slice(1),16),r=i((n>>16&255)+e*255),c=i((n>>8&255)+e*255),h=i((n&255)+e*255);return`rgb(${r},${c},${h})`}function nM(a){const{ctx:e,x:i,y:n,width:r,height:c,borderRadius:h,baseStyleId:u,alpha:d=1,scale:g=1,brighten:m=0}=a,y=iM[u];if(!y){console.warn(`[drawBlockCard] Unknown style: ${u}`);return}const v=u;let M=Tp.get(v);if(!M){M=document.createElement("canvas"),M.width=r,M.height=c;const w=M.getContext("2d");w.fillStyle=y.backgroundColor,w.strokeStyle=y.borderColor,w.lineWidth=2,w.beginPath(),w.roundRect(0,0,r,c,h),w.fill(),w.stroke(),Tp.set(v,M)}e.save(),e.globalAlpha*=d;const b=i+r/2,C=n+c/2;e.translate(b,C),e.scale(g,g),e.translate(-r/2,-c/2),m>.01?(e.drawImage(M,0,0,r,c),e.fillStyle=sM(y.backgroundColor,m),e.globalAlpha*=.2,e.fillRect(0,0,r,c)):e.drawImage(M,0,0,r,c),e.restore()}function aM(a){switch(a){case 0:return"gray";case 1:return"gray";case 2:return"green";case 3:return"blue";case 4:return"purple";default:return"gray"}}class oM{constructor(e,i,n){this.canvasManager=e,this.playerResources=i,this.blockDropDecisionMenu=n,this.MINI_BLOCK_SIZE=16,this.MINI_BLOCK_SPIN_SPEED=.5,this.BLOCK_CULLING_THRESHOLD=20,this.floatOffsets=[],this.FLOAT_SPEED=80,this.FLOAT_HEIGHT=10,this.xOffsets=[],this.X_OFFSET_SPEED=360,this.FANOUT_X_OFFSET=28,this.pulseTimers=[],this.PULSE_SPEED=4,this.PULSE_SCALE_AMPLITUDE=.06,this.PULSE_BRIGHTNESS_AMPLITUDE=.25;const r=ci("hull0");this.blockPreviewRenderer=new $r(r,this.MINI_BLOCK_SPIN_SPEED,this.MINI_BLOCK_SPIN_SPEED*1.5)}update(e){const i=this.playerResources.getBlockQueue();if(i.length===0){this.floatOffsets.length=0,this.pulseTimers.length=0,this.xOffsets.length=0;return}this.blockPreviewRenderer.update(e);const n=this.blockDropDecisionMenu.getHoveredButton();for(;this.floatOffsets.length<i.length;)this.floatOffsets.push(0);for(;this.floatOffsets.length>i.length;)this.floatOffsets.pop();for(;this.pulseTimers.length<i.length;)this.pulseTimers.push(0);for(;this.pulseTimers.length>i.length;)this.pulseTimers.pop();const r=new Set;if(n==="refine"||n==="autoplace")i.length>0&&r.add(0);else if(n==="roll")for(let h=0;h<3&&h<i.length;h++)r.add(h);for(let h=0;h<i.length;h++){const u=r.has(h)?this.FLOAT_HEIGHT:0,d=this.floatOffsets[h],g=u-d,m=this.FLOAT_SPEED*e,y=Math.sign(g)*Math.min(Math.abs(g),m);this.floatOffsets[h]+=y}for(let h=0;h<i.length;h++)this.pulseTimers[h]+=e*this.PULSE_SPEED;for(;this.xOffsets.length<i.length;)this.xOffsets.push(0);for(;this.xOffsets.length>i.length;)this.xOffsets.pop();const c=this.FANOUT_X_OFFSET*ne();for(let h=0;h<i.length;h++){let u=0;n==="roll"&&h>=0&&h<=2&&(u=c*h);const d=this.xOffsets[h],g=u-d,m=this.X_OFFSET_SPEED*e,y=Math.sign(g)*Math.min(Math.abs(g),m);this.xOffsets[h]+=y}}render(){var K,le;const e=this.canvasManager.getContext("ui"),i=e.canvas,n=ne(),r=Math.floor(80*n),c=Math.floor(i.width/2),h=Math.floor(32*n),u=Math.floor(32*n),d=Math.floor(8*n),g=Math.floor(8*n),m=6,y=Math.floor(6*n),v=Math.floor(6*n),M=Math.floor(h*m+y*2+d*(m-1)),b=Math.floor(44*n),C=c-M/2,w=i.height-r,A=this.blockDropDecisionMenu.getHoveredButton(),R=this.playerResources.getBlockQueue(),I=R.length;let _=I>0?"#00ff00":"#003400",x=`Blocks: ${I}`,N=.5;if(A&&I>0)switch(A){case"refine":{x=`Refine "${((K=R[0])==null?void 0:K.name)??"Block"}"`,_="#ffcc00",N=.85;break}case"roll":{x="3-1 Reroll",_="#cc66ff",N=.85;break}case"autoplace":{x=`Attach "${((le=R[0])==null?void 0:le.name)??"Block"}"`,_="#00ccff",N=.85;break}case"autoPlaceAll":{x=`Attach ${I} Blocks`,_="#66ff66",N=.85;break}}Mt({ctx:e,x:C,y:w,width:M,height:b,options:{alpha:N,borderRadius:12,borderColor:_,backgroundColor:"#00000000"}}),He(e,C,w-14*n,x,{align:"left",color:_},n);const z=Math.floor(this.MINI_BLOCK_SIZE*n);let q=h+d;if(I>m){const Z=M-y*2;I*h+(I-1)*d>Z&&(q=(Z-h)/(I-1))}const ie=A==="roll",ee=C+y;for(let Z=R.length-1;Z>=0;Z--){const se=R[Z],D=Yi(se.id),X=aM(D),te=this.floatOffsets[Z]??0,ae=this.pulseTimers[Z]??0,k=this.xOffsets[Z]??0;let H=1,J=0;if(te>.5){const Ki=(Math.sin(ae)+1)/2;H=1+Ki*this.PULSE_SCALE_AMPLITUDE,J=Ki*this.PULSE_BRIGHTNESS_AMPLITUDE}const $=Math.floor(h*H),oe=Math.floor(u*H),ye=Math.floor(z*H);let ue;ie&&Z>=0&&Z<=2?ue=ee+k+(h-$)/2:ue=C+y+Z*q+(h-$)/2;const ut=w+v-te+(u-oe)/2;nM({ctx:e,x:ue,y:ut,width:$,height:oe,borderRadius:12,baseStyleId:X,alpha:1,scale:1,brighten:J});const Fe=ue+d,ui=ut+g,ua=I>0?1:.3;Z<this.BLOCK_CULLING_THRESHOLD&&this.blockPreviewRenderer.render(e,Fe,ui,ye,ye,ua,se)}}}class rM{constructor(e,i,n,r){this.canvasManager=e,this.ship=i,this.floatingTextManager=n,this.blockDropDecisionMenu=r,this.currency=0,this.previousCurrency=0,this.disposer=null,this.playerResources=Re.getInstance(),this.currency=this.playerResources.getCurrency(),this.previousCurrency=this.currency,this.disposer=this.playerResources.onCurrencyChange(c=>{if(c>this.currency){const h=this.canvasManager.getContext("ui"),u=c-this.currency,d=ne(),g=Math.floor(900*d)+Math.floor(80*d),y=h.canvas.height-Math.floor(24*d)-Math.floor(12*d);this.floatingTextManager.createScreenText(`+${u}`,g,y,12,"monospace",1,100,1,"#FFD700",{impactScale:1.5},"currency")}this.currency=c}),this.blockQueueDisplayManager=new oM(this.canvasManager,this.playerResources,this.blockDropDecisionMenu)}update(e){this.blockQueueDisplayManager.update(e)}render(e){var D;const i=ne(),n=this.canvasManager.getContext("ui"),r=n.canvas,{velocity:c}=this.ship.getTransform(),u=this.ship.getAllBlocks().reduce((X,[te,ae])=>X+ae.type.mass,0);Math.floor(this.ship.getCockpitHp()??0),Math.floor(((D=this.ship.getCockpit())==null?void 0:D.type.armor)??1);const d=Math.sqrt(c.x**2+c.y**2),g=this.ship.getEnergyComponent(),m=Math.floor((g==null?void 0:g.getCurrent())??0),y=Math.floor((g==null?void 0:g.getMax())??0),v=Math.floor(180*i),M=Math.floor(12*i),b=Math.floor(20*i),C=v*2+b,w=Math.floor((r.width-C)/2),A=r.height-Math.floor(24*i),R=this.ship.getAfterburnerComponent(),I=R?R.getCurrent():0,_=R?R.getMax():1;Cp(n,{x:w,y:A,width:v,height:M,value:I/_,label:`${Math.floor(I)} / ${_}`,style:{barColor:"#ffcc00",borderColor:"#ffee88",backgroundColor:"#221800",glow:!0,textColor:"#ffffaa",font:`${Math.floor(11*i)}px "Courier New", monospace`,scanlineIntensity:.3,chromaticAberration:!0,phosphorDecay:!0,cornerBevel:!0,warningThreshold:.25,criticalThreshold:.1,warningColor:"#ffaa00",criticalColor:"#ff0040",animated:!0}},performance.now()),Cp(n,{x:w+v+b,y:A,width:v,height:M,value:y>0?m/y:1,label:`${Math.round(m)} / ${y}`,style:{barColor:"#0af",borderColor:"#6cf",backgroundColor:"#003",glow:!0,textColor:"#9cf",font:`${Math.floor(11*i)}px "Courier New", monospace`,scanlineIntensity:.25,chromaticAberration:!0,phosphorDecay:!0,cornerBevel:!0,warningThreshold:.25,criticalThreshold:.1,warningColor:"#ffaa00",criticalColor:"#ff0040",animated:!0}},performance.now());const x=Math.floor(120*i),N=Math.floor(12*i),W=Math.floor(32*i),z=A-x+Math.floor(14*i);eM(n,{x:W,y:z,width:N,height:x,value:d,maxValue:2e3,style:{barColor:"#00ff41",backgroundColor:"#001100",borderColor:"#00aa33",glow:!0,textColor:"#00ff88",showLabel:!0,unit:"m/s"}});const q=Math.floor(120*i),ie=Math.floor(24*i),ee=Math.floor(64*i),K=A-Math.floor(12*i);tM(n,{x:ee,y:K,mode:this.ship.getFiringMode(),style:{width:q,height:ie,backgroundColor:"#000a00",borderColor:"#00ff41",activeColor:"#00ff41",inactiveColor:"#001a00",textColor:"#00ff41",glowColor:"#00ff41",font:`${Math.floor(10*i)}px "Courier New", monospace`,glow:!0,animated:!0,scanlineIntensity:.3,chromaticAberration:!1}},performance.now());const le=Math.floor(900*i),Z=Math.floor(16*i);let se=K;He(n,le,se,`Entropium: ${this.currency}`,{},i),se+=Z,He(n,le,se,`Mass: ${u.toFixed(1)} kg`,{},i),this.blockQueueDisplayManager.render()}destroy(){var e;(e=this.disposer)==null||e.call(this)}}class lM{constructor(e,i){this.canvasManager=e,this.waveSpawner=i}render(){const e=this.canvasManager.getContext("ui"),i=e.canvas,n=this.waveSpawner.getCurrentWaveNumber(),r=this.waveSpawner.getTimeUntilNextWave(),c=this.waveSpawner.isBossWaveActive(),h=ne(),u=240*h;let d=i.height-36*h;const g=18*h;He(e,u,d,`Wave: ${n}`,{},h),d+=g,c?He(e,u,d,"Boss Encounter",{},h):He(e,u,d,`Next wave in: ${Math.ceil(r)}s`,{},h)}}class cM{constructor(e){this.canvasManager=e,this.messages=[],this.ctx=e.getContext("ui")}displayMessage(e,i){this.messages.push({text:e,duration:(i==null?void 0:i.duration)??3,elapsed:0,color:(i==null?void 0:i.color)??"#00ff00",font:(i==null?void 0:i.font)??"28px monospace",glow:(i==null?void 0:i.glow)??!0,yOffset:0})}update(e){for(const i of this.messages)i.elapsed+=e;this.messages=this.messages.filter(i=>i.elapsed<i.duration)}render(){const e=this.ctx.canvas.width/2,i=this.ctx.canvas.height*.35,n=36;performance.now()/1e3;for(let r=0;r<this.messages.length;r++){const c=this.messages[r],h=c.elapsed/c.duration,u=1-h,d=i-r*n-h*30;He(this.ctx,e,d,c.text,{font:c.font,align:"center",alpha:u,glow:c.glow,shadowBlur:0,color:c.color})}}}class As{constructor(){this.objects=new Set,this.idMap=new Map}static getInstance(){return As.instance||(As.instance=new As),As.instance}getById(e){return this.idMap.get(e)}add(e){this.objects.add(e),this.idMap.set(e.id,e)}remove(e){this.objects.delete(e),this.idMap.delete(e.id)}getAll(){return this.objects}getAllIds(){return Array.from(this.idMap.keys())}getFirst5Ids(){return Array.from(this.idMap.keys()).slice(0,5)}clear(){this.objects.clear(),this.idMap.clear()}count(){return this.objects.size}}class hM{constructor(e,i,n){this.canvasManager=e,this.shipRegistry=i,this.aiOrchestrator=n,this.smoothedFps=60}render(e){const i=this.canvasManager.getContext("ui"),n=i.canvas;As.getInstance();const r=1/e,c=.05;this.smoothedFps+=(r-this.smoothedFps)*c;const h=this.shipRegistry.count(),u=this.aiOrchestrator.getControllerCount();let d=0,g=0;for(const M of this.shipRegistry.getAll())for(const[,b]of M.getAllBlocks())b.isShielded&&(d++,g+=b.shieldEfficiency??0);const m=n.width-220;let y=12;const v=18;He(i,m,y,"DEBUG"),y+=v,He(i,m,y,`FPS: ${this.smoothedFps.toFixed(1)}`),y+=v,He(i,m,y,`Ships: ${h}`),y+=v,He(i,m,y,`AI Controllers: ${u}`),y+=v,He(i,m,y,`Shielded Blocks: ${d}`),y+=v,He(i,m,y,`Total Shield Efficiency: ${g.toFixed(2)}`),y+=v,He(i,m,y,`Enemy Power: ${ji.getEnemyPower()}`)}}class uM{static createIcon(e,i){const n=document.createElement("canvas");n.width=i,n.height=i;const r=n.getContext("2d");switch(r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",e){case"caution":this.drawCautionIcon(r,i);break;case"greenCross":this.drawGreenCrossIcon(r,i);break;case"skullAndBones":this.drawSkullAndBonesIcon(r,i);break}return n}static drawCautionIcon(e,i){const n=i/2,r=i*.4,c=e.createRadialGradient(n,n,0,n,n,r);c.addColorStop(0,"#ffff00"),c.addColorStop(1,"#ff8800"),e.fillStyle=c,e.strokeStyle="#cc6600",e.lineWidth=i*.05,e.beginPath(),e.moveTo(n,n-r),e.lineTo(n-r*.87,n+r*.5),e.lineTo(n+r*.87,n+r*.5),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#000000",e.font=`bold ${i*.5}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("!",n,n-i*.05)}static drawGreenCrossIcon(e,i){const n=i/2,r=i*.45,c=e.createRadialGradient(n,n,0,n,n,r);c.addColorStop(0,"#00ff88"),c.addColorStop(1,"#00cc44"),e.fillStyle=c,e.strokeStyle="#008833",e.lineWidth=i*.05,e.beginPath(),e.arc(n,n,r,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="#ffffff",e.strokeStyle="#ffffff",e.lineWidth=i*.08,e.lineCap="round";const h=i*.25;e.beginPath(),e.moveTo(n,n-h),e.lineTo(n,n+h),e.stroke(),e.beginPath(),e.moveTo(n-h,n),e.lineTo(n+h,n),e.stroke()}static drawSkullAndBonesIcon(e,i){const n=i/2;e.fillStyle="#ffffff",e.strokeStyle="#666666",e.lineWidth=i*.03;const r=i*.4,c=i*.45;e.beginPath(),e.ellipse(n,n-i*.1,r,c,0,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="#000000";const h=i*.08,u=i*.12;e.beginPath(),e.arc(n-u,n-i*.15,h,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n+u,n-i*.15,h,0,Math.PI*2),e.fill(),e.beginPath(),e.moveTo(n,n-i*.05),e.lineTo(n-i*.04,n+i*.05),e.lineTo(n+i*.04,n+i*.05),e.closePath(),e.fill(),e.strokeStyle="#000000",e.lineWidth=i*.02;const d=n+i*.1,g=i*.06;for(let v=-1;v<=1;v++)e.beginPath(),e.moveTo(n+v*g,d),e.lineTo(n+v*g,d+i*.08),e.stroke();e.fillStyle="#dddddd",e.strokeStyle="#999999",e.lineWidth=i*.02;const m=i*.7,y=i*.06;e.save(),e.translate(n,n),e.rotate(Math.PI/4),this.drawBone(e,m,y),e.restore(),e.save(),e.translate(n,n),e.rotate(-Math.PI/4),this.drawBone(e,m,y),e.restore()}static drawBone(e,i,n){const r=n*1.5;e.fillRect(-i/2,-n/2,i,n),e.strokeRect(-i/2,-n/2,i,n),e.beginPath(),e.arc(-i/2,0,r,0,Math.PI*2),e.fill(),e.stroke(),e.beginPath(),e.arc(i/2,0,r,0,Math.PI*2),e.fill(),e.stroke()}}const an=32e3,ca=32e3,rl={x:0,y:0},fM={MINIMAP_TRANSPARENCY:.3};class dM{constructor(e,i,n,r,c=1){this.canvasManager=e,this.player=i,this.aiOrchestrator=n,this.planetSystem=r,this.scale=c,this.baseWidth=220,this.baseHeight=220,this.baseMargin=14,this.animationTime=0,this.scanlineOffset=0,this.lastFrameTime=0,this.incidentMarkers=new Map,this.iconCache=new Map,this.staticCanvas=null,this.staticCtx=null,this.staticCacheValid=!1,this.handleIncidentMarkerAdd=h=>{this.incidentMarkers.set(h.id,h)},this.handleIncidentMarkerClear=({id:h})=>{this.incidentMarkers.delete(h)},this.unsubscribeResolution=we.getInstance().onResolutionChange(()=>{this.resize(ne())}),this.width=Math.floor(this.baseWidth*this.scale),this.height=Math.floor(this.baseHeight*this.scale),this.margin=Math.floor(this.baseMargin*this.scale),this.initializeStaticCache(),this.enemyMarkers={passive:this.createEnemyDot("#3399ff"),seeking:this.createEnemyDot("#ffbb33"),attacking:this.createEnemyDot("#ff0000"),hunter:this.createEnemyDot("#ff0000")},this.planetMarker=this.createPlanetDot("#00ffff"),this.playerMarker=this.createPlayerMarker(),Ee.on("incident:minimap:marker",this.handleIncidentMarkerAdd),Ee.on("incident:minimap:clear",this.handleIncidentMarkerClear)}initializeStaticCache(){this.staticCanvas=document.createElement("canvas"),this.staticCanvas.width=this.width+Math.floor(20*this.scale),this.staticCanvas.height=this.height+Math.floor(20*this.scale),this.staticCtx=this.staticCanvas.getContext("2d")}resize(e){this.scale=e,this.width=Math.floor(this.baseWidth*this.scale),this.height=Math.floor(this.baseHeight*this.scale),this.margin=Math.floor(this.baseMargin*this.scale),this.initializeStaticCache(),this.resetAllCaches()}resetAllCaches(){this.staticCacheValid=!1,this.enemyMarkers={passive:this.createEnemyDot("#3399ff"),seeking:this.createEnemyDot("#ffbb33"),attacking:this.createEnemyDot("#ff0000"),hunter:this.createEnemyDot("#ff0000")},this.planetMarker=this.createPlanetDot("#00ffff"),this.playerMarker=this.createPlayerMarker()}renderStaticElements(){if(!this.staticCtx||this.staticCacheValid)return;const e=this.staticCtx,i=Math.floor(10*this.scale),n=Math.floor(10*this.scale);e.clearRect(0,0,this.staticCanvas.width,this.staticCanvas.height),this.drawDiegeticFrame(e,i,n),this.drawCRTBackground(e,i,n),this.drawRadarGrid(e,i,n),this.staticCacheValid=!0}getOrCreateIncidentIcon(e){if(this.iconCache.has(e))return this.iconCache.get(e);const i=Math.floor(18*this.scale),r=["caution","greenCross","skullAndBones"].includes(e)?e:null;let c;if(r)c=uM.createIcon(r,i);else{c=document.createElement("canvas"),c.width=i,c.height=i;const h=c.getContext("2d");h.fillStyle="#ffffff",h.shadowColor="#ffffff",h.shadowBlur=6,h.beginPath(),h.arc(i/2,i/2,i/2.5,0,Math.PI*2),h.fill()}return this.iconCache.set(e,c),c}render(){const e=this.canvasManager.getContext("ui"),i=performance.now(),n=i-this.lastFrameTime;this.lastFrameTime=i,this.animationTime=i,this.scanlineOffset=(this.scanlineOffset+n*.03)%(4*this.scale);const r=e.canvas.width,c=e.canvas.height,h=r-this.width-this.margin,u=c-this.height-this.margin,d=fM.MINIMAP_TRANSPARENCY;e.save(),e.globalAlpha=d,this.renderStaticElements(),this.staticCanvas&&e.drawImage(this.staticCanvas,h-Math.floor(10*this.scale),u-Math.floor(10*this.scale));const g=(this.width-Math.floor(20*this.scale))/an,m=(this.height-Math.floor(20*this.scale))/ca,y=v=>{const M=v.x-rl.x+an/2,b=v.y-rl.y+ca/2;return{x:h+Math.floor(10*this.scale)+M*g,y:u+Math.floor(10*this.scale)+b*m}};this.drawPlanets(e,y),this.drawShips(e,y);for(const{x:v,y:M,icon:b}of this.incidentMarkers.values()){const C=y({x:v,y:M}),w=this.getOrCreateIncidentIcon(b),A=Math.floor(w.width/2);e.drawImage(w,C.x-A,C.y-A)}this.drawScanlines(e,h,u),this.drawStatusIndicator(e,h,u),e.restore()}drawDiegeticFrame(e,i,n){const r=Math.floor(2*this.scale),c=Math.floor(8*this.scale);e.strokeStyle="#00ff41",e.lineWidth=r,e.strokeRect(i-r,n-r,this.width+r*2,this.height+r*2),e.strokeStyle="#00ff41",e.lineWidth=Math.max(1,Math.floor(1*this.scale));const h=Math.floor(6*this.scale);e.beginPath(),e.moveTo(i-h,n+c),e.lineTo(i-h,n-h),e.lineTo(i+c,n-h),e.stroke(),e.beginPath(),e.moveTo(i+this.width-c,n-h),e.lineTo(i+this.width+h,n-h),e.lineTo(i+this.width+h,n+c),e.stroke(),e.beginPath(),e.moveTo(i+this.width+h,n+this.height-c),e.lineTo(i+this.width+h,n+this.height+h),e.lineTo(i+this.width-c,n+this.height+h),e.stroke(),e.beginPath(),e.moveTo(i+c,n+this.height+h),e.lineTo(i-h,n+this.height+h),e.lineTo(i-h,n+this.height-c),e.stroke()}drawCRTBackground(e,i,n){const r=e.createLinearGradient(i,n,i,n+this.height);r.addColorStop(0,"#001a00"),r.addColorStop(1,"#000a00"),e.fillStyle=r,e.fillRect(i,n,this.width,this.height)}drawRadarGrid(e,i,n){e.strokeStyle="#00ff4120",e.lineWidth=Math.max(1,Math.floor(1*this.scale));const r=i+this.width/2,c=n+this.height/2,h=Math.min(this.width,this.height)/2-Math.floor(10*this.scale);for(let u=1;u<=2;u++){const d=h*u/2;e.beginPath(),e.arc(r,c,d,0,Math.PI*2),e.stroke()}e.beginPath(),e.moveTo(r,n+Math.floor(10*this.scale)),e.lineTo(r,n+this.height-Math.floor(10*this.scale)),e.moveTo(i+Math.floor(10*this.scale),c),e.lineTo(i+this.width-Math.floor(10*this.scale),c),e.stroke()}drawPlanets(e,i){for(const n of this.planetSystem.getPlanets()){const r=n.getPosition(),c=i(r),h=Math.floor(8*this.scale);e.drawImage(this.planetMarker,c.x-h,c.y-h)}}drawShips(e,i){const n=i(this.player.getTransform().position),r=this.player.getTransform().rotation;for(const[h,u]of this.aiOrchestrator.getAllControllers()){const{position:d}=u.getTransform(),{x:g,y:m}=i(d),y=h.getCurrentStateString(),v=h.isHunter()?this.enemyMarkers.hunter:y==="AttackState"?this.enemyMarkers.attacking:y==="SeekTargetState"?this.enemyMarkers.seeking:this.enemyMarkers.passive,M=Math.floor(4*this.scale);e.drawImage(v,g-M,m-M)}e.save(),e.translate(n.x,n.y),e.rotate(r);const c=Math.floor(8*this.scale);e.drawImage(this.playerMarker,-c,-c),e.restore()}createPlanetDot(e){const i=Math.floor(16*this.scale),n=document.createElement("canvas");n.width=i,n.height=i;const r=n.getContext("2d");return r.fillStyle=e,r.shadowColor=e,r.shadowBlur=Math.floor(8*this.scale),r.beginPath(),r.arc(i/2,i/2,Math.floor(6*this.scale),0,Math.PI*2),r.fill(),n}drawScanlines(e,i,n){e.fillStyle="rgba(0, 255, 65, 0.06)";const r=Math.floor(8*this.scale);for(let c=-this.scanlineOffset;c<this.height;c+=r)n+c>=n&&n+c<n+this.height&&e.fillRect(i,n+c,this.width,Math.max(1,Math.floor(1*this.scale)))}drawStatusIndicator(e,i,n){e.fillStyle="#00ff41",e.shadowColor="#00ff41",e.shadowBlur=Math.floor(4*this.scale),e.beginPath();const r=Math.floor(3*this.scale),c=Math.floor(10*this.scale);e.arc(i+this.width-c,n+c,r,0,Math.PI*2),e.fill();const h=Math.floor(8*this.scale);e.font=`${h}px "Courier New", monospace`,e.fillStyle="#00ff4180",e.textAlign="right",e.textBaseline="bottom",e.shadowBlur=0;const u="1:"+Math.floor(an/this.width),d=Math.floor(4*this.scale);e.fillText(u,i+this.width-d,n+this.height-d)}invalidateCache(){this.staticCacheValid=!1}createEnemyDot(e){const i=Math.floor(8*this.scale),n=document.createElement("canvas");n.width=i,n.height=i;const r=n.getContext("2d");return r.fillStyle=e,r.shadowColor=e,r.shadowBlur=Math.floor(4*this.scale),r.beginPath(),r.arc(i/2,i/2,Math.floor(2*this.scale),0,Math.PI*2),r.fill(),n}createPlayerMarker(){const e=Math.floor(16*this.scale),i=document.createElement("canvas");i.width=e,i.height=e;const n=i.getContext("2d");n.translate(e/2,e/2),n.rotate(0),n.fillStyle="#ffffff",n.shadowColor="#ffffff",n.shadowBlur=Math.floor(6*this.scale);const r=Math.floor(4*this.scale),c=Math.floor(4*this.scale);return n.beginPath(),n.moveTo(0,-r),n.lineTo(Math.floor(3*this.scale),0),n.lineTo(0,r),n.lineTo(-Math.floor(3*this.scale),0),n.closePath(),n.fill(),n.strokeStyle="#ffffff",n.lineWidth=Math.max(1,Math.floor(1*this.scale)),n.beginPath(),n.moveTo(0,-r),n.lineTo(0,-r-c),n.stroke(),i}destroy(){this.unsubscribeResolution(),Ee.off("incident:minimap:marker",this.handleIncidentMarkerAdd),Ee.off("incident:minimap:clear",this.handleIncidentMarkerClear),this.incidentMarkers.clear(),this.iconCache.clear()}}function wp(a,e,i){const n=a.createShader(e);if(!n)throw new Error("[shaderUtils] Failed to create shader");if(a.shaderSource(n,i),a.compileShader(n),!a.getShaderParameter(n,a.COMPILE_STATUS)){const c=a.getShaderInfoLog(n);throw a.deleteShader(n),new Error(`[shaderUtils] Shader compile error:
${c}

Source:
${i}`)}return n}function gM(a,e,i){const n=a.createProgram();if(!n)throw new Error("[shaderUtils] Failed to create program");if(a.attachShader(n,e),a.attachShader(n,i),a.linkProgram(n),!a.getProgramParameter(n,a.LINK_STATUS)){const c=a.getProgramInfoLog(n);throw a.deleteProgram(n),new Error(`[shaderUtils] Program link error:
${c}`)}return n}function qi(a,e,i){const n=wp(a,a.VERTEX_SHADER,e),r=wp(a,a.FRAGMENT_SHADER,i);return gM(a,n,r)}function ha(a){const e=new Float32Array([-1,-1,1,-1,-1,1,1,1]),i=a.createBuffer();if(!i)throw new Error("[bufferUtils] Failed to create VBO");return a.bindBuffer(a.ARRAY_BUFFER,i),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,null),i}const pM=`#version 300 es\r
precision mediump float;\r
\r
// Vertex attribute: quad corner position in local space (e.g., [-1,-1] to [1,1])\r
in vec2 a_position;\r
\r
// Output to fragment shader\r
out vec2 vScreenPos;\r
flat out int vInstanceID; // Pass instance index explicitly\r
\r
uniform vec2 uResolution;\r
\r
// Per-light data buffer\r
// Each light occupies 3 vec4s:\r
//   vec4[0] = [x, y, radius, unused]\r
//   vec4[1] = [r, g, b, intensity]\r
//   vec4[2] = [falloff, _, _, _]\r
layout(std140) uniform LightBlock {\r
  vec4 uLightData[30000];\r
};\r
\r
void main() {\r
  int idx = gl_InstanceID;\r
\r
  vec2 lightPos = uLightData[idx * 3 + 0].xy;\r
  float radius  = uLightData[idx * 3 + 0].z;\r
\r
  vec2 scaled   = a_position * radius;\r
  vec2 position = lightPos + scaled;\r
\r
  vec2 clip = (position / uResolution) * 2.0 - 1.0;\r
  clip.y = -clip.y; // Flip Y for screen-space\r
\r
  gl_Position = vec4(clip, 0.0, 1.0);\r
  vScreenPos = position;\r
  vInstanceID = idx;\r
}\r
`,mM=`#version 300 es\r
precision mediump float;\r
\r
in vec2 vScreenPos;\r
flat in int vInstanceID;\r
out vec4 fragColor;\r
\r
// Per-light data buffer\r
// Each light occupies 3 vec4s:\r
//   vec4[0] = [x, y, radius, unused]\r
//   vec4[1] = [r, g, b, intensity]\r
//   vec4[2] = [falloff, _, _, _]\r
layout(std140) uniform LightBlock {\r
  vec4 uLightData[30000]; // 5000 lights * 3 vec4s\r
};\r
\r
void main() {\r
  int idx = vInstanceID;\r
\r
  vec2  lightPos     = uLightData[idx * 3 + 0].xy;\r
  float radius       = uLightData[idx * 3 + 0].z;\r
\r
  vec3  color        = uLightData[idx * 3 + 1].rgb;\r
  float intensity    = uLightData[idx * 3 + 1].a;\r
\r
  float falloffParam = uLightData[idx * 3 + 2].x;\r
\r
  float dist     = distance(vScreenPos, lightPos);\r
  float normDist = clamp(dist / radius, 0.0, 1.0);\r
  float falloff  = pow(1.0 - normDist, 2.0) * falloffParam;\r
\r
  if (falloff < 0.001) discard;\r
\r
  fragColor = vec4(color * falloff * intensity, 0.0); // Alpha unused in additive blend\r
}\r
`,yM=`#version 300 es\r
precision mediump float;\r
\r
// src/rendering/unified/shaders/lightingPassBeam.vert\r
\r
// Beam Vertex Shader - WebGL 2 version\r
in vec2 position;\r
out vec2 vPosition;\r
\r
void main() {\r
  vPosition = position * 0.5 + 0.5;\r
  gl_Position = vec4(position, 0.0, 1.0);\r
}`,vM=`#version 300 es\r
\r
precision mediump float;\r
\r
// src/rendering/unified/shaders/lightingPassBeam.frag\r
\r
// Beam Fragment Shader - WebGL 2 version\r
in vec2 vPosition;\r
\r
uniform vec2 uStart;\r
uniform vec2 uEnd;\r
uniform float uWidth;\r
uniform vec4 uColor;\r
uniform float uIntensity;\r
uniform float uFalloff;\r
uniform vec2 uResolution;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // Convert UV coordinates to pixel coordinates\r
  vec2 fragPos = vPosition * uResolution;\r
  \r
  // Compute beam vector\r
  vec2 beamDir = uEnd - uStart;\r
  float beamLength = length(beamDir);\r
  \r
  // Handle degenerate case (zero-length beam)\r
  if (beamLength < 0.001) {\r
    fragColor = vec4(0.0);\r
    return;\r
  }\r
  \r
  vec2 normDir = beamDir / beamLength;\r
\r
  // Project fragment onto beam axis\r
  vec2 delta = fragPos - uStart;\r
  float t = clamp(dot(delta, normDir), 0.0, beamLength);\r
\r
  // Closest point on beam line segment\r
  vec2 closest = uStart + t * normDir;\r
  float dist = length(fragPos - closest);\r
\r
  // Gaussian falloff based on distance from beam centerline\r
  float falloff = exp(-pow(dist / max(uWidth, 0.1), 2.0)) * uFalloff;\r
\r
  vec4 finalColor = uColor * falloff * uIntensity;\r
  finalColor.a = falloff;\r
\r
  fragColor = finalColor;\r
}`,bM=`#version 300 es\r
precision mediump float;\r
\r
// src/rendering/unified/shaders/lightingPassPost.vert\r
\r
// Post-processing Vertex Shader - WebGL 2 version\r
in vec2 position;\r
out vec2 vUV;\r
\r
void main() {\r
  vUV = position * 0.5 + 0.5;\r
  gl_Position = vec4(position, 0.0, 1.0);\r
}`,SM=`#version 300 es\r
precision mediump float;\r
\r
in vec2 vUV;\r
uniform sampler2D uTexture;\r
uniform float uMaxBrightness;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 color = texture(uTexture, vUV);\r
\r
  // Skip blending in pixels with no light contribution\r
  if (max(color.r, max(color.g, color.b)) < 0.001) {\r
    discard;\r
  }\r
\r
  // Brightness capping (ITU-R BT.709 luminance weighting)\r
  float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));\r
  if (brightness > uMaxBrightness) {\r
    color.rgb *= uMaxBrightness / brightness;\r
  }\r
\r
  fragColor = color;\r
}\r
`,Ap=1e4,Qh=12,kp=2;class MM{constructor(e,i){this.ambientLight=[.2,.2,.25],this.framebufferWidth=0,this.framebufferHeight=0,this.framebufferDirty=!0,this.resolutionScale=.2,this.clearColor=[0,0,0,0],this.maxBrightness=1,this.gl=e,this.cameraUBO=i,this.lightProgram=qi(e,pM,mM),this.beamProgram=qi(e,yM,vM),this.postProgram=qi(e,bM,SM),this.quadBuffer=ha(e),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.bindVertexArray(null),this.lightUBO=e.createBuffer(),this.lightData=new Float32Array(Ap*Qh),e.bindBuffer(e.UNIFORM_BUFFER,this.lightUBO),e.bufferData(e.UNIFORM_BUFFER,this.lightData.byteLength,e.DYNAMIC_DRAW),e.bindBufferBase(e.UNIFORM_BUFFER,kp,this.lightUBO);const n=e.getUniformBlockIndex(this.lightProgram,"LightBlock");n!==e.INVALID_INDEX&&e.uniformBlockBinding(this.lightProgram,n,kp),this.colorTexture=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.initializeFramebuffer()}initializeFramebuffer(){const e=this.gl,i=Math.max(1,Math.floor(e.drawingBufferWidth*this.resolutionScale)),n=Math.max(1,Math.floor(e.drawingBufferHeight*this.resolutionScale));this.framebufferWidth=i,this.framebufferHeight=n,e.bindTexture(e.TEXTURE_2D,this.colorTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.colorTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null)}generateLightBuffer(e,i){const n=this.gl;this.framebufferDirty&&(this.initializeFramebuffer(),this.framebufferDirty=!1),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer),n.viewport(0,0,this.framebufferWidth,this.framebufferHeight),n.clearColor(...this.clearColor),n.clear(n.COLOR_BUFFER_BIT),n.blendFunc(n.ONE,n.ONE),n.enable(n.BLEND),n.bindVertexArray(this.vao);let r=0;for(const c of e){if(c.type!=="point")continue;if(r>=Ap)break;const h=i.worldToScreen(c.x,c.y),u=h.x*this.resolutionScale,d=h.y*this.resolutionScale,g=r*Qh,[m,y,v,M]=this.hexToRgbaVec4(c.color);this.lightData[g+0]=u,this.lightData[g+1]=d,this.lightData[g+2]=c.radius*i.getZoom()*this.resolutionScale,this.lightData[g+3]=0,this.lightData[g+4]=m,this.lightData[g+5]=y,this.lightData[g+6]=v,this.lightData[g+7]=c.intensity,this.lightData[g+8]=c.animationPhase??1,this.lightData[g+9]=0,this.lightData[g+10]=0,this.lightData[g+11]=0,r++}n.bindBuffer(n.UNIFORM_BUFFER,this.lightUBO),n.bufferSubData(n.UNIFORM_BUFFER,0,this.lightData.subarray(0,r*Qh)),n.useProgram(this.lightProgram),n.uniform2f(n.getUniformLocation(this.lightProgram,"uResolution"),this.framebufferWidth,this.framebufferHeight),n.drawArraysInstanced(n.TRIANGLE_STRIP,0,4,r);for(const c of e){if(c.type!=="beam")continue;n.useProgram(this.beamProgram),n.uniform2f(n.getUniformLocation(this.beamProgram,"uResolution"),this.framebufferWidth,this.framebufferHeight);const h=i.worldToScreen(c.start.x,c.start.y),u=i.worldToScreen(c.end.x,c.end.y),d=h.x*this.resolutionScale,g=this.framebufferHeight-h.y*this.resolutionScale,m=u.x*this.resolutionScale,y=this.framebufferHeight-u.y*this.resolutionScale;n.uniform2f(n.getUniformLocation(this.beamProgram,"uStart"),d,g),n.uniform2f(n.getUniformLocation(this.beamProgram,"uEnd"),m,y),n.uniform1f(n.getUniformLocation(this.beamProgram,"uWidth"),c.width*i.getZoom()*this.resolutionScale),n.uniform4fv(n.getUniformLocation(this.beamProgram,"uColor"),this.hexToRgbaVec4(c.color)),n.uniform1f(n.getUniformLocation(this.beamProgram,"uIntensity"),c.intensity),n.uniform1f(n.getUniformLocation(this.beamProgram,"uFalloff"),c.animationPhase??1),n.drawArrays(n.TRIANGLE_STRIP,0,4)}return n.disable(n.BLEND),n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),this.colorTexture}compositeLightingOverScene(){const e=this.gl;e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.useProgram(this.postProgram),e.bindVertexArray(this.vao),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.colorTexture),e.uniform1i(e.getUniformLocation(this.postProgram,"uTexture"),0),e.uniform1f(e.getUniformLocation(this.postProgram,"uMaxBrightness"),this.maxBrightness),e.blendFunc(e.ONE,e.ONE),e.enable(e.BLEND),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.disable(e.BLEND)}setAmbientLight(e){this.ambientLight=e}getAmbientLight(){return this.ambientLight}resize(){this.framebufferDirty=!0}destroy(){const e=this.gl;e.deleteProgram(this.lightProgram),e.deleteProgram(this.beamProgram),e.deleteProgram(this.postProgram),e.deleteBuffer(this.quadBuffer),e.deleteFramebuffer(this.framebuffer),e.deleteTexture(this.colorTexture),e.deleteVertexArray(this.vao),e.deleteBuffer(this.lightUBO)}hexToRgbaVec4(e){e.startsWith("#")&&(e=e.slice(1));const i=parseInt(e.slice(0,2),16)/255,n=parseInt(e.slice(2,4),16)/255,r=parseInt(e.slice(4,6),16)/255,c=e.length===8?parseInt(e.slice(6,8),16)/255:1;return[i,n,r,c]}}let Bp=0,$n=null;class $e{constructor(){this.lights=new Map,this.lightPool=[],this.cachedVisibleLights=[],this.lastCameraBounds=null,this.lightsDirty=!0}static getInstance(){return $n||($n=new $e),$n}static hasInstance(){return!!$n}registerLight(e){e.id||(e.id=`light_${Bp++}`),this.lights.set(e.id,e),this.lightsDirty=!0}removeLight(e){const i=this.lights.get(e);i&&this.recycleLight(i),this.lights.delete(e),this.lightsDirty=!0}clear(){for(const e of this.lights.values())this.recycleLight(e);this.lights.clear(),this.lightsDirty=!0}update(e){for(const[i,n]of this.lights)if(n.life!==void 0&&n.maxLife!==void 0){if(n.life-=e,n.expires&&n.life<=0){this.recycleLight(n),this.lights.delete(i),this.lightsDirty=!0;continue}const r=Math.max(0,n.life/n.maxLife);n.fadeMode==="delayed"?n.animationPhase=r>=.1?1:r/.1:n.animationPhase=r}}collectVisibleLights(e){const i=e.getViewportBounds(),n=!this.lastCameraBounds||i.x!==this.lastCameraBounds.x||i.y!==this.lastCameraBounds.y||i.width!==this.lastCameraBounds.width||i.height!==this.lastCameraBounds.height;if(!this.lightsDirty&&!n)return this.cachedVisibleLights;const r=i.x,c=i.x+i.width,h=i.y,u=i.y+i.height;return this.cachedVisibleLights=Array.from(this.lights.values()).filter(d=>{switch(d.type){case"directional":return!0;case"point":case"spot":{const{x:g,y:m,radius:y}=d;return g+y>r&&g-y<c&&m+y>h&&m-y<u}default:return!0}}),this.lastCameraBounds=i,this.lightsDirty=!1,this.cachedVisibleLights}getLightCount(){return this.lights.size}getActiveLights(){return Array.from(this.lights.values())}getLightById(e){return this.lights.get(e)}getPooledLight(){return this.lightPool.pop()??{id:"",x:0,y:0,radius:32,color:"#ffffff",intensity:1,type:"point"}}updateLight(e,i){const n=this.lights.get(e);!n||n.type!=="point"||(Object.assign(n,i),this.lightsDirty=!0)}recycleLight(e){this.isPoolableLight(e)&&(e.id="",e.life=void 0,e.maxLife=void 0,e.animationPhase=void 0,this.lightPool.push(e))}isPoolableLight(e){return e.type==="point"}destroy(){$n===this&&(this.clear(),this.lightPool.length=0,this.cachedVisibleLights.length=0,this.lastCameraBounds=null,$n=null,Bp=0)}}const CM=`#version 300 es\r
precision mediump float;\r
\r
in vec2 position;\r
\r
layout(std140) uniform CameraBlock {\r
  mat4 uProjectionMatrix;\r
  mat4 uViewMatrix;\r
};\r
\r
uniform mat4 uModelMatrix;\r
uniform vec2 uBlockPosition;\r
uniform float uBlockRotation;\r
uniform vec2 uBlockScale;\r
\r
out vec2 vUV;\r
out vec2 vScreenUV;\r
\r
void main() {\r
  vUV = vec2(position.x * 0.5 + 0.5, 1.0 - (position.y * 0.5 + 0.5));\r
\r
  vec2 scaledPosition = position * uBlockScale * 0.5;\r
  vec2 flippedPosition = vec2(scaledPosition.x, -scaledPosition.y);\r
\r
  float cos_rot = cos(uBlockRotation);\r
  float sin_rot = sin(uBlockRotation);\r
  vec2 rotatedPosition = vec2(\r
    flippedPosition.x * cos_rot - flippedPosition.y * sin_rot,\r
    flippedPosition.x * sin_rot + flippedPosition.y * cos_rot\r
  );\r
\r
  vec2 blockWorldPosition = rotatedPosition + uBlockPosition;\r
\r
  vec4 worldPos = uModelMatrix * vec4(blockWorldPosition, 0.0, 1.0);\r
  vec4 viewPos = uViewMatrix * worldPos;\r
  gl_Position = uProjectionMatrix * viewPos;\r
\r
  // derive screen UV from clip-space coordinates\r
  vScreenUV = gl_Position.xy / gl_Position.w * 0.5 + 0.5;\r
}\r
`,TM=`#version 300 es\r
precision mediump float;\r
\r
in vec2 vUV;\r
in vec2 vScreenUV; // passed from vertex shader\r
out vec4 outColor;\r
\r
uniform sampler2D uTexture;\r
uniform sampler2D uLightMap;\r
\r
uniform float uTime;\r
uniform float uGlowStrength;\r
uniform float uEnergyPulse;\r
uniform vec3 uChargeColor;\r
uniform float uSheenStrength;\r
uniform vec3 uCollisionColor;\r
uniform bool uUseCollisionColor;\r
uniform vec3 uAmbientLight;\r
\r
void main() {\r
  vec4 base = texture(uTexture, vUV);\r
  if (base.a < 0.01) discard;\r
\r
  // === Lightmap Sampling ===\r
  vec3 lightSample = texture(uLightMap, vScreenUV).rgb;\r
  vec3 effectiveLight = max(lightSample, uAmbientLight); // clamp floor\r
  \r
  // Darken base by ambient light floor\r
  vec3 ambiented = base.rgb * uAmbientLight;\r
\r
  // Modulate with light texture\r
  vec3 modulated = base.rgb * lightSample;\r
\r
  // Additive bloom-style wrap lighting\r
  vec3 additive = lightSample * 0.7;\r
\r
  // Final mix: ambient base + modulated + additive bloom\r
  base.rgb = ambiented + modulated * 0.6 + additive * 0.4;\r
\r
  // === Radial Charge Bloom ===\r
  vec2 centeredUV = vUV - 0.5;\r
  float dist = length(centeredUV);\r
\r
  float wavePhase = uTime * 3.0 - dist * 8.0;\r
  float pulse = sin(wavePhase) * 0.5 + 0.5;\r
  pulse = pow(pulse, 2.0);\r
\r
  float innerRadius = 0.1;\r
  float outerRadius = 0.4;\r
  float falloff = 1.0 - smoothstep(innerRadius, outerRadius, dist);\r
  falloff = pow(falloff, 1.5);\r
\r
  float energy = pulse * falloff * uEnergyPulse;\r
  base.rgb += uChargeColor * energy * 0.8;\r
\r
  // === Pulsating Glow ===\r
  float breathe = sin(uTime * 2.5) * 0.3 + 0.7;\r
  breathe = smoothstep(0.4, 1.0, breathe);\r
  base.rgb += base.rgb * uGlowStrength * breathe * 0.3;\r
\r
  // === Metallic Sheen ===\r
  if (uSheenStrength > 0.0) {\r
    vec2 centeredUV = vUV - 0.5;\r
    float dist = length(centeredUV);\r
\r
    float radialFalloff = 1.0 - smoothstep(0.0, 0.7, dist);\r
    radialFalloff = pow(radialFalloff, 0.8);\r
\r
    float noise = sin(vUV.x * 12.0) * sin(vUV.y * 8.0) * 0.1 + 0.9;\r
\r
    float metallic = radialFalloff * noise;\r
\r
    vec3 metallicColor = base.rgb * 1.2 + vec3(0.05, 0.05, 0.1);\r
    base.rgb = mix(base.rgb, metallicColor, uSheenStrength * metallic * 0.3);\r
\r
    base.rgb += uSheenStrength * metallic * 0.15;\r
  }\r
\r
  // === Collision Red Override ===\r
  if (uUseCollisionColor) {\r
    base.rgb = uCollisionColor;\r
  }\r
\r
  outColor = base;\r
}\r
`;function ym(a,e,i,n){const r=e-a,c=n-i;return new Float32Array([2/r,0,0,0,0,2/c,0,0,0,0,-1,0,-(e+a)/r,-(n+i)/c,0,1])}function Au(a,e){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,a,e,0,1])}function wM(a){const e=Math.cos(a),i=Math.sin(a);return new Float32Array([e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1])}function AM(a,e){const i=new Float32Array(16);for(let n=0;n<4;n++)for(let r=0;r<4;r++)i[n*4+r]=a[n*4+0]*e[0*4+r]+a[n*4+1]*e[1*4+r]+a[n*4+2]*e[2*4+r]+a[n*4+3]*e[3*4+r];return i}function kM(a){const e=new Float32Array([-1,-1,1,-1,-1,1,1,1]),i=a.createBuffer();return a.bindBuffer(a.ARRAY_BUFFER,i),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW),i}function BM(a){return a==="battery1"||a==="reactor1"||a==="shield1"?[.2,.6,1]:a==="battery2"||a==="reactor2"||a==="shield3"?[.8,.5,1]:a==="shield2"?[.3,1,.4]:null}function RM(a){return a.startsWith("hull")||a.startsWith("fin")||a.startsWith("faceplate")||a.startsWith("engine")}class EM{constructor(e,i){this.inputManager=i,this.ambientLight=[.2,.2,.25],this.shipModelMatrix=new Float32Array(16),this.gl=e,this.program=qi(e,CM,TM);const n=e.getUniformBlockIndex(this.program,"CameraBlock");n!==e.INVALID_INDEX&&e.uniformBlockBinding(this.program,n,0),this.quadBuffer=kM(e),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.bindVertexArray(null),this.uniforms={uModelMatrix:e.getUniformLocation(this.program,"uModelMatrix"),uBlockPosition:e.getUniformLocation(this.program,"uBlockPosition"),uBlockRotation:e.getUniformLocation(this.program,"uBlockRotation"),uBlockScale:e.getUniformLocation(this.program,"uBlockScale"),uTexture:e.getUniformLocation(this.program,"uTexture"),uLightMap:e.getUniformLocation(this.program,"uLightMap"),uTime:e.getUniformLocation(this.program,"uTime"),uGlowStrength:e.getUniformLocation(this.program,"uGlowStrength"),uEnergyPulse:e.getUniformLocation(this.program,"uEnergyPulse"),uChargeColor:e.getUniformLocation(this.program,"uChargeColor"),uSheenStrength:e.getUniformLocation(this.program,"uSheenStrength"),uCollisionColor:e.getUniformLocation(this.program,"uCollisionColor"),uUseCollisionColor:e.getUniformLocation(this.program,"uUseCollisionColor"),uAmbientLight:e.getUniformLocation(this.program,"uAmbientLight")}}render(e,i,n){var u;const{gl:r}=this,c=performance.now()/1e3;r.useProgram(this.program),r.bindVertexArray(this.vao),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.uniform1f(this.uniforms.uTime,c),r.uniform3f(this.uniforms.uAmbientLight,...this.ambientLight),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,i),r.uniform1i(this.uniforms.uLightMap,1);let h={x:0,y:0};if(this.inputManager){const d=this.inputManager.getMousePosition();h=n.screenToWorld(d.x,d.y)}for(const d of e){const{position:g,rotation:m}=d.getTransform();if(we.getInstance().isLightingEnabled()){const y=(u=d.getLightAuraId)==null?void 0:u.call(d);if(y)try{$e.getInstance().updateLight(y,g)}catch(v){console.warn(`[EntityPass] Light update failed for ship ${d.id}`,v)}}this.shipModelMatrix=AM(wM(m),Au(g.x,g.y)),r.uniformMatrix4fv(this.uniforms.uModelMatrix,!1,this.shipModelMatrix),r.uniform1i(this.uniforms.uUseCollisionColor,0);for(const[y,v]of d.getAllBlocks()){if(v.hidden)continue;const M=v.type.armor??1,b=Xp(v.hp,M),C=Bb(v.type.id,b),w=y.x*G,A=y.y*G,R=(v.rotation??0)*(Math.PI/180);r.uniform2f(this.uniforms.uBlockPosition,w,A),r.uniform1f(this.uniforms.uBlockRotation,R),r.uniform2f(this.uniforms.uBlockScale,G,G);const I=BM(v.type.id),_=I?Math.sin(c*6)*.5+.5:0,x=v.type.id.startsWith("cockpit")?1:0,N=RM(v.type.id)?1:0;if(r.uniform1f(this.uniforms.uEnergyPulse,_),r.uniform1f(this.uniforms.uGlowStrength,x),r.uniform1f(this.uniforms.uSheenStrength,N),r.uniform3f(this.uniforms.uChargeColor,...I??[0,0,0]),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,C.base),r.uniform1i(this.uniforms.uTexture,0),r.drawArrays(r.TRIANGLE_STRIP,0,4),C.overlay&&this.inputManager){const W=g.x+w*Math.cos(m)-A*Math.sin(m),z=g.y+w*Math.sin(m)+A*Math.cos(m),q=h.x-W,ie=h.y-z,K=Math.atan2(ie,q)-m+Math.PI/2;r.uniform1f(this.uniforms.uBlockRotation,K),r.uniform2f(this.uniforms.uBlockPosition,w,A),r.bindTexture(r.TEXTURE_2D,C.overlay),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.uniform1f(this.uniforms.uBlockRotation,R)}}}r.disable(r.BLEND),r.bindVertexArray(null),r.useProgram(null)}setAmbientLight(e){this.ambientLight=e}destroy(){const{gl:e}=this;e.isProgram(this.program)&&e.deleteProgram(this.program),e.isBuffer(this.quadBuffer)&&e.deleteBuffer(this.quadBuffer),e.isVertexArray(this.vao)&&e.deleteVertexArray(this.vao)}}const IM=`#version 300 es\r
precision mediump float;\r
\r
// src/rendering/unified/shaders/particlePass.vert\r
\r
layout(location = 0) in vec2 aPosition;\r
layout(location = 1) in vec2 aParticlePos;\r
layout(location = 2) in float aSize;\r
layout(location = 3) in float aLifeRatio;\r
layout(location = 4) in vec3 aColor;\r
\r
layout(std140) uniform CameraMatrices {\r
  mat4 uProjectionMatrix;\r
  mat4 uViewMatrix;\r
};\r
\r
out float vAlpha;\r
out vec3 vColor;\r
\r
void main() {\r
  vec2 scaled = aPosition * aSize;\r
  vec2 world = scaled + aParticlePos;\r
  gl_Position = uProjectionMatrix * uViewMatrix * vec4(world, 0.0, 1.0);\r
  vAlpha = aLifeRatio;\r
  vColor = aColor;\r
}\r
`,_M=`#version 300 es\r
precision mediump float;\r
\r
// src/rendering/unified/shaders/particlePass.frag\r
\r
in float vAlpha;\r
in vec3 vColor;\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = vec4(vColor, vAlpha);\r
}\r
`;function xM(a){a.startsWith("#")&&(a=a.slice(1));const e=parseInt(a.slice(0,2),16)/255,i=parseInt(a.slice(2,4),16)/255,n=parseInt(a.slice(4,6),16)/255;return[e,i,n]}class DM{constructor(e,i){this.gl=e,this.program=qi(e,IM,_M),this.quadBuffer=ha(e),this.instanceBuffer=e.createBuffer(),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.vertexAttribDivisor(0,0),e.bindBuffer(e.ARRAY_BUFFER,this.instanceBuffer);const n=7*4;e.enableVertexAttribArray(1),e.vertexAttribPointer(1,2,e.FLOAT,!1,n,0),e.vertexAttribDivisor(1,1),e.enableVertexAttribArray(2),e.vertexAttribPointer(2,1,e.FLOAT,!1,n,8),e.vertexAttribDivisor(2,1),e.enableVertexAttribArray(3),e.vertexAttribPointer(3,1,e.FLOAT,!1,n,12),e.vertexAttribDivisor(3,1),e.enableVertexAttribArray(4),e.vertexAttribPointer(4,3,e.FLOAT,!1,n,16),e.vertexAttribDivisor(4,1),e.bindVertexArray(null);const r=e.getUniformBlockIndex(this.program,"CameraMatrices");r!==e.INVALID_INDEX&&e.uniformBlockBinding(this.program,r,0)}render(e,i){const n=this.gl;if(e.length===0)return;const r=7,c=new Float32Array(e.length*r);for(let h=0;h<e.length;h++){const u=e[h],d=h*r,[g,m,y]=xM(u.color);c.set([u.x,u.y,u.size,u.renderAlpha??1,g,m,y],d)}n.bindBuffer(n.ARRAY_BUFFER,this.instanceBuffer),n.bufferData(n.ARRAY_BUFFER,c,n.DYNAMIC_DRAW),n.useProgram(this.program),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE),n.bindVertexArray(this.vao),n.drawArraysInstanced(n.TRIANGLE_STRIP,0,4,e.length),n.bindVertexArray(null),n.disable(n.BLEND),n.useProgram(null)}destroy(){const e=this.gl;e.deleteProgram(this.program),e.deleteBuffer(this.quadBuffer),e.deleteBuffer(this.instanceBuffer),e.deleteVertexArray(this.vao)}}const PM=`#version 300 es\r
precision mediump float;\r
\r
// === Attribute Bindings ===\r
// Quad vertex position (static)\r
layout(location = 0) in vec2 aPosition;\r
\r
// Per-instance attributes\r
layout(location = 1) in vec2 aInstancePos;   // world-space center\r
layout(location = 2) in vec2 aInstanceSize;  // world-space size\r
layout(location = 3) in float aInstanceAlpha; // transparency\r
\r
// === Uniform block for camera ===\r
layout(std140) uniform CameraMatrices {\r
  mat4 uProjectionMatrix;\r
  mat4 uViewMatrix;\r
};\r
\r
out vec2 vUV;\r
out float vAlpha;\r
\r
void main() {\r
  vec2 scaled = aPosition * aInstanceSize;\r
  vec2 world = scaled + aInstancePos;\r
\r
  gl_Position = uProjectionMatrix * uViewMatrix * vec4(world, 0.0, 1.0);\r
\r
  // UVs range from (0,0) bottom-left to (1,1) top-right\r
  vUV = vec2((aPosition.x + 1.0) * 0.5, 1.0 - (aPosition.y + 1.0) * 0.5);\r
  vAlpha = aInstanceAlpha;\r
}\r
`,LM=`#version 300 es\r
precision mediump float;\r
\r
in vec2 vUV;\r
in float vAlpha;\r
\r
uniform sampler2D uTexture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 texColor = texture(uTexture, vUV);\r
  fragColor = vec4(texColor.rgb, texColor.a * vAlpha);\r
}\r
`,Cs=class Cs{constructor(e,i){this.gl=e,this.program=qi(e,PM,LM),this.vao=e.createVertexArray(),this.quadBuffer=ha(e),this.instanceBuffer=e.createBuffer(),this.instanceCapacity=256,this.instanceData=new Float32Array(this.instanceCapacity*Cs.INSTANCE_FLOATS),e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.vertexAttribDivisor(0,0),e.bindBuffer(e.ARRAY_BUFFER,this.instanceBuffer);const n=Cs.INSTANCE_FLOATS*4;e.enableVertexAttribArray(1),e.vertexAttribPointer(1,2,e.FLOAT,!1,n,0),e.vertexAttribDivisor(1,1),e.enableVertexAttribArray(2),e.vertexAttribPointer(2,2,e.FLOAT,!1,n,8),e.vertexAttribDivisor(2,1),e.enableVertexAttribArray(3),e.vertexAttribPointer(3,1,e.FLOAT,!1,n,16),e.vertexAttribDivisor(3,1),e.bindVertexArray(null);const r=e.getUniformBlockIndex(this.program,"CameraMatrices");r!==e.INVALID_INDEX&&e.uniformBlockBinding(this.program,r,0),this.uTexture=e.getUniformLocation(this.program,"uTexture")}renderBatch(e,i){if(i.length===0)return;const n=this.gl,c=1/ne();if(i.length>this.instanceCapacity){for(;this.instanceCapacity<i.length;)this.instanceCapacity*=2;this.instanceData=new Float32Array(this.instanceCapacity*Cs.INSTANCE_FLOATS)}for(let h=0;h<i.length;h++){const u=i[h],d=h*Cs.INSTANCE_FLOATS,g=u.widthPx*c,m=u.heightPx*c;this.instanceData[d+0]=u.worldX,this.instanceData[d+1]=u.worldY,this.instanceData[d+2]=g,this.instanceData[d+3]=m,this.instanceData[d+4]=u.alpha}n.bindBuffer(n.ARRAY_BUFFER,this.instanceBuffer),n.bufferData(n.ARRAY_BUFFER,this.instanceData.subarray(0,i.length*Cs.INSTANCE_FLOATS),n.DYNAMIC_DRAW),n.useProgram(this.program),n.bindVertexArray(this.vao),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(this.uTexture,0),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.drawArraysInstanced(n.TRIANGLE_STRIP,0,4,i.length),n.disable(n.BLEND),n.bindTexture(n.TEXTURE_2D,null),n.bindVertexArray(null),n.useProgram(null)}destroy(){const e=this.gl;e.deleteProgram(this.program),e.deleteBuffer(this.quadBuffer),e.deleteBuffer(this.instanceBuffer),e.deleteVertexArray(this.vao)}};Cs.INSTANCE_FLOATS=5;let lu=Cs;function OM(a){const e=a.createBuffer();return a.bindBuffer(a.UNIFORM_BUFFER,e),a.bufferData(a.UNIFORM_BUFFER,128,a.DYNAMIC_DRAW),e}function FM(a,e,i){const n=ym(-i.getViewportWidth()/(2*i.getZoom()),i.getViewportWidth()/(2*i.getZoom()),i.getViewportHeight()/(2*i.getZoom()),-i.getViewportHeight()/(2*i.getZoom())),r=Au(-i.getPosition().x,-i.getPosition().y),c=new Float32Array(32);c.set(n,0),c.set(r,16),a.bindBuffer(a.UNIFORM_BUFFER,e),a.bufferSubData(a.UNIFORM_BUFFER,0,c)}class UM{constructor(e,i){this.inputManager=i,this.spriteGroups=new Map,this.clearedTextures=[];const n=ii.getInstance();this.gl=n.getWebGL2Context("unifiedgl2"),this.cameraUBO=OM(this.gl),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,this.cameraUBO),this.lightingPass=new MM(this.gl,this.cameraUBO),this.entityPass=new EM(this.gl,this.inputManager),this.spritePass=new lu(this.gl,this.cameraUBO),this.particlePass=new DM(this.gl,this.cameraUBO),this.onResolutionChanged=()=>{this.lightingPass.resize()},Ee.on("resolution:changed",this.onResolutionChanged)}render(e,i,n,r,c){const h=this.gl;FM(h,this.cameraUBO,e),h.viewport(0,0,h.canvas.width,h.canvas.height),h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT);const u=this.lightingPass.generateLightBuffer(n,e),d=this.lightingPass.getAmbientLight();this.entityPass.setAmbientLight(d),this.entityPass.render(i,u,e);for(const g of this.spriteGroups.values())g.length=0;this.clearedTextures.length=0;for(const g of r){const m=g.texture;let y=this.spriteGroups.get(m);y||(y=[],this.spriteGroups.set(m,y)),y.push({worldX:g.worldX,worldY:g.worldY,widthPx:g.widthPx,heightPx:g.heightPx,alpha:g.alpha??1})}for(const[g,m]of this.spriteGroups)m.length>0&&this.spritePass.renderBatch(g,m);this.particlePass.render(c,e),this.lightingPass.compositeLightingOverScene()}getLightingPass(){return this.lightingPass}getEntityPass(){return this.entityPass}getSpritePass(){return this.spritePass}getParticlePass(){return this.particlePass}setAmbientLight(e){this.lightingPass.setAmbientLight(e)}resize(){this.lightingPass.resize()}destroy(){this.gl.deleteBuffer(this.cameraUBO),this.lightingPass.destroy(),this.entityPass.destroy(),this.spritePass.destroy(),this.particlePass.destroy(),Ee.off("resolution:changed",this.onResolutionChanged)}}const Rp=.1,Ms=2420,NM=1,HM=`
attribute vec2 aPosition;
uniform vec2 uOffset;
uniform vec2 uScale;
varying vec2 vUV;
void main() {
  vec2 pos = aPosition * uScale + uOffset;
  vUV = (aPosition + 1.0) / 2.0;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,WM=`
precision mediump float;
uniform sampler2D uTexture;
uniform float uAlpha;
varying vec2 vUV;
void main() {
  vec4 texColor = texture2D(uTexture, vUV);
  gl_FragColor = vec4(texColor.rgb, texColor.a * uAlpha);
}
`;class zM{constructor(e,i,n){this.backgroundImageId=n,this.imageLoadPromise=null,this.texture=null,this.image=null;const r=e.getWebGLContext("backgroundgl");this.gl=r,this.camera=i,this.program=qi(r,HM,WM),this.quadBuffer=ha(r),this.initUniformLocations()}initUniformLocations(){this.program&&(this.uOffset=this.gl.getUniformLocation(this.program,"uOffset"),this.uScale=this.gl.getUniformLocation(this.program,"uScale"),this.uTexture=this.gl.getUniformLocation(this.program,"uTexture"),this.uAlpha=this.gl.getUniformLocation(this.program,"uAlpha"))}async load(){if(!this.backgroundImageId)return;if(this.imageLoadPromise)return this.imageLoadPromise;const e=this.backgroundImageId;return this.imageLoadPromise=new Promise(async(i,n)=>{try{const r=await this.loadImageAsync(e),c=document.createElement("canvas");c.width=r.width,c.height=r.height,c.getContext("2d").drawImage(r,0,0),this.texture&&this.gl.deleteTexture(this.texture),this.image=r,this.texture=fb(this.gl,c),i()}catch(r){n(r)}finally{this.imageLoadPromise=null}}),this.imageLoadPromise}loadImageAsync(e){return new Promise((i,n)=>{const r=new Image;r.src=Mi(`/assets/backgrounds/${e}`),r.onload=()=>i(r),r.onerror=n})}update(){}render(){if(!this.texture||!this.program||!this.quadBuffer)return;const e=this.gl,{width:i,height:n}=e.canvas;this.gl.viewport(0,0,i,n),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer);const r=e.getAttribLocation(this.program,"aPosition");e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(this.uTexture,0),e.uniform1f(this.uAlpha,NM);const c=this.camera.getOffset(),h=c.x*Rp,u=c.y*Rp,d=Math.ceil(i/Ms)+2,g=Math.ceil(n/Ms)+2,m=Math.floor(h/Ms)-1,y=Math.floor(u/Ms)-1,v=Ms/i,M=Ms/n;for(let b=0;b<g;b++)for(let C=0;C<d;C++){const w=(m+C)*Ms-h,A=(y+b)*Ms-u,R=w/i*2,I=-(A/n)*2;e.uniform2f(this.uOffset,R,I),e.uniform2f(this.uScale,v,M),e.drawArrays(e.TRIANGLE_STRIP,0,4)}e.disableVertexAttribArray(r),e.bindTexture(e.TEXTURE_2D,null),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}destroy(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null),this.quadBuffer&&(this.gl.deleteBuffer(this.quadBuffer),this.quadBuffer=null),this.program&&(this.gl.deleteProgram(this.program),this.program=null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}class ks{constructor(){this.energy=100,this.maxEnergy=100,this.onEnergyChangeCallbacks=[],this.firingMode=Ht.Sequence}static getInstance(){return ks.instance||(ks.instance=new ks),ks.instance}initialize(e=100){this.energy=e,this.maxEnergy=e}getFiringMode(){return this.firingMode}setFiringMode(e){this.firingMode=e}getEnergy(){return this.energy}getMaxEnergy(){return this.maxEnergy}setEnergy(e){this.energy=Math.max(0,Math.min(this.maxEnergy,e)),this.notifyEnergyChange()}spendEnergy(e){return e>this.energy?!1:(this.energy-=e,this.notifyEnergyChange(),!0)}addEnergy(e){this.energy=Math.min(this.energy+e,this.maxEnergy),this.notifyEnergyChange()}onEnergyChange(e){this.onEnergyChangeCallbacks.push(e)}notifyEnergyChange(){for(const e of this.onEnergyChangeCallbacks)e(this.energy,this.maxEnergy)}reset(){this.energy=this.maxEnergy,this.notifyEnergyChange()}destroy(){this.energy=0,this.maxEnergy=0,this.onEnergyChangeCallbacks.length=0}}let GM=0;function VM(){return`point-light-${GM++}`}const Ep=.25;function ti(a){a.intensity=a.intensity?a.intensity*Ep:Ep;const{x:e,y:i,radius:n=128,color:r="#ffffff",intensity:c=1,flicker:h=!1,life:u,expires:d=!1,id:g=VM(),fadeMode:m="linear"}=a;return{id:g,x:e,y:i,radius:n,color:r,intensity:c,flicker:h,life:u,maxLife:u,expires:d,type:"point",fadeMode:m}}const yo=new Map,Wt={registerBlock(a,e){yo.set(a,e)},unregisterBlock(a){yo.delete(a)},getObject(a){return yo.get(a)},clear(){yo.clear()},size(){return yo.size}};class li{constructor(){this.ships=new Set,this.shipIdMap=new Map,this.playerShip=null}static getInstance(){return li.instance||(li.instance=new li),li.instance}getById(e){return this.shipIdMap.get(e)}add(e){this.ships.add(e),this.shipIdMap.set(e.id,e)}remove(e){this.ships.delete(e),this.shipIdMap.delete(e.id),this.playerShip===e&&(this.playerShip=null)}getAll(){return this.ships}clear(){this.ships.clear(),this.shipIdMap.clear(),this.playerShip=null}count(){return this.ships.size}setPlayerShip(e){this.ships.has(e)||this.add(e),this.playerShip=e}getPlayerShip(){return this.playerShip}}function vm(a,e){const i=new Set,n=[e],r=h=>`${h.x},${h.y}`,c=h=>[{x:h.x+1,y:h.y},{x:h.x-1,y:h.y},{x:h.x,y:h.y+1},{x:h.x,y:h.y-1}];for(;n.length>0;){const h=n.pop(),u=r(h);if(!i.has(u)&&a.hasBlockAt(h)){i.add(u);for(const d of c(h)){const g=r(d);!i.has(g)&&a.hasBlockAt(d)&&n.push(d)}}}return i}function qe(a){return`${a.x},${a.y}`}function tn(a){const[e,i]=a.split(",").map(Number);return{x:e,y:i}}var Rs=(a=>(a.Player="player",a.Enemy="enemy",a.Neutral="neutral",a))(Rs||{});class ku{constructor(e,i,n,r){if(this.blocks=new Map,this.blockToCoordMap=new Map,this.destroyed=!1,this.deathTimestamp=null,this.totalMass=null,this.immoveable=!1,this.collidingUntil=0,this.grid=e,this.id=this.generateId(),this.faction=r??Rs.Neutral,this.transform={position:(n==null?void 0:n.position)??{x:0,y:0},velocity:(n==null?void 0:n.velocity)??{x:0,y:0},rotation:(n==null?void 0:n.rotation)??0,angularVelocity:(n==null?void 0:n.angularVelocity)??0},i)for(const[c,h]of i)this.blocks.set(qe(c),h),this.grid.addBlockToCell(h),this.blockToCoordMap.set(h,c),Wt.registerBlock(h,this)}update(e){}onDestroyed(){}setFaction(e){this.faction=e}getFaction(){return this.faction}placeBlock(e,i){const n=qe(e);this.blocks.set(n,i),this.grid.addBlockToCell(i),this.blockToCoordMap.set(i,e),Wt.registerBlock(i,this),this.invalidateMass()}getBlock(e){return this.blocks.get(qe(e))}hasBlockAt(e){return this.blocks.has(qe(e))}getBlockMap(){return this.blocks}getAllBlocks(){return Array.from(this.blocks.entries()).map(([e,i])=>[tn(e),i])}getBlockCount(){return this.blocks.size}getCenterBlock(){return this.blocks.get("0,0")}getBlockCoord(e){return this.blockToCoordMap.get(e)??null}getBlocksWithinGridDistance(e,i){const n=[];for(const[r,c]of this.getAllBlocks()){const h=this.getBlockCoord(c);if(!h)continue;const u=Math.abs(h.x-e.x),d=Math.abs(h.y-e.y);Math.max(u,d)<=i&&n.push(c)}return n}hideAllBlocks(){for(const e of this.blocks.values())e.hidden=!0}showAllBlocks(){for(const e of this.blocks.values())e.hidden=!1}findBlockCoord(e){for(const[i,n]of this.blocks.entries())if(n===e)return tn(i);return null}removeBlock(e){const i=qe(e),n=this.blocks.get(i);n&&(Wt.unregisterBlock(n),this.grid.removeBlockFromCell(n),this.blocks.delete(i),this.blockToCoordMap.delete(n),this.invalidateMass())}removeBlocks(e,i){const n=i??[];if(i)for(const r of i){const c=this.blockToCoordMap.get(r);c&&this.blocks.delete(qe(c)),this.blockToCoordMap.delete(r)}else for(const r of e){const c=qe(r),h=this.blocks.get(c);h&&(n.push(h),this.blocks.delete(c),this.blockToCoordMap.delete(h))}for(const r of n)Wt.unregisterBlock(r);this.grid.removeBlocksFromCells(n),this.invalidateMass()}getTransform(){return this.transform}setTransform(e){this.transform={...e},this.updateBlockPositions()}getGrid(){return this.grid}setImmoveable(e){this.immoveable=e}isImmoveable(){return this.immoveable}setColliding(e,i=100){e&&(this.collidingUntil=performance.now()+i)}isColliding(){return performance.now()<this.collidingUntil}getBlockWorldPosition(e){const i=this.getBlockCoord(e);return i?this.calculateBlockWorldPosition(i):{x:0,y:0}}calculateBlockWorldPosition(e){const{position:i,rotation:n}=this.transform,{x:r,y:c}=i,h=Math.cos(n),u=Math.sin(n),d=r+e.x*32*h-e.y*32*u,g=c+e.x*32*u+e.y*32*h;return{x:d,y:g}}updateBlockPositions(){for(const[e,i]of this.blocks.entries()){const n=tn(e);this.grid.removeBlockFromCell(i),i.position=this.calculateBlockWorldPosition(n),this.grid.addBlockToCell(i)}}getTotalMass(){if(this.totalMass==null){let e=0;for(const i of this.blocks.values())e+=i.type.mass;this.totalMass=e}return this.totalMass}invalidateMass(){this.totalMass=null}destroy(){if(!this.destroyed){this.destroyed=!0,this.deathTimestamp=performance.now();for(const e of this.blocks.values())this.grid.removeBlockFromCell(e);this.blocks.clear(),this.blockToCoordMap.clear(),this.onDestroyed()}}isDestroyed(){return this.destroyed}isVisuallyExpired(e=2e3){return!this.destroyed||this.deathTimestamp===null?!1:performance.now()-this.deathTimestamp>e}getTimeSinceDeath(){return!this.destroyed||this.deathTimestamp===null?0:performance.now()-this.deathTimestamp}isDeletionSafe(e){const i=qe(e);if(!this.blocks.has(i))return!0;const n=new Map(this.blocks);n.delete(i);const r=[...n.keys()][0];if(!r)return!0;const c=new Set,h=[r];for(;h.length>0;){const u=h.pop();if(c.has(u))continue;c.add(u);const{x:d,y:g}=tn(u),m=[{x:d+1,y:g},{x:d-1,y:g},{x:d,y:g+1},{x:d,y:g-1}];for(const y of m){const v=qe(y);n.has(v)&&!c.has(v)&&h.push(v)}}return c.size===n.size}loadFromJson(e){const{position:i,velocity:n,rotation:r,angularVelocity:c}=e.transform;this.transform.position=i,this.transform.velocity=n,this.transform.rotation=r,this.transform.angularVelocity=c,e.blocks.forEach(h=>{const u=ci(h.id);if(!u){console.warn(`Unknown block type during deserialization: ${h.id}`);return}const d=crypto.randomUUID(),g={ownerFaction:Rs.Neutral,id:d,type:u,rotation:h.rotation??0,hp:u.armor,ownerShipId:this.id,position:{x:0,y:0}},m=qe(h.coord);this.blocks.set(m,g),this.blockToCoordMap.set(g,h.coord),this.grid.addBlockToCell(g)}),this.invalidateMass(),this.updateBlockPositions()}generateId(){return"entity-"+Math.random().toString(36).slice(2,10)}}class XM{constructor(e,i){this.timeSinceLastUse=0,this.rechargeDelay=.25,this.max=e,this.current=e,this.rechargePerSecond=i}update(e){this.timeSinceLastUse+=e,this.timeSinceLastUse>=this.rechargeDelay&&(this.current=Math.min(this.current+this.rechargePerSecond*e,this.max))}spend(e){return this.current<e?!1:(this.current-=e,this.timeSinceLastUse=0,!0)}add(e){this.current=Math.min(this.current+e,this.max)}reset(){this.current=this.max,this.timeSinceLastUse=0}getCurrent(){return this.current}getMax(){return this.max}setMax(e){this.max=e,this.current=Math.min(this.current,e)}setRechargeRate(e){this.rechargePerSecond=e}setMaxEnergy(e){this.max=e,this.current=Math.min(this.current,e)}}const Ts=class Ts{constructor(e,i){this.activeVisuals=[],this.shieldedBlocks=new Set,this.ctx=e.getContext("fx"),this.camera=i}static getInstance(){if(!Ts.instance)throw new Error("ShieldEffectsSystem not initialized. Call initialize(canvasManager, camera) first.");return Ts.instance}static initialize(e,i){Ts.instance||(Ts.instance=new Ts(e,i))}registerShield(e,i){this.activeVisuals.push({block:e,radius:i,age:0})}registerShieldedBlock(e){this.shieldedBlocks.add(e)}unregisterShieldedBlock(e){this.shieldedBlocks.delete(e)}clearShieldedBlocks(){this.shieldedBlocks.clear()}clearVisualsForShip(e){this.activeVisuals=this.activeVisuals.filter(i=>i.block.ownerShipId!==e);for(const i of Array.from(this.shieldedBlocks))i.ownerShipId===e&&this.shieldedBlocks.delete(i)}update(e){for(const i of this.activeVisuals)i.age+=e;this.activeVisuals=this.activeVisuals.filter(i=>{var n;return((n=i.block.type.behavior)==null?void 0:n.shieldRadius)!=null||i.block.isShielded})}render(){const e=this.ctx;e.save(),e.scale(this.camera.getZoom(),this.camera.getZoom());for(const i of this.activeVisuals){const n=i.block.position;if(!n)continue;const r=this.camera.worldToScreen(n.x,n.y),c=r.x/this.camera.getZoom(),h=r.y/this.camera.getZoom(),u=i.radius,d=.75+.1*Math.sin(i.age*3),g=fm[i.block.type.id]??["#88ddff","#44bbff","#00aaff"],[m,y,v]=g,M=e.createRadialGradient(c,h,0,c,h,u);M.addColorStop(0,m+`${Math.floor(d*255).toString(16).padStart(2,"0")}`),M.addColorStop(1,v+"00"),e.globalAlpha=d,e.fillStyle=M,e.beginPath(),e.arc(c,h,u,0,Math.PI*2),e.fill()}for(const i of this.shieldedBlocks){const n=li.getInstance().getById(i.ownerShipId);if(!n)continue;const r=n.getBlockCoord(i);if(!r)continue;const c=n.getTransform(),h=r.x*G,u=r.y*G,d=Math.cos(c.rotation),g=Math.sin(c.rotation),m=h*d-u*g,y=h*g+u*d,v=c.position.x+m,M=c.position.y+y,b=this.camera.worldToScreen(v,M);e.save(),e.translate(b.x/this.camera.getZoom(),b.y/this.camera.getZoom()),e.rotate(c.rotation);const C=i.shieldHighlightColor??"rgba(255, 0, 0, 0.4)";hm(e,i.type.id,i.rotation,C),e.restore()}e.restore()}clear(){this.activeVisuals.length=0,this.shieldedBlocks.clear()}};Ts.instance=null;let Xi=Ts;class YM{constructor(e){this.active=!1,this.protectedBlocks=new Set,this.ownerShip=e}recalculateCoverage(){var r,c;for(const h of this.protectedBlocks)h.isShielded=!1,h.shieldEfficiency=void 0,h.shieldHighlightColor=void 0,h.shieldSourceId=void 0;this.protectedBlocks.clear();const e=this.ownerShip.getShieldBlocks(),i=Array.from(e),n=Xi.getInstance();if(n.clearVisualsForShip(this.ownerShip.id),i.length===0){this.deactivate();return}for(const h of i){const u=this.ownerShip.getBlockCoord(h);if(!u)continue;const d=((r=h.type.behavior)==null?void 0:r.shieldRadius)??0,g=((c=h.type.behavior)==null?void 0:c.shieldEfficiency)??0,m=u2[h.type.id]??"rgba(100, 255, 255, 0.4)",y=this.ownerShip.getBlocksWithinGridDistance(u,d);for(const v of y){this.protectedBlocks.add(v);const M=v.shieldEfficiency??0;g>=M&&(v.shieldEfficiency=g,v.shieldHighlightColor=m,v.shieldSourceId=h.type.id),this.active&&(v.isShielded=!0,n.registerShieldedBlock(v))}if(this.active){const v=d*G;n.registerShield(h,v)}}}activate(){var i;this.active=!0,this.recalculateCoverage();const e=Xi.getInstance();e.clearVisualsForShip(this.ownerShip.id);for(const n of this.protectedBlocks)n.isShielded=!0,e.registerShieldedBlock(n);for(const n of this.ownerShip.getShieldBlocks()){const c=(((i=n.type.behavior)==null?void 0:i.shieldRadius)??0)*G;e.registerShield(n,c)}}deactivate(){this.active=!1,Xi.getInstance().clearVisualsForShip(this.ownerShip.id);for(const i of this.protectedBlocks)i.isShielded=!1,i.shieldEfficiency=void 0,i.shieldHighlightColor=void 0,i.shieldSourceId=void 0}isActive(){return this.active}hasShieldBlocks(){for(const e of this.ownerShip.getShieldBlocks())return!0;return!1}}class qM{constructor(e,i=5,n=5){this.BASE_MAX_FUEL=100,this.RECHARGE_DURATION_SECONDS=8,this.speedMultiplier=1.5,this.accelerationMultiplier=2,this.pulseMultiplier=1.5,this.superPulseBonusMultiplier=.5,this.TRIGGER_COOLDOWN=1,this.triggerCooldownRemaining=0,this.PULSE_WINDOW=.4,this.PULSE_DURATION=6,this.PULSE_COOLDOWN=2,this.PULSE_PERFECT_WINDOW=.2,this.pulsePerfectTimingFuelRefundAmount=25,this.pulseDurationRemaining=0,this.pulseCooldownRemaining=0,this.superPulseDurationRemaining=0,this.afterburnerJustActivated=!1,this.pulseJustActivated=!1,this.superPulseJustActivated=!1,this.lastDeactivationTime=null,this.active=!1,this.max=e,this.current=e,this.rechargePerSecond=e/this.RECHARGE_DURATION_SECONDS,this.consumptionPerSecond=n}update(e){if(this.triggerCooldownRemaining>0&&(this.triggerCooldownRemaining-=e,this.triggerCooldownRemaining<0&&(this.triggerCooldownRemaining=0)),this.active){const i=this.consumptionPerSecond*e;this.current-=i,this.current<=0&&(this.current=0,this.active=!1,this.lastDeactivationTime=performance.now()/1e3,this.pulseDurationRemaining=0)}else this.rechargePerSecond>0&&(this.current=Math.min(this.current+this.rechargePerSecond*e,this.max));this.pulseDurationRemaining>0&&(this.pulseDurationRemaining-=e,this.pulseDurationRemaining<=0&&(this.pulseDurationRemaining=0)),this.superPulseDurationRemaining>0&&(this.superPulseDurationRemaining-=e,this.superPulseDurationRemaining<=0&&(this.superPulseDurationRemaining=0)),this.pulseCooldownRemaining>0&&(this.pulseCooldownRemaining-=e,this.pulseCooldownRemaining<0&&(this.pulseCooldownRemaining=0))}consume(e){return this.current<e?!1:(this.current-=e,!0)}refill(e){this.current=Math.min(this.current+e,this.max)}reset(){this.current=this.max,this.active=!1,this.lastDeactivationTime=null,this.pulseDurationRemaining=0,this.pulseCooldownRemaining=0,this.pulseJustActivated=!1,this.superPulseJustActivated=!1}setActive(e){const i=performance.now()/1e3;if(e){if(this.active)return!0;if(this.triggerCooldownRemaining>0)return!1;if(this.current>=10){const n=this.lastDeactivationTime!==null?i-this.lastDeactivationTime:1/0;return this.pulseCooldownRemaining<=0&&n<=this.PULSE_WINDOW&&(this.pulseDurationRemaining=this.PULSE_DURATION,this.pulseCooldownRemaining=this.PULSE_COOLDOWN,this.pulseJustActivated=!0,n>=this.PULSE_WINDOW-this.PULSE_PERFECT_WINDOW&&(this.current=Math.min(this.current+this.pulsePerfectTimingFuelRefundAmount,this.max),this.superPulseJustActivated=!0,this.superPulseDurationRemaining=this.PULSE_DURATION)),this.active=!0,this.triggerCooldownRemaining=this.TRIGGER_COOLDOWN,this.afterburnerJustActivated=!0,!0}return!1}else return this.active&&(this.lastDeactivationTime=i),this.active=!1,!1}isActive(){return this.active}isPulsing(){return this.pulseDurationRemaining>0}getCurrent(){return this.current}getMax(){return this.max}setMax(e){this.max=e+this.BASE_MAX_FUEL,this.current=Math.min(this.current,this.max),this.rechargePerSecond=this.max/this.RECHARGE_DURATION_SECONDS}getConsumptionRatePerSecond(){return this.consumptionPerSecond}setConsumptionRatePerSecond(e){this.consumptionPerSecond=e}getSpeedMultiplier(){const e=this.getPulseDecayFactor(),i=this.getSuperPulseDecayFactor();return this.speedMultiplier+this.pulseMultiplier*e+this.superPulseBonusMultiplier*i}getAccelerationMultiplier(){const e=this.getPulseDecayFactor(),i=this.getSuperPulseDecayFactor();return this.accelerationMultiplier+this.pulseMultiplier*e+this.superPulseBonusMultiplier*i}getPulseMultiplier(){return this.pulseMultiplier}getPulseDecayFactor(){return this.pulseDurationRemaining>0?this.pulseDurationRemaining/this.PULSE_DURATION:0}wasAfterburnerJustActivated(){const e=this.afterburnerJustActivated;return this.afterburnerJustActivated=!1,e}wasPulseJustActivated(){const e=this.pulseJustActivated;return this.pulseJustActivated=!1,e}wasSuperPulseJustActivated(){const e=this.superPulseJustActivated;return this.superPulseJustActivated=!1,e}getPulseCooldownRemaining(){return this.pulseCooldownRemaining}wouldTriggerPulseNow(){const e=performance.now()/1e3;return this.pulseCooldownRemaining<=0&&this.lastDeactivationTime!==null&&e-this.lastDeactivationTime<=this.PULSE_WINDOW}getPulseWindowRemaining(){if(this.lastDeactivationTime===null)return 0;const i=performance.now()/1e3-this.lastDeactivationTime;return Math.max(0,this.PULSE_WINDOW-i)}getSuperPulseWindowRemaining(){if(this.lastDeactivationTime===null)return 0;const i=performance.now()/1e3-this.lastDeactivationTime,n=this.PULSE_WINDOW-this.PULSE_PERFECT_WINDOW;return i<n||i>this.PULSE_WINDOW?0:Math.max(0,this.PULSE_WINDOW-i)}getSuperPulseDecayFactor(){return this.superPulseDurationRemaining>0?this.superPulseDurationRemaining/this.PULSE_DURATION:0}}class Et extends ku{constructor(e,i,n,r,c,h){super(e,i,n),this.afterburnerComponent=null,this.energyComponent=null,this.shieldBlocks=new Set,this.fuelTankBlocks=new Set,this.firingPlan=[],this.firingPlanIndex=new Map,this.turretSequenceState={},this.firingMode=Ht.Synced,this.harvesterBlocks=new Map,this.haloBladeBlocks=new Map,this.destroyedListeners=[],this.lightAuraId=null,this.thrusting=!0,this.strafingLeft=!1,this.strafingRight=!1,this.affixes={},this.shieldComponent=new YM(this),this.afterburnerComponent=new qM(100,5),this.validateFiringPlan(),this.isPlayerShip=r??!1,this.affixes=c??{},this.faction=h??Rs.Enemy}generateId(){return"ship-"+Math.random().toString(36).slice(2,9)}getIsPlayerShip(){return this.isPlayerShip}setIsPlayerShip(e){this.isPlayerShip=e}getAffixes(){return this.affixes}setAffixes(e){this.affixes=e}getAfterburnerComponent(){return this.afterburnerComponent}triggerAfterburner(){this.afterburnerComponent&&this.afterburnerComponent.setActive(!0)}deactivateAfterburner(){this.afterburnerComponent&&this.afterburnerComponent.setActive(!1)}isAfterburnerActive(){var e;return((e=this.afterburnerComponent)==null?void 0:e.isActive())??!1}getAfterburnerSpeedMultiplier(){var e;return((e=this.afterburnerComponent)==null?void 0:e.getSpeedMultiplier())??1}getAfterburnerAccelMultiplier(){var e;return((e=this.afterburnerComponent)==null?void 0:e.getAccelerationMultiplier())??1}registerAuraLight(e="#ffffff",i=64,n=1.25){if(!$e.hasInstance())return;const r=$e.getInstance();this.lightAuraId=`aura-${this.id}`;const c=ti({id:this.lightAuraId,x:this.getTransform().position.x,y:this.getTransform().position.y,radius:i,color:e,intensity:n});r.registerLight(c)}cleanupAuraLight(){this.lightAuraId&&($e.getInstance().removeLight(this.lightAuraId),this.lightAuraId=null)}getLightAuraId(){return this.lightAuraId}isThrusting(){return this.thrusting}isStrafingLeft(){return this.strafingLeft}isStrafingRight(){return this.strafingRight}setThrusting(e){this.thrusting=e}setStrafingLeft(e){this.strafingLeft=e}setStrafingRight(e){this.strafingRight=e}getCockpit(){return this.blocks.get(qe({x:0,y:0}))}getCockpitHp(){const e=this.getCockpit();return e?e.hp:(console.warn(`[Ship ${this.id}] Cockpit block missing.`),null)}getCockpitCoord(){if(this.getCockpit())return{x:0,y:0}}getFiringPlan(){return this.firingPlan}getFiringMode(){return this.firingMode}setFiringMode(e){this.firingMode=e,this.isPlayerShip&&ks.getInstance().setFiringMode(e)}validateFiringPlan(){const e=[],i=new Map;for(const n of this.firingPlan)if(this.blocks.has(qe(n.coord))&&this.blocks.get(qe(n.coord))===n.block){const c=e.length;e.push(n),i.set(n.block,c)}this.firingPlan=e,this.firingPlanIndex=i}addWeaponToPlanIfApplicable(e,i){var h,u,d;const n=(h=i.type.behavior)==null?void 0:h.fire;if(!n||!((d=(u=i.type)==null?void 0:u.behavior)!=null&&d.canFire))return;const r={coord:e,block:i,fireRate:n.fireRate||1,fireCooldown:1/(n.fireRate||1),timeSinceLastShot:0},c=this.firingPlan.length;this.firingPlan.push(r),this.firingPlanIndex.set(i,c)}removeWeaponFromPlanIfApplicable(e){const i=this.firingPlanIndex.get(e);if(i===void 0)return;const n=this.firingPlan.length-1,r=this.firingPlan[n];i!==n&&(this.firingPlan[i]=r,this.firingPlanIndex.set(r.block,i)),this.firingPlan.pop(),this.firingPlanIndex.delete(e)}removeWeaponsFromPlan(e){if(e.length===0)return;const i=new Set(e),n=[],r=new Map;for(const c of this.firingPlan)if(!i.has(c.block)){const h=n.length;n.push(c),r.set(c.block,h)}this.firingPlan=n,this.firingPlanIndex=r}resetTurretSequenceState(){this.turretSequenceState={}}getFuelTankBlocks(){return this.fuelTankBlocks}updateFuelCapacity(){let e=0;for(const i of this.fuelTankBlocks){const n=i.type.behavior;n!=null&&n.fuelCapacityIncrease&&(e+=n.fuelCapacityIncrease)}this.afterburnerComponent&&this.afterburnerComponent.setMax(e)}getEnergyComponent(){return this.energyComponent}getShieldComponent(){return this.shieldComponent}getShieldBlocks(){return this.shieldBlocks}updateEnergy(e){var i;(i=this.energyComponent)==null||i.update(e)}recomputeEnergyStats(){this.energyComponent||this.enableEnergyComponent();const e=this.getEnergyComponent();if(!e)return;const{max:i,regen:n}=this.computeEnergyStats();e.setMax(i),e.setRechargeRate(n)}enableEnergyComponent(){if(this.energyComponent)return;const{max:e,regen:i}=this.computeEnergyStats();e!==0&&(this.energyComponent=new XM(e,i))}computeEnergyStats(){let e=0,i=0;for(const[,n]of this.blocks.entries()){const r=n.type.behavior;r!=null&&r.energyMaxIncrease&&(e+=r.energyMaxIncrease),r!=null&&r.energyChargeRate&&(i+=r.energyChargeRate)}return{max:e,regen:i>0?i:10}}getHaloBladeBlocks(){return this.haloBladeBlocks}getTotalHarvestRate(){let e=0;for(const i of this.harvesterBlocks.values())e+=i;return e}rebuildHaloBladeIndex(){var e;this.haloBladeBlocks.clear();for(const[,i]of this.blocks.entries()){const n=(e=i.type.behavior)==null?void 0:e.haloBladeProperties;n&&this.haloBladeBlocks.set(i,n)}}placeBlockById(e,i,n){const r=ci(i);if(!r)throw new Error(`Unknown block type: ${i}`);const c=qe(e);if(this.blocks.has(c))return!1;const h=this.calculateBlockWorldPosition(e),u=crypto.randomUUID(),d={ownerFaction:this.faction,id:u,type:r,hp:r.armor,ownerShipId:this.id,position:h,...n!==void 0?{rotation:n}:{}};return this.placeBlock(e,d),!0}placeBlock(e,i){var h,u,d;const n=qe(e);this.blocks.set(n,i),this.grid.addBlockToCell(i),this.blockToCoordMap.set(i,e),Wt.registerBlock(i,this),(h=i.type.behavior)!=null&&h.shieldRadius&&this.shieldBlocks.add(i);const r=(u=i.type.behavior)==null?void 0:u.harvestRate;r&&this.harvesterBlocks.set(i,r);const c=(d=i.type.behavior)==null?void 0:d.haloBladeProperties;c&&this.haloBladeBlocks.set(i,c),i.type.id.startsWith("fuelTank")&&this.fuelTankBlocks.add(i),this.updateFuelCapacity(),this.invalidateMass(),this.recomputeEnergyStats(),this.addWeaponToPlanIfApplicable(e,i),this.shieldComponent.recalculateCoverage()}removeBlock(e){const i=qe(e),n=this.blocks.get(i);n&&(this.grid.removeBlockFromCell(n),this.blockToCoordMap.delete(n),this.harvesterBlocks.delete(n),this.shieldBlocks.delete(n),this.haloBladeBlocks.delete(n),this.fuelTankBlocks.delete(n),this.removeWeaponFromPlanIfApplicable(n),Wt.unregisterBlock(n)),this.blocks.delete(i),this.updateFuelCapacity(),this.invalidateMass(),this.recomputeEnergyStats(),this.shieldComponent.recalculateCoverage()}removeBlocks(e,i){if(e.length===0)return;const n=i??[];if(i)for(const r of i){const c=this.blockToCoordMap.get(r);if(c){const h=qe(c);this.blocks.delete(h)}this.blockToCoordMap.delete(r)}else for(const r of e){const c=qe(r),h=this.blocks.get(c);h&&(n.push(h),this.blocks.delete(c),this.blockToCoordMap.delete(h))}if(n.length!==0){this.grid.removeBlocksFromCells(n);for(const r of n)this.harvesterBlocks.delete(r),this.shieldBlocks.delete(r),this.haloBladeBlocks.delete(r),this.fuelTankBlocks.delete(r),Wt.unregisterBlock(r);this.removeWeaponsFromPlan(n),this.updateFuelCapacity(),this.invalidateMass(),this.recomputeEnergyStats(),this.shieldComponent.recalculateCoverage()}}isDeletionSafe(e){var u;const i=qe(e);if(!this.blocks.has(i))return!0;const n=new Map(this.blocks);n.delete(i);const r=((u=[...n.entries()].find(([,d])=>d.type.id.startsWith("cockpit")))==null?void 0:u[0])??[...n.keys()][0];if(!r)return!0;const c=new Set,h=[r];for(;h.length>0;){const d=h.pop();if(c.has(d))continue;c.add(d);const{x:g,y:m}=tn(d),y=[{x:g+1,y:m},{x:g-1,y:m},{x:g,y:m+1},{x:g,y:m-1}];for(const v of y){const M=qe(v);n.has(M)&&!c.has(M)&&h.push(M)}}return c.size===n.size}loadFromJson(e){const i=this.getTransform();i.position=e.transform.position,i.rotation=e.transform.rotation,e.blocks.forEach(n=>{const{coord:r,id:c,rotation:h}=n;this.placeBlockById(r,c,h)}),this.updateFuelCapacity(),this.validateFiringPlan(),this.rebuildHaloBladeIndex()}destroyInstantly(){if(!this.destroyed){this.destroyed=!0,this.deathTimestamp=performance.now()-1e4;for(const e of this.blocks.values())this.grid.removeBlockFromCell(e);this.blocks.clear(),this.blockToCoordMap.clear(),this.cleanupAuraLight();for(const e of this.destroyedListeners)e(this);this.destroyedListeners.length=0}}onDestroyedCallback(e){if(this.destroyed){e(this);return}this.destroyedListeners.push(e)}onDestroyed(){this.cleanupAuraLight();for(const e of this.destroyedListeners)e(this);this.destroyedListeners.length=0}}function jM(a,e,i,n,r=200,c="#00AAFF",h=20){n=Math.max(0,Math.min(1,n));const u=c,d=2,g=.35,m=.5;for(let y=0;y<d;y++){const v=y*g,M=Math.max(0,(n-v)/(1-v));if(M<=0)continue;const b=M*r,C=Math.pow(1-M,1.5)*(1-y*m);if(C<=.01)continue;const w=a.createRadialGradient(e,i,Math.max(0,b-h),e,i,b+h),[A,R,I]=Ip(u);w.addColorStop(0,`rgba(${A}, ${R}, ${I}, 0)`),w.addColorStop(.5,`rgba(${A}, ${R}, ${I}, ${(C*.8).toFixed(3)})`),w.addColorStop(1,`rgba(${A}, ${R}, ${I}, 0)`),a.save(),a.globalCompositeOperation="screen",a.fillStyle=w,a.beginPath(),a.arc(e,i,b,0,Math.PI*2),a.fill(),a.restore()}if(n<.4){const v=(1-n/.4)*.4,M=a.createRadialGradient(e,i,0,e,i,40),[b,C,w]=Ip(u);M.addColorStop(0,`rgba(255, 255, 255, ${v.toFixed(3)})`),M.addColorStop(.5,`rgba(${b}, ${C}, ${w}, ${(v*.6).toFixed(3)})`),M.addColorStop(1,`rgba(${b}, ${C}, ${w}, 0)`),a.save(),a.globalCompositeOperation="screen",a.fillStyle=M,a.beginPath(),a.arc(e,i,40,0,Math.PI*2),a.fill(),a.restore()}}function Ip(a){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[0,170,255]}function Jt(a,e,{file:i,channel:n,maxSimultaneous:r=5,baseVolume:c=1,pitchRange:h=[.7,1],volumeJitter:u=.2}){let d=0,g=1;if(e&&a!==e){const A=a.getTransform().position,R=e.getTransform().position,I=A.x-R.x,_=A.y-R.y,x=Math.sqrt(I*I+_*_),N=2450,W=300,z=Math.max(0,1-(x-W)/(N-W));g=Math.min(1,z),d=Math.max(-.7,Math.min(.7,I/300))}if(c*(1-u)*g<.01)return;const[v,M]=h,b=v+Math.random()*(M-v),w=c*(1-u*Math.random())*g;Q.play(i,n,{pitch:b,volume:w,pan:d,maxSimultaneous:r})}class ZM{constructor(e,i,n){this.activeShips=[],this.animationDuration=500,this.startBlockRevealInterval=200,this.decrementPerBlock=5,this.finalBlockRevealInterval=5,this.basePitch=.5,this.pitchIncrement=.03,this.maxPitch=2,this.playerShip=e,this.camera=i,this.ctx=n.getCanvas("fx").getContext("2d")}animateShipConstruction(e,i){const n=e.getAllBlocks();for(const[,r]of n)r.hidden=!0;this.activeShips.push({ship:e,queue:[...n],revealed:new Set,animationTimers:new Map,timeSinceLastReveal:0,blockRevealInterval:this.startBlockRevealInterval,totalBlockCount:n.length,blocksRevealed:0,phase:"building",shockwaveTimer:this.animationDuration,auraLightOptions:i})}update(e){const i=e*1e3;for(let n=this.activeShips.length-1;n>=0;n--){const r=this.activeShips[n];for(r.timeSinceLastReveal+=i;r.timeSinceLastReveal>=r.blockRevealInterval&&r.queue.length>0;){const[c,h]=r.queue.shift();h.hidden=!1;const u=qe(c);r.revealed.add(u),r.animationTimers.set(u,this.animationDuration),r.timeSinceLastReveal-=r.blockRevealInterval;const d=Math.min(this.basePitch+r.blocksRevealed*this.pitchIncrement,this.maxPitch);Jt(r.ship,this.playerShip,{file:"assets/sounds/sfx/ship/gather_00.wav",channel:"sfx",baseVolume:1,pitchRange:[d,d],volumeJitter:.2,maxSimultaneous:5});const g=this.startBlockRevealInterval,m=this.decrementPerBlock,y=this.finalBlockRevealInterval;r.blockRevealInterval=Math.max(y,g-m*r.blocksRevealed),r.blocksRevealed++}for(const[c,h]of r.animationTimers.entries()){const u=h-i;u<=0?r.animationTimers.delete(c):r.animationTimers.set(c,u)}r.phase==="building"?r.revealed.size===r.ship.getBlockCount()&&(r.phase="shockwave",r.shockwaveTimer=this.animationDuration,Jt(r.ship,this.playerShip,{file:"assets/sounds/sfx/ship/repair_00.wav",channel:"sfx",baseVolume:1,pitchRange:[.7,1.2],volumeJitter:.1,maxSimultaneous:3}),r.auraLightOptions&&r.ship.registerAuraLight(r.auraLightOptions.color,r.auraLightOptions.radius,r.auraLightOptions.intensity)):r.phase==="shockwave"&&(r.shockwaveTimer-=i,r.shockwaveTimer<=0&&this.activeShips.splice(n,1))}}render(e){var y;const i=this.playerShip.getTransform().position,n=this.playerShip.getGrid(),r=3e3,c=i.x-r,h=i.y-r,u=i.x+r,d=i.y+r,g=n.getBlocksInArea(c,h,u,d),m=new Set;for(const v of g){const M=Wt.getObject(v);if(!M||!(M instanceof Et))continue;const b=this.activeShips.find(se=>se.ship===M);if(!b)continue;const C=(y=[...b.ship.getBlockMap().entries()].find(([,se])=>se===v))==null?void 0:y[0];if(!C)continue;const w=C,A=b.animationTimers.get(w);if(!A)continue;if(!m.has(M)){if(m.add(M),b.phase!=="shockwave")continue;const se=M.getTransform(),D=this.camera.worldToScreen(se.position.x,se.position.y),X=1-b.shockwaveTimer/this.animationDuration,te=M.getBlockMap().size,ae=250,k=Math.sqrt(te)*20,H=(ae+k)*this.camera.getZoom(),J=Math.max(8,Math.sqrt(te)*2)*this.camera.getZoom();jM(this.ctx,D.x,D.y,X,H,"#00AAFF",J)}const R=M.getTransform(),I=tn(C),_=I.x*G,x=I.y*G,N=Math.cos(R.rotation),W=Math.sin(R.rotation),z=_*N-x*W,q=_*W+x*N,ie=R.position.x+z,ee=R.position.y+q,K=this.camera.worldToScreen(ie,ee),Z=(1-(1-A/this.animationDuration))*.6;this.ctx.save(),this.ctx.translate(K.x,K.y),this.ctx.scale(this.camera.getZoom(),this.camera.getZoom()),hm(this.ctx,v.type.id,v.rotation??0,`rgba(0,255,255,${Z.toFixed(3)})`),this.ctx.restore()}}}const KM=`
  precision mediump float;

  attribute vec2 aPosition;

  uniform mat4 uProjectionMatrix;
  uniform mat4 uViewMatrix;
  uniform vec2 uWorldPosition;  // world-space center position
  uniform vec2 uWorldSize;      // half extents in world units

  varying vec2 vUV;

  void main() {
    vec2 scaled = aPosition * uWorldSize; // convert [-1, 1] to world-size quad
    vec2 world = scaled + uWorldPosition;

    gl_Position = uProjectionMatrix * uViewMatrix * vec4(world, 0.0, 1.0);

    vUV = vec2((aPosition.x + 1.0) / 2.0, 1.0 - (aPosition.y + 1.0) / 2.0);
  }
`,QM=`
  precision mediump float;
  uniform sampler2D uTexture;
  uniform float uAlpha;
  varying vec2 vUV;

  void main() {
    vec4 texColor = texture2D(uTexture, vUV);
    gl_FragColor = vec4(texColor.rgb, texColor.a * uAlpha);
  }
`,ul=class ul{constructor(e){this.attribs={aPosition:0},this.gl=e,this.program=qi(e,KM,QM),this.quadBuffer=ha(e),this.uniforms={uProjectionMatrix:e.getUniformLocation(this.program,"uProjectionMatrix"),uViewMatrix:e.getUniformLocation(this.program,"uViewMatrix"),uWorldPosition:e.getUniformLocation(this.program,"uWorldPosition"),uWorldSize:e.getUniformLocation(this.program,"uWorldSize"),uTexture:e.getUniformLocation(this.program,"uTexture"),uAlpha:e.getUniformLocation(this.program,"uAlpha")}}static getInstance(e){return this.instance||(this.instance=new ul(e)),this.instance}static destroyInstance(){this.instance&&(this.instance.destroy(),this.instance=null)}renderTexture(e,i,n,r,c,h=1){const u=this.gl,d=Ct.getInstance(),g=ne();u.useProgram(this.program),u.bindBuffer(u.ARRAY_BUFFER,this.quadBuffer),u.enableVertexAttribArray(this.attribs.aPosition),u.vertexAttribPointer(this.attribs.aPosition,2,u.FLOAT,!1,0,0);const m=ym(-d.getViewportWidth()/(2*d.getZoom()),d.getViewportWidth()/(2*d.getZoom()),d.getViewportHeight()/(2*d.getZoom()),-d.getViewportHeight()/(2*d.getZoom())),y=d.getPosition(),v=Au(-y.x,-y.y),M=1/g,b=r*M,C=c*M;u.uniformMatrix4fv(this.uniforms.uProjectionMatrix,!1,m),u.uniformMatrix4fv(this.uniforms.uViewMatrix,!1,v),u.uniform2f(this.uniforms.uWorldPosition,i,n),u.uniform2f(this.uniforms.uWorldSize,b,C),u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,e),u.uniform1i(this.uniforms.uTexture,0),u.uniform1f(this.uniforms.uAlpha,h),u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),u.drawArrays(u.TRIANGLE_STRIP,0,4),u.disableVertexAttribArray(this.attribs.aPosition),u.bindTexture(u.TEXTURE_2D,null),u.bindBuffer(u.ARRAY_BUFFER,null),u.disable(u.BLEND),u.useProgram(null)}destroy(){const e=this.gl;e.deleteBuffer(this.quadBuffer),e.deleteProgram(this.program)}};ul.instance=null;let ll=ul;class $M{constructor(e,i,n,r,c,h,u,d,g){this.text=e,this.getPosition=i,this.fontSize=n,this.fontFamily=r,this.life=c,this.speed=h,this.alpha=u,this.color=d,this.behavior=g,this.elapsed=0,this.yOffset=0,this.originalFontSize=n}update(e){var i,n;if(this.elapsed+=e,this.yOffset-=this.speed*e,(i=this.behavior)!=null&&i.impactScale){const r=Math.min(this.elapsed/.15,1),c=1+(this.behavior.impactScale-1)*(1-r);this.fontSize=this.originalFontSize*c}if(((n=this.behavior)==null?void 0:n.fadeOut)!==!1){const r=Math.max(0,this.life-this.elapsed);this.alpha=Math.min(1,r/this.life)}}isExpired(){return this.elapsed>=this.life}render(e){const i=ne(),n=this.getPosition(),r=n.y+this.yOffset;e.save(),e.globalAlpha=this.alpha,e.fillStyle=this.color,e.font=`${Math.round(this.fontSize*i)}px ${this.fontFamily}`,e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,n.x,r),e.restore()}}class JM{constructor(){this.floatingTexts=[],this.channelMap=new Map,this.MERGE_WINDOW_MS=250,this.canvasManager=ii.getInstance(),this.ctx=this.canvasManager.getContext("ui")}update(e){for(const i of this.floatingTexts)i.update(e);this.floatingTexts=this.floatingTexts.filter(i=>!i.isExpired())}render(){for(const e of this.floatingTexts)e.render(this.ctx)}clear(){this.floatingTexts.length=0,this.channelMap.clear()}createScreenText(e,i,n,r=14,c="monospace",h=.6,u=30,d=1,g="#FFFFFF",m,y){const v=()=>({x:i,y:n});this.create(e,v,r,c,h,u,d,g,m,y)}createWorldText(e,i,n,r,c=14,h="monospace",u=.6,d=30,g=1,m="#FFFFFF",y,v){const M=()=>r.worldToScreen(i,n);this.create(e,M,c,h,u,d,g,m,y,v)}create(e,i,n,r,c,h,u,d,g,m){const y=performance.now();if(m){const M=this.channelMap.get(m);if(M&&y-M.lastUpdate<this.MERGE_WINDOW_MS){const b=parseFloat(M.entity.text),C=parseFloat(e);if(!isNaN(b)&&!isNaN(C)){const w=b+C;M.entity.text=`${Math.round(w)}`,M.entity.alpha=1,M.entity.life=c,M.lastUpdate=y;return}}}const v=new $M(e,i,n,r,c,h,u,d,g);this.floatingTexts.push(v),m&&this.channelMap.set(m,{entity:v,lastUpdate:y})}}class eC{constructor(e,i,n,r,c){this.grid=i,this.combatService=n,this.particleManager=r,this.playerShip=c,this.projectiles=[]}spawnProjectile(e,i,n,r,c=300,h=2,u=1,d,g,m,y){const v=i.x-e.x,M=i.y-e.y;if(Math.sqrt(v*v+M*M)===0)return;let C=Math.atan2(M,v);const w=(1-u)*Math.PI/8;u<1&&(C+=(Math.random()*2-1)*w);const A=Math.cos(C)*c,R=Math.sin(C)*c,I=this.particleManager.emitParticle(e,{colors:m??["#ffff88","#ffaa00","#ffcc33"],baseSpeed:0,sizeRange:[2.2,2.8],lifeRange:[h,h+.1],velocity:{x:A,y:R},light:!0,lightRadiusScalar:20,lightIntensity:.8,fadeMode:y});this.projectiles.push({position:{x:e.x,y:e.y},velocity:{x:A,y:R},type:n,damage:r,life:h,ownerShipId:d,ownerFaction:g,particle:I})}update(e){for(const i of this.projectiles)i.position.x+=i.velocity.x*e,i.position.y+=i.velocity.y*e,i.life-=e;this.projectiles=this.projectiles.filter(i=>i.life>0),this.checkCollisions()}checkCollisions(){for(const e of this.projectiles){const n=this.grid.getBlocksInArea(e.position.x-32,e.position.y-32,e.position.x+32,e.position.y+32,e.ownerFaction);for(const r of n){if(!this.checkCollision(e,r))continue;const c=Wt.getObject(r);if(!c)continue;const h=c.getBlockCoord(r);if(!h)continue;const u=li.getInstance().getById(e.ownerShipId);if(u){this.combatService.applyDamageToBlock(c,u,r,h,e.damage,"projectile",this.playerShip),this.removeProjectile(e);return}}}}checkCollision(e,i){if(!i.position)return!1;const n=15,r=i.type.size||32,c=e.position.x-i.position.x,h=e.position.y-i.position.y;return Math.sqrt(c*c+h*h)<n+r/2}removeProjectile(e){this.projectiles=this.projectiles.filter(i=>i!==e),this.particleManager.removeParticle(e.particle)}}let tC=0;function iC(){return`beam-light-${tC++}`}function sC(a){const{start:e,end:i,width:n=16,color:r="#00ffff",intensity:c=1,life:h,expires:u=!1,id:d=iC()}=a;return{id:d,type:"beam",start:e,end:i,width:n,color:r,intensity:c,life:h,maxLife:h,expires:u}}function bm(a){if(!a.length)throw new Error("randomFromArray: cannot select from an empty array");const e=Math.floor(Math.random()*a.length);return a[e]}function Bu(a){const i=li.getInstance().getById(a.ownerShipId);return i||As.getInstance().getById(a.ownerShipId)||null}function Sm(a,e){return e.getBlockCoord(a)}function ea(a,e){const i=e.x*32,n=e.y*32,r=Math.cos(a.rotation),c=Math.sin(a.rotation);return{x:a.position.x+i*r-n*c,y:a.position.y+i*c+n*r}}function _p(a,e,i){const n=Math.cos(i),r=Math.sin(i);return{x:a*n-e*r,y:a*r+e*n}}class nC{constructor(e,i,n,r,c,h){this.camera=i,this.grid=n,this.combatService=r,this.particleManager=c,this.playerShip=h,this.beamLength=2e3,this.activeBeams=[],this.intentMap=new Map,this.ctx=e.getContext("fx")}queueUpdate(e,i,n){this.intentMap.set(e,{intent:n,transform:i})}update(e){var i,n;for(const r of this.activeBeams)r.age+=e,r.intensity=.75+.25*Math.sin(r.age*10),r.glowPulse=.5+.5*Math.sin(r.age*4);this.activeBeams=[];for(const[r,{intent:c,transform:h}]of this.intentMap.entries()){if(!(c!=null&&c.fireSecondary))continue;const u=r.getAllBlocks().filter(([m,y])=>{var v,M;return y.type.id.startsWith("laser")&&((v=y.type.behavior)==null?void 0:v.canFire)&&((M=y.type.behavior.fire)==null?void 0:M.fireType)==="laser"});if(u.length===0)continue;let d=r.getEnergyComponent();if(d||(r.enableEnergyComponent(),d=r.getEnergyComponent()),!d)continue;let g=0;for(const[,m]of u){const y=((n=(i=m.type.behavior)==null?void 0:i.fire)==null?void 0:n.energyCost)??.25;g+=y}if(d.spend(g))for(const[m,y]of u){const v=y.type.behavior.fire,M=ea(h,m);if(!c.aimAt)continue;const C=(typeof y.rotation=="number"?y.rotation:0)*(Math.PI/180),w={x:0,y:-1},A=_p(w.x,w.y,C),R=_p(A.x,A.y,h.rotation),I=R.x,_=R.y,x=M.x+I*this.beamLength,N=M.y+_*this.beamLength;let W=x,z=N;const q=this.grid.getFirstBlockAlongRay(M,{x,y:N},r.getFaction());if(q){W=q.point.x,z=q.point.y;const X=Bu(q.block),te=X?Sm(q.block,X):null;X&&te&&this.combatService.applyDamageToBlock(X,r,q.block,te,v.fireDamage,"laser",this.playerShip)}const ie=128,ee=W-M.x,K=z-M.y,le=ee*ee+K*K;let Z=W,se=z,D=0;if(le>1e-4&&(D=1/Math.sqrt(le),Z+=ee*D*ie,se+=K*D*ie),this.activeBeams.push({origin:{x:M.x,y:M.y},target:{x:Z,y:se},age:0,intensity:Math.random()*.5+.75,coreWidth:3+Math.random(),glowPulse:Math.random()*Math.PI*2,blockTypeId:y.type.id}),Math.random()<.1){const X=pp[y.type.id],te=$e.getInstance();if(we.getInstance().isLightingEnabled()&&X){const ae=bm(X),k=sC({start:{x:M.x,y:M.y},end:{x:Z,y:se},width:30+Math.random()*4,color:ae,intensity:.15+Math.random()*.4,life:.1+Math.random()*.15,expires:!0});te.registerLight(k);const H=ti({x:M.x,y:M.y,radius:186+Math.random()*32,color:ae,intensity:.4+Math.random()*.3,life:.05+Math.random()*.1,expires:!0});te.registerLight(H)}}}}this.intentMap.clear()}render(){const e=this.ctx;e.save();for(const i of this.activeBeams){const n=this.camera.worldToScreen(i.origin.x,i.origin.y),r=this.camera.worldToScreen(i.target.x,i.target.y),c=pp[i.blockTypeId]??["#FFFFFF","#00CCFF","#00FFFF"],[h,u,d]=c;e.globalAlpha=i.intensity,e.strokeStyle=h,e.lineWidth=i.coreWidth+Math.sin(i.age*20)*.5,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.stroke(),e.globalAlpha=.2+.2*i.glowPulse,e.strokeStyle=u,e.lineWidth=7+Math.sin(i.age*4),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.stroke(),e.globalAlpha=.1,e.strokeStyle=d,e.lineWidth=11+2*Math.sin(i.age*2),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.stroke()}e.restore()}}function aC(a,e,i){if(e<=0)return;const n=a.getAllBlocks().filter(([,r])=>r.hp<r.type.armor);for(const[,r]of n){const c=r.type.armor-r.hp,h=Math.min(c,e);h>0&&(r.hp+=h,i.createRepairEffect(r.position))}}function Sl(a,e,i=300,n=1,r=.5,c="#ffffff"){const h=ti({x:a,y:e,radius:i,intensity:n,life:r,color:c,expires:!0});$e.getInstance().registerLight(h)}const xp=16,oC=48,rC=10,lC=2,jr=128,Dp={currency:.1,block:.05,repair:.1},cC={colors:["#ffcc00","#ffaa00","#ff8800","#cc6600"]},mt=class mt{constructor(e,i,n,r,c,h,u,d){this.camera=i,this.pickups=[],this.blockPickups=[],this.resourcePickups=[],this.currencyPickupPitch=mt.BASE_PICKUP_PITCH,this.blockPickupPitch=mt.BASE_PICKUP_PITCH,this.timeSinceLastCurrencyPickup=0,this.timeSinceLastBlockPickup=0,this.ctx=e.getContext("entities"),this.playerResources=Re.getInstance(),this.playerShip=n,this.sparkManager=r,this.screenEffects=c,this.popupMessageSystem=h,this.shipBuilderEffects=u,this.blockDropDecisionMenu=d}spawnCurrencyPickup(e,i){const n=$e.getInstance(),r=ti({x:e.x,y:e.y,radius:200,color:"#ffcc00",intensity:1,life:1e4,expires:!0});n.registerLight(r);const c={type:{id:"currency",name:"Gold Coin",currencyAmount:i,category:"currency",sprite:"currency",repairAmount:0},position:e,isPickedUp:!1,repairAmount:0,currencyAmount:i,rotation:0,lightId:r.id};this.pickups.push(c),this.resourcePickups.push(c)}spawnRepairPickup(e,i){const n=$e.getInstance(),r=ti({x:e.x,y:e.y,radius:200,color:"#ff4444",intensity:1,life:1e4,expires:!0});n.registerLight(r);const c={type:{id:"repair",name:"Repair Nanobot Swarm",sprite:"repair",category:"repair",currencyAmount:0,repairAmount:i},position:e,isPickedUp:!1,currencyAmount:0,repairAmount:i,rotation:0,lightId:r.id};this.pickups.push(c),this.resourcePickups.push(c)}spawnBlockPickup(e,i){const n=$e.getInstance(),r=Yi(i.id),c=mp[r]??"#ffffff",h=ti({x:e.x,y:e.y,radius:300,color:c,intensity:.75,life:1e4,expires:!0});n.registerLight(h);const u={type:{id:`unlock-${i.id}`,name:`${i.name} Blueprint`,sprite:i.sprite,currencyAmount:0,category:"block",blockTypeId:i.id,repairAmount:0},position:e,isPickedUp:!1,repairAmount:0,currencyAmount:0,rotation:0,lightId:h.id};this.pickups.push(u),this.blockPickups.push(u)}render(e){const i=this.camera.getViewportBounds(),n=i.x-jr,r=i.y-jr,c=i.x+i.width+jr,h=i.y+i.height+jr,u=G;for(const d of this.resourcePickups){const{x:g,y:m}=d.position;if(g<n||g>c||m<r||m>h)continue;const y=_b(d.type.id);if(!(y!=null&&y.base)){console.error("Missing sprite for pickup:",d.type.id);continue}const v=this.camera.worldToScreen(g,m);d.rotation+=Dp[d.type.category]??.5;let M=this.camera.getZoom();d.type.category==="currency"?M*=.5+Math.log2(d.currencyAmount+1)/5:d.type.category==="repair"&&(M*=.5+Math.log2(d.repairAmount+1)/5),this.ctx.save(),this.ctx.translate(v.x,v.y),this.ctx.rotate(d.rotation),this.ctx.scale(M,M),this.ctx.drawImage(y.base,-32/2,-32/2,u,u),this.ctx.restore()}for(const d of this.blockPickups){const{x:g,y:m}=d.position;if(g<n||g>c||m<r||m>h)continue;let y;try{y=hi(d.type.blockTypeId,gu.NONE)}catch(b){console.error(`Failed to resolve block sprite for pickup: ${d.type.blockTypeId}`,b);continue}if(!(y!=null&&y.base)){console.error("No sprite found for block pickup:",d.type.blockTypeId);continue}const v=this.camera.worldToScreen(g,m);d.rotation+=Dp.block;const M=this.camera.getZoom()*2;this.ctx.save(),this.ctx.translate(v.x,v.y),this.ctx.rotate(d.rotation),this.ctx.scale(M,M),this.ctx.drawImage(y.base,-32/2,-32/2,u,u),this.ctx.restore()}}update(e){var g;this.timeSinceLastCurrencyPickup+=e,this.timeSinceLastBlockPickup+=e,this.timeSinceLastCurrencyPickup>=mt.PITCH_RESET_DELAY&&(this.currencyPickupPitch=mt.BASE_PICKUP_PITCH),this.timeSinceLastBlockPickup>=mt.PITCH_RESET_DELAY&&(this.blockPickupPitch=mt.BASE_PICKUP_PITCH);const i=this.playerShip.getTransform().position,n=600,r=this.playerShip.getTotalHarvestRate()*oC,c=n+r,h=c*c,u=xp*xp,d=Math.random()<.2;for(const m of this.pickups){if(m.isPickedUp)continue;if(d){let _;switch(m.type.category){case"block":{const x=m.type.blockTypeId;if(x){const N=x.match(/(\d+)/),W=N?parseInt(N[1],10):0;_=c2[W]??cC.colors}else _=["#0022ff","#000099","#0055cc","#003388"];break}case"repair":_=["#ff4444","#cc2222","#ff0000","#aa0000"];break;case"currency":default:_=["#ffcc00","#ffaa00","#ff8800","#cc6600"];break}this.sparkManager.emitParticle(m.position,{colors:_,baseSpeed:250,sizeRange:[1,2.5],lifeRange:[1,2],fadeOut:!0})}const y=i.x-m.position.x,v=i.y-m.position.y,M=y*y+v*v;if(M>h)continue;const b=M/h,C=Math.pow(1-b,lC),w=rC*C,A=Math.sqrt(M),R=y/A,I=v/A;if(m.position.x+=R*w,m.position.y+=I*w,m.lightId){const _=$e.getInstance(),x=(g=_.getLightById)==null?void 0:g.call(_,m.lightId);x&&x.type==="point"&&(x.x=m.position.x,x.y=m.position.y)}M<u&&this.collectPickup(m)}}async collectPickup(e){e.isPickedUp=!0,e.lightId&&$e.getInstance().removeLight(e.lightId);const i=d=>{const g=d.indexOf(e);g!==-1&&d.splice(g,1)};i(this.pickups),e.type.category==="block"?i(this.blockPickups):i(this.resourcePickups);const n=this.playerShip.getTransform().position,r=$e.getInstance();let c=f2[e.type.category]??"#ffffff";if(e.type.category==="block"&&e.type.blockTypeId){const d=Yi(e.type.blockTypeId);c=mp[d]??c}const h=ti({x:n.x,y:n.y,radius:320+Math.random()*100,color:c,intensity:1.2,life:.5,expires:!0});r.registerLight(h);let u=!1;if(e.type.category==="currency"){const d=e.currencyAmount;this.playerResources.addCurrency(d),Ce.addCurrency(d),u=await Q.play("assets/sounds/sfx/ship/gather_00.wav","sfx",{volume:1.25,pitch:this.currencyPickupPitch+.25,maxSimultaneous:8}),u&&(this.timeSinceLastCurrencyPickup=0,this.currencyPickupPitch=Math.min(this.currencyPickupPitch+mt.PICKUP_PITCH_INCREMENT,mt.MAX_PICKUP_PITCH))}else if(e.type.category==="block"&&e.type.blockTypeId){Ce.incrementBlockCollectedCount(),u=await Q.play("assets/sounds/sfx/ui/start_00.wav","sfx",{volume:.8,pitch:this.blockPickupPitch,maxSimultaneous:8}),u&&(this.timeSinceLastBlockPickup=0,this.blockPickupPitch=Math.min(this.blockPickupPitch+mt.PICKUP_PITCH_INCREMENT,mt.MAX_PICKUP_PITCH));const d=Yi(e.type.blockTypeId),g=dm[d]??["#fff"];Sl(n.x,n.y,360,1,.5,g);const m=ci(e.type.blockTypeId);this.blockDropDecisionMenu.enqueueBlock(hb(m))}else if(e.type.category==="repair"){const d=e.repairAmount;aC(this.playerShip,d,this.shipBuilderEffects),Q.play("assets/sounds/sfx/ship/repair_00.wav","sfx",{maxSimultaneous:3})}else console.warn("Unhandled pickup category or malformed pickup:",e)}};mt.BASE_PICKUP_PITCH=.8,mt.PICKUP_PITCH_INCREMENT=.05,mt.MAX_PICKUP_PITCH=2.2,mt.PITCH_RESET_DELAY=3.2;let cu=mt;function Zr(a,e){return Math.random()*(e-a)+a}function hC(a,e){return Math.floor(Math.random()*(e-a+1))+a}function Pp(){return Math.random()*2*Math.PI}const uC=3;class fC{constructor(e){this.lightingOrchestrator=e,this.activeParticles=[],this.particlePool=[],this.CULL_PADDING=128,this.emissionAccumulator=0}_createAndRegisterParticle(e,i){var g,m;const{colors:n=["#00f","#009","#00a9f4","#1e90ff"],sizeRange:r=[1,4],lifeRange:c=[1,2]}=i;let h,u;if(i.randomDirection){const y=Pp(),v=((g=i.speedRange)==null?void 0:g[0])??0,M=((m=i.speedRange)==null?void 0:m[1])??i.baseSpeed??1,b=Zr(v,M);h=Math.cos(y)*b,u=Math.sin(y)*b}else if(i.velocity)h=i.velocity.x,u=i.velocity.y;else{const y=Pp(),v=Zr(0,i.baseSpeed??1);h=Math.cos(y)*v,u=Math.sin(y)*v}const d=this.getParticle();if(d.x=e.x,d.y=e.y,d.vx=h,d.vy=u,d.size=Zr(r[0],r[1])*uC,d.life=Zr(c[0],c[1]),d.initialLife=d.life,d.fadeOut=i.fadeOut??!1,d.fadeMode=i.fadeMode??"linear",d.renderAlpha=1,d.color=n[hC(0,n.length-1)],this.lightingOrchestrator&&i.light){const y=ti({x:d.x,y:d.y,radius:d.size*(i.lightRadiusScalar??3),color:d.color,intensity:i.lightIntensity??1,life:d.life,expires:!0,fadeMode:i.fadeMode??"linear"});this.lightingOrchestrator.registerLight(y),d.lightId=y.id}return this.activeParticles.push(d),d}emitBurst(e,i,n={}){for(let r=0;r<i;r++)this.spawnParticle(e,n)}emitContinuous(e,i,n,r={}){const c=Math.min(i,.05);this.emissionAccumulator+=n*c;const h=Math.floor(this.emissionAccumulator);this.emissionAccumulator-=h;for(let u=0;u<h;u++)this.spawnParticle(e,r)}emitParticle(e,i={}){return this._createAndRegisterParticle(e,i)}spawnParticle(e,i={}){this._createAndRegisterParticle(e,i)}update(e){if(we.getInstance().isParticlesEnabled()){for(const i of this.activeParticles){if(i.x+=i.vx*e,i.y+=i.vy*e,i.life-=e,i.lightId){const c=this.lightingOrchestrator.getLightById(i.lightId);c&&(c.type==="point"||c.type==="spot")&&(c.x=i.x,c.y=i.y)}const n=i.initialLife?i.life/i.initialLife:1,r=.1;switch(i.fadeMode){case"delayed":i.renderAlpha=n>=r?1:n/r;break;case"linear":default:i.renderAlpha=n;break}}this.activeParticles=this.activeParticles.filter(i=>{const n=i.life>0;return n||this.recycleParticle(i),n})}}getActiveParticles(){return this.activeParticles}getParticle(){return this.particlePool.pop()||{x:0,y:0,vx:0,vy:0,size:1,life:1,color:"#fff",speed:0}}removeParticle(e){const i=this.activeParticles.indexOf(e);i!==-1&&(this.activeParticles.splice(i,1),this.recycleParticle(e))}recycleParticle(e){e.lightId&&(this.lightingOrchestrator.removeLight(e.lightId),e.lightId=void 0),e.initialLife=void 0,e.fadeOut=void 0,e.fadeMode=void 0,e.renderAlpha=void 0,this.particlePool.push(e)}}const dC=["#fff","#f90","#ff0"],Lp=32,gC=16,Op=100,pC=.1;class Mm{constructor(e){this.sparkManager=e,this.colorCache=new Map,this.playerSettings=we.getInstance(),this.lightingOrchestrator=$e.getInstance()}emit(e){if(!this.playerSettings.isParticlesEnabled())return;const{coord:i,blockRotation:n,shipRotation:r,shipPosition:c,block:h,afterBurner:u,afterBurnerJustActivated:d,pulseJustActivated:g,superPulseJustActivated:m}=e,y=(h==null?void 0:h.type.id)??"",v=this.colorCache.get(y)??h2[y]??dC;this.colorCache.set(y,v);const M=Math.cos(r),b=Math.sin(r),C=n*(Math.PI/180),w=i.x*Lp,A=i.y*Lp,R=c.x+(w*M-A*b),I=c.y+(w*b+A*M),_=Math.cos(C),x=Math.sin(C),N=-16*x,W=gC*_,z=R+(N*M-W*b),q=I+(N*b+W*M),ie=x*M-_*b,ee=x*b+_*M,K=ie*Op,le=ee*Op,Z={x:K*(u?3:1),y:le*(u?3:1)};if(this.sparkManager.emitBurst({x:z,y:q},2,{colors:v,velocity:Z,baseSpeed:1,sizeRange:u?[2,4]:[1,3],lifeRange:[.08,.18],fadeOut:!0}),d){const se={x:z,y:q};let D=220,X="#ffffff",te=["#ffffcc","#ffee88","#ffaa44"],ae=12;g&&(D=300,X="#ffcc00",te=["#ffcc00","#ffaa00","#ff8800"],ae=18),m&&(D=300,X="#00ffff",te=["#ccffff","#88ddff","#ffffff"],ae=24),Sl(se.x,se.y,D,1,.35,X),this.sparkManager.emitBurst(se,ae,{colors:te,randomDirection:!0,speedRange:[120,320],sizeRange:[1,3],lifeRange:[.25,.65],fadeOut:!0})}if(this.playerSettings.isLightingEnabled()&&Math.random()<pC){const se=ti({x:z,y:q,radius:25+Math.random()*50,color:v[0],intensity:1+Math.random()*.5,life:.45+Math.random()*.15,expires:!0});this.lightingOrchestrator.registerLight(se)}}}class mC{constructor(e,i,n,r){this.camera=e,this.inputManager=i,this.cursorRenderer=n,this.playerShip=r,this.isEnginePlaying=!1,this.lastFiringModeSwitchTime=-1/0}getIntent(){const e=this.inputManager.isShiftPressed(),i=this.inputManager.getGamepadMovementVector(),n=Math.hypot(i.x,i.y),r=It.getInstance().getLastUsed()==="gamepad",c=r&&!e&&n>.1,h=this.inputManager.isActionPressed("brake");let u=!1;h||(r?u=n>.1:u=this.inputManager.isActionPressed("thrustForward"));const d=this.inputManager.isActionPressed("afterburner"),g=u&&d,m={thrustForward:u,brake:h,rotateLeft:this.inputManager.isActionPressed("rotateLeft")&&!(r&&c),rotateRight:this.inputManager.isActionPressed("rotateRight")&&!(r&&c),strafeLeft:this.inputManager.isActionPressed("strafeLeft")||e&&n>.1,strafeRight:this.inputManager.isActionPressed("strafeRight")||e&&n>.1,turnToAngle:c?Math.atan2(i.y,i.x)+Math.PI/2:void 0,afterburner:g},y=this.inputManager.isActionPressed("firePrimary"),v=this.inputManager.isActionPressed("fireSecondary"),M=this.playerShip.getTransform().position,b=this.inputManager.getGamepadAimVector(),C=800,A=b.x!==0||b.y!==0?this.normalize(b.x,b.y):r?{x:Math.cos(this.playerShip.getTransform().rotation-Math.PI/2),y:Math.sin(this.playerShip.getTransform().rotation-Math.PI/2)}:null,R=A?{x:M.x+A.x*C,y:M.y+A.y*C}:this.camera.screenToWorld(this.inputManager.getMousePosition().x,this.inputManager.getMousePosition().y),I={firePrimary:y,fireSecondary:v,aimAt:R,firingMode:this.playerShip.getFiringMode()};y||v?this.cursorRenderer.setTargetCrosshairCursor():this.cursorRenderer.setDefaultCursor();const x={toggleShields:this.inputManager.wasActionJustPressed("fireTertiary")},N=performance.now();if(this.inputManager.wasActionJustPressed("switchFiringMode")&&N-this.lastFiringModeSwitchTime>=1e3){this.lastFiringModeSwitchTime=N;const z=this.playerShip.getFiringMode()===Ht.Synced?Ht.Sequence:Ht.Synced;this.playerShip.setFiringMode(z),Q.play("assets/sounds/sfx/ship/attach_00.wav","sfx");const q=z===Ht.Synced?"#00ffff":"#ff0000";Sl(M.x,M.y,520,1.2,.4,q)}return{movement:m,weapons:I,utility:x}}normalize(e,i){const n=Math.hypot(e,i);return n>1e-5?{x:e/n,y:i/n}:{x:0,y:0}}}class yC{constructor(e,i,n,r,c){this.inputManager=e,this.canvasManager=i,this.waveSpawner=n,this.playerShip=r,this.coachMarkManager=c,this.dialogueQueueManager=Mo.create(),this.scriptQueue=[]}initialize(){this.enqueueInitialDialogues(),this.tryStartNextScript()}enqueueInitialDialogues(){const e=ji.getMissionDialogue();e&&rn(e,this.getDialogueContext())&&this.scriptQueue.push(e)}getDialogueContext(){return{inputManager:this.inputManager,playerShip:this.playerShip,waveSpawner:this.waveSpawner,coachMarkManager:this.coachMarkManager}}tryStartNextScript(){if(this.dialogueQueueManager.isRunning()||this.scriptQueue.length===0)return;const e=this.scriptQueue.shift(),i=rn(e,this.getDialogueContext());i&&this.dialogueQueueManager.startScript(i)}update(e){this.dialogueQueueManager.update(e),this.dialogueQueueManager.isRunning()||this.tryStartNextScript()}render(){const e=this.canvasManager.getContext("dialogue");this.dialogueQueueManager.render(e)}destroy(){this.dialogueQueueManager.clear(),this.dialogueQueueManager.destroy();const e=this.canvasManager.getContext("dialogue");e.clearRect(0,0,e.canvas.width,e.canvas.height)}}class Zi{constructor(e,i){this.getPosition=e,this.behavior=i,this.elapsed=0}update(e){this.elapsed+=e}isExpired(){return this.elapsed>=(this.behavior.duration??2.5)}}class vC extends Zi{constructor(e,i){super(e,i),this.behavior=i}render(e){const i=this.getPosition(),n=ne(),r=this.resolveArrowAngle(),c=(this.behavior.arrowLength??30)*n,h=i.x+c*Math.cos(r),u=i.y+c*Math.sin(r);e.save(),e.strokeStyle=this.behavior.arrowColor??"#ffffff",e.lineWidth=2*n,e.beginPath(),e.moveTo(h,u),e.lineTo(i.x*n,i.y*n),e.stroke(),e.restore()}resolveArrowAngle(){switch(this.behavior.arrowDirection){case"up":return-Math.PI/2;case"down":return Math.PI/2;case"left":return Math.PI;case"right":return 0;default:return 0}}}class bC extends Zi{constructor(e,i){super(e,i),this.behavior=i}render(e){const i=this.getPosition(),n=ne(),r=this.behavior.boxWidth??100,c=this.behavior.boxHeight??40,h=r*n,u=c*n,d={x:i.x*n,y:i.y*n};e.save(),e.strokeStyle=this.behavior.boxStrokeColor??"#ffffff",e.lineWidth=this.behavior.boxLineWidth??2*ne(),e.strokeRect(d.x-h/2,d.y-u/2,h,u),e.restore()}}class SC extends Zi{constructor(e,i){super(e,i),this.behavior=i,this.image=new Image,this.image.src=i.imageSrc}render(e){if(!this.image.complete)return;const i=this.getPosition(),n=ne(),r=(this.behavior.imageWidth??this.image.width)*n,c=(this.behavior.imageHeight??this.image.height)*n;e.drawImage(this.image,i.x-r/2,i.y-c/2,r,c)}}class MC extends Zi{constructor(e,i,n){super(i,n),this.behavior=n,this.label=e}render(e){const i=this.getPosition(),n=ne(),r=(this.behavior.fontSize??14)*n,c=this.behavior.labelOffset??{x:0,y:-30};e.save(),e.font=`${Math.round(r)}px ${this.behavior.fontFamily??"monospace"}`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.behavior.textColor??"#FFFFFF",e.fillText(this.label,i.x+c.x,i.y+c.y),e.restore()}}class CC extends Zi{constructor(e,i){super(e,i),this.floatTimer=0,this.behavior=i}update(e){super.update(e),this.floatTimer+=e}render(e){const i=this.getPosition(),n=ne(),r=Math.sin(this.floatTimer*2*Math.PI)*5,c=(this.behavior.width??36)*n,h=(this.behavior.height??36)*n,u=(this.behavior.fontSize??18)*n,d=this.behavior.borderColor??"#FFFFFF",g=this.behavior.fillColor??"#222222",m=this.behavior.textColor??"#FFFFFF",y=this.behavior.keyLabel,v=i.x*n,M=(i.y+r)*n;e.save(),e.font=`${Math.round(u)}px monospace`;const b=e.measureText(y).width,C=12*n,A=Math.max(c,b+C*2);e.fillStyle=g,e.strokeStyle=d,e.lineWidth=2*n,e.beginPath(),e.roundRect(v-A/2,M-h/2,A,h,6),e.fill(),e.stroke(),e.fillStyle=m,e.textAlign="center",e.textBaseline="middle",e.fillText(y,v,M),e.restore()}}class TC extends Zi{constructor(e,i){super(e,i),this.animationTimer=0,this.behavior=i}update(e){super.update(e),this.animationTimer+=e}render(e){const i=this.getPosition(),n=ne(),r=i.x*n,c=i.y*n,h=(this.behavior.width??50)*n,u=(this.behavior.height??80)*n,d=this.behavior.borderColor??"#FFFFFF",g=this.behavior.fillColor??"#222222",m=this.behavior.highlightColor??"#00FFFF",y=this.behavior.interactionMode,v=.5+.5*Math.sin(this.animationTimer*Math.PI*2),M=y==="wiggle"?Math.sin(this.animationTimer*6)*6:0;e.save(),e.translate(r+M,c),e.lineWidth=2*n,e.beginPath(),e.strokeStyle=d,e.fillStyle=g,e.roundRect(-h/2,-u/2,h,u,12),e.fill(),e.stroke();const b=u*.25,C=h*.4,w=-h*.45,A=h*.05,R=-u/2+b/2+4;e.beginPath(),e.roundRect(w,R-b/2,C,b,4),e.fillStyle=y==="leftClick"?$h(m,v):g,e.fill(),e.strokeStyle=d,e.stroke(),e.beginPath(),e.roundRect(A,R-b/2,C,b,4),e.fillStyle=y==="rightClick"?$h(m,v):g,e.fill(),e.strokeStyle=d,e.stroke();const I=6*n,_=R+b/2+12;e.beginPath(),e.arc(0,_,I,0,Math.PI*2),e.fillStyle=y==="scroll"?$h(m,v):"#888888",e.fill(),e.strokeStyle=d,e.stroke(),e.restore()}}function $h(a,e){const i=Math.max(0,Math.min(1,e)),n=parseInt(a.slice(1,3),16),r=parseInt(a.slice(3,5),16),c=parseInt(a.slice(5,7),16);return`rgba(${n}, ${r}, ${c}, ${i.toFixed(2)})`}class wC extends Zi{constructor(e,i){super(e,i),this.animationTimer=0,this.behavior=i}update(e){super.update(e),this.animationTimer+=e}render(e){const i=this.getPosition(),n=ne(),r=i.x*n,c=i.y*n,h=(this.behavior.radius??60)*n,u=(this.behavior.fontSize??16)*n,d=this.behavior.borderColor??"#FFFFFF",g=this.behavior.fillColor??"#222222",m=this.behavior.highlightColor??"#00FFFF",y=this.behavior.textColor??"#FFFFFF",v=.5+.5*Math.sin(this.animationTimer*Math.PI*2),M=R=>this.behavior.highlightButton===R?AC(m,v):g;e.save(),e.translate(r,c),e.lineWidth=2*n,e.beginPath(),e.fillStyle=g,e.strokeStyle=d,e.arc(0,0,h,0,Math.PI*2),e.fill(),e.stroke();const b=h*.25,C=h*.5,w={Y:[0,-C],A:[0,C],X:[-C,0],B:[C,0]},A=R=>{const[I,_]=w[R];e.beginPath(),e.fillStyle=M(R),e.strokeStyle=d,e.arc(I,_,b,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle=y,e.font=`${Math.round(u)}px monospace`,e.textAlign="center",e.textBaseline="middle",e.fillText(R,I,_)};A("A"),A("B"),A("X"),A("Y"),e.restore()}}function AC(a,e){const i=Math.max(0,Math.min(1,e)),n=parseInt(a.slice(1,3),16),r=parseInt(a.slice(3,5),16),c=parseInt(a.slice(5,7),16);return`rgba(${n}, ${r}, ${c}, ${i.toFixed(2)})`}class kC extends Zi{constructor(e,i){super(e,i),this.animationTimer=0,this.behavior=i}update(e){super.update(e),this.animationTimer+=e}render(e){const i=this.getPosition(),n=ne(),r=i.x*n,c=i.y*n,h=(this.behavior.width??120)*n,u=(this.behavior.height??60)*n,d=12*n,g=5*n,m=.5+.5*Math.sin(this.animationTimer*Math.PI*2),y=this.behavior.borderColor??"#FFFFFF",v=this.behavior.fillColor??"#222222",M=this.behavior.highlightColor??"#00FFFF",{highlightStick:b,wiggleStick:C}=this.behavior,w=b==="left"?m:0,A=b==="right"?m:0,R=C==="left"?Math.sin(this.animationTimer*4)*g:0,I=C==="right"?Math.sin(this.animationTimer*4)*g:0;e.save(),e.translate(r,c),e.lineWidth=2*n,e.beginPath(),e.strokeStyle=y,e.fillStyle=v,e.roundRect(-h/2,-u/2,h,u,12),e.fill(),e.stroke();const _=-h*.3+R,x=0;e.beginPath(),e.arc(_,x,d,0,Math.PI*2),e.fillStyle=this.behavior.highlightStick==="left"?Fp(M,w):"#444444",e.fill(),e.strokeStyle=y,e.stroke();const N=h*.3+I;e.beginPath(),e.arc(N,x,d,0,Math.PI*2),e.fillStyle=this.behavior.highlightStick==="right"?Fp(M,A):"#444444",e.fill(),e.strokeStyle=y,e.stroke(),e.restore()}}function Fp(a,e){const i=Math.max(0,Math.min(1,e)),n=parseInt(a.slice(1,3),16),r=parseInt(a.slice(3,5),16),c=parseInt(a.slice(5,7),16);return`rgba(${n}, ${r}, ${c}, ${i.toFixed(2)})`}class BC extends Zi{constructor(e,i){super(e,i),this.animationTimer=0,this.behavior=i}update(e){super.update(e),this.animationTimer+=e}render(e){const i=this.getPosition(),n=ne(),r=i.x*n,c=i.y*n,h=(this.behavior.width??160)*n,u=(this.behavior.height??80)*n,d=this.behavior.borderColor??"#FFFFFF",g=this.behavior.fillColor??"#222222",m=this.behavior.highlightColor??"#00FFFF",y=.5+.5*Math.sin(this.animationTimer*Math.PI*2);e.save(),e.translate(r,c),e.lineWidth=2*n,e.beginPath(),e.strokeStyle=d,e.fillStyle=g,e.roundRect(-h/2,-u/2,h,u,12),e.fill(),e.stroke();const v=h*.25,M=u*.25,b=h*.2,C=u*.15;w(e,-h/2-v*.5,-u*.3,v,M,"leftTrigger",m,g,d,this.behavior.highlighted),w(e,h/2-v*.5,-u*.3,v,M,"rightTrigger",m,g,d,this.behavior.highlighted),w(e,-h/2+b*.5,-u/2-C*.5,b,C,"leftBumper",m,g,d,this.behavior.highlighted),w(e,h/2-b*1.5,-u/2-C*.5,b,C,"rightBumper",m,g,d,this.behavior.highlighted),e.restore();function w(A,R,I,_,x,N,W,z,q,ie){A.beginPath(),A.roundRect(R,I,_,x,4),A.fillStyle=ie.includes(N)?RC(W,y):z,A.fill(),A.strokeStyle=q,A.stroke()}}}function RC(a,e){const i=Math.max(0,Math.min(1,e)),n=parseInt(a.slice(1,3),16),r=parseInt(a.slice(3,5),16),c=parseInt(a.slice(5,7),16);return`rgba(${n}, ${r}, ${c}, ${i.toFixed(2)})`}class EC{constructor(){this.coachMarks=[],this.canvasManager=ii.getInstance(),this.ctx=this.canvasManager.getContext("ui")}update(e){for(const i of this.coachMarks)i.update(e);this.coachMarks=this.coachMarks.filter(i=>!i.isExpired())}render(){for(const e of this.coachMarks)e.render(this.ctx)}clear(){this.coachMarks.length=0}createScreenCoachMark(e,i,n,r){const c=()=>({x:i,y:n});this.create(e,c,r)}createWorldCoachMark(e,i,n,r,c){const h=()=>r.worldToScreen(i,n);this.create(e,h,c)}create(e,i,n){let r;switch(n.type){case"arrow":r=new vC(i,n);break;case"box":r=new bC(i,n);break;case"image":r=new SC(i,n);break;case"text":r=new MC(e,i,n);break;case"key":r=new CC(i,n);break;case"mouse":r=new TC(i,n);break;case"gamepadFaceButtons":r=new wC(i,n);break;case"gamepadSticks":r=new kC(i,n);break;case"gamepadShoulders":r=new BC(i,n);break;default:throw new Error(`Unhandled coach mark type: ${n.type}`)}this.coachMarks.push(r)}}const IC=a=>{const e=(a%360+360)%360;return e===0?"forward":e===90?"strafeRight":e===270?"strafeLeft":null},Jh=500,Up=.4,_C=2,xC=12,DC=15,PC=.5,LC=3,Np=2,OC=.94,FC=.6,UC=.6,NC=1,HC=1,eu=8,WC=.15,zC=1.6,GC=2.2,VC=1.4,XC=3.5,YC=1.5;class Cm{constructor(e,i,n){this.ship=e,this.emitter=i,this.collisionSystem=n,this.fallbackThrustPower=10,this.baseThrust=5,this.externalImpulse={x:0,y:0},this.afterburnerCharge=0,this.wasAfterburnerActiveLastFrame=!1,this.currentIntent={thrustForward:!1,brake:!1,rotateLeft:!1,rotateRight:!1,strafeLeft:!1,strafeRight:!1}}setIntent(e){this.currentIntent=e}applyExternalImpulse(e,i){this.externalImpulse.x+=e,this.externalImpulse.y+=i}getAfterburnerCharge(){return this.afterburnerCharge}rotateVector(e,i,n){const r=Math.cos(n),c=Math.sin(n);return{x:e*r-i*c,y:e*c+i*r}}getBlockThrustDirection(e){const i=e*(Math.PI/180),n=Math.sin(i),r=-Math.cos(i);return{x:n,y:r}}updateAfterburnerCharge(e){const i=this.ship.getAfterburnerComponent(),n=this.currentIntent.afterburner??!1;let r=!1;if(i){i.setActive(n),i.update(e);const c=i.isActive();r=c&&!this.wasAfterburnerActiveLastFrame,this.wasAfterburnerActiveLastFrame=c,c?this.afterburnerCharge=Math.min(1,this.afterburnerCharge+XC*e):this.afterburnerCharge=Math.max(0,this.afterburnerCharge-YC*e)}else this.afterburnerCharge=0,this.wasAfterburnerActiveLastFrame=!1;return r}getAfterburnerMultipliers(){const e=this.afterburnerCharge,i=this.ship.getAfterburnerSpeedMultiplier()||zC,n=this.ship.getAfterburnerAccelMultiplier()||GC;return{speed:1+(i-1)*e,accel:1+(n-1)*e,turning:1+(VC-1)*e}}update(e){const i=this.ship.getTransform(),{position:n,velocity:r}=i,{rotateLeft:c,rotateRight:h,thrustForward:u,brake:d,strafeLeft:g,strafeRight:m}=this.currentIntent,y=this.updateAfterburnerCharge(e),v=this.getAfterburnerMultipliers();this.ship.setThrusting(u),this.ship.setStrafingLeft(g),this.ship.setStrafingRight(m),r.x+=this.externalImpulse.x,r.y+=this.externalImpulse.y,this.externalImpulse.x=0,this.externalImpulse.y=0;const M=this.ship.getTotalMass(),b=Math.min(1,Math.pow(Jh/Math.max(M,1),UC)),C={forward:[],strafeLeft:[],strafeRight:[]};let w=_C;for(const[W,z]of this.ship.getAllBlocks()){const q=z.type.behavior;if(q!=null&&q.canThrust){const ie=q.thrustPower??this.baseThrust,ee=IC(z.rotation??0);ee&&C[ee].push({coord:W,power:ie,rotation:z.rotation??0})}z.type.id.startsWith("fin")&&(w+=(q==null?void 0:q.turnPower)??0)}const A=Math.min(xC,Math.pow(w,OC)),R=Math.min(A*b*FC*v.turning,DC);let I=0;if(this.currentIntent.turnToAngle!==void 0){const{rotation:W}=i;let q=this.currentIntent.turnToAngle-W;for(;q>Math.PI;)q-=2*Math.PI;for(;q<-Math.PI;)q+=2*Math.PI;I=q*Np*v.turning,I=Math.max(-R,Math.min(I,R))}else c?I=-R:h&&(I=R);const _=I-i.angularVelocity;if(i.angularVelocity+=_*Np*v.turning*e,i.angularVelocity=Math.max(-R,Math.min(i.angularVelocity,R)),u&&this.applyDirectionalThrust(e,"forward",C.forward,i,n,v,y),g&&this.applyDirectionalThrust(e,"strafeLeft",C.strafeLeft,i,n,v,y),m&&this.applyDirectionalThrust(e,"strafeRight",C.strafeRight,i,n,v,y),!u&&!g&&!m){const W=Math.pow(PC,e);r.x*=W,r.y*=W}if(d){const W=Math.hypot(r.x,r.y);if(W>0){const z=r.x/W,q=r.y/W,K=([...C.forward,...C.strafeLeft,...C.strafeRight].reduce((D,X)=>D+X.power,0)+this.fallbackThrustPower)*e*NC,le=r.x-z*K,Z=r.y-q*K;le*r.x+Z*r.y<0?(r.x=0,r.y=0):(r.x=le,r.y=Z)}}if(this.ship.getIsPlayerShip()){this.collisionSystem.resolveCollisions(this.ship);const W=i.velocity;W.x=Math.round(W.x*1e3)/1e3,W.y=Math.round(W.y*1e3)/1e3}const{thrustPowerMulti:x=1,turnPowerMulti:N=1}=this.ship.getAffixes()??{};i.rotation+=i.angularVelocity*e*N,n.x+=r.x*e*x,n.y+=r.y*e*x,this.ship.updateBlockPositions()}applyDirectionalThrust(e,i,n,r,c,h,u){var se,D,X,te,ae;let d=0,g=0;const m=this.fallbackThrustPower,y=n.length+1,v=HC,b=n.reduce((k,H)=>k+H.power,0)+m,C=(()=>{if(y<=eu)return b*v;const k=b/y*eu,H=y-eu,J=b/y,$=1/(1+WC*H),oe=J*H*$;return(k+oe)*v})(),w=this.ship.getTotalMass(),A=Math.min(1,Math.pow(Jh/Math.max(w,1),Up)),R=C*h.speed*A,I=(()=>{switch(i){case"forward":return this.rotateVector(0,-1,r.rotation);case"strafeLeft":return this.rotateVector(-1,0,r.rotation);case"strafeRight":return this.rotateVector(1,0,r.rotation)}})();d+=I.x*m,g+=I.y*m;const _=li.getInstance().getPlayerShip();let x=!1,N=!1,W=!1,z=!1,q=!1;if(_&&_!==this.ship){const k=Ct.getInstance().getViewportBounds(),H=100,J=k.x-H,$=k.y-H,oe=k.x+k.width+H,ye=k.y+k.height+H,ue=this.ship.getTransform().position;x=ue.x>=J&&ue.x<=oe&&ue.y>=$&&ue.y<=ye}else N=((se=this.ship.getAfterburnerComponent())==null?void 0:se.wasAfterburnerJustActivated())??!1,W=((D=this.ship.getAfterburnerComponent())==null?void 0:D.wasPulseJustActivated())??!1,z=((X=this.ship.getAfterburnerComponent())==null?void 0:X.isPulsing())??!1,q=((te=this.ship.getAfterburnerComponent())==null?void 0:te.wasSuperPulseJustActivated())??!1,x=!0;this.ship.getIsPlayerShip()&&((W||q||N)&&this.emitPulseSoundAndShake(this.ship.id,W,q),q&&Sl(this.ship.getTransform().position.x,this.ship.getTransform().position.y,300,1.5,.5,"#ffffff"));for(const{coord:k,power:H,rotation:J}of n){const $=this.ship.getBlock(k);if(!$)continue;const oe=this.getBlockThrustDirection(J),ye=this.rotateVector(oe.x,oe.y,r.rotation);d+=ye.x*H,g+=ye.y*H,x&&this.emitter.emit({coord:k,block:$,blockRotation:J,shipRotation:r.rotation,shipPosition:c,afterBurner:((ae=this.ship.getAfterburnerComponent())==null?void 0:ae.isActive())??!1,afterBurnerJustActivated:u,isPulsing:z,pulseJustActivated:W,superPulseJustActivated:q})}const ie=Math.min(1,Math.pow(Jh/Math.max(w,1),Up)),ee=d*e*ie*h.accel,K=g*e*ie*h.accel;r.velocity.x+=ee,r.velocity.y+=K;const le=Math.sqrt(r.velocity.x**2+r.velocity.y**2);if(le>0){const k=r.velocity.x/le,H=r.velocity.y/le,J=I.x-k,$=I.y-H,oe=LC*h.turning;r.velocity.x+=J*oe*le*e,r.velocity.y+=$*oe*le*e}const Z=r.velocity.x*I.x+r.velocity.y*I.y;if(Z>R){const H=1/(1+.5*(Z/R-1)),J=Z-Z*H;r.velocity.x-=I.x*J,r.velocity.y-=I.y*J}}emitPulseSoundAndShake(e,i=!1,n=!1){const r=li.getInstance(),c=r.getPlayerShip(),h=r.getById(e);let u="assets/sounds/sfx/explosions/afterburner_00.wav";if(n?u="assets/sounds/sfx/ui/sub_00.wav":i&&(u="assets/sounds/sfx/explosions/afterburner_00.wav"),h&&(Jt(h,c,{file:u,channel:"sfx",baseVolume:1,pitchRange:[1,1.3],volumeJitter:.15,maxSimultaneous:5}),n&&Jt(h,c,{file:"assets/sounds/sfx/explosions/superpulse_00.wav",channel:"sfx",baseVolume:1,pitchRange:[1.1,1.4],volumeJitter:.1,maxSimultaneous:5})),h&&h===c){let d=4,g=.16;i&&(d=6,g=.18),n&&(d=9,g=.2),Ee.emit("camera:shake",{strength:d,duration:g,frequency:10})}}}const _u=class _u{static register(e,i){this.registry.set(e.id,i)}static unregister(e){this.registry.delete(e.id)}static get(e){return this.registry.get(e.id)}static clear(){this.registry.clear()}};_u.registry=new Map;let vo=_u;function Hp(a){return typeof a.getAffixes=="function"?a.getAffixes()??{}:{}}const St=class St{constructor(e){this.combatService=e}resolveCollisions(e){if(!we.getInstance().isCollisionsEnabled())return;const i=this.getNearbyObjects(e);for(const n of i){if(!this.aabbOverlap(e,n))continue;e.setColliding(!0),n.setColliding(!0),this.applyCollisionDamage(e,n);const r=this.computeMinimumSeparationVector(e,n);r&&(this.resolvePenetration(e,n,r),this.resolveImpulse(e,n,r))}}getNearbyObjects(e){const i=this.computeAABB(e),n=e.getGrid().getBlocksInArea(i.x,i.y,i.x+i.width,i.y+i.height),r=new Set;for(const c of n){const h=Wt.getObject(c);h&&h!==e&&r.add(h)}return Array.from(r)}aabbOverlap(e,i){const n=this.computeAABB(e),r=this.computeAABB(i);return!(n.x+n.width<r.x||n.x>r.x+r.width||n.y+n.height<r.y||n.y>r.y+r.height)}computeAABB(e){let i=1/0,n=-1/0,r=1/0,c=-1/0;for(const[h]of e.getAllBlocks()){const u=ea(e.getTransform(),h);i=Math.min(i,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),c=Math.max(c,u.y)}return{x:i,y:r,width:n-i+St.BLOCK_SIZE,height:c-r+St.BLOCK_SIZE}}computeMinimumSeparationVector(e,i){const n=[];for(const[v]of e.getAllBlocks()){const M=ea(e.getTransform(),v);for(const[b]of i.getAllBlocks()){const C=ea(i.getTransform(),b);this.blocksOverlap(M,C)&&n.push({a:M,b:C})}}if(n.length===0)return null;let r=0,c=0;for(const v of n)r+=v.a.x-v.b.x,c+=v.a.y-v.b.y;const h=n.length;r/=h,c/=h;const u=Math.sqrt(r*r+c*c);if(u===0)return null;const d=St.BLOCK_SIZE/2,g=St.PENETRATION_SLOP,m=St.PENETRATION_CORRECTION_RATIO,y=Math.max(d-g,0)*m;return{x:r/u*y,y:c/u*y}}blocksOverlap(e,i){const n=St.BLOCK_SIZE;return Math.abs(e.x-i.x)<n&&Math.abs(e.y-i.y)<n}resolvePenetration(e,i,n){var d,g;const r=((d=e.isImmoveable)==null?void 0:d.call(e))??!1,c=((g=i.isImmoveable)==null?void 0:g.call(i))??!1,h=e.getTransform(),u=i.getTransform();if(!(r&&c))if(r)u.position.x-=n.x,u.position.y-=n.y,i.updateBlockPositions();else if(c)h.position.x+=n.x,h.position.y+=n.y,e.updateBlockPositions();else{const m=e.getTotalMass(),y=i.getTotalMass(),v=m+y||1,M=y/v,b=m/v;h.position.x+=n.x*M,h.position.y+=n.y*M,u.position.x-=n.x*b,u.position.y-=n.y*b,e.updateBlockPositions(),i.updateBlockPositions()}}resolveImpulse(e,i,n){var N,W;const r=((N=e.isImmoveable)==null?void 0:N.call(e))??!1,c=((W=i.isImmoveable)==null?void 0:W.call(i))??!1,h=e.getTransform(),u=i.getTransform(),d=h.velocity,g=u.velocity,m=d.x-g.x,y=d.y-g.y,v=m*n.x+y*n.y;if(v>=0)return;const M=e.getTotalMass(),b=i.getTotalMass(),C=M+b||1,w=St.RESTITUTION,A=Math.max(v,-200),R=-(1+w)*A/C;if(Math.abs(R)<St.IMPULSE_EPSILON)return;const I=R*n.x,_=R*n.y,x=.95;r&&c||(r?(g.x+=I,g.y+=_,g.x*=x,g.y*=x):c?(d.x-=I,d.y-=_,d.x*=x,d.y*=x):(d.x-=I*b/C,d.y-=_*b/C,g.x+=I*M/C,g.y+=_*M/C,d.x*=x,d.y*=x,g.x*=x,g.y*=x))}applyCollisionDamage(e,i){const n=this.computeRelativeVelocity(e,i),r=Math.sqrt(n.x**2+n.y**2),c=70,h=1500,u=50;if(r<c)return;const g=(Math.min(r,h)-c)/(h-c),y=Math.pow(g,1.35)*u;for(const[v,M]of e.getAllBlocks()){const b=ea(e.getTransform(),v);for(const[C,w]of i.getAllBlocks()){const A=ea(i.getTransform(),C);if(!this.blocksOverlap(b,A))continue;const R=M.type.behavior??{},I=w.type.behavior??{},_=R.rammingDamageMultiplier??1,x=I.rammingDamageMultiplier??1,N=R.rammingArmor??0,W=I.rammingArmor??0,z=Hp(e)??{},q=Hp(i)??{},ie=z.rammingDamageInflictMultiplier??1,ee=q.rammingDamageInflictMultiplier??1,K=z.rammingArmorMultiplier??1,le=q.rammingArmorMultiplier??1,Z=N*K,se=W*le,D=y*_*ie,X=Math.max(0,D-se);this.combatService.applyDamageToBlock(i,e,w,C,X,"collision",null);const te=y*x*ee,ae=Math.max(0,te-Z);this.combatService.applyDamageToBlock(e,i,M,v,ae,"collision",null)}}}computeRelativeVelocity(e,i){const n=e.getTransform().velocity,r=i.getTransform().velocity;return{x:n.x-r.x,y:n.y-r.y}}};St.BLOCK_SIZE=32,St.PENETRATION_SLOP=4,St.PENETRATION_CORRECTION_RATIO=.4,St.RESTITUTION=.2,St.IMPULSE_EPSILON=.05;let hu=St;class Tm{constructor(...e){this.currentIntent=null,this.backends=e}setIntent(e){this.currentIntent=e}update(e,i,n){for(const r of this.backends)r.update(e,i,n,this.currentIntent)}render(e){for(const i of this.backends)i.render&&i.render(e)}destroy(){for(const e of this.backends)e.destroy&&e.destroy()}}class wm{constructor(...e){this.currentIntent=null,this.backends=e}setIntent(e){this.currentIntent=e}update(e,i,n){for(const r of this.backends)r.update(e,i,n,this.currentIntent)}}const qC=`
  attribute vec2 aPosition;
  uniform vec2 uOffset;
  uniform vec2 uScale;
  varying vec2 vUV;

  void main() {
    vec2 pos = aPosition * uScale + uOffset;
    // Flip Y-axis of UVs to correct upside-down rendering
    vUV = vec2((aPosition.x + 1.0) / 2.0, 1.0 - (aPosition.y + 1.0) / 2.0);
    gl_Position = vec4(pos, 0.0, 1.0);
  }
`,jC=`
  precision mediump float;
  uniform sampler2D uTexture;
  uniform float uAlpha;
  varying vec2 vUV;
  void main() {
    vec4 texColor = texture2D(uTexture, vUV);
    gl_FragColor = vec4(texColor.rgb, texColor.a * uAlpha);
  }
`;class ZC{constructor(e,i,n,r){this.imagePath=i,this.scale=n,this.name=r,this.texture=null,this.image=null,this.renderMargin=.2,this.gl=e,this.program=qi(e,qC,jC),this.quadBuffer=ha(e),this.initUniformLocations(),this.loadImage()}initUniformLocations(){this.uOffset=this.gl.getUniformLocation(this.program,"uOffset"),this.uScale=this.gl.getUniformLocation(this.program,"uScale"),this.uTexture=this.gl.getUniformLocation(this.program,"uTexture"),this.uAlpha=this.gl.getUniformLocation(this.program,"uAlpha")}loadImage(){const e=new Image;e.src=Mi(this.imagePath),e.onload=()=>{this.image=e;const i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0),this.texture=db(this.gl,i)}}isVisible(e,i,n,r,c){const h=n.getPosition(),u=n.getZoom(),d=e-r/2,g=e+r/2,m=i-c/2,y=i+c/2,v=n.getViewportWidth()/u,M=n.getViewportHeight()/u,b=v*this.renderMargin,C=M*this.renderMargin,w=h.x-v/2-b,A=h.x+v/2+b,R=h.y-M/2-C,I=h.y+M/2+C;return!(g<w||d>A||y<R||m>I)}render(e,i,n,r,c,h){if(!this.texture||!this.image)return;const u=this.image.width*this.scale,d=this.image.height*this.scale;if(!this.isVisible(i,n,r,u,d))return;const{width:g,height:m}=this.gl.canvas,y=r.getPosition(),v=i-y.x,M=n-y.y,b=v*r.getZoom(),C=M*r.getZoom(),w=b/(g/2),A=-C/(m/2),R=u*r.getZoom()/g,I=d*r.getZoom()/m;this.gl.viewport(0,0,g,m),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quadBuffer);const _=this.gl.getAttribLocation(this.program,"aPosition");if(this.gl.enableVertexAttribArray(_),this.gl.vertexAttribPointer(_,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.uniform1i(this.uTexture,0),this.gl.uniform1f(this.uAlpha,1),this.gl.uniform2f(this.uOffset,w,A),this.gl.uniform2f(this.uScale,R,I),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.disableVertexAttribArray(_),this.gl.disable(this.gl.BLEND),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.useProgram(null),c&&!h){const x=ne(),N=r.getViewportWidth()/2,W=32*x;Rt(e,N,W,this.name,{font:`${x*24}px "Courier New", monospace`,align:"center",baseline:"top",glow:!0,chromaticAberration:!0}),Rt(e,N,W+32*x,"Open Communications: [C]",{font:`${x*16}px "Courier New", monospace`,align:"center",baseline:"top",glow:!0,chromaticAberration:!0})}}update(e){}}class Am{constructor(e,i,n,r,c,h,u){this.x=e,this.y=i,this.playerShip=n,this.inputManager=r,this.camera=c,this.definition=h,this.waveSpawner=u,this.isInteracting=!1;const d=ii.getInstance().getWebGLContext("backgroundgl");this.renderer=new ZC(d,h.imagePath,h.scale,h.name),this.dialogueQueueManager=Mo.create()}calculateRanges(){const e=this.playerShip.getTransform().position.x,i=this.playerShip.getTransform().position.y,n=this.x-e,r=this.y-i,c=n*n+r*r,h=this.definition.scale*1e3+1e3,u=h*h,d=(h*.5)**2,g=(h*.25)**2;return{inDrawingRange:c<=u,inTransmissionRange:c<=d,inInteractionRange:c<=g,dx:n,dy:r}}update(e){const{inTransmissionRange:i,inInteractionRange:n}=this.calculateRanges();if(this.renderer.update(e),n&&this.inputManager.wasKeyJustPressed("KeyC")&&!this.isInteracting){this.isInteracting=!0;const r=rn(this.definition.interactionDialogueId,{inputManager:this.inputManager,playerShip:this.playerShip,waveSpawner:this.waveSpawner});r&&this.dialogueQueueManager.startScript(r)}this.dialogueQueueManager.isRunning()?(this.dialogueQueueManager.update(e),this.inputManager.wasMouseClicked()&&this.dialogueQueueManager.skipOrAdvance()):this.isInteracting=!1}render(e,i,n){const{inDrawingRange:r,inTransmissionRange:c,inInteractionRange:h,dx:u,dy:d}=this.calculateRanges();r&&this.renderer.render(i,this.x,this.y,this.camera,h,this.isInteracting),this.dialogueQueueManager.render(n)}getPosition(){return{x:this.x,y:this.y}}}const KC={name:"Ferrust",imagePath:"assets/planets/17.png",scale:5,interactionDialogueId:"planet-generic"},QC={name:"Gilipe",imagePath:"assets/planets/5.png",scale:8,interactionDialogueId:"planet-generic"},$C={name:"Arsea",imagePath:"assets/planets/6.png",scale:10,interactionDialogueId:"planet-generic"},cl=new Map;function Ru(a){if(cl.has(a.name))throw new Error(`Duplicate planet registration: ${a.name}`);cl.set(a.name,a)}Ru(KC);Ru(QC);Ru($C);const JC={getPlanetByName(a){const e=cl.get(a);if(!e)throw new Error(`Planet "${a}" not found in registry`);return e},getAll(){return Array.from(cl.values())}},eT={createPlanetByName(a,e,i,n,r,c,h){const u=JC.getPlanetByName(a);return new Am(e,i,n,r,c,u,h)}};class tT{constructor(e,i,n,r,c){this.playerShip=e,this.inputManager=i,this.camera=n,this.canvasManager=r,this.waveSpawner=c,this.planets=new Set,this.ctx=r.getContext("background"),this.overlayCtx=r.getContext("ui"),this.dialogueCtx=r.getContext("dialogue")}registerPlanetsFromConfigs(e){for(const{name:i,x:n,y:r}of e)this.registerPlanetByName(i,n,r)}registerPlanet(e,i,n){const r=new Am(i,n,this.playerShip,this.inputManager,this.camera,e,this.waveSpawner);this.planets.add(r)}registerPlanetByName(e,i,n){const r=eT.createPlanetByName(e,i,n,this.playerShip,this.inputManager,this.camera,this.waveSpawner);this.planets.add(r)}getPlanets(){return Array.from(this.planets)}clear(){this.planets.clear()}update(e){for(const i of this.planets)i.update(e)}render(e){for(const i of this.planets)i.render(this.ctx,this.overlayCtx,this.dialogueCtx)}}class iT{constructor(e){this.pickupSystem=e}spawnPickupOnBlockDestruction(e){var h,u,d,g;const i=e.type,n=i.dropRate??0,r=ji.getDropMultiplier(),c=Math.min(n*r,1);if(Math.random()<c){const m={x:((h=e.position)==null?void 0:h.x)??0,y:((u=e.position)==null?void 0:u.y)??0};this.pickupSystem.spawnBlockPickup(m,i);return}if(Math.random()<.2){const m={x:((d=e.position)==null?void 0:d.x)??0,y:((g=e.position)==null?void 0:g.y)??0};if(Math.random()<.07){const y=this.getRepairAmountForBlock(e);this.pickupSystem.spawnRepairPickup(m,y)}else{const y=this.getCurrencyAmountForBlock(e);this.pickupSystem.spawnCurrencyPickup(m,y)}}}getCurrencyAmountForBlock(e){const i=e.type.id,n=Yi(i),c={0:5,1:10,2:15,3:25,4:35,5:40,6:45,7:50,8:60,9:75,10:80}[n]??0,h=Math.floor(Math.random()*1.5);return c+h}getRepairAmountForBlock(e){const i=e.type.id,n=Yi(i),c={0:10,1:15,2:20,3:30,4:40,5:55,6:70,7:80,8:90,9:95,10:100}[n]??5,h=Math.floor(Math.random()*2);return c+h}}function sT(a,e){const i=a.getTransform(),n={position:i.position,rotation:i.rotation},r=a.getAllBlocks().map(([c,h])=>(e.addBlockToCell(h),{id:h.type.id,coord:c,rotation:h.rotation??0}));return{transform:n,blocks:r}}function nT(a,e){return fetch(Mi(`/assets/ships/${a}`)).then(i=>i.json()).then(i=>{const n=new Et(e);return n.loadFromJson(i),n})}function aT(a,e,i){const n=sT(a,e),r=JSON.stringify(n,null,2);localStorage.setItem(i,r);const c=new Blob([r],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(c),h.download=i,h.click()}class oT{constructor(e,i,n,r,c){this.ship=e,this.menu=i,this.camera=n,this.shipBuilderEffects=r,this.inputManager=c,this.rotation=0,this.lastBlockId=null,this.hasSaved=!1,this.hoveredShipCoord=null}update(e){var u;this.inputManager.wasKeyJustPressed("Space")&&(this.rotation=(this.rotation+90)%360);const i=this.inputManager.getMousePosition();if(this.isCursorOverMenu(i))return;const n=la(i,this.camera,e.position,e.rotation);if(this.menu.getActiveTool()===xe.REPAIR){const d=this.ship.getBlock(n);this.menu.setHoveredShipBlock(d),d&&this.inputManager.wasMouseClicked()&&(Q.play("assets/sounds/sfx/ship/repair_00.wav","sfx"),this.repairBlockAt(n));return}const r=this.menu.getSelectedBlockId();if(!r||(r!==this.lastBlockId&&(this.rotation=0,this.lastBlockId=r),!hi(r)))return;const h=Vp(r);if(h!==void 0){if(this.inputManager.wasRightClicked()){const d=this.ship.getBlock(n);if(!d)return;if(!d.type.id.startsWith("cockpit")){if(!this.ship.isDeletionSafe(n)){Q.play("assets/sounds/sfx/ui/error_00.wav","sfx",{maxSimultaneous:3});return}this.shipBuilderEffects.createSellEffect(d.position),this.ship.removeBlock(n),Q.play("assets/sounds/sfx/ui/click_00.wav","sfx",{maxSimultaneous:3});const m=Math.round(h/2);Re.getInstance().addCurrency(m)}}if(Re.getInstance().hasEnoughCurrency(h)&&this.inputManager.wasMouseClicked()&&!this.ship.hasBlockAt(n)&&wu(this.ship,n)){this.ship.placeBlockById(n,r,this.rotation);const d=this.ship.getBlock(n);d!=null&&d.position&&this.shipBuilderEffects.createRepairEffect(d.position);const g=((u=ci(r))==null?void 0:u.placementSound)??"assets/sounds/sfx/ship/gather_00.wav";Q.play(g,"sfx",{maxSimultaneous:3}),Re.getInstance().spendCurrency(h),Ce.incrementBlockPlacedCount()}this.inputManager.isLPressed()&&!this.hasSaved&&(aT(this.ship,this.ship.getGrid(),"saved_player_ship.json"),this.hasSaved=!0),!this.inputManager.isLPressed()&&this.hasSaved&&(this.hasSaved=!1)}}render(e,i){const n=this.inputManager.getMousePosition();if(this.isCursorOverMenu(n))return;const r=la(n,this.camera,i.position,i.rotation),c=r.x*G,h=r.y*G,u=Math.cos(i.rotation),d=Math.sin(i.rotation),g=c*u-h*d,m=c*d+h*u,y=i.position.x+g,v=i.position.y+m,M=this.camera.worldToScreen(y,v);e.save(),e.translate(M.x,M.y),e.scale(this.camera.getZoom(),this.camera.getZoom()),e.rotate(i.rotation);const b=this.menu.getActiveTool();if(b===xe.REPAIR)this.ship.getBlock(r)&&um(e,"rgba(0,255,0,0.3)");else if(b===xe.PLACE){const C=this.menu.getSelectedBlockId();if(!C){e.restore();return}if(this.ship.getBlock(r)){const A=this.ship.isDeletionSafe(r);Tu(e,A)}else{const A=hi(C);e.save(),e.rotate(this.rotation*Math.PI/180),e.globalAlpha=.6,e.drawImage(A.base,-32/2,-32/2,G,G),e.restore()}}e.restore()}isCursorOverMenu(e){return this.menu.isPointInBounds(e.x,e.y)}repairBlockAt(e){const i=this.ship.getBlock(e);if(!i||i.type.armor-i.hp<=0)return;const r=Si(i),c=Re.getInstance();c.hasEnoughCurrency(r)&&(c.spendCurrency(r),i.hp=i.type.armor,this.shipBuilderEffects.createRepairEffect(i.position))}repairAllBlocks(){const e=Re.getInstance(),i=this.ship.getAllBlocks().filter(([,n])=>n.hp<n.type.armor).map(([n,r])=>({coord:n,block:r})).sort((n,r)=>{const c=n.block.type.armor-n.block.hp,h=r.block.type.armor-r.block.hp;if(c!==h)return h-c;const u=Si(n.block),d=Si(r.block);return u-d});for(const{coord:n,block:r}of i){const c=Si(r);if(e.hasEnoughCurrency(c))Q.play("assets/sounds/sfx/ship/repair_00.wav","sfx"),this.repairBlockAt(n);else{console.log("Stopped repair: insufficient funds.");break}}}getHoveredShipBlock(){return this.hoveredShipCoord?this.ship.getBlock(this.hoveredShipCoord):void 0}}class rT{constructor(e,i,n,r){this.explosionSystem=e,this.pickupSpawner=i,this.shipRegistry=n,this.aiOrchestrator=r,this.destructionCallbacks=new Set}onEntityDestroyed(e){this.destructionCallbacks.add(e)}offEntityDestroyed(e){this.destructionCallbacks.delete(e)}destroyEntity(e,i="scripted"){var h,u,d;const n=e.getTransform(),r=e.getAllBlocks();e.getTotalMass();const c=e.id;if(this.destructionCallbacks.forEach(g=>{try{g(e,i)}catch(m){console.error("Error in destruction callback:",m)}}),e instanceof Et&&(this.shipRegistry.remove(e),vo.unregister(e),(u=(h=this.aiOrchestrator).removeControllersForShip)==null||u.call(h,c)),e.destroy(),r.forEach(([g,m],y)=>{setTimeout(()=>{this.explosionSystem.createBlockExplosion(n.position,n.rotation,g,50+Math.random()*40,.5+Math.random()*.5,void 0,ta),this.pickupSpawner.spawnPickupOnBlockDestruction(m)},y*50)}),e instanceof Et){if(we.getInstance().isLightingEnabled()){const v=$e.getInstance(),M="#ffffff",b=1.25,C=4*e.getTotalMass(),A=ti({x:n.position.x,y:n.position.y,radius:C,color:M,intensity:b,life:.5,expires:!0});v.registerLight(A)}const g=(d=e.getCockpitCoord)==null?void 0:d.call(e);if(!g)return;const m=vm(e,g),y=v=>`${v.x},${v.y}`;for(const[v,M]of r)m.has(y(v))||setTimeout(()=>{this.explosionSystem.createBlockExplosion(n.position,n.rotation,v,60+Math.random()*20,.5+Math.random()*.3,void 0,ta),this.pickupSpawner.spawnPickupOnBlockDestruction(M)},50+Math.random()*100)}}}const Kr=5e3,fl=class fl{constructor(){this.playerShip=null,this.grid=null,this.controllerToShipMap=new Map,this.cachedRelevantBlocks=[],this.frameCounter=0,this.REEVALUATE_FRAMES=60,this.hunterControllers=new Set,fl.instance=this}registerPlayerShip(e){this.playerShip=e,this.grid=e.getGrid()}addController(e){const i=e.getShip();i&&(i.updateBlockPositions(),this.controllerToShipMap.set(e,i),e.isHunter()&&this.hunterControllers.add(e))}removeController(e){this.controllerToShipMap.delete(e),this.hunterControllers.delete(e)}getAllControllers(){return this.controllerToShipMap.entries()}removeControllersForShip(e){const i=[];for(const[n,r]of this.controllerToShipMap.entries())r.id===e&&i.push(n);for(const n of i)this.removeController(n)}getControllerCount(){return this.controllerToShipMap.size}clear(){this.controllerToShipMap.clear()}update(e){if(!this.playerShip||!this.grid)return;if(this.frameCounter++%this.REEVALUATE_FRAMES===0){const c=this.playerShip.getTransform().position,h=c.x-Kr,u=c.x+Kr,d=c.y-Kr,g=c.y+Kr;this.cachedRelevantBlocks=this.grid.getBlocksInArea(h,d,u,g)}const i=new Map;for(const[c,h]of this.controllerToShipMap)i.set(h.id,c);const n=new Set;for(const c of this.hunterControllers)n.add(c);for(const c of this.cachedRelevantBlocks){const h=c.ownerShipId;if(!h){console.warn("Block in spatial query missing ownerShipId!",c);continue}const u=i.get(h);u&&n.add(u)}const r=[];for(const c of n)try{const h=c.getShip();if(!h||typeof h.getAllBlocks!="function"){r.push(c);continue}c.update(e)}catch(h){console.error("Error updating AI controller:",h),r.push(c)}for(const c of r)this.removeController(c)}render(e){for(const[i,n]of this.controllerToShipMap)try{typeof i.render=="function"&&i.render(e)}catch(r){console.error("Error rendering AI controller:",r)}}};fl.instance=null;let uu=fl;class km{constructor(e,i){this.projectileSystem=e,this.playerShip=i,this.fireSoundTimer=0,this.wasFiringLastFrame=!1}update(e,i,n,r){const c=i.getFiringPlan().filter(y=>y.block.type.id.startsWith("turret")||y.block.type.id.startsWith("cockpit"));if(c.length===0)return;const{fireRateMulti:h=1}=i.getAffixes(),u=r==null?void 0:r.aimAt,d=(r==null?void 0:r.firePrimary)??!1,g=(r==null?void 0:r.firingMode)??Ht.Synced;this.fireSoundTimer++;for(const y of c)y.timeSinceLastShot+=e;const m=d&&!this.wasFiringLastFrame;this.wasFiringLastFrame=d,!(!d||!u)&&(g===Ht.Synced?this.handleSyncedFiring(c,i,n,u,h,e):g===Ht.Sequence&&this.handleSequenceFiring(c,i,n,u,h,e,m))}handleSyncedFiring(e,i,n,r,c,h){for(let u=e.length-1;u>=0;u--){const d=e[u];i.getBlockCoord(d.block)&&(d.timeSinceLastShot<d.fireCooldown/c||(this.spawnTurretProjectile(i,n,d,r),d.timeSinceLastShot=0))}}handleSequenceFiring(e,i,n,r,c,h,u){const d=new Map;for(const m of e){const y=m.block.type.id;d.has(y)||d.set(y,[]),d.get(y).push(m)}const g=i.turretSequenceState;for(const[m,y]of d.entries()){if(y.length===0)continue;const M=y[0].fireCooldown/c,b=M/y.length;let C=g[m];if(C||(C=g[m]={nextIndex:0,lastFiredAt:b}),u){const w=y.find(A=>A.timeSinceLastShot>=M);if(w){const A=y.indexOf(w);this.spawnTurretProjectile(i,n,w,r),w.timeSinceLastShot=0,C.nextIndex=(A+1)%y.length,C.lastFiredAt=0;continue}}if(C.lastFiredAt+=h,C.lastFiredAt>=b){const w=y[C.nextIndex%y.length];if(!i.getBlockCoord(w.block))continue;w.timeSinceLastShot>=M&&(this.spawnTurretProjectile(i,n,w,r),w.timeSinceLastShot=0,C.nextIndex=(C.nextIndex+1)%y.length,C.lastFiredAt=0)}}}spawnTurretProjectile(e,i,n,r){const{coord:c,block:h}=n;n.timeSinceLastShot=0;const u=c.x*32,d=c.y*32,g=Math.cos(i.rotation),m=Math.sin(i.rotation),y=i.position.x+u*g-d*m,v=i.position.y+u*m+d*g,M=h.type.behavior.fire,b=h.type.id,C=gp[b]??gp.turret0;this.fireSoundTimer>5&&(Jt(e,this.playerShip,{file:"assets/sounds/sfx/weapons/turret_00.wav",channel:"sfx",pitchRange:[.7,1.4],volumeJitter:.2,baseVolume:1,maxSimultaneous:7}),this.fireSoundTimer=0),this.projectileSystem.spawnProjectile({x:y,y:v},r,M.fireType,M.fireDamage,M.projectileSpeed??300,M.lifetime??2,M.accuracy??1,e.id,e.getFaction(),C,"delayed")}render(e){}}class Bm{constructor(e){this.laserSystem=e,this.fireEligibility=new WeakMap}update(e,i,n,r){if(!(r!=null&&r.fireSecondary)){this.fireEligibility.set(i,!1);return}const c=i.getEnergyComponent();if(!c)return;if(!(this.fireEligibility.get(i)??!1))if(c.getCurrent()>=15)this.fireEligibility.set(i,!0);else return;i.getAllBlocks().filter(([d,g])=>{var m,y;return g.type.id.startsWith("laser")&&((m=g.type.behavior)==null?void 0:m.canFire)&&((y=g.type.behavior.fire)==null?void 0:y.fireType)==="laser"}).length!==0&&this.laserSystem.queueUpdate(i,n,r)}render(e){}}class Rm{constructor(e,i,n,r,c){this.combatService=e,this.particleManager=i,this.grid=n,this.explosionSystem=r,this.playerShip=c,this.activeLances=[]}update(e,i,n,r){const c=i.getFiringPlan().filter(d=>{var g,m;return((m=(g=d.block.type.behavior)==null?void 0:g.fire)==null?void 0:m.fireType)==="explosiveLance"});if(c.length===0)return;const h=r==null?void 0:r.aimAt,u=(r==null?void 0:r.firePrimary)??!1;for(let d=c.length-1;d>=0;d--){const g=c[d];if(!i.getBlockCoord(g.block)||(g.timeSinceLastShot+=e,!u||g.timeSinceLastShot<g.fireCooldown))continue;g.timeSinceLastShot=0;const m=g.block.type.behavior.fire,y=m.lifetime??1.5,v=g.coord,M=Math.cos(n.rotation),b=Math.sin(n.rotation),C=v.x*32,w=v.y*32,A=n.position.x+C*M-w*b,R=n.position.y+C*b+w*M,I=h.x-A,_=h.y-R;if(Math.sqrt(I*I+_*_)===0)continue;let N=Math.atan2(_,I);const W=(1-(m.accuracy??1))*Math.PI/8;N+=(Math.random()*2-1)*W;const z=Math.cos(N)*(m.projectileSpeed??300),q=Math.sin(N)*(m.projectileSpeed??300),ie=mo[g.block.type.id]??["#ccc","#aaa","#888"],ee=this.particleManager.emitParticle({x:A,y:R},{colors:ie,baseSpeed:0,sizeRange:[4,4],lifeRange:[m.lifetime??1.5,(m.lifetime??1.5)+.1],velocity:{x:z,y:q}}),K=ti({x:A,y:R,radius:600,color:ie[0],intensity:.9,life:y+.4,expires:!0});$e.getInstance().registerLight(K),Jt(i,this.playerShip,{file:"assets/sounds/sfx/weapons/lance_00.wav",channel:"sfx",baseVolume:.8,pitchRange:[.8,1.2],volumeJitter:.1,maxSimultaneous:3}),this.activeLances.push({position:{x:A,y:R},velocity:{x:z,y:q},fireDamage:m.fireDamage??10,explosionDamage:m.explosionDamage??30,explosionRadius:m.explosionRadiusBlocks??2,detonationDelay:m.detonationDelayMs/1e3,elapsed:0,stuck:!1,targetBlock:null,targetShip:null,coord:null,ownerShipId:i.id,particle:ee,ttl:y,age:0,emissionAccumulatorTrail:0,emissionAccumulatorStuck:0,firingBlockId:g.block.type.id,light:K})}this.updateLances(e,i)}updateLances(e,i){const n=new Set;for(const r of this.activeLances){r.age+=e;const c=mo[r.firingBlockId]??["#ccc","#aaa","#888"];r.emissionAccumulatorTrail+=e*20;const h=Math.floor(r.emissionAccumulatorTrail);r.emissionAccumulatorTrail-=h;for(let d=0;d<h;d++)this.particleManager.emitParticle(r.position,{colors:c,baseSpeed:20,sizeRange:[1,2],lifeRange:[.3,.5],fadeOut:!0});if(r.age>r.ttl&&!r.stuck){this.particleManager.removeParticle(r.particle),n.add(r);continue}if(r.stuck){if(r.targetShip&&r.anchorOffset){const m=r.targetShip.getTransform().position;r.position.x=m.x+r.anchorOffset.x,r.position.y=m.y+r.anchorOffset.y,r.particle.x=r.position.x,r.particle.y=r.position.y}r.emissionAccumulatorStuck+=e*20;const d=Math.floor(r.emissionAccumulatorStuck);r.emissionAccumulatorStuck-=d;const g=mo[r.firingBlockId]??["#ccc","#aaa","#888"];for(let m=0;m<d;m++)this.particleManager.emitParticle(r.position,{colors:g,baseSpeed:300,sizeRange:[1,3],lifeRange:[.4,.9],fadeOut:!0});r.elapsed+=e,r.elapsed>=r.detonationDelay&&(this.explodeLance(r,i),n.add(r));continue}r.position.x+=r.velocity.x*e,r.position.y+=r.velocity.y*e,r.light.x=r.position.x,r.light.y=r.position.y;const u=this.grid.getRelevantCells(r.position);for(const d of u){const g=this.grid.getBlocksInCellByCoords(d.x,d.y,i.getFaction());for(const m of g){if(m.ownerShipId===r.ownerShipId||!m.position)continue;const y=r.position.x-m.position.x,v=r.position.y-m.position.y;if(Math.sqrt(y*y+v*v)<32){const b=Bu(m),C=b?Sm(m,b):null;if(b&&C){r.stuck=!0,r.targetBlock=m,r.targetShip=b,r.coord=C;const w=b.getTransform().position;if(r.anchorOffset={x:r.position.x-w.x,y:r.position.y-w.y},r.velocity={x:0,y:0},r.particle.vx=0,r.particle.vy=0,r.particle.life=r.detonationDelay+.2,r.particle.size*=1.25,Jt(this.playerShip,i,{file:"assets/sounds/sfx/weapons/lance_01.wav",channel:"sfx",baseVolume:.9,pitchRange:[.8,1.2],volumeJitter:.1,maxSimultaneous:5}),Ee.emit("camera:shake",{strength:6,duration:.16,frequency:10}),this.combatService.applyDamageToBlock(b,i,m,C,r.fireDamage,"explosiveLance",this.playerShip)){this.explodeLance(r,i),n.add(r);continue}}break}}}}this.activeLances=this.activeLances.filter(r=>!n.has(r))}explodeLance(e,i){var r;if(!e.targetShip||!e.coord)return;$e.getInstance().removeLight(e.light.id);const n=e.targetShip.getBlocksWithinGridDistance(e.coord,e.explosionRadius);for(const c of n){const h=e.targetShip.getBlockCoord(c);h&&(this.explosionSystem.createBlockExplosion(e.targetShip.getTransform().position,e.targetShip.getTransform().rotation,h,e.explosionRadius*64,.7,(r=mo[e.firingBlockId])==null?void 0:r[0],mo[e.firingBlockId]),this.combatService.applyDamageToBlock(e.targetShip,i,c,h,e.explosionDamage,"explosiveLanceAoE",this.playerShip))}this.particleManager.removeParticle(e.particle)}render(e){}}class Em{constructor(e,i,n,r){this.combatService=e,this.particleManager=i,this.grid=n,this.ship=r,this.orbiters=[],this.tierPhases=new Map,this.energyRingSprites=new Map,this.gl=ii.getInstance().getWebGLContext("entitygl"),this.spriteRenderer=ll.getInstance(this.gl),this.energyRingSprites=new Map([["energyRing0",ho("energyRing0")],["energyRing1",ho("energyRing1")],["energyRing2",ho("energyRing2")],["energyRing3",ho("energyRing3")],["energyRing4",ho("energyRing4")]])}render(e){}update(e,i,n,r){const c=this.ship.getHaloBladeBlocks(),h=Array.from(c.keys());this.orbiters=this.orbiters.filter(m=>c.has(m.block));for(const m of h)if(!this.orbiters.find(y=>y.block===m)){const y=c.get(m);this.orbiters.push({block:m,angle:0,radius:y.orbitingRadius,position:{x:0,y:0},sprite:this.energyRingSprites.get(y.sprite)})}const u=i.getTransform().position,d=new Map;for(const m of this.orbiters){const y=m.block.type.id;d.has(y)||d.set(y,[]),d.get(y).push(m)}for(const[m,y]of d.entries()){if(y.length===0)continue;const v=c.get(y[0].block);if(!v)continue;const M=i.getFiringMode()===Ht.Sequence,b=M?1:-1;let C=this.tierPhases.get(m)??Math.random()*Math.PI*2;C+=v.orbitingSpeed*e*b,this.tierPhases.set(m,C),y.sort((A,R)=>{const I=A.block.id,_=R.block.id;return I.localeCompare(_)});const w=y.length;for(let A=0;A<w;A++){const R=y[A],I=C+A/w*Math.PI*2;R.angle=I,R.radius=v.orbitingRadius;const _=M?R.radius:R.radius*.5;R.position.x=u.x+Math.cos(I)*_,R.position.y=u.y+Math.sin(I)*_,om.add({texture:R.sprite.texture,worldX:R.position.x,worldY:R.position.y,widthPx:64,heightPx:64,alpha:1}),this.particleManager.emitParticle(R.position,{colors:[v.color,"#fff"],baseSpeed:0,sizeRange:[.8,1.2],lifeRange:[.3,.8],fadeOut:!0,light:!0,lightRadiusScalar:32,lightIntensity:.7})}}const g=new Set(d.keys());for(const m of this.tierPhases.keys())g.has(m)||this.tierPhases.delete(m);for(const m of this.orbiters){const y=c.get(m.block);if(!y)continue;const v=m.position.x,M=m.position.y,b=this.grid.getRelevantCells({x:v,y:M});for(const C of b){const w=this.grid.getBlocksInCellByCoords(C.x,C.y,i.getFaction());for(const A of w){if(!A.position)continue;const R=v-A.position.x,I=M-A.position.y;if(Math.sqrt(R*R+I*I)<y.size/2+16){const x=Bu(A),N=x==null?void 0:x.getBlockCoord(A);x&&N&&this.combatService.applyDamageToBlock(x,i,A,N,y.damage,"haloBlade",this.ship)}}}}}}class Im{constructor(){this.wasPressedLastFrame=new WeakMap}update(e,i,n,r){var d;const c=!!(r!=null&&r.toggleShields),h=this.wasPressedLastFrame.get(i)??!1;if(this.wasPressedLastFrame.set(i,c),!c||h)return;const u=(d=i.getShieldComponent)==null?void 0:d.call(i);u&&u.hasShieldBlocks()&&(u.isActive()?(Q.play("assets/sounds/sfx/ship/energy-shield-reverse_00.wav","sfx",{maxSimultaneous:3}),u.deactivate()):(Q.play("assets/sounds/sfx/ship/energy-shield_00.wav","sfx",{maxSimultaneous:3}),u.activate()))}}class Eu{constructor(e,i){this.controller=e,this.ship=i}}class lT extends Eu{update(){return{movement:{thrustForward:!1,brake:!1,rotateLeft:!1,rotateRight:!1,strafeLeft:!1,strafeRight:!1},weapons:{firePrimary:!1,fireSecondary:!1,aimAt:{x:0,y:0}},utility:{toggleShields:!1}}}transitionIfNeeded(){return null}}class cT{constructor(e,i,n,r,c){this.hunter=!1,this.ship=e,this.movementSystem=i,this.weaponSystem=n,this.utilitySystem=r,this.behaviorProfile=c,this.currentState=new lT(this,e)}update(e){if(!(!this.ship||!this.ship.getTransform))try{const i=this.currentState.update(e);this.movementSystem.setIntent(i.movement),this.weaponSystem.setIntent(i.weapons),this.movementSystem.update(e),this.utilitySystem.setIntent(i.utility),this.utilitySystem.update(e,this.ship,this.ship.getTransform()),this.weaponSystem.update(e,this.ship,this.ship.getTransform());const n=this.currentState.transitionIfNeeded();n&&(this.currentState=n)}catch(i){console.error("Error in AIControllerSystem update:",i)}}render(e){try{this.weaponSystem.render(e)}catch(i){console.error("Error in AIControllerSystem render:",i)}}getShip(){return this.ship}getBehaviorProfile(){return this.behaviorProfile}getCurrentState(){return this.currentState}getCurrentStateString(){return this.currentState.constructor.name}setHunter(e){this.hunter=e}isHunter(){return this.hunter}}function hT(a,e){const i=e.x-a.x,n=e.y-a.y;return Math.sqrt(i*i+n*n)}function bo(a,e){return{x:a.x-e.x,y:a.y-e.y}}function sn(a){const e=Math.sqrt(a.x*a.x+a.y*a.y);return e===0?{x:0,y:0}:{x:a.x/e,y:a.y/e}}function fu(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function on(a,e){return a.x*e.x+a.y*e.y}function _m(a,e){let i=(e-a+Math.PI)%(2*Math.PI);return i<0&&(i+=2*Math.PI),i-Math.PI}function uT(a,e,i){return{x:a.x+e.x*i,y:a.y+e.y*i}}function fT(a){const e=a*(Math.PI/180),i=Math.sin(e),n=Math.cos(e);return{x:i,y:-n}}function dT(a,e){const i=Math.cos(e),n=Math.sin(e);return{x:a.x*i-a.y*n,y:a.x*n+a.y*i}}function Iu(a){var r;let e=0,i=0;const n=a.getTransform().rotation;for(const[c,h]of a.getAllBlocks()){if(!((r=h.type.behavior)!=null&&r.canThrust))continue;const u=h.type.behavior.thrustPower??5,d=fT(h.rotation??0),g=dT(d,n);e+=g.x*u,i+=g.y*u}return sn({x:e,y:i})}function xm(a,e,i){return hT(a,e)<=i}function gT(a,e){const i=a.getTransform().position,n=Iu(a),r=bo(e,i),c=sn(r),h=on(n,c);return Math.acos(Math.max(-1,Math.min(1,h)))}function pT(a,e,i=.15){return gT(a,e)<=i}function Dm(a,e,i){const n=a.getTransform().position,r=bo(e,n),c=fu(r),h=sn(r),u=pT(a,e,.15),d=on(i,h);let g=!1,m=!1;c<100?m=d>10:u&&(g=!0);const y=Iu(a),v=Math.atan2(h.y,h.x),M=Math.atan2(y.y,y.x),b=_m(M,v),C=b<-.05,w=b>.05;return{thrustForward:g,brake:m,rotateLeft:C,rotateRight:w,strafeLeft:!1,strafeRight:!1}}function Wp(a,e,i,n){const r=a.getTransform().position,c=bo(i,r),u=fu(c)-n,d=sn(c),g={x:-d.y,y:d.x},m=Iu(a),y=Math.atan2(g.y,g.x),v=Math.atan2(m.y,m.x),M=_m(v,y),b=.05,C=M<-.05,w=M>b;let A=!1,R=!1;const I=fu(e),_=I>0?on(sn(e),g):0,x=_<.5;if(u>20)A=!0;else if(u<-40){const N=sn(bo(r,i));(I>0?on(sn(e),N):0)<.6?A=!0:R=!1}else x?A=!0:_>.7&&u<0&&(R=!0);return{thrustForward:A,brake:R,rotateLeft:C,rotateRight:w,strafeLeft:!1,strafeRight:!1}}function mT(a,e,i,n){const r=bo(e,a),c=on(i,i)-n*n,h=2*on(r,i),u=on(r,r),d=h*h-4*c*u;if(d<0||Math.abs(c)<1e-5)return e;const g=Math.sqrt(d),m=(-h-g)/(2*c),y=(-h+g)/(2*c),v=Math.max(m,y);return uT(e,i,Math.max(v,0))}class yT extends Eu{constructor(e,i,n){super(e,i),this.disengageRange=1400,this.orbitRadius=300,this.projectileSpeed=400,this.phase=0,this.phaseTimer=0,this.ramDuration=10,this.orbitDuration=10,this.target=n}update(e){const i=this.controller.getBehaviorProfile().attack,n=this.ship.getTransform(),r=this.target.getTransform();if(i==="ram"){if(this.phase===0?this.ship.isColliding()&&(this.phase=1,this.phaseTimer=0):this.phase===1&&(this.phaseTimer+=e,this.phaseTimer>=this.orbitDuration&&(this.phase=0,this.phaseTimer=0)),this.phase===0)return{movement:Dm(this.ship,r.position,n.velocity),weapons:{firePrimary:!1,fireSecondary:!1,aimAt:r.position},utility:{toggleShields:!0}};if(this.phase===1)return{movement:Wp(this.ship,n.velocity,r.position,this.orbitRadius),weapons:{firePrimary:!1,fireSecondary:!1,aimAt:r.position},utility:{toggleShields:!1}}}return i==="orbit"?{movement:Wp(this.ship,n.velocity,r.position,this.orbitRadius),weapons:{firePrimary:!0,fireSecondary:!1,aimAt:mT(n.position,r.position,r.velocity,this.projectileSpeed)},utility:{toggleShields:!1}}:{movement:{thrustForward:!1,brake:!1,rotateLeft:!1,rotateRight:!1,strafeLeft:!1,strafeRight:!1},weapons:{firePrimary:!1,fireSecondary:!1,aimAt:r.position},utility:{toggleShields:!1}}}transitionIfNeeded(){const e=this.ship.getTransform(),i=this.target.getTransform();return xm(e.position,i.position,this.disengageRange)?null:new Pm(this.controller,this.ship,this.target)}}class Pm extends Eu{constructor(e,i,n){super(e,i),this.engagementRange=1200,this.target=n}update(){const e=this.ship.getTransform(),i=this.target.getTransform();return{movement:Dm(this.ship,i.position,e.velocity),weapons:{firePrimary:!1,fireSecondary:!1,aimAt:i.position},utility:{toggleShields:!1}}}transitionIfNeeded(){const e=this.ship.getTransform(),i=this.target.getTransform();return xm(e.position,i.position,this.engagementRange)?new yT(this.controller,this.ship,this.target):null}}class vT{constructor(e,i,n,r,c,h,u,d,g,m,y){this.grid=e,this.registry=i,this.orchestrator=n,this.playerShip=r,this.particleManager=c,this.projectileSystem=h,this.laserSystem=u,this.combatService=d,this.explosionSystem=g,this.collisionSystem=m,this.shipConstructionAnimator=y}async createShip(e,i,n,r=!1,c=AS,h={},u=Rs.Enemy){const d=await nT(`${e}.json`,this.grid);d.setAffixes(h),d.setFaction(u);const g={color:"#ff0000",radius:96,intensity:.8},m=d.getTransform();m.position.x=i,m.position.y=n,this.registry.add(d);const y=new Mm(this.particleManager),v=new Cm(d,y,this.collisionSystem),M=new Tm(new km(this.projectileSystem,this.playerShip),new Bm(this.laserSystem),new Rm(this.combatService,this.particleManager,this.grid,this.explosionSystem,this.playerShip),new Em(this.combatService,this.particleManager,this.grid,d)),b=new wm(new Im),C=new cT(d,v,M,b,c);return C.currentState=new Pm(C,d,this.playerShip),C.setHunter(r),this.orchestrator.addController(C),d.hideAllBlocks(),d.updateBlockPositions(),this.shipConstructionAnimator.animateShipConstruction(d,g),{ship:d,controller:C}}}const zp=0;class bT{constructor(e,i,n,r,c,h,u,d,g,m,y,v,M,b){this.waves=e,this.shipRegistry=i,this.aiOrchestrator=n,this.playerShip=r,this.projectileSystem=c,this.laserSystem=h,this.particleManager=u,this.grid=d,this.combatService=g,this.explosionSystem=m,this.collisionSystem=y,this.shipConstructionAnimator=v,this.incidentSystem=M,this.popupMessageSystem=b,this.currentWaveIndex=zp,this.elapsedTime=0,this.timeSinceStart=0,this.isRunning=!1,this.isPaused=!1,this.hasSpawnedFirstWave=!1,this.initialDelay=10,this.defaultWaveInterval=120,this.interWaveDelay=10,this.interWaveCountdown=-1,this.waitingToSpawnNextWave=!1,this.activeWave=null,this.activeShips=new Set,this.activeControllers=new Map,this.onMissionComplete=null,this.missionCompleteTriggered=!1,this.shipFactory=new vT(this.grid,this.shipRegistry,this.aiOrchestrator,this.playerShip,this.particleManager,this.projectileSystem,this.laserSystem,this.combatService,this.explosionSystem,this.collisionSystem,this.shipConstructionAnimator)}setMissionCompleteHandler(e){this.onMissionComplete=e}start(){this.isRunning=!0,this.timeSinceStart=0}pause(){this.isPaused=!0}resume(){this.isPaused=!1}getIsRunning(){return this.isRunning}getIsPaused(){return this.isPaused}update(e){var i,n;if(!(!this.isRunning||this.isPaused)){if(!this.hasSpawnedFirstWave){if(this.timeSinceStart+=e,this.timeSinceStart<this.initialDelay)return;const r=this.waves[this.currentWaveIndex];this.spawnWave(r),this.currentWaveIndex++,this.elapsedTime=0,this.hasSpawnedFirstWave=!0;return}if(this.waitingToSpawnNextWave){if(this.interWaveCountdown-=e,this.interWaveCountdown<=0&&(this.waitingToSpawnNextWave=!1,this.currentWaveIndex<this.waves.length)){const r=this.waves[this.currentWaveIndex];this.spawnWave(r),this.currentWaveIndex++,this.elapsedTime=0}return}if(!(((i=this.activeWave)==null?void 0:i.type)==="boss"&&!this.activeWave.isComplete)){if(this.shouldCompleteMission()){this.missionCompleteTriggered||(this.missionCompleteTriggered=!0,console.log("Mission completed!"),(n=this.onMissionComplete)==null||n.call(this),this.onMissionComplete=null);return}if(this.elapsedTime+=e,this.currentWaveIndex<this.waves.length){const r=this.waves[this.currentWaveIndex],c=r.waveDurationSeconds??this.defaultWaveInterval;this.elapsedTime>=c&&(Ce.incrementWavesCleared(),this.spawnWave(r),this.currentWaveIndex++,this.elapsedTime=0)}}}}shouldCompleteMission(){const e=this.currentWaveIndex>=this.waves.length,i=this.activeShips.size===0,n=!this.waitingToSpawnNextWave;return e&&i&&n}clearCurrentWave(){for(const e of this.activeShips){this.shipRegistry.remove(e);const i=this.activeControllers.get(e);i&&(this.aiOrchestrator.removeController(i),this.activeControllers.delete(e)),e.destroy()}this.activeShips.clear(),this.activeWave&&this.incidentSystem.clear(this.activeWave.id)}async spawnWave(e){var n;console.log(`Spawning wave ${e.id} (type: ${e.type})`),this.activeWave={id:e.id,type:e.type,mods:e.mods,isComplete:!1},e.type==="boss"&&this.clearCurrentWave();const i=[];for(const r of e.ships)for(let c=0;c<r.count;c++){const h=e.type==="boss"?(Math.random()-.5)*200:Math.random()*an-an/2,u=e.type==="boss"?(Math.random()-.5)*200:Math.random()*ca-ca/2,{ship:d,controller:g}=await this.shipFactory.createShip(r.shipId,h,u,r.hunter??!1,r.behaviorProfile,r.affixes??{});this.applyModifiers(d,e.mods),this.activeShips.add(d),this.activeControllers.set(d,g),i.push(d)}for(const r of e.incidents??[])Math.random()<=r.spawnChance&&(console.log(`[WaveSpawner] Triggering incident '${r.script}' (wave ${e.id})`),this.incidentSystem.trigger(r.script,r.options??{},e.id));e.type==="boss"?(Q.playMusic(e.music??{file:"assets/sounds/music/track_03_boss.mp3"}),this.popupMessageSystem.displayMessage("⚠ DANGER ⚠",{color:"#ff5555",duration:4,glow:!0,font:"28px monospace"}),(n=e.lightingSettings)!=null&&n.clearColor,this.monitorBossWaveCompletion(i)):this.popupMessageSystem.displayMessage("Wave "+e.id,{color:"#00ff00",duration:3,glow:!0,font:"28px monospace"})}skipToNextWave(){var i;if(this.currentWaveIndex>=this.waves.length||(this.activeWave&&(this.activeWave.isComplete=!0),this.currentWaveIndex>=this.waves.length))return;const e=this.waves[this.currentWaveIndex];if(((i=this.activeWave)==null?void 0:i.type)==="boss"){this.waitingToSpawnNextWave=!0,this.interWaveCountdown=this.interWaveDelay,this.activeWave=null;return}this.spawnWave(e),this.currentWaveIndex++,this.elapsedTime=0,this.waitingToSpawnNextWave=!1}applyModifiers(e,i){for(const n of i)switch(n){case"shielded":break;case"extra-aggressive":break;default:console.warn(`Unknown wave modifier: ${n}`)}}monitorBossWaveCompletion(e){const i=new Set(e);for(const n of e)n.onDestroyedCallback(()=>{var r;i.has(n)&&(i.delete(n),i.size===0&&((r=this.activeWave)==null?void 0:r.type)==="boss"&&(this.activeWave.isComplete=!0,console.log(`Boss wave ${this.activeWave.id} defeated.`),this.currentWaveIndex>=this.waves.length||(this.waitingToSpawnNextWave=!0,this.interWaveCountdown=this.interWaveDelay)))})}getCurrentWaveNumber(){return this.currentWaveIndex}getTimeUntilNextWave(){var n;if(this.waitingToSpawnNextWave)return Math.ceil(this.interWaveCountdown);if(this.currentWaveIndex===0&&this.timeSinceStart<this.initialDelay)return Math.ceil(this.initialDelay-this.timeSinceStart);if(((n=this.activeWave)==null?void 0:n.type)==="boss"&&!this.activeWave.isComplete||this.shouldCompleteMission())return-1;const e=this.waves[this.currentWaveIndex],i=(e==null?void 0:e.waveDurationSeconds)??this.defaultWaveInterval;return Math.max(0,i-this.elapsedTime)}isBossWaveActive(){var e;return((e=this.activeWave)==null?void 0:e.type)==="boss"&&!this.activeWave.isComplete}isBossWaveComplete(){var e;return((e=this.activeWave)==null?void 0:e.type)==="boss"&&this.activeWave.isComplete}notifyShipDestruction(e){this.activeShips.has(e)&&Ce.incrementKillCount(),this.activeShips.delete(e),this.activeControllers.get(e)&&this.activeControllers.delete(e)}reset(){this.clearCurrentWave(),this.currentWaveIndex=zp,this.isRunning=!1,this.hasSpawnedFirstWave=!1,this.elapsedTime=0,this.timeSinceStart=0,this.interWaveCountdown=-1,this.waitingToSpawnNextWave=!1,this.activeWave=null,this.activeShips.clear(),this.activeControllers.clear(),this.onMissionComplete=null,this.missionCompleteTriggered=!1}}function ST(a){Ee.emit("incident:minimap:marker",a)}function Gp(a){Ee.emit("incident:minimap:clear",{id:a})}class Lm{constructor(e,i,n,r){this.minimapRegistered=!1,this.id=e,this.options=i,this.waveId=n,this.context=r}getId(){return this.id}getWaveId(){return this.waveId}getMinimapIcon(){return null}onTrigger(){const e=this.getMinimapIcon(),{x:i,y:n}=this.options;e&&typeof i=="number"&&typeof n=="number"&&(ST({id:this.id,icon:e,x:i,y:n}),this.minimapRegistered=!0)}onComplete(){this.minimapRegistered&&(Gp(this.id),this.minimapRegistered=!1),Ce.incrementIncidentsCompleted()}destroy(){this.minimapRegistered&&(Gp(this.id),this.minimapRegistered=!1)}}class MT extends Lm{constructor(e,i,n,r){super(e,i,n,r),this.elapsed=0,this.lifetime=5,this.nextLogTime=0}getMinimapIcon(){return"skullAndBones"}onTrigger(){super.onTrigger(),console.log(`[BlackHoleIncident] Triggered at (${this.options.x}, ${this.options.y})`),this.context.popupMessageSystem.displayMessage("⚠ BLACK HOLE SPAWNED ⚠",{color:"#ff5555",duration:3,glow:!0,font:"28px monospace"})}update(e){this.elapsed+=e,this.elapsed>=this.nextLogTime&&(console.log(`[BlackHoleIncident] ${this.elapsed.toFixed(1)}s elapsed (id=${this.getId()})`),this.nextLogTime=Math.ceil(this.elapsed))}isComplete(){return this.elapsed>=this.lifetime}onComplete(){console.log(`[BlackHoleIncident] Complete (total time: ${this.elapsed.toFixed(1)}s)`)}destroy(){console.log(`[BlackHoleIncident] Destroyed prematurely (elapsed: ${this.elapsed.toFixed(1)}s)`)}}class CT extends Lm{constructor(e,i,n,r){super(e,i,n,r),this.elapsed=0,this.lifetime=6,this.nextLogTime=0}getMinimapIcon(){return"greenCross"}onTrigger(){console.log(`[HealingBeaconIncident] Deployed at (${this.options.x}, ${this.options.y})`),this.context.popupMessageSystem.displayMessage("✨ Healing Beacon Online ✨",{color:"#00ffaa",duration:3,font:"26px monospace",glow:!0})}update(e){this.elapsed+=e,this.elapsed>=this.nextLogTime&&(console.log(`[HealingBeaconIncident] Active for ${this.elapsed.toFixed(1)}s (id=${this.getId()})`),this.nextLogTime=Math.ceil(this.elapsed))}isComplete(){return this.elapsed>=this.lifetime}onComplete(){console.log(`[HealingBeaconIncident] Completed after ${this.elapsed.toFixed(1)}s`)}destroy(){console.log(`[HealingBeaconIncident] Destroyed early at ${this.elapsed.toFixed(1)}s`)}}class TT{constructor(){this.scriptConstructors=new Map,this.registerAll()}registerAll(){this.register("BlackHoleIncident",MT),this.register("HealingBeaconIncident",CT)}register(e,i){if(this.scriptConstructors.has(e)){console.warn(`[IncidentRegistry] Duplicate script ID: '${e}'`);return}this.scriptConstructors.set(e,i)}has(e){return this.scriptConstructors.has(e)}create(e,i,n,r){const c=this.scriptConstructors.get(e);return c?new c(e,i,n,r):(console.warn(`[IncidentRegistry] Unknown incident script ID: '${e}'`),null)}getRegisteredScriptIds(){return Array.from(this.scriptConstructors.keys())}}class wT{constructor(e){this.activeIncidents=new Map,this.registry=new TT,this.context=e}trigger(e,i={},n){const r=this.registry.create(e,i,n,this.context);if(!r){console.warn(`[IncidentOrchestrator] Unknown incident script: '${e}'`);return}const c=r.getId();if(this.activeIncidents.has(c)){console.warn(`[IncidentOrchestrator] Duplicate incident ID '${c}' — skipping trigger.`);return}this.activeIncidents.set(c,r),r.onTrigger()}update(e){var i,n;for(const[r,c]of this.activeIncidents)c.update(e),c.isComplete()&&((i=c.onComplete)==null||i.call(c),(n=c.destroy)==null||n.call(c),this.activeIncidents.delete(r))}render(e){var n;const i=this.context.canvasManager;for(const r of this.activeIncidents.values())(n=r.render)==null||n.call(r,i,e)}clear(e){var i;for(const[n,r]of this.activeIncidents)(e===void 0||r.getWaveId()===e)&&((i=r.destroy)==null||i.call(r),this.activeIncidents.delete(n))}destroy(){var e;for(const i of this.activeIncidents.values())(e=i.destroy)==null||e.call(i);this.activeIncidents.clear()}getActiveCount(){return this.activeIncidents.size}getActiveIncidentIds(){return Array.from(this.activeIncidents.keys())}}class Om extends ku{constructor(e,i,n){super(e,i,n)}update(e){const i=this.transform;i.position.x+=i.velocity.x*e,i.position.y+=i.velocity.y*e,i.rotation+=i.angularVelocity*e,this.updateBlockPositions()}onDestroyed(){}}const tu=new Map;async function AT(a){if(tu.has(a))return tu.get(a);const e=Mi(`/assets/environment/asteroids/${a}`),i=await fetch(e).then(n=>n.json());return tu.set(a,i),i}async function kT(a,e){const i=await AT(a),n=new Om(e,[],{position:i.transform.position,rotation:i.transform.rotation,velocity:{x:0,y:0},angularVelocity:0});for(const r of i.blocks){const c=Fb(r.id);if(!c)throw new Error(`Unknown block type: ${r.id}`);const h={id:crypto.randomUUID(),ownerFaction:Rs.Neutral,type:c,hp:c.armor,ownerShipId:n.id,position:{x:0,y:0},rotation:r.rotation};n.placeBlock(r.coord,h)}return n}class BT{constructor(e,i){this.grid=e,this.registry=i}async createAsteroid(e,i,n={x:0,y:0},r=0){const c=await kT(e+".json",this.grid),h=c.getTransform();return h.position={...i},h.velocity={...n},h.angularVelocity=r,this.registry.add(c),c}}const RT={id:"asteroid-field-01",asteroids:[{asteroidId:"asteroid_0_00",count:100},{asteroidId:"asteroid_0_01",count:100}],velocityRange:{x:[-50,50],y:[-50,50]},angularVelocityRange:[-1,1]},ET={id:"asteroid-field-02",bounds:{x:-2e3,y:-1500,width:4e3,height:3e3},density:.8,velocityRange:{x:[-.2,.2],y:[-.1,.1]},angularVelocityRange:[-.1,.1],asteroids:[{asteroidId:"asteroid_0_00",count:30},{asteroidId:"asteroid_0_01",count:20},{asteroidId:"asteroid_0_02",count:15}]},IT=new Map([["asteroid-field-01",RT],["asteroid-field-02",ET]]);function _T(a){return IT.get(a)}class xT{constructor(e,i){this.factory=new BT(e,i)}spawnFieldById(e){const i=_T(e);if(!i){console.warn(`[AsteroidSpawningSystem] Unknown field id: ${e}`);return}this.spawnField(i)}spawnField(e){var n,r;const i=e.bounds??{x:rl.x-an/2,y:rl.y-ca/2,width:an,height:ca};for(const c of e.asteroids)for(let h=0;h<c.count;h++){const u=i.x+Math.random()*i.width,d=i.y+Math.random()*i.height,g=this.randomInRange(((n=e.velocityRange)==null?void 0:n.x)??[-.1,.1]),m=this.randomInRange(((r=e.velocityRange)==null?void 0:r.y)??[-.1,.1]),y=this.randomInRange(e.angularVelocityRange??[-.05,.05]);this.factory.createAsteroid(c.asteroidId,{x:u,y:d},{x:g,y:m},y)}}randomInRange([e,i]){return e+Math.random()*(i-e)}}class DT{constructor(e,i,n,r){this.camera=i,this.cullingSystem=n,this.inputManager=r,this.ctx=e.getContext("entities")}render(){const e=this.cullingSystem.getVisibleObjects();for(const i of e){if(i instanceof Et)continue;const n=i.getTransform(),{position:r,rotation:c}=n,h=this.camera.worldToScreen(r.x,r.y);this.ctx.save(),this.ctx.translate(h.x,h.y),this.ctx.scale(this.camera.getZoom(),this.camera.getZoom()),this.ctx.rotate(c);let u=null,d=null;for(const[g,m]of i.getAllBlocks()){i instanceof Om?(d=this.getAsteroidDamageLevel(m.hp,m.type.armor??1),u=zb(m.type.id,d)):(d=Xp(m.hp,m.type.armor??1),u=hi(m.type.id,d));const y=g.x*G,v=g.y*G,M=(m.rotation??0)*(Math.PI/180);this.ctx.save(),this.ctx.translate(y,v),this.ctx.rotate(M),this.ctx.drawImage(u.base,-32/2,-32/2,G,G),this.ctx.restore()}this.ctx.restore()}}getAsteroidDamageLevel(e,i){const n=e/i;return n<.25?Qr.CRUMBLING:n<.75?Qr.FRACTURED:Qr.NONE}}class PT{constructor(e,i,n,r){this.explosionSystem=e,this.pickupSpawner=i,this.destructionService=n,this.floatingTextManager=r}applyDamageToBlock(e,i,n,r,c,h="scripted",u=null){var M,b,C,w,A,R;if(n.indestructible||i.getFaction()===e.getFaction())return!1;const d=ji.getEnemyPower();if(u!=null&&u.getIsPlayerShip()&&!(e instanceof Et&&e.getIsPlayerShip())?c/=d:!(u!=null&&u.getIsPlayerShip())&&e instanceof Et&&e.getIsPlayerShip()&&(c*=d),n.isShielded&&e instanceof Et){const I=(M=e.getEnergyComponent)==null?void 0:M.call(e),_=n.shieldEfficiency??0;if(_>0){const x=Math.random()*5+5,N=we.getInstance().isLightingEnabled()&&h!=="collision"?{lightRadiusScalar:x,lightIntensity:1.2,lightLifeScalar:.5,lightColor:"#00ffff"}:void 0,W=Math.max(.001,_),z=c/W;if(I&&I.spend(z))return n.position&&(Jt(e,u,{file:"assets/sounds/sfx/ship/energy-shield-hit_00.wav",channel:"sfx",baseVolume:.65,pitchRange:[2,2.5],volumeJitter:.1,maxSimultaneous:5}),this.explosionSystem.createShieldDeflection(n.position,n.shieldSourceId??"shield0",N)),!1}}n.hp-=c;const m=we.getInstance().isLightingEnabled()&&h!=="collision"?{lightRadiusScalar:12,lightIntensity:1,lightLifeScalar:.7,lightColor:h==="laser"?"#00ffff":void 0}:void 0;if(n.position){let I=!0;(h==="laser"||h==="collision")&&(I=Math.random()<.2),I&&this.explosionSystem.createExplosion(n.position,20,.3,void 0,ta,m);const _=e.getTransform().position.x+r.x,x=e.getTransform().position.y+r.y;(b=this.floatingTextManager)==null||b.createWorldText(`${Math.floor(c)}`,_,x,Ct.getInstance(),10,"monospace",.8,140,1,"#FFFFFF",{impactScale:1.5},n.ownerShipId)}if(Jt(e,u,{file:"assets/sounds/sfx/explosions/hit_00.wav",channel:"sfx",baseVolume:.25,pitchRange:[.2,.4],volumeJitter:.1,maxSimultaneous:3}),n.hp>0)return!1;if(r.x===0&&r.y===0)return this.destructionService.destroyEntity(e,h),!0;const v=n.type.id.startsWith("cockpit");if(this.explosionSystem.createBlockExplosion(e.getTransform().position,e.getTransform().rotation,r,70*(v?2:1),.7*(v?2:1),void 0,ta),Jt(e,u,{file:"assets/sounds/sfx/explosions/explosion_00.wav",channel:"sfx",baseVolume:1,pitchRange:[.7,1],volumeJitter:.2,maxSimultaneous:3}),this.pickupSpawner.spawnPickupOnBlockDestruction(n),e.removeBlock(r),e instanceof Et&&((C=e.getIsPlayerShip)!=null&&C.call(e))&&Ce.incrementBlocksLost(1),e instanceof Et){if(v)return this.destructionService.destroyEntity(e,h),Jt(e,u,{file:"assets/sounds/sfx/explosions/explosion_01.wav",channel:"sfx",baseVolume:.8,pitchRange:[.7,1],volumeJitter:.2}),!0;const I=(w=e.getCockpitCoord)==null?void 0:w.call(e);if(!I)return!0;const _=vm(e,I),x=e.getBlockMap(),N=[],W=[];for(const[q,ie]of x.entries()){if(_.has(q))continue;const ee=tn(q);this.explosionSystem.createBlockExplosion(e.getTransform().position,e.getTransform().rotation,ee,60+Math.random()*20,.5+Math.random()*.3,void 0,ta),this.pickupSpawner.spawnPickupOnBlockDestruction(ie),N.push(ee),W.push(ie)}N.length>0&&(e.removeBlocks(N,W),e instanceof Et&&((A=e.getIsPlayerShip)!=null&&A.call(e))&&Ce.incrementBlocksLost(N.length));const z=Array.from(e.getBlockMap().values());if(z.length===1&&z[0].type.id.startsWith("cockpit")){const q=(R=e.getCockpitCoord)==null?void 0:R.call(e);if(q){const ie=z[0];this.explosionSystem.createBlockExplosion(e.getTransform().position,e.getTransform().rotation,q,140,1.2,void 0,ta),this.pickupSpawner.spawnPickupOnBlockDestruction(ie),e.removeBlock(q),this.destructionService.destroyEntity(e,h),Jt(e,u,{file:"assets/sounds/sfx/explosions/explosion_01.wav",channel:"sfx",baseVolume:.8,pitchRange:[.7,1],volumeJitter:.2})}}}return!0}}class LT{constructor(e){this.shipRegistry=e}update(e){var i;for(const n of this.shipRegistry.getAll()){const r=n.getEnergyComponent(),c=n.getShieldComponent();if(r&&(r.update(e),c.isActive())){let h=0;for(const g of n.getShieldBlocks()){const m=((i=g.type.behavior)==null?void 0:i.shieldEnergyDrain)??0;h+=m}const u=h*e;r.spend(u)||c.deactivate()}}}}function OT(a,e){const i="assets/sounds/sfx/ship/engine_loop_00.wav";return a&&!e?(Q.startLoop(i,"sfx",{volume:1,pitch:1,pan:0}),!0):!a&&e?(Q.stopLoop(i),!1):e}function FT({inputManager:a,pause:e,resume:i,shipBuilderMenu:n,pauseMenu:r,settingsMenu:c,blockDropDecisionMenu:h,menuManager:u}){const d=a.wasActionJustPressed("openShipBuilder"),g=a.wasActionJustPressed("pause"),m=u.getTop();if(d){if(h.isOpen())return;if(!c.isOpen()&&!r.isOpen()&&!n.isOpen()&&!h.isOpen())if(console.log("Attempting to open blockDropDecisionMenu..."),h.hasBlocksInQueue()){console.log("Called openMenu on blockDropDecisionMenu"),h.openMenu();return}else console.log("No blocks in queue, not opening blockDropDecisionMenu"),Q.play("assets/sounds/sfx/ui/error_00.wav","sfx");console.log("Failed to open blockDropDecisionMenu");return}if(g){if(h.isOpen())return;m?(u.pop(),u.anyOpen()||i()):(e(),u.open(r))}}class UT{constructor(e,i){this.grid=e,this.camera=i}getVisibleShips(){return this.queryShipsInBounds(250)}getActiveAIShips(){return this.queryShipsInBounds(2e3)}queryShipsInBounds(e){const i=this.camera.getViewportBounds(),n=i.x-e,r=i.y-e,c=i.x+i.width+e,h=i.y+i.height+e,u=this.grid.getBlocksInArea(n,r,c,h),d=new Set;for(const g of u){const m=Wt.getObject(g);m&&m instanceof Et&&d.add(m)}return Array.from(d)}}class NT{constructor(e,i){this.grid=e,this.camera=i}getVisibleObjects(){const e=this.camera.getViewportBounds();return this.queryObjectsInBounds(e.x,e.y,e.x+e.width,e.y+e.height)}getNearbyObjects(){const e=this.camera.getViewportBounds(),i=2e3;return this.queryObjectsInBounds(e.x-i,e.y-i,e.x+e.width+i,e.y+e.height+i)}queryObjectsInBounds(e,i,n,r){const c=this.grid.getBlocksInArea(e,i,n,r),h=new Set;for(const u of c){const d=Wt.getObject(u);d&&h.add(d)}return Array.from(h)}}class HT{constructor(e){this.registry=e}update(e){for(const i of this.registry.getAll())i.update(e)}}function WT(a){const e=new Et(a,void 0,void 0,!0,void 0,Rs.Player);return e.setIsPlayerShip(!0),e.placeBlockById({x:0,y:-3},"hull1"),e.placeBlockById({x:0,y:0},"cockpit1"),e.placeBlockById({x:0,y:-1},"hull1"),e.placeBlockById({x:0,y:-2},"turret1"),e.placeBlockById({x:-1,y:-1},"fin1"),e.placeBlockById({x:1,y:-1},"fin1",90),e.placeBlockById({x:1,y:0},"hull1"),e.placeBlockById({x:-1,y:0},"hull1"),e.placeBlockById({x:2,y:0},"turret1",90),e.placeBlockById({x:-2,y:0},"turret1"),e.placeBlockById({x:0,y:1},"engine1"),e.placeBlockById({x:-1,y:1},"engine1"),e.placeBlockById({x:1,y:1},"engine1"),e.hideAllBlocks(),e.setFiringMode(Ht.Sequence),e}class zT extends ku{constructor(e,i,n){super(e,i,n),this.setImmoveable(!0)}update(e){}onDestroyed(){}placeBlockById(e,i,n){const r=ci(i);if(!r)throw new Error(`Unknown block type: ${i}`);const c=this.calculateBlockWorldPosition(e),h={ownerFaction:Rs.Neutral,id:crypto.randomUUID(),type:r,hp:r.armor,ownerShipId:this.id,position:c,...n!==void 0?{rotation:n}:{}};this.placeBlock(e,h)}}function GT(a){const e=new zT(a);return e.placeBlockById({x:-1e4,y:1e4},"hull1"),e}class VT{constructor(e=256){this.cells=new Map,this.factionCells=new Map,this.cellSize=e}getCellCoords(e,i){return[Math.floor(e/this.cellSize),Math.floor(i/this.cellSize)]}getOrCreateCell(e,i,n){let r=e.get(i);r||(r=new Map,e.set(i,r));let c=r.get(n);return c||(c=[],r.set(n,c)),c}getFactionMap(e){let i=this.factionCells.get(e);return i||(i=new Map,this.factionCells.set(e,i)),i}getCellSources(e){if(!e)return[this.cells];const i=[];for(const[n,r]of this.factionCells)n!==e&&i.push(r);return i}addBlockToCell(e){const{x:i,y:n}=e.position,[r,c]=this.getCellCoords(i,n),h=this.getOrCreateCell(this.cells,r,c);h.includes(e)||h.push(e);const u=this.getFactionMap(e.ownerFaction),d=this.getOrCreateCell(u,r,c);d.includes(e)||d.push(e)}removeBlockFromCell(e){const{x:i,y:n}=e.position,[r,c]=this.getCellCoords(i,n),h=this.cells.get(r),u=h==null?void 0:h.get(c);if(u){const m=u.indexOf(e);m!==-1&&u.splice(m,1)}const d=this.getFactionMap(e.ownerFaction).get(r),g=d==null?void 0:d.get(c);if(g){const m=g.indexOf(e);m!==-1&&g.splice(m,1)}}removeBlocksFromCells(e){for(const i of e)this.removeBlockFromCell(i)}getBlocksInCell(e,i,n){const[r,c]=this.getCellCoords(e,i);return this.getBlocksInCellByCoords(r,c,n)}getBlocksInCellByCoords(e,i,n){const r=this.getCellSources(n),c=[];for(const h of r){const u=h.get(e);if(!u)continue;const d=u.get(i);d&&c.push(...d)}return c}getRelevantCells(e){const i=Math.floor(e.x/this.cellSize),n=Math.floor(e.y/this.cellSize),r=[];for(let c=-1;c<=1;c++)for(let h=-1;h<=1;h++)r.push({x:i+c,y:n+h});return r}getAllBlocksInCells(e,i,n,r,c){const h=[],u=this.getCellSources(c);for(let d=e;d<=n;d++)for(let g=i;g<=r;g++)for(const m of u){const y=m.get(d);if(!y)continue;const v=y.get(g);v&&h.push(...v)}return h}getBlocksInArea(e,i,n,r,c){const h=Math.floor(e/this.cellSize),u=Math.floor(i/this.cellSize),d=Math.floor(n/this.cellSize),g=Math.floor(r/this.cellSize);return this.getAllBlocksInCells(h,u,d,g,c)}getBlocksAlongRay(e,i,n=0,r){const c=new Set,h=i.x-e.x,u=i.y-e.y,d=h>0?1:-1,g=u>0?1:-1,m=Math.abs(this.cellSize/h),y=Math.abs(this.cellSize/u);let v=Math.floor(e.x/this.cellSize),M=Math.floor(e.y/this.cellSize);const b=Math.floor(i.x/this.cellSize),C=Math.floor(i.y/this.cellSize),w=h>0?(v+1)*this.cellSize-e.x:e.x-v*this.cellSize,A=u>0?(M+1)*this.cellSize-e.y:e.y-M*this.cellSize;let R=Math.abs(w/h),I=Math.abs(A/u);const _=500;let x=[[0,0]];if(n>0){const N=n/2,W=Math.sqrt(h*h+u*u),z=h/W,ie=-(u/W),ee=z,K=Math.ceil(N/this.cellSize),le=new Set;x=[];for(let Z=-K;Z<=K;Z++){const se=Math.round(ie*Z),D=Math.round(ee*Z),X=se<<8^D;le.has(X)||(le.add(X),x.push([se,D]))}}for(let N=0;N<_;N++){for(const[W,z]of x){const q=v+W,ie=M+z,ee=this.getBlocksInCellByCoords(q,ie,r);for(const K of ee)c.add(K)}if(v===b&&M===C)break;R<I?(R+=m,v+=d):(I+=y,M+=g)}return Array.from(c)}getFirstBlockAlongRay(e,i,n){const r=i.x-e.x,c=i.y-e.y,h=Math.sqrt(r*r+c*c);if(h===0)return null;const u={x:r/h,y:c/h},d=this.getBlocksAlongRay(e,i,0,n);let g=null,m=1/0;for(const y of d){const v=y.position,M=this.cellSize/2,b={x:v.x-M,y:v.y-M},C={x:v.x+M,y:v.y+M},w=XT(e,u,b,C);w.hit&&w.tmin>=0&&w.tmin<m&&w.tmin<=h&&(m=w.tmin,g={block:y,point:{x:e.x+u.x*w.tmin,y:e.y+u.y*w.tmin}})}return g}clear(){this.cells.clear(),this.factionCells.clear()}}function XT(a,e,i,n){const r=1/e.x,c=1/e.y;let h=(i.x-a.x)*r,u=(n.x-a.x)*r,d=(i.y-a.y)*c,g=(n.y-a.y)*c;const m=Math.max(Math.min(h,u),Math.min(d,g));return{hit:Math.min(Math.max(h,u),Math.max(d,g))>=Math.max(0,m),tmin:m}}class YT{constructor(e,i,n,r){this.camera=i,this.particleManager=n,this.lightingOrchestrator=r,this.explosions=[],this.ctx=e.getContext("fx")}createExplosion(e,i=60,n=.6,r,c,h){if(this.particleManager.emitBurst(e,10+Math.floor(i/10),{colors:c,baseSpeed:200,sizeRange:[1,3],lifeRange:[.4,1],fadeOut:!0}),this.lightingOrchestrator&&we.getInstance().isLightingEnabled()&&h){const u=TS(r),d=ti({x:e.x,y:e.y,radius:i*(h.lightRadiusScalar??5),color:h.lightColor??u,intensity:h.lightIntensity??.3,life:n*(h.lightLifeScalar??1),expires:!0});this.lightingOrchestrator.registerLight(d)}this.explosions.push({position:{...e},size:1,maxSize:i,life:n,maxLife:n,color:r??this.getRandomExplosionColor()})}createBlockExplosion(e,i,n,r=70,c=.7,h,u,d){const m=n.x*32,y=n.y*32,v=Math.cos(i),M=Math.sin(i),b=m*v-y*M,C=m*M+y*v,w=e.x+b,A=e.y+C;this.createExplosion({x:w,y:A},r,c,h,u,d)}createShieldDeflection(e,i,n){const r=fm[i],c=(r==null?void 0:r[0])??"rgba(100, 255, 255, 0.6)",h=r??["#ffff00","#ff9900","#ff6600"],u=n?{...n,lightColor:n.lightColor??bm(r??["#00ffff"])}:void 0;this.createExplosion(e,34,.3,c,h,u)}update(e){for(const i of this.explosions){i.life-=e;const n=1-i.life/i.maxLife;n<.5?i.size=i.maxSize*(n*2):i.size=i.maxSize*(1-(n-.5)*2)}this.explosions=this.explosions.filter(i=>i.life>0)}render(){const e=this.ctx;e.save(),e.scale(this.camera.getZoom(),this.camera.getZoom());for(const i of this.explosions){const n=this.camera.worldToScreen(i.position.x,i.position.y),r=n.x/this.camera.getZoom(),c=n.y/this.camera.getZoom(),h=e.createRadialGradient(r,c,0,r,c,i.size),u=i.life/i.maxLife;h.addColorStop(0,`rgba(255, 255, 200, ${u})`),h.addColorStop(.2,`${i.color}`),h.addColorStop(1,"rgba(0, 0, 0, 0)"),e.globalAlpha=u,e.fillStyle=h,e.beginPath(),e.arc(r,c,i.size,0,Math.PI*2),e.fill()}e.restore()}getRandomExplosionColor(){const e=["rgba(255, 100, 0, 0.8)","rgba(255, 50, 0, 0.8)","rgba(255, 200, 0, 0.8)","rgba(200, 0, 0, 0.8)"];return e[Math.floor(Math.random()*e.length)]}}class qT{constructor(e,i){this.camera=i,this.runWhilePaused=!0,this.effects=[],this.ctx=e.getContext("fx")}createRepairEffect(e,i=48,n=.5){this.effects.push(this.createEffect(e,i,n,"repair"))}createSellEffect(e,i=48,n=.5){this.effects.push(this.createEffect(e,i,n,"sell"))}createEffect(e,i,n,r){const c=this.generateSparkles(e,8+Math.floor(i/8),r);return{kind:r,position:{...e},size:0,maxSize:i,life:n,maxLife:n,color:this.getRandomColor(r),sparkles:c}}generateSparkles(e,i,n){const r=n==="repair"?["#00ffff","#66ffcc","#66ccff","#33ffee","#ccffff"]:["#ff6666","#ff3333","#ff9999","#ff4444","#ff2200"],c=[];for(let h=0;h<i;h++){const u=Math.random()*Math.PI*2,d=20+Math.random()*40;c.push({x:e.x,y:e.y,vx:Math.cos(u)*d,vy:Math.sin(u)*d,size:1+Math.random()*2,life:.4+Math.random()*.4,color:r[Math.floor(Math.random()*r.length)]})}return c}update(e){for(const i of this.effects){i.life-=e;const n=1-i.life/i.maxLife;i.size=n<.5?i.maxSize*(n*2):i.maxSize*(1-(n-.5)*2);for(const r of i.sparkles)r.x+=r.vx*e,r.y+=r.vy*e,r.life-=e;i.sparkles=i.sparkles.filter(r=>r.life>0)}this.effects=this.effects.filter(i=>i.life>0)}render(){const e=this.ctx;e.save(),e.scale(this.camera.getZoom(),this.camera.getZoom());for(const i of this.effects){const n=this.camera.worldToScreen(i.position.x,i.position.y),r=n.x/this.camera.getZoom(),c=n.y/this.camera.getZoom(),h=i.life/i.maxLife,u=e.createRadialGradient(r,c,0,r,c,i.size);u.addColorStop(0,`rgba(255,255,255,${h})`),u.addColorStop(.3,i.color),u.addColorStop(1,"rgba(0,0,0,0)"),e.globalAlpha=h,e.fillStyle=u,e.beginPath(),e.arc(r,c,i.size,0,Math.PI*2),e.fill();for(const d of i.sparkles){const g=this.camera.worldToScreen(d.x,d.y);e.globalAlpha=d.life,e.fillStyle=d.color,e.beginPath(),e.arc(g.x/this.camera.getZoom(),g.y/this.camera.getZoom(),d.size,0,Math.PI*2),e.fill()}}e.restore()}getRandomColor(e){const n={repair:["rgba(100, 255, 255, 0.8)","rgba(100, 255, 200, 0.8)","rgba(150, 255, 240, 0.8)","rgba(120, 255, 220, 0.8)"],sell:["rgba(255, 100, 100, 0.8)","rgba(255, 80, 80, 0.8)","rgba(255, 120, 120, 0.8)","rgba(255, 60, 60, 0.8)"]}[e];return n[Math.floor(Math.random()*n.length)]}}class jT{constructor(e){this.flashes=[];try{this.ctx=e.getContext("overlay"),this.width=e.getWidth(),this.height=e.getHeight()}catch(i){console.error("Failed to initialize ScreenEffectsSystem:",i);const n=document.createElement("canvas");this.ctx=n.getContext("2d"),this.width=1,this.height=1}}createFlash(e="white",i=.5,n=.3){this.flashes.push({color:e,intensity:Math.max(0,Math.min(1,i)),duration:n,currentTime:0})}createExplosionFlash(e=.3){this.createFlash("rgba(255, 255, 220, 1)",e,.2)}createDamageFlash(e=.2){this.createFlash("rgba(255, 0, 0, 1)",e,.15)}update(e){for(const i of this.flashes)i.currentTime+=e;this.flashes=this.flashes.filter(i=>i.currentTime<i.duration)}render(){if(!(!this.ctx||this.flashes.length===0))try{const e=this.ctx;e.clearRect(0,0,this.width,this.height);for(const i of this.flashes){const n=i.currentTime/i.duration,r=i.intensity*(1-n);e.fillStyle=this.getColorWithAlpha(i.color,r),e.fillRect(0,0,this.width,this.height)}}catch(e){console.error("Error rendering screen effects:",e)}}getColorWithAlpha(e,i){if(e.startsWith("rgba"))return e.replace(/[\d.]+\)$/,`${i})`);if(e.startsWith("rgb"))return e.replace("rgb","rgba").replace(")",`, ${i})`);const n=document.createElement("div");n.style.color=e,document.body.appendChild(n);const r=getComputedStyle(n).color;return document.body.removeChild(n),r.replace("rgb","rgba").replace(")",`, ${i})`)}}class ZT{constructor(){var u;this.boundUpdate=d=>this.update(d),this.boundRender=d=>this.render(d),this.menuManager=ws.getInstance(),this.camera=null,this.shipRegistry=li.getInstance(),this.blockObjectRegistry=As.getInstance(),this.grid=null,this.ship=null,this.spaceStation=null,this.engineSoundPlaying=!1,this.updatables=[],this.renderables=[],this.isPaused=!1,this.isDestroyed=!1,this.update=d=>{if(!this.isDestroyed){if(this.engineSoundPlaying=OT(this.inputManager.isKeyPressed("KeyW"),this.engineSoundPlaying),FT({inputManager:this.inputManager,pause:this.pause.bind(this),resume:this.resume.bind(this),shipBuilderMenu:this.shipBuilderMenu,pauseMenu:this.pauseMenu,settingsMenu:this.settingsMenu,blockDropDecisionMenu:this.blockDropDecisionMenu,menuManager:this.menuManager}),this.blockDropDecisionMenu.isOpen()&&(this.blockDropDecisionMenu.update(d),this.ship&&this.blockPlacementController.update(this.ship.getTransform())),this.pauseMenu.isOpen()&&this.pauseMenu.update(),this.settingsMenu.isOpen()&&this.settingsMenu.update(),this.shipBuilderMenu.isOpen()&&this.shipBuilderMenu.update(),this.spaceStationBuilderMenu.isOpen()&&this.spaceStationBuilderMenu.update(),this.inputManager.wasKeyJustPressed("Digit2")&&Be.unlockAllFlags(),this.inputManager.wasKeyJustPressed("Digit1")){const g=["engine1","engine2","engine3","engine4"];this.blockDropDecisionMenu.enqueueBlock(ci(g[Math.floor(Math.random()*g.length)]))}this.inputManager.wasKeyJustPressed("KeyN")&&(this.waveSpawner.getIsPaused()?this.waveSpawner.resume():this.waveSpawner.pause()),this.inputManager.wasKeyJustPressed("Digit0")&&Re.getInstance().addCurrency(1e3),this.inputManager.wasKeyJustPressed("KeyO")&&(this.shipBuilderMenu.isOpen()?(this.shipBuilderMenu.closeMenu(),this.resume()):(this.pause(),this.shipBuilderMenu.openMenu())),this.inputManager.wasKeyJustPressed("KeyU")&&ei.getInstance().unlockAll(),this.inputManager.wasRightBracketPressed()&&this.waveSpawner.skipToNextWave(),this.inputManager.wasKeyJustPressed("KeyI")&&(this.spaceStationBuilderMenu.isOpen()?(this.resume(),console.log("Closing space station builder menu..."),this.spaceStationBuilderMenu.closeMenu()):(this.pause(),console.log("Opening space station builder menu..."),this.spaceStationBuilderMenu.openMenu()));try{if(!this.ship||typeof this.ship.getTransform!="function"||!this.camera)return;const g=this.ship.getTransform();this.camera.adjustZoom(this.inputManager.consumeZoomDelta()),this.camera.follow(g.position),this.camera.update(d),this.shipBuilderMenu.isOpen()&&this.shipBuilderController.update(g),this.spaceStationBuilderMenu.isOpen()&&this.spaceStation&&this.spaceStationBuilderController.update(this.spaceStation.getTransform())}catch(g){console.error("Error getting ship transform:",g)}this.isPaused||this.updatables.forEach(g=>g.update(d)),this.hud.update(d),this.shipBuilderEffects.update(d),this.inputManager.updateFrame(),this.missionDialogueManager.update(d),this.floatingTextManager.update(d),this.coachMarkManager.update(d)}},this.render=d=>{if(!this.ship||this.isDestroyed)return;const g=this.ship.getTransform();if(this.canvasManager.clearLayer("entities"),this.canvasManager.clearLayer("fx"),this.canvasManager.clearLayer("particles"),this.canvasManager.clearLayer("ui"),this.canvasManager.clearLayer("overlay"),this.canvasManager.clearLayer("dialogue"),this.renderables.forEach(m=>m.render(d)),this.camera){const m=this.shipCulling.getVisibleShips(),y=this.lightingOrchestrator.collectVisibleLights(this.camera),v=this.particleManager.getActiveParticles(),M=om.getAndClear();this.unifiedSceneRenderer.render(this.camera,m,y,M,v)}this.shipBuilderEffects.render(),this.shipBuilderMenu.isOpen()&&(this.shipBuilderController.render(this.canvasManager.getContext("entities"),g),this.shipBuilderMenu.render(this.canvasManager.getContext("ui"))),this.blockDropDecisionMenu.isOpen()&&(this.blockDropDecisionMenu.render(this.canvasManager.getContext("ui")),this.blockPlacementController.render(this.canvasManager.getContext("entities"),g)),this.spaceStationBuilderMenu.isOpen()&&this.spaceStation&&(this.spaceStationBuilderController.render(this.canvasManager.getContext("entities"),this.spaceStation.getTransform()),this.spaceStationBuilderMenu.render(this.canvasManager.getContext("ui"))),this.pauseMenu.isOpen()&&this.pauseMenu.render(this.canvasManager.getContext("ui")),this.settingsMenu.isOpen()&&this.settingsMenu.render(this.canvasManager.getContext("ui")),this.cursorRenderer.render()},this.canvasManager=ii.getInstance(),this.inputManager=new $p(this.canvasManager.getCanvas("ui")),this.grid=new VT,this.gameLoop=new Jp,this.camera=Ct.getInstance(ri(),bi()),qb(this.canvasManager.getWebGL2Context("unifiedgl2")),Ab(this.canvasManager.getWebGL2Context("unifiedgl2")),ol(this.canvasManager,this.camera),this.popupMessageSystem=new cM(this.canvasManager),this.lightingOrchestrator=$e.getInstance(),this.particleManager=new fC(this.lightingOrchestrator),Xi.initialize(this.canvasManager,this.camera),this.mission=ji.getMission(),Ce.initialize(),Re.getInstance().initialize(0),ks.getInstance().initialize(),this.ship=WT(this.grid),this.shipRegistry.add(this.ship),this.shipRegistry.setPlayerShip(this.ship),this.shipCulling=new UT(this.grid,this.camera),this.blockObjectCulling=new NT(this.grid,this.camera),this.explosionSystem=new YT(this.canvasManager,this.camera,this.particleManager,this.lightingOrchestrator),this.screenEffects=new jT(this.canvasManager),this.shipBuilderEffects=new qT(this.canvasManager,this.camera),this.cursorRenderer=new Mu(this.canvasManager,this.inputManager,this.ship),this.aiOrchestrator=new uu,this.aiOrchestrator.registerPlayerShip(this.ship),this.shipBuilderMenu=new e2(this.inputManager,this.cursorRenderer),this.settingsMenu=new $2(this.inputManager,this.menuManager,this.canvasManager,this.camera),this.pauseMenu=new J2(this.inputManager,this.handlePlayerFailure.bind(this),this.menuManager),this.menuManager.registerMenu("pauseMenu",this.pauseMenu),this.menuManager.registerMenu("settingsMenu",this.settingsMenu),this.menuManager.registerMenu("shipBuilderMenu",this.shipBuilderMenu),this.menuManager.registerPauseHandlers(this.pause.bind(this),this.resume.bind(this)),this.shipBuilderController=new oT(this.ship,this.shipBuilderMenu,this.camera,this.shipBuilderEffects,this.inputManager),this.shipBuilderMenu.setRepairAllHandler(()=>{this.shipBuilderController.repairAllBlocks()}),this.blockDropDecisionMenu=new z2(this.ship,this.inputManager,this.shipBuilderEffects,this.pause.bind(this),this.resume.bind(this)),this.blockPlacementController=new G2(this.ship,this.blockDropDecisionMenu,this.camera,this.shipBuilderEffects,this.inputManager),this.pickupSystem=new cu(this.canvasManager,this.camera,this.ship,this.particleManager,this.screenEffects,this.popupMessageSystem,this.shipBuilderEffects,this.blockDropDecisionMenu);const n=new iT(this.pickupSystem),r=new rT(this.explosionSystem,n,this.shipRegistry,this.aiOrchestrator);this.floatingTextManager=new JM;const c=new PT(this.explosionSystem,n,r,this.floatingTextManager);this.collisionSystem=new hu(c),this.projectileSystem=new eC(this.canvasManager,this.grid,c,this.particleManager,this.ship),this.laserSystem=new nC(this.canvasManager,this.camera,this.grid,c,this.particleManager,this.ship),this.energyRechargeSystem=new LT(this.shipRegistry),this.background=new zM(this.canvasManager,this.camera,(u=this.mission.environmentSettings)==null?void 0:u.backgroundId),this.asteroidRenderer=new DT(this.canvasManager,this.camera,this.blockObjectCulling,this.inputManager),this.shipConstructionAnimator=new ZM(this.ship,this.camera,this.canvasManager),this.unifiedSceneRenderer=new UM(this.camera,this.inputManager),this.unifiedSceneRenderer.setAmbientLight([.4,.4,.4]),this.blockObjectUpdate=new HT(this.blockObjectRegistry);const h=new Mm(this.particleManager);this.movement=new Cm(this.ship,h,this.collisionSystem),vo.register(this.ship,this.movement),this.weaponSystem=new Tm(new km(this.projectileSystem,this.ship),new Bm(this.laserSystem),new Rm(c,this.particleManager,this.grid,this.explosionSystem,this.ship),new Em(c,this.particleManager,this.grid,this.ship)),this.utilitySystem=new wm(new Im),this.playerController=new mC(this.camera,this.inputManager,this.cursorRenderer,this.ship),this.spaceStationBuilderMenu=new r2(this.inputManager,this.cursorRenderer),this.spaceStation=GT(this.grid),this.spaceStationBuilderController=new l2(this.spaceStation,this.spaceStationBuilderMenu,this.camera,this.shipBuilderEffects,this.inputManager),this.incidentOrchestrator=new wT({canvasManager:this.canvasManager,camera:this.camera,inputManager:this.inputManager,playerShip:this.ship,aiOrchestrator:this.aiOrchestrator,popupMessageSystem:this.popupMessageSystem}),this.waveSpawner=new bT(this.mission.waves,this.shipRegistry,this.aiOrchestrator,this.ship,this.projectileSystem,this.laserSystem,this.particleManager,this.grid,c,this.explosionSystem,this.collisionSystem,this.shipConstructionAnimator,this.incidentOrchestrator,this.popupMessageSystem),this.waveSpawner.setMissionCompleteHandler(()=>this.handlePlayerVictory()),r.onEntityDestroyed((d,g)=>{d instanceof Et&&this.waveSpawner.notifyShipDestruction(d)}),this.planetSystem=new tT(this.ship,this.inputManager,this.camera,this.canvasManager,this.waveSpawner),this.planetSystem.registerPlanetsFromConfigs(ji.getPlanetSpawnConfigs()),this.asteroidSpawner=new xT(this.grid,this.blockObjectRegistry),this.coachMarkManager=new EC,this.missionDialogueManager=new yC(this.inputManager,this.canvasManager,this.waveSpawner,this.ship,this.coachMarkManager),this.wavesOverlay=new lM(this.canvasManager,this.waveSpawner),this.debugOverlay=new hM(this.canvasManager,this.shipRegistry,this.aiOrchestrator),this.hud=new rM(this.canvasManager,this.ship,this.floatingTextManager,this.blockDropDecisionMenu),this.miniMap=new dM(this.canvasManager,this.ship,this.aiOrchestrator,this.planetSystem,ne()),this.updatables=[this.movement,this.projectileSystem,this.laserSystem,this.particleManager,this.aiOrchestrator,this.blockObjectUpdate,this.explosionSystem,Xi.getInstance(),this.screenEffects,this.pickupSystem,this.waveSpawner,this.energyRechargeSystem,{update:d=>{var m;if(!this.ship)return;const g=this.playerController.getIntent();this.movement.setIntent(g.movement),this.weaponSystem.setIntent(g.weapons),this.utilitySystem.setIntent(g.utility);try{this.weaponSystem.update(d,this.ship,this.ship.getTransform()),this.utilitySystem.update(d,this.ship,this.ship.getTransform()),(m=this.ship.getAfterburnerComponent())==null||m.update(d)}catch(y){console.error("Error updating system:",y)}}},this.popupMessageSystem,this.background,this.shipConstructionAnimator,this.planetSystem,this.lightingOrchestrator],this.renderables=[this.background,this.laserSystem,this.pickupSystem,this.asteroidRenderer,this.hud,this.miniMap,this.explosionSystem,Xi.getInstance(),this.screenEffects,this.wavesOverlay,this.debugOverlay,this.popupMessageSystem,this.missionDialogueManager,this.shipConstructionAnimator,this.planetSystem,this.aiOrchestrator,this.floatingTextManager,this.coachMarkManager],this.registerLoopHandlers()}registerLoopHandlers(){this.gameLoop.onUpdate(this.boundUpdate),this.gameLoop.onRender(this.boundRender)}pause(){this.isPaused=!0,this.waveSpawner.pause()}resume(){this.isPaused=!1,this.waveSpawner.resume()}async load(){var e,i;await Promise.all([(i=(e=this.background)==null?void 0:e.load)==null?void 0:i.call(e)])}start(){this.gameLoop.start(),this.asteroidSpawner.spawnFieldById("asteroid-field-01"),this.inputManager.disableAllActions(),setTimeout(()=>{this.ship&&this.shipConstructionAnimator.animateShipConstruction(this.ship,{color:"#ADD8E6",radius:96,intensity:1.25})},1e3),setTimeout(()=>{this.inputManager.enableAllActions(),this.missionDialogueManager.initialize()},4200)}handlePlayerVictory(e=1e4){console.log("Player victorious — debriefing will begin in 10 seconds..."),setTimeout(()=>{Ce.finalize("victory",this.gameLoop.getElapsedSeconds()),this.destroy(),vt.fadeToScene("debriefing")},e)}handlePlayerFailure(){console.log("Player defeated — transitioning to debriefing screen."),Ce.finalize("defeat",this.gameLoop.getElapsedSeconds()),this.destroy(),vt.fadeToScene("debriefing")}destroy(){console.log("EngineRuntime: Performing cleanup before scene transition."),this.isDestroyed=!0,this.gameLoop.offUpdate(this.boundUpdate),this.gameLoop.offRender(this.boundRender),this.gameLoop.stop(),this.waveSpawner.reset(),this.shipRegistry.clear(),this.aiOrchestrator.clear(),Xi.getInstance().clear(),Re.getInstance().postMissionClear(),ks.getInstance().destroy(),vo.clear(),Wt.clear(),Ct.destroy(),ws.getInstance().reset(),ll.destroyInstance(),this.cursorRenderer.destroy(),this.hud.destroy(),this.miniMap.destroy(),this.lightingOrchestrator.destroy(),this.background.destroy(),this.missionDialogueManager.destroy(),this.blockDropDecisionMenu.destroy(),jb(this.canvasManager.getWebGL2Context("unifiedgl2")),this.updatables.length=0,this.renderables.length=0,this.inputManager.destroy(),this.menuManager.reset(),this.ship=null,this.camera=null,this.grid=null,console.log("EngineRuntime: Cleanup complete.")}}let Zs=null;function KT(){const[a,e]=il.useState(!1);return il.useEffect(()=>{let i=!1;return(async()=>{Zs=new ZT;try{await Zs.load(),i||(Zs.start(),e(!0))}catch(r){console.error("Failed to load runtime assets:",r)}})(),()=>{i=!0,Zs==null||Zs.destroy(),Zs=null}},[]),pt.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"black",transition:"opacity 1.5s ease-in-out",opacity:a?0:1,pointerEvents:"none",zIndex:9999}})}function Fm(){try{const a=document.createElement("canvas");return a.getContext("webgl")||a.getContext("experimental-webgl")?{supported:!0}:{supported:!1,error:"WebGL context creation failed"}}catch(a){return{supported:!1,error:a instanceof Error?a.message:"An unknown error occurred"}}}const QT=Fm();console.log("WebGL Support Check:",QT);function $T(){const[a,e]=il.useState(vt.getScene());return il.useEffect(()=>{yu()&&window.electronAPI.toggleFullscreen();const i=Fm();i.supported||console.error("WebGL is not supported on this device or browser. Lighting will not work.",i.error);const n=lt.getFirstAvailableResolution(),r=we.getInstance();r.setViewportWidth(n.width),r.setViewportHeight(n.height);const c=ii.getInstance();ol(c),r.onResolutionChange(()=>{ol(c)});const h=()=>{Q.unlock(),window.removeEventListener("pointerdown",h)};window.addEventListener("pointerdown",h,{once:!0});const u=vt.onSceneChange(e);return setTimeout(()=>{vt.setScene("title")},0),()=>u()},[]),pt.jsxs("div",{id:"canvas-root",children:[pt.jsx("canvas",{id:"background-canvas"}),pt.jsx("canvas",{id:"backgroundgl-canvas"}),pt.jsx("canvas",{id:"entity-canvas"}),pt.jsx("canvas",{id:"entitygl-canvas"}),pt.jsx("canvas",{id:"polygon-canvas"}),pt.jsx("canvas",{id:"fx-canvas"}),pt.jsx("canvas",{id:"particles-canvas"}),pt.jsx("canvas",{id:"lighting-canvas"}),pt.jsx("canvas",{id:"unifiedgl2-canvas"}),pt.jsx("canvas",{id:"ui-canvas"}),pt.jsx("canvas",{id:"overlay-canvas"}),pt.jsx("canvas",{id:"dialogue-canvas"}),a==="mission"&&pt.jsx(KT,{})]})}cb();Yb();wb();Ib();Wb();sS.createRoot(document.getElementById("root")).render(pt.jsx($T,{}));
